(self.webpackChunkmapas_app_angular=self.webpackChunkmapas_app_angular||[]).push([[179],{255:Un=>{function Rt(Ve){return Promise.resolve().then(()=>{var ue=new Error("Cannot find module '"+Ve+"'");throw ue.code="MODULE_NOT_FOUND",ue})}Rt.keys=()=>[],Rt.resolve=Rt,Rt.id=255,Un.exports=Rt},583:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{mr:()=>zt,ez:()=>$s,K0:()=>Pt,JJ:()=>bl,Do:()=>ni,V_:()=>Te,Ye:()=>Kr,S$:()=>Qt,sg:()=>ki,PC:()=>$i,b0:()=>Dt,lw:()=>je,EM:()=>Nn,JF:()=>Ms,w_:()=>it,bD:()=>di,q:()=>jt,Mx:()=>Zn,HT:()=>Vt});var ue=Ve(639);let ne=null;function jt(){return ne}function Vt(z){ne||(ne=z)}class it{}const Pt=new ue.OlP("DocumentToken");let je=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=(0,ue.Yz7)({factory:Ie,token:z,providedIn:"platform"}),z})();function Ie(){return(0,ue.LFG)(He)}const Te=new ue.OlP("Location Initialized");let He=(()=>{class z extends je{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return jt().getBaseHref(this._doc)}onPopState(B){const J=jt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("popstate",B,!1),()=>J.removeEventListener("popstate",B)}onHashChange(B){const J=jt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("hashchange",B,!1),()=>J.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,J,Ee){Qe()?this._history.pushState(B,J,Ee):this.location.hash=Ee}replaceState(B,J,Ee){Qe()?this._history.replaceState(B,J,Ee):this.location.hash=Ee}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(Pt))},z.\u0275prov=(0,ue.Yz7)({factory:_t,token:z,providedIn:"platform"}),z})();function Qe(){return!!window.history.pushState}function _t(){return new He((0,ue.LFG)(Pt))}function mt(z,W){if(0==z.length)return W;if(0==W.length)return z;let B=0;return z.endsWith("/")&&B++,W.startsWith("/")&&B++,2==B?z+W.substring(1):1==B?z+W:z+"/"+W}function Tt(z){const W=z.match(/#|\?|$/),B=W&&W.index||z.length;return z.slice(0,B-("/"===z[B-1]?1:0))+z.slice(B)}function et(z){return z&&"?"!==z[0]?"?"+z:z}let Qt=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=(0,ue.Yz7)({factory:Pn,token:z,providedIn:"root"}),z})();function Pn(z){const W=(0,ue.LFG)(Pt).location;return new Dt((0,ue.LFG)(je),W&&W.origin||"")}const zt=new ue.OlP("appBaseHref");let Dt=(()=>{class z extends Qt{constructor(B,J){if(super(),this._platformLocation=B,this._removeListenerFns=[],null==J&&(J=this._platformLocation.getBaseHrefFromDOM()),null==J)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=J}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return mt(this._baseHref,B)}path(B=!1){const J=this._platformLocation.pathname+et(this._platformLocation.search),Ee=this._platformLocation.hash;return Ee&&B?`${J}${Ee}`:J}pushState(B,J,Ee,We){const ht=this.prepareExternalUrl(Ee+et(We));this._platformLocation.pushState(B,J,ht)}replaceState(B,J,Ee,We){const ht=this.prepareExternalUrl(Ee+et(We));this._platformLocation.replaceState(B,J,ht)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Ee;null===(Ee=(J=this._platformLocation).historyGo)||void 0===Ee||Ee.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(je),ue.LFG(zt,8))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})(),ni=(()=>{class z extends Qt{constructor(B,J){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=J&&(this._baseHref=J)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let J=this._platformLocation.hash;return null==J&&(J="#"),J.length>0?J.substring(1):J}prepareExternalUrl(B){const J=mt(this._baseHref,B);return J.length>0?"#"+J:J}pushState(B,J,Ee,We){let ht=this.prepareExternalUrl(Ee+et(We));0==ht.length&&(ht=this._platformLocation.pathname),this._platformLocation.pushState(B,J,ht)}replaceState(B,J,Ee,We){let ht=this.prepareExternalUrl(Ee+et(We));0==ht.length&&(ht=this._platformLocation.pathname),this._platformLocation.replaceState(B,J,ht)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Ee;null===(Ee=(J=this._platformLocation).historyGo)||void 0===Ee||Ee.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(je),ue.LFG(zt,8))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})(),Kr=(()=>{class z{constructor(B,J){this._subject=new ue.vpe,this._urlChangeListeners=[],this._platformStrategy=B;const Ee=this._platformStrategy.getBaseHref();this._platformLocation=J,this._baseHref=Tt(Bi(Ee)),this._platformStrategy.onPopState(We=>{this._subject.emit({url:this.path(!0),pop:!0,state:We.state,type:We.type})})}path(B=!1){return this.normalize(this._platformStrategy.path(B))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(B,J=""){return this.path()==this.normalize(B+et(J))}normalize(B){return z.stripTrailingSlash(function(z,W){return z&&W.startsWith(z)?W.substring(z.length):W}(this._baseHref,Bi(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._platformStrategy.prepareExternalUrl(B)}go(B,J="",Ee=null){this._platformStrategy.pushState(Ee,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+et(J)),Ee)}replaceState(B,J="",Ee=null){this._platformStrategy.replaceState(Ee,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+et(J)),Ee)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(B=0){var J,Ee;null===(Ee=(J=this._platformStrategy).historyGo)||void 0===Ee||Ee.call(J,B)}onUrlChange(B){this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(J=>{this._notifyUrlChangeListeners(J.url,J.state)}))}_notifyUrlChangeListeners(B="",J){this._urlChangeListeners.forEach(Ee=>Ee(B,J))}subscribe(B,J,Ee){return this._subject.subscribe({next:B,error:J,complete:Ee})}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(Qt),ue.LFG(je))},z.normalizeQueryParams=et,z.joinWithSlash=mt,z.stripTrailingSlash=Tt,z.\u0275prov=(0,ue.Yz7)({factory:Tn,token:z,providedIn:"root"}),z})();function Tn(){return new Kr((0,ue.LFG)(Qt),(0,ue.LFG)(je))}function Bi(z){return z.replace(/\/index.html$/,"")}var _n=(()=>((_n=_n||{})[_n.Decimal=0]="Decimal",_n[_n.Percent=1]="Percent",_n[_n.Currency=2]="Currency",_n[_n.Scientific=3]="Scientific",_n))(),Xn=(()=>((Xn=Xn||{})[Xn.Zero=0]="Zero",Xn[Xn.One=1]="One",Xn[Xn.Two=2]="Two",Xn[Xn.Few=3]="Few",Xn[Xn.Many=4]="Many",Xn[Xn.Other=5]="Other",Xn))(),pt=(()=>((pt=pt||{})[pt.Decimal=0]="Decimal",pt[pt.Group=1]="Group",pt[pt.List=2]="List",pt[pt.PercentSign=3]="PercentSign",pt[pt.PlusSign=4]="PlusSign",pt[pt.MinusSign=5]="MinusSign",pt[pt.Exponential=6]="Exponential",pt[pt.SuperscriptingExponent=7]="SuperscriptingExponent",pt[pt.PerMille=8]="PerMille",pt[pt.Infinity=9]="Infinity",pt[pt.NaN=10]="NaN",pt[pt.TimeSeparator=11]="TimeSeparator",pt[pt.CurrencyDecimal=12]="CurrencyDecimal",pt[pt.CurrencyGroup=13]="CurrencyGroup",pt))();function Lr(z,W){const B=(0,ue.cg1)(z),J=B[ue.wAp.NumberSymbols][W];if(void 0===J){if(W===pt.CurrencyDecimal)return B[ue.wAp.NumberSymbols][pt.Decimal];if(W===pt.CurrencyGroup)return B[ue.wAp.NumberSymbols][pt.Group]}return J}const tr=ue.kL8,Oe=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function on(z){const W=parseInt(z);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+z);return W}class xn{}let hr=(()=>{class z extends xn{constructor(B){super(),this.locale=B}getPluralCategory(B,J){switch(tr(J||this.locale)(B)){case Xn.Zero:return"zero";case Xn.One:return"one";case Xn.Two:return"two";case Xn.Few:return"few";case Xn.Many:return"many";default:return"other"}}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(ue.soG))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})();function Zn(z,W){W=encodeURIComponent(W);for(const B of z.split(";")){const J=B.indexOf("="),[Ee,We]=-1==J?[B,""]:[B.slice(0,J),B.slice(J+1)];if(Ee.trim()===W)return decodeURIComponent(We)}return null}class ln{constructor(W,B,J,Ee){this.$implicit=W,this.ngForOf=B,this.index=J,this.count=Ee}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let ki=(()=>{class z{constructor(B,J,Ee){this._viewContainer=B,this._template=J,this._differs=Ee,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(B){this._ngForOf=B,this._ngForOfDirty=!0}set ngForTrackBy(B){this._trackByFn=B}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(B){B&&(this._template=B)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const B=this._ngForOf;if(!this._differ&&B)try{this._differ=this._differs.find(B).create(this.ngForTrackBy)}catch(J){throw new Error(`Cannot find a differ supporting object '${B}' of type '${function(z){return z.name||typeof z}(B)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const B=this._differ.diff(this._ngForOf);B&&this._applyChanges(B)}}_applyChanges(B){const J=[];B.forEachOperation((Ee,We,ht)=>{if(null==Ee.previousIndex){const Gt=this._viewContainer.createEmbeddedView(this._template,new ln(null,this._ngForOf,-1,-1),null===ht?void 0:ht),Zt=new Gr(Ee,Gt);J.push(Zt)}else if(null==ht)this._viewContainer.remove(null===We?void 0:We);else if(null!==We){const Gt=this._viewContainer.get(We);this._viewContainer.move(Gt,ht);const Zt=new Gr(Ee,Gt);J.push(Zt)}});for(let Ee=0;Ee<J.length;Ee++)this._perViewChange(J[Ee].view,J[Ee].record);for(let Ee=0,We=this._viewContainer.length;Ee<We;Ee++){const ht=this._viewContainer.get(Ee);ht.context.index=Ee,ht.context.count=We,ht.context.ngForOf=this._ngForOf}B.forEachIdentityChange(Ee=>{this._viewContainer.get(Ee.currentIndex).context.$implicit=Ee.item})}_perViewChange(B,J){B.context.$implicit=J.item}static ngTemplateContextGuard(B,J){return!0}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.s_b),ue.Y36(ue.Rgc),ue.Y36(ue.ZZ4))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),z})();class Gr{constructor(W,B){this.record=W,this.view=B}}let $i=(()=>{class z{constructor(B,J,Ee){this._ngEl=B,this._differs=J,this._renderer=Ee,this._ngStyle=null,this._differ=null}set ngStyle(B){this._ngStyle=B,!this._differ&&B&&(this._differ=this._differs.find(B).create())}ngDoCheck(){if(this._differ){const B=this._differ.diff(this._ngStyle);B&&this._applyChanges(B)}}_setStyle(B,J){const[Ee,We]=B.split(".");null!=(J=null!=J&&We?`${J}${We}`:J)?this._renderer.setStyle(this._ngEl.nativeElement,Ee,J):this._renderer.removeStyle(this._ngEl.nativeElement,Ee)}_applyChanges(B){B.forEachRemovedItem(J=>this._setStyle(J.key,null)),B.forEachAddedItem(J=>this._setStyle(J.key,J.currentValue)),B.forEachChangedItem(J=>this._setStyle(J.key,J.currentValue))}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.SBq),ue.Y36(ue.aQg),ue.Y36(ue.Qsj))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),z})();let bl=(()=>{class z{constructor(B){this._locale=B}transform(B,J,Ee){if(!function(z){return!(null==z||""===z||z!=z)}(B))return null;Ee=Ee||this._locale;try{return function(z,W,B){return function(z,W,B,J,Ee,We,ht=!1){let Gt="",Zt=!1;if(isFinite(z)){let pr=function(z){let J,Ee,We,ht,Gt,W=Math.abs(z)+"",B=0;for((Ee=W.indexOf("."))>-1&&(W=W.replace(".","")),(We=W.search(/e/i))>0?(Ee<0&&(Ee=We),Ee+=+W.slice(We+1),W=W.substring(0,We)):Ee<0&&(Ee=W.length),We=0;"0"===W.charAt(We);We++);if(We===(Gt=W.length))J=[0],Ee=1;else{for(Gt--;"0"===W.charAt(Gt);)Gt--;for(Ee-=We,J=[],ht=0;We<=Gt;We++,ht++)J[ht]=Number(W.charAt(We))}return Ee>22&&(J=J.splice(0,21),B=Ee-1,Ee=1),{digits:J,exponent:B,integerLen:Ee}}(z);ht&&(pr=function(z){if(0===z.digits[0])return z;const W=z.digits.length-z.integerLen;return z.exponent?z.exponent+=2:(0===W?z.digits.push(0,0):1===W&&z.digits.push(0),z.integerLen+=2),z}(pr));let jn=W.minInt,bn=W.minFrac,Sn=W.maxFrac;if(We){const mo=We.match(Oe);if(null===mo)throw new Error(`${We} is not a valid digit info`);const Qr=mo[1],qr=mo[3],Ps=mo[5];null!=Qr&&(jn=on(Qr)),null!=qr&&(bn=on(qr)),null!=Ps?Sn=on(Ps):null!=qr&&bn>Sn&&(Sn=bn)}!function(z,W,B){if(W>B)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${B}).`);let J=z.digits,Ee=J.length-z.integerLen;const We=Math.min(Math.max(W,Ee),B);let ht=We+z.integerLen,Gt=J[ht];if(ht>0){J.splice(Math.max(z.integerLen,ht));for(let bn=ht;bn<J.length;bn++)J[bn]=0}else{Ee=Math.max(0,Ee),z.integerLen=1,J.length=Math.max(1,ht=We+1),J[0]=0;for(let bn=1;bn<ht;bn++)J[bn]=0}if(Gt>=5)if(ht-1<0){for(let bn=0;bn>ht;bn--)J.unshift(0),z.integerLen++;J.unshift(1),z.integerLen++}else J[ht-1]++;for(;Ee<Math.max(0,We);Ee++)J.push(0);let Zt=0!==We;const pr=W+z.integerLen,jn=J.reduceRight(function(bn,Sn,Mn,Hr){return Hr[Mn]=(Sn+=bn)<10?Sn:Sn-10,Zt&&(0===Hr[Mn]&&Mn>=pr?Hr.pop():Zt=!1),Sn>=10?1:0},0);jn&&(J.unshift(jn),z.integerLen++)}(pr,bn,Sn);let Mn=pr.digits,Hr=pr.integerLen;const ro=pr.exponent;let mr=[];for(Zt=Mn.every(mo=>!mo);Hr<jn;Hr++)Mn.unshift(0);for(;Hr<0;Hr++)Mn.unshift(0);Hr>0?mr=Mn.splice(Hr,Mn.length):(mr=Mn,Mn=[0]);const bi=[];for(Mn.length>=W.lgSize&&bi.unshift(Mn.splice(-W.lgSize,Mn.length).join(""));Mn.length>W.gSize;)bi.unshift(Mn.splice(-W.gSize,Mn.length).join(""));Mn.length&&bi.unshift(Mn.join("")),Gt=bi.join(Lr(B,J)),mr.length&&(Gt+=Lr(B,Ee)+mr.join("")),ro&&(Gt+=Lr(B,pt.Exponential)+"+"+ro)}else Gt=Lr(B,pt.Infinity);return Gt=z<0&&!Zt?W.negPre+Gt+W.negSuf:W.posPre+Gt+W.posSuf,Gt}(z,function(z,W="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},J=z.split(";"),Ee=J[0],We=J[1],ht=-1!==Ee.indexOf(".")?Ee.split("."):[Ee.substring(0,Ee.lastIndexOf("0")+1),Ee.substring(Ee.lastIndexOf("0")+1)],Gt=ht[0],Zt=ht[1]||"";B.posPre=Gt.substr(0,Gt.indexOf("#"));for(let jn=0;jn<Zt.length;jn++){const bn=Zt.charAt(jn);"0"===bn?B.minFrac=B.maxFrac=jn+1:"#"===bn?B.maxFrac=jn+1:B.posSuf+=bn}const pr=Gt.split(",");if(B.gSize=pr[1]?pr[1].length:0,B.lgSize=pr[2]||pr[1]?(pr[2]||pr[1]).length:0,We){const jn=Ee.length-B.posPre.length-B.posSuf.length,bn=We.indexOf("#");B.negPre=We.substr(0,bn).replace(/'/g,""),B.negSuf=We.substr(bn+jn).replace(/'/g,"")}else B.negPre=W+B.posPre,B.negSuf=B.posSuf;return B}(function(z,W){return(0,ue.cg1)(z)[ue.wAp.NumberFormats][W]}(W,_n.Decimal),Lr(W,pt.MinusSign)),W,pt.Group,pt.Decimal,B)}(function(z){if("string"==typeof z&&!isNaN(Number(z)-parseFloat(z)))return Number(z);if("number"!=typeof z)throw new Error(`${z} is not a number`);return z}(B),Ee,J)}catch(We){throw function(z,W){return Error(`InvalidPipeArgument: '${W}' for pipe '${(0,ue.AaK)(z)}'`)}(z,We.message)}}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.soG,16))},z.\u0275pipe=ue.Yjl({name:"number",type:z,pure:!0}),z})();let $s=(()=>{class z{}return z.\u0275fac=function(B){return new(B||z)},z.\u0275mod=ue.oAB({type:z}),z.\u0275inj=ue.cJS({providers:[{provide:xn,useClass:hr}]}),z})();const di="browser";let Nn=(()=>{class z{}return z.\u0275prov=(0,ue.Yz7)({token:z,providedIn:"root",factory:()=>new jo((0,ue.LFG)(Pt),window)}),z})();class jo{constructor(W,B){this.document=W,this.window=B,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const B=function(z,W){const B=z.getElementById(W)||z.getElementsByName(W)[0];if(B)return B;if("function"==typeof z.createTreeWalker&&z.body&&(z.body.createShadowRoot||z.body.attachShadow)){const J=z.createTreeWalker(z.body,NodeFilter.SHOW_ELEMENT);let Ee=J.currentNode;for(;Ee;){const We=Ee.shadowRoot;if(We){const ht=We.getElementById(W)||We.querySelector(`[name="${W}"]`);if(ht)return ht}Ee=J.nextNode()}}return null}(this.document,W);B&&(this.scrollToElement(B),this.attemptFocus(B))}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=W)}}scrollToElement(W){const B=W.getBoundingClientRect(),J=B.left+this.window.pageXOffset,Ee=B.top+this.window.pageYOffset,We=this.offset();this.window.scrollTo(J-We[0],Ee-We[1])}attemptFocus(W){return W.focus(),this.document.activeElement===W}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=Ao(this.window.history)||Ao(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch(W){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(W){return!1}}}function Ao(z){return Object.getOwnPropertyDescriptor(z,"scrollRestoration")}class Ms{}},639:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{deG:()=>X,tb:()=>$x,AFp:()=>Vx,ip1:()=>Y_,CZH:()=>Kh,hGG:()=>IT,z2F:()=>Lf,sBO:()=>gE,Sil:()=>Ff,_Vd:()=>$h,EJc:()=>Hx,SBq:()=>ac,qLn:()=>ia,vpe:()=>lc,gxx:()=>iu,tBr:()=>wc,XFs:()=>Nt,OlP:()=>V,zs3:()=>Me,ZZ4:()=>bm,aQg:()=>wm,soG:()=>km,YKP:()=>R0,v3s:()=>aT,h0i:()=>Lu,PXZ:()=>tT,R0b:()=>ua,FiY:()=>Pa,Lbi:()=>jx,g9A:()=>Ux,Qsj:()=>tE,FYo:()=>xm,JOm:()=>Oa,Tiy:()=>E_,q3G:()=>Ar,tp0:()=>ll,EAV:()=>hT,Rgc:()=>wf,dDg:()=>Yx,DyG:()=>Y,GfV:()=>C0,s_b:()=>Dm,ifc:()=>Kt,eFA:()=>tb,G48:()=>WD,_c5:()=>bT,VLi:()=>ZD,c2e:()=>Gx,zSh:()=>Ru,wAp:()=>cn,vHH:()=>Tn,EiD:()=>md,mCW:()=>Tc,qzn:()=>ti,JVY:()=>ad,pB0:()=>Hu,eBb:()=>Cc,L6k:()=>Yf,LAX:()=>Dc,cg1:()=>p_,Tjo:()=>vT,kL8:()=>Zv,yhl:()=>Qn,dqk:()=>vn,sIi:()=>ca,CqO:()=>s_,QGY:()=>o_,F4k:()=>ev,RDi:()=>We,AaK:()=>et,z3N:()=>ul,TTD:()=>Hs,xp6:()=>zp,uIk:()=>Xg,Suo:()=>yx,Xpm:()=>Ce,lG2:()=>Ut,Yz7:()=>tr,cJS:()=>nr,oAB:()=>kt,Yjl:()=>rn,Y36:()=>mf,_UZ:()=>Xy,qZA:()=>i_,TgZ:()=>r_,EpF:()=>Jy,Ikx:()=>f_,LFG:()=>ur,$8M:()=>Ul,NdJ:()=>a_,CRH:()=>vx,oxw:()=>iv,ALo:()=>dx,xi3:()=>fx,Q6J:()=>t_,VKq:()=>sx,iGM:()=>gx,MAs:()=>zy,CHM:()=>Dl,LSH:()=>gd,kYT:()=>ve,YNc:()=>Ny,_uU:()=>Av,Oqu:()=>h_,hij:()=>fm,lnq:()=>d_,Gf:()=>_x});var ue=Ve(574),ne=Ve(869),jt=Ve(282),f=Ve(693),it=Ve(709),Pt=Ve(319),je=Ve(441);var He=Ve(307);function Qe(){return new it.xQ}function mt(t){for(let n in t)if(t[n]===mt)return n;throw Error("Could not find renamed property on target object.")}function et(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(et).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const i=n.indexOf("\n");return-1===i?n:n.substring(0,i)}function Qt(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Pn=mt({__forward_ref__:mt});function zt(t){return t.__forward_ref__=zt,t.toString=function(){return et(this())},t}function Dt(t){return function(t){return"function"==typeof t&&t.hasOwnProperty(Pn)&&t.__forward_ref__===zt}(t)?t():t}class Tn extends Error{constructor(n,i){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,i)),this.code=n}}function Ft(t){return"string"==typeof t?t:null==t?"":String(t)}function _n(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Ft(t)}function In(t,n){const i=n?` in ${n}`:"";throw new Tn("201",`No provider for ${_n(t)} found${i}`)}function Dr(t,n){null==t&&function(t,n,i,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${i} ${a} ${n} <=Actual]`))}(n,t,null,"!=")}function tr(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function nr(t){return{providers:t.providers||[],imports:t.imports||[]}}function Or(t){return Vi(t,Ai)||Vi(t,gi)}function Vi(t,n){return t.hasOwnProperty(n)?t[n]:null}function ri(t){return t&&(t.hasOwnProperty(Do)||t.hasOwnProperty(ii))?t[Do]:null}const Ai=mt({\u0275prov:mt}),Do=mt({\u0275inj:mt}),gi=mt({ngInjectableDef:mt}),ii=mt({ngInjectorDef:mt});var Nt=(()=>((Nt=Nt||{})[Nt.Default=0]="Default",Nt[Nt.Host=1]="Host",Nt[Nt.Self=2]="Self",Nt[Nt.SkipSelf=4]="SkipSelf",Nt[Nt.Optional=8]="Optional",Nt))();let Kn;function qt(t){const n=Kn;return Kn=t,n}function oi(t,n,i){const a=Or(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:i&Nt.Optional?null:void 0!==n?n:void In(et(t),"Injector")}function Tr(t){return{toString:t}.toString()}var qn=(()=>((qn=qn||{})[qn.OnPush=0]="OnPush",qn[qn.Default=1]="Default",qn))(),Kt=(()=>((Kt=Kt||{})[Kt.Emulated=0]="Emulated",Kt[Kt.None=2]="None",Kt[Kt.ShadowDom=3]="ShadowDom",Kt))();const po="undefined"!=typeof globalThis&&globalThis,Ln="undefined"!=typeof window&&window,ss="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,vn=po||"undefined"!=typeof global&&global||Ln||ss,ai={},pn=[],re=mt({\u0275cmp:mt}),j=mt({\u0275dir:mt}),Z=mt({\u0275pipe:mt}),ie=mt({\u0275mod:mt}),he=mt({\u0275loc:mt}),ge=mt({\u0275fac:mt}),ke=mt({__NG_ELEMENT_ID__:mt});let Le=0;function Ce(t){return Tr(()=>{const i={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===qn.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||pn,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||Kt.Emulated,id:"c",styles:t.styles||pn,_:null,setInput:null,schemas:t.schemas||null,tView:null},u=t.directives,g=t.features,x=t.pipes;return a.id+=Le++,a.inputs=Ge(t.inputs,i),a.outputs=Ge(t.outputs),g&&g.forEach(w=>w(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(Xe):null,a.pipeDefs=x?()=>("function"==typeof x?x():x).map(ut):null,a})}function Xe(t){return Lt(t)||function(t){return t[j]||null}(t)}function ut(t){return function(t){return t[Z]||null}(t)}const Ue={};function kt(t){return Tr(()=>{const n={type:t.type,bootstrap:t.bootstrap||pn,declarations:t.declarations||pn,imports:t.imports||pn,exports:t.exports||pn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Ue[t.id]=t.type),n})}function ve(t,n){return Tr(()=>{const i=hn(t,!0);i.declarations=n.declarations||pn,i.imports=n.imports||pn,i.exports=n.exports||pn})}function Ge(t,n){if(null==t)return ai;const i={};for(const a in t)if(t.hasOwnProperty(a)){let u=t[a],g=u;Array.isArray(u)&&(g=u[1],u=u[0]),i[u]=a,n&&(n[u]=g)}return i}const Ut=Ce;function rn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function Lt(t){return t[re]||null}function hn(t,n){const i=t[ie]||null;if(!i&&!0===n)throw new Error(`Type ${et(t)} does not have '\u0275mod' property.`);return i}function ci(t){return Array.isArray(t)&&"object"==typeof t[1]}function ui(t){return Array.isArray(t)&&!0===t[1]}function Wa(t){return 0!=(8&t.flags)}function no(t){return 2==(2&t.flags)}function da(t){return 1==(1&t.flags)}function hi(t){return null!==t.template}function Fi(t){return 0!=(512&t[2])}function Gi(t,n){return t.hasOwnProperty(ge)?t[ge]:null}class ma{constructor(n,i,a){this.previousValue=n,this.currentValue=i,this.firstChange=a}isFirstChange(){return this.firstChange}}function Hs(){return As}function As(t){return t.type.prototype.ngOnChanges&&(t.setInput=jo),Nn}function Nn(){const t=ls(this),n=null==t?void 0:t.current;if(n){const i=t.previous;if(i===ai)t.previous=n;else for(let a in n)i[a]=n[a];t.current=null,this.ngOnChanges(n)}}function jo(t,n,i,a){const u=ls(t)||function(t,n){return t[Ao]=n}(t,{previous:ai,current:null}),g=u.current||(u.current={}),x=u.previous,w=this.declaredInputs[i],I=x[w];g[w]=new ma(I&&I.currentValue,n,x===ai),t[a]=n}Hs.ngInherit=!0;const Ao="__ngSimpleChanges__";function ls(t){return t[Ao]||null}let Ee;function We(t){Ee=t}function Zt(t){return!!t.listen}const jn={createRenderer:(t,n)=>void 0!==Ee?Ee:"undefined"!=typeof document?document:void 0};function Sn(t){for(;Array.isArray(t);)t=t[0];return t}function mr(t,n){return Sn(n[t.index])}function mo(t,n){return t.data[n]}function Qr(t,n){return t[n]}function qr(t,n){const i=n[t];return ci(i)?i:i[0]}function Ps(t){return 4==(4&t[2])}function qs(t){return 128==(128&t[2])}function Hi(t,n){return null==n?null:t[n]}function Mo(t){t[18]=0}function Cl(t,n){t[5]+=n;let i=t,a=t[3];for(;null!==a&&(1===n&&1===i[5]||-1===n&&0===i[5]);)a[5]+=n,i=a,a=a[3]}const sn={lFrame:us(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Qa(){return sn.bindingsEnabled}function ct(){return sn.lFrame.lView}function zn(){return sn.lFrame.tView}function Dl(t){return sn.lFrame.contextLView=t,t[8]}function gr(){let t=Tl();for(;null!==t&&64===t.type;)t=t.parent;return t}function Tl(){return sn.lFrame.currentTNode}function fi(t,n){const i=sn.lFrame;i.currentTNode=t,i.isParent=n}function Ws(){return sn.lFrame.isParent}function Ja(){return sn.isInCheckNoChangesMode}function el(t){sn.isInCheckNoChangesMode=t}function Zr(){const t=sn.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function Po(){return sn.lFrame.bindingIndex}function Go(){return sn.lFrame.bindingIndex++}function Zi(t,n){const i=sn.lFrame;i.bindingIndex=i.bindingRootIndex=t,Ho(n)}function Ho(t){sn.lFrame.currentDirectiveIndex=t}function tl(){return sn.lFrame.currentQueryIndex}function _o(t){sn.lFrame.currentQueryIndex=t}function Oi(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function Il(t,n,i){if(i&Nt.SkipSelf){let u=n,g=t;for(;!(u=u.parent,null!==u||i&Nt.Host||(u=Oi(g),null===u||(g=g[15],10&u.type))););if(null===u)return!1;n=u,t=g}const a=sn.lFrame=Al();return a.currentTNode=n,a.lView=t,!0}function ko(t){const n=Al(),i=t[1];sn.lFrame=n,n.currentTNode=i.firstChild,n.lView=t,n.tView=i,n.contextLView=t,n.bindingIndex=i.bindingStartIndex,n.inI18n=!1}function Al(){const t=sn.lFrame,n=null===t?null:t.child;return null===n?us(t):n}function us(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Xs(){const t=sn.lFrame;return sn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const nl=Xs;function _a(){const t=Xs();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function wi(){return sn.lFrame.selectedIndex}function Wi(t){sn.lFrame.selectedIndex=t}function _r(){const t=sn.lFrame;return mo(t.tView,t.selectedIndex)}function Ei(t,n){for(let i=n.directiveStart,a=n.directiveEnd;i<a;i++){const g=t.data[i].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:w,ngAfterViewInit:I,ngAfterViewChecked:F,ngOnDestroy:G}=g;x&&(t.contentHooks||(t.contentHooks=[])).push(-i,x),w&&((t.contentHooks||(t.contentHooks=[])).push(i,w),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(i,w)),I&&(t.viewHooks||(t.viewHooks=[])).push(-i,I),F&&((t.viewHooks||(t.viewHooks=[])).push(i,F),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(i,F)),null!=G&&(t.destroyHooks||(t.destroyHooks=[])).push(i,G)}}function hs(t,n,i){Pl(t,n,3,i)}function xa(t,n,i,a){(3&t[2])===i&&Pl(t,n,i,a)}function ds(t,n){let i=t[2];(3&i)===n&&(i&=2047,i+=1,t[2]=i)}function Pl(t,n,i,a){const g=null!=a?a:-1,x=n.length-1;let w=0;for(let I=void 0!==a?65535&t[18]:0;I<x;I++)if("number"==typeof n[I+1]){if(w=n[I],null!=a&&w>=a)break}else n[I]<0&&(t[18]+=65536),(w<g||-1==g)&&(jc(t,i,n,I),t[18]=(4294901760&t[18])+I+2),I++}function jc(t,n,i,a){const u=i[a]<0,g=i[a+1],w=t[u?-i[a]:i[a]];if(u){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(w)}finally{}}}else try{g.call(w)}finally{}}class ba{constructor(n,i,a){this.factory=n,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=a}}function Ea(t,n,i){const a=Zt(t);let u=0;for(;u<i.length;){const g=i[u];if("number"==typeof g){if(0!==g)break;u++;const x=i[u++],w=i[u++],I=i[u++];a?t.setAttribute(n,w,I,x):n.setAttributeNS(x,w,I)}else{const x=g,w=i[++u];kl(x)?a&&t.setProperty(n,x,w):a?t.setAttribute(n,x,w):n.setAttribute(x,w),u++}}return u}function Zo(t){return 3===t||4===t||6===t}function kl(t){return 64===t.charCodeAt(0)}function Fl(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let i=-1;for(let a=0;a<n.length;a++){const u=n[a];"number"==typeof u?i=u:0===i||Ll(t,i,u,null,-1===i||2===i?n[++a]:null)}}return t}function Ll(t,n,i,a,u){let g=0,x=t.length;if(-1===n)x=-1;else for(;g<t.length;){const w=t[g++];if("number"==typeof w){if(w===n){x=-1;break}if(w>n){x=g-1;break}}}for(;g<t.length;){const w=t[g];if("number"==typeof w)break;if(w===i){if(null===a)return void(null!==u&&(t[g+1]=u));if(a===t[g+1])return void(t[g+2]=u)}g++,null!==a&&g++,null!==u&&g++}-1!==x&&(t.splice(x,0,n),g=x+1),t.splice(g++,0,i),null!==a&&t.splice(g++,0,a),null!==u&&t.splice(g++,0,u)}function Ca(t){return-1!==t}function Jr(t){return 32767&t}function Ks(t,n){let i=function(t){return t>>16}(t),a=n;for(;i>0;)a=a[15],i--;return a}let Nr=!0;function St(t){const n=Nr;return Nr=t,n}let Wo=0;function Ta(t,n){const i=Ol(t,n);if(-1!==i)return i;const a=n[1];a.firstCreatePass&&(t.injectorIndex=n.length,Sa(a.data,t),Sa(n,null),Sa(a.blueprint,null));const u=ps(t,n),g=t.injectorIndex;if(Ca(u)){const x=Jr(u),w=Ks(u,n),I=w[1].data;for(let F=0;F<8;F++)n[g+F]=w[x+F]|I[x+F]}return n[g+8]=u,g}function Sa(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Ol(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function ps(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let i=0,a=null,u=n;for(;null!==u;){const g=u[1],x=g.type;if(a=2===x?g.declTNode:1===x?u[6]:null,null===a)return-1;if(i++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|i<<16}return-1}function sl(t,n,i){!function(t,n,i){let a;"string"==typeof i?a=i.charCodeAt(0)||0:i.hasOwnProperty(ke)&&(a=i[ke]),null==a&&(a=i[ke]=Wo++);const u=255&a;n.data[t+(u>>5)]|=1<<u}(t,n,i)}function ms(t,n,i){if(i&Nt.Optional)return t;In(n,"NodeInjector")}function Ia(t,n,i,a){if(i&Nt.Optional&&void 0===a&&(a=null),0==(i&(Nt.Self|Nt.Host))){const u=t[9],g=qt(void 0);try{return u?u.get(n,a,i&Nt.Optional):oi(n,a,i&Nt.Optional)}finally{qt(g)}}return ms(a,n,i)}function Nl(t,n,i,a=Nt.Default,u){if(null!==t){const g=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(ke)?t[ke]:void 0;return"number"==typeof n?n>=0?255&n:zl:n}(i);if("function"==typeof g){if(!Il(n,t,a))return a&Nt.Host?ms(u,i,a):Ia(n,i,a,u);try{const x=g(a);if(null!=x||a&Nt.Optional)return x;In(i)}finally{nl()}}else if("number"==typeof g){let x=null,w=Ol(t,n),I=-1,F=a&Nt.Host?n[16][6]:null;for((-1===w||a&Nt.SkipSelf)&&(I=-1===w?ps(t,n):n[w+8],-1!==I&&Vl(a,!1)?(x=n[1],w=Jr(I),n=Ks(I,n)):w=-1);-1!==w;){const G=n[1];if(yc(g,w,G.data)){const Q=_c(w,n,i,x,a,F);if(Q!==Yo)return Q}I=n[w+8],-1!==I&&Vl(a,n[1].data[w+8]===F)&&yc(g,w,n)?(x=G,w=Jr(I),n=Ks(I,n)):w=-1}}}return Ia(n,i,a,u)}const Yo={};function zl(){return new Xo(gr(),ct())}function _c(t,n,i,a,u,g){const x=n[1],w=x.data[t+8],G=Aa(w,x,i,null==a?no(w)&&Nr:a!=x&&0!=(3&w.type),u&Nt.Host&&g===w);return null!==G?Fs(n,x,G,w):Yo}function Aa(t,n,i,a,u){const g=t.providerIndexes,x=n.data,w=1048575&g,I=t.directiveStart,G=g>>20,oe=u?w+G:t.directiveEnd;for(let ye=a?w:w+G;ye<oe;ye++){const Pe=x[ye];if(ye<I&&i===Pe||ye>=I&&Pe.type===i)return ye}if(u){const ye=x[I];if(ye&&hi(ye)&&ye.type===i)return I}return null}function Fs(t,n,i,a){let u=t[i];const g=n.data;if(function(t){return t instanceof ba}(u)){const x=u;x.resolving&&function(t,n){throw new Tn("200",`Circular dependency in DI detected for ${t}`)}(_n(g[i]));const w=St(x.canSeeViewProviders);x.resolving=!0;const I=x.injectImpl?qt(x.injectImpl):null;Il(t,a,Nt.Default);try{u=t[i]=x.factory(void 0,g,t,a),n.firstCreatePass&&i>=a.directiveStart&&function(t,n,i){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:g}=n.type.prototype;if(a){const x=As(n);(i.preOrderHooks||(i.preOrderHooks=[])).push(t,x),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,x)}u&&(i.preOrderHooks||(i.preOrderHooks=[])).push(0-t,u),g&&((i.preOrderHooks||(i.preOrderHooks=[])).push(t,g),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,g))}(i,g[i],n)}finally{null!==I&&qt(I),St(w),x.resolving=!1,nl()}}return u}function yc(t,n,i){return!!(i[n+(t>>5)]&1<<t)}function Vl(t,n){return!(t&Nt.Self||t&Nt.Host&&n)}class Xo{constructor(n,i){this._tNode=n,this._lView=i}get(n,i){return Nl(this._tNode,this._lView,n,void 0,i)}}function Ul(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const i=t.attrs;if(i){const a=i.length;let u=0;for(;u<a;){const g=i[u];if(Zo(g))break;if(0===g)u+=2;else if("number"==typeof g)for(u++;u<a&&"string"==typeof i[u];)u++;else{if(g===n)return i[u+1];u+=2}}}return null}(gr(),t)}const _s="__parameters__";function yo(t,n,i){return Tr(()=>{const a=function(t){return function(...i){if(t){const a=t(...i);for(const u in a)this[u]=a[u]}}}(n);function u(...g){if(this instanceof u)return a.apply(this,g),this;const x=new u(...g);return w.annotation=x,w;function w(I,F,G){const Q=I.hasOwnProperty(_s)?I[_s]:Object.defineProperty(I,_s,{value:[]})[_s];for(;Q.length<=G;)Q.push(null);return(Q[G]=Q[G]||[]).push(x),I}}return i&&(u.prototype=Object.create(i.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}class V{constructor(n,i){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=tr({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}toString(){return`InjectionToken ${this._desc}`}}const X=new V("AnalyzeForEntryComponents"),Y=Function;function ee(t,n){void 0===n&&(n=t);for(let i=0;i<t.length;i++){let a=t[i];Array.isArray(a)?(n===t&&(n=t.slice(0,i)),ee(a,n)):n!==t&&n.push(a)}return n}function ce(t,n){t.forEach(i=>Array.isArray(i)?ce(i,n):n(i))}function me(t,n,i){n>=t.length?t.push(i):t.splice(n,0,i)}function xe(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const ei={},Yi="__NG_DI_FLAG__",oo="ngTempTokenPath",cr=/\n/gm,Gn="__source",Xi=mt({provide:String,useValue:mt});let rr;function Br(t){const n=rr;return rr=t,n}function Qo(t,n=Nt.Default){if(void 0===rr)throw new Error("inject() must be called from an injection context");return null===rr?oi(t,void 0,n):rr.get(t,n&Nt.Optional?null:void 0,n)}function ur(t,n=Nt.Default){return(Kn||Qo)(Dt(t),n)}function Os(t){const n=[];for(let i=0;i<t.length;i++){const a=Dt(t[i]);if(Array.isArray(a)){if(0===a.length)throw new Error("Arguments array must have arguments.");let u,g=Nt.Default;for(let x=0;x<a.length;x++){const w=a[x],I=Uu(w);"number"==typeof I?-1===I?u=w.token:g|=I:u=w}n.push(ur(u,g))}else n.push(ur(a))}return n}function ys(t,n){return t[Yi]=n,t.prototype[Yi]=n,t}function Uu(t){return t[Yi]}function jl(t,n,i,a){const u=t[oo];throw n[Gn]&&u.unshift(n[Gn]),t.message=function(t,n,i,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let u=et(n);if(Array.isArray(n))u=n.map(et).join(" -> ");else if("object"==typeof n){let g=[];for(let x in n)if(n.hasOwnProperty(x)){let w=n[x];g.push(x+":"+("string"==typeof w?JSON.stringify(w):et(w)))}u=`{${g.join(", ")}}`}return`${i}${a?"("+a+")":""}[${u}]: ${t.replace(cr,"\n  ")}`}("\n"+t.message,u,i,a),t.ngTokenPath=u,t[oo]=null,t}const wc=ys(yo("Inject",t=>({token:t})),-1),Pa=ys(yo("Optional"),8),ll=ys(yo("SkipSelf"),4);let $u;function Ra(t){var n;return(null===(n=function(){if(void 0===$u&&($u=null,vn.trustedTypes))try{$u=vn.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(t){}return $u}())||void 0===n?void 0:n.createHTML(t))||t}class Ec{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Zm extends Ec{getTypeName(){return"HTML"}}class Wf extends Ec{getTypeName(){return"Style"}}class Gu extends Ec{getTypeName(){return"Script"}}class na extends Ec{getTypeName(){return"URL"}}class Wm extends Ec{getTypeName(){return"ResourceURL"}}function ul(t){return t instanceof Ec?t.changingThisBreaksApplicationSecurity:t}function ti(t,n){const i=Qn(t);if(null!=i&&i!==n){if("ResourceURL"===i&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${i} (see https://g.co/ng/security#xss)`)}return i===n}function Qn(t){return t instanceof Ec&&t.getTypeName()||null}function ad(t){return new Zm(t)}function Yf(t){return new Wf(t)}function Cc(t){return new Gu(t)}function Dc(t){return new na(t)}function Hu(t){return new Wm(t)}class Xf{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const i=(new window.DOMParser).parseFromString(Ra(n),"text/html").body;return null===i?this.inertDocumentHelper.getInertBodyElement(n):(i.removeChild(i.firstChild),i)}catch(i){return null}}}class Ym{constructor(n){if(this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const i=this.inertDocument.createElement("html");this.inertDocument.appendChild(i);const a=this.inertDocument.createElement("body");i.appendChild(a)}}getInertBodyElement(n){const i=this.inertDocument.createElement("template");if("content"in i)return i.innerHTML=Ra(n),i;const a=this.inertDocument.createElement("body");return a.innerHTML=Ra(n),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(a),a}stripCustomNsAttrs(n){const i=n.attributes;for(let u=i.length-1;0<u;u--){const x=i.item(u).name;("xmlns:ns1"===x||0===x.indexOf("ns1:"))&&n.removeAttribute(x)}let a=n.firstChild;for(;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}const Xm=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Km=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Tc(t){return(t=String(t)).match(Xm)||t.match(Km)?t:"unsafe:"+t}function ra(t){const n={};for(const i of t.split(","))n[i]=!0;return n}function Fa(...t){const n={};for(const i of t)for(const a in i)i.hasOwnProperty(a)&&(n[a]=!0);return n}const cd=ra("area,br,col,hr,img,wbr"),Jf=ra("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Sc=ra("rp,rt"),hd=Fa(cd,Fa(Jf,ra("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Fa(Sc,ra("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Fa(Sc,Jf)),dd=ra("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),vo=ra("srcset"),fd=Fa(dd,vo,ra("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ra("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),tg=ra("script,style,template");class Zu{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let i=n.firstChild,a=!0;for(;i;)if(i.nodeType===Node.ELEMENT_NODE?a=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,a&&i.firstChild)i=i.firstChild;else for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let u=this.checkClobberedElement(i,i.nextSibling);if(u){i=u;break}i=this.checkClobberedElement(i,i.parentNode)}return this.buf.join("")}startElement(n){const i=n.nodeName.toLowerCase();if(!hd.hasOwnProperty(i))return this.sanitizedSomething=!0,!tg.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);const a=n.attributes;for(let u=0;u<a.length;u++){const g=a.item(u),x=g.name,w=x.toLowerCase();if(!fd.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let I=g.value;dd[w]&&(I=Tc(I)),vo[w]&&(t=I,I=(t=String(t)).split(",").map(n=>Tc(n.trim())).join(", ")),this.buf.push(" ",x,'="',pd(I),'"')}var t;return this.buf.push(">"),!0}endElement(n){const i=n.nodeName.toLowerCase();hd.hasOwnProperty(i)&&!cd.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(n){this.buf.push(pd(n))}checkClobberedElement(n,i){if(i&&(n.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return i}}const tp=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Zc=/([^\#-~ |!])/g;function pd(t){return t.replace(/&/g,"&amp;").replace(tp,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(Zc,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let fu;function md(t,n){let i=null;try{fu=fu||function(t){const n=new Ym(t);return function(){try{return!!(new window.DOMParser).parseFromString(Ra(""),"text/html")}catch(t){return!1}}()?new Xf(n):n}(t);let a=n?String(n):"";i=fu.getInertBodyElement(a);let u=5,g=a;do{if(0===u)throw new Error("Failed to sanitize html because the input is unstable");u--,a=g,g=i.innerHTML,i=fu.getInertBodyElement(a)}while(a!==g);return Ra((new Zu).sanitizeChildren(Wu(i)||i))}finally{if(i){const a=Wu(i)||i;for(;a.firstChild;)a.removeChild(a.firstChild)}}}function Wu(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Ar=(()=>((Ar=Ar||{})[Ar.NONE=0]="NONE",Ar[Ar.HTML=1]="HTML",Ar[Ar.STYLE=2]="STYLE",Ar[Ar.SCRIPT=3]="SCRIPT",Ar[Ar.URL=4]="URL",Ar[Ar.RESOURCE_URL=5]="RESOURCE_URL",Ar))();function gd(t){const n=function(){const t=ct();return t&&t[12]}();return n?n.sanitize(Ar.URL,t)||"":ti(t,"URL")?ul(t):Tc(Ft(t))}const Yu="__ngContext__";function Wr(t,n){t[Yu]=n}function vd(t){const n=function(t){return t[Yu]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function Ku(t){return t.ngOriginalError}function ug(t,...n){t.error(...n)}class ia{constructor(){this._console=console}handleError(n){const i=this._findOriginalError(n),a=this._findContext(n),u=(t=n)&&t.ngErrorLogger||ug;var t;u(this._console,"ERROR",n),i&&u(this._console,"ORIGINAL ERROR",i),a&&u(this._console,"ERROR CONTEXT",a)}_findContext(n){return n?n.ngDebugContext||this._findContext(Ku(n)):null}_findOriginalError(n){let i=n&&Ku(n);for(;i&&Ku(i);)i=Ku(i);return i||null}}const pp=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(vn))();function La(t){return t instanceof Function?t():t}var Oa=(()=>((Oa=Oa||{})[Oa.Important=1]="Important",Oa[Oa.DashCase=2]="DashCase",Oa))();function Dd(t,n){return undefined(t,n)}function Na(t){const n=t[3];return ui(n)?n[3]:n}function nh(t){return xp(t[13])}function rh(t){return xp(t[4])}function xp(t){for(;null!==t&&!ui(t);)t=t[4];return t}function Ns(t,n,i,a,u){if(null!=a){let g,x=!1;ui(a)?g=a:ci(a)&&(x=!0,a=a[0]);const w=Sn(a);0===t&&null!==i?null==u?Pd(n,i,w):Ac(n,i,w,u||null,!0):1===t&&null!==i?Ac(n,i,w,u||null,!0):2===t?function(t,n,i){const a=sh(t,n);a&&function(t,n,i,a){Zt(t)?t.removeChild(n,i,a):n.removeChild(i)}(t,a,n,i)}(n,w,x):3===t&&n.destroyNode(w),null!=g&&function(t,n,i,a,u){const g=i[7];g!==Sn(i)&&Ns(n,t,a,g,u);for(let w=10;w<i.length;w++){const I=i[w];hl(I[1],I,t,n,a,g)}}(n,t,g,i,u)}}function ih(t,n,i){return Zt(t)?t.createElement(n,i):null===i?t.createElement(n):t.createElementNS(i,n)}function Cp(t,n){const i=t[9],a=i.indexOf(n),u=n[3];1024&n[2]&&(n[2]&=-1025,Cl(u,-1)),i.splice(a,1)}function Ad(t,n){if(t.length<=10)return;const i=10+n,a=t[i];if(a){const u=a[17];null!==u&&u!==t&&Cp(u,a),n>0&&(t[i-1][4]=a[4]);const g=xe(t,10+n);!function(t,n){hl(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(a[1],a);const x=g[19];null!==x&&x.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Dp(t,n){if(!(256&n[2])){const i=n[11];Zt(i)&&i.destroyNode&&hl(t,n,i,3,null,null),function(t){let n=t[13];if(!n)return Md(t[1],t);for(;n;){let i=null;if(ci(n))i=n[13];else{const a=n[10];a&&(i=a)}if(!i){for(;n&&!n[4]&&n!==t;)ci(n)&&Md(n[1],n),n=n[3];null===n&&(n=t),ci(n)&&Md(n[1],n),i=n&&n[4]}n=i}}(n)}}function Md(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let i;if(null!=t&&null!=(i=t.destroyHooks))for(let a=0;a<i.length;a+=2){const u=n[i[a]];if(!(u instanceof ba)){const g=i[a+1];if(Array.isArray(g))for(let x=0;x<g.length;x+=2){const w=u[g[x]],I=g[x+1];try{I.call(w)}finally{}}else try{g.call(u)}finally{}}}}(t,n),function(t,n){const i=t.cleanup,a=n[7];let u=-1;if(null!==i)for(let g=0;g<i.length-1;g+=2)if("string"==typeof i[g]){const x=i[g+1],w="function"==typeof x?x(n):Sn(n[x]),I=a[u=i[g+2]],F=i[g+3];"boolean"==typeof F?w.removeEventListener(i[g],I,F):F>=0?a[u=F]():a[u=-F].unsubscribe(),g+=2}else{const x=a[u=i[g+1]];i[g].call(x)}if(null!==a){for(let g=u+1;g<a.length;g++)a[g]();n[7]=null}}(t,n),1===n[1].type&&Zt(n[11])&&n[11].destroy();const i=n[17];if(null!==i&&ui(n[3])){i!==n[3]&&Cp(i,n);const a=n[19];null!==a&&a.detachView(t)}}}function Tp(t,n,i){return function(t,n,i){let a=n;for(;null!==a&&40&a.type;)a=(n=a).parent;if(null===a)return i[0];if(2&a.flags){const u=t.data[a.directiveStart].encapsulation;if(u===Kt.None||u===Kt.Emulated)return null}return mr(a,i)}(t,n.parent,i)}function Ac(t,n,i,a,u){Zt(t)?t.insertBefore(n,i,a,u):n.insertBefore(i,a,u)}function Pd(t,n,i){Zt(t)?t.appendChild(n,i):n.appendChild(i)}function Rd(t,n,i,a,u){null!==a?Ac(t,n,i,a,u):Pd(t,n,i)}function sh(t,n){return Zt(t)?t.parentNode(n):n.parentNode}let kd=function(t,n,i){return 40&t.type?mr(t,i):null};function vs(t,n,i,a){const u=Tp(t,a,n),g=n[11],w=function(t,n,i){return kd(t,n,i)}(a.parent||n[6],a,n);if(null!=u)if(Array.isArray(i))for(let I=0;I<i.length;I++)Rd(g,u,i[I],w,!1);else Rd(g,u,i,w,!1)}function Yc(t,n){if(null!==n){const i=n.type;if(3&i)return mr(n,t);if(4&i)return Wl(-1,t[n.index]);if(8&i){const a=n.child;if(null!==a)return Yc(t,a);{const u=t[n.index];return ui(u)?Wl(-1,u):Sn(u)}}if(32&i)return Dd(n,t)()||Sn(t[n.index]);{const a=wu(t,n);return null!==a?Array.isArray(a)?a[0]:Yc(Na(t[16]),a):Yc(t,n.next)}}return null}function wu(t,n){return null!==n?t[16][6].projection[n.projection]:null}function Wl(t,n){const i=10+t+1;if(i<n.length){const a=n[i],u=a[1].firstChild;if(null!==u)return Yc(a,u)}return n[7]}function Ld(t,n,i,a,u,g,x){for(;null!=i;){const w=a[i.index],I=i.type;if(x&&0===n&&(w&&Wr(Sn(w),a),i.flags|=4),64!=(64&i.flags))if(8&I)Ld(t,n,i.child,a,u,g,!1),Ns(n,t,u,w,g);else if(32&I){const F=Dd(i,a);let G;for(;G=F();)Ns(n,t,u,G,g);Ns(n,t,u,w,g)}else 16&I?Pp(t,n,a,i,u,g):Ns(n,t,u,w,g);i=x?i.projectionNext:i.next}}function hl(t,n,i,a,u,g){Ld(i,a,t.firstChild,n,u,g,!1)}function Pp(t,n,i,a,u,g){const x=i[16],I=x[6].projection[a.projection];if(Array.isArray(I))for(let F=0;F<I.length;F++)Ns(n,t,u,I[F],g);else Ld(t,n,I,x[3],u,g,!0)}function Xc(t,n,i){Zt(t)?t.setAttribute(n,"style",i):n.style.cssText=i}function ir(t,n,i){Zt(t)?""===i?t.removeAttribute(n,"class"):t.setAttribute(n,"class",i):n.className=i}function ah(t,n,i){let a=t.length;for(;;){const u=t.indexOf(n,i);if(-1===u)return u;if(0===u||t.charCodeAt(u-1)<=32){const g=n.length;if(u+g===a||t.charCodeAt(u+g)<=32)return u}i=u+1}}const Od="ng-template";function dl(t,n,i){let a=0;for(;a<t.length;){let u=t[a++];if(i&&"class"===u){if(u=t[a],-1!==ah(u.toLowerCase(),n,0))return!0}else if(1===u){for(;a<t.length&&"string"==typeof(u=t[a++]);)if(u.toLowerCase()===n)return!0;return!1}}return!1}function Mc(t){return 4===t.type&&t.value!==Od}function Fp(t,n,i){return n===(4!==t.type||i?t.value:Od)}function bg(t,n,i){let a=4;const u=t.attrs||[],g=function(t){for(let n=0;n<t.length;n++)if(Zo(t[n]))return n;return t.length}(u);let x=!1;for(let w=0;w<n.length;w++){const I=n[w];if("number"!=typeof I){if(!x)if(4&a){if(a=2|1&a,""!==I&&!Fp(t,I,i)||""===I&&1===n.length){if(oa(a))return!1;x=!0}}else{const F=8&a?I:n[++w];if(8&a&&null!==t.attrs){if(!dl(t.attrs,F,i)){if(oa(a))return!1;x=!0}continue}const Q=wg(8&a?"class":I,u,Mc(t),i);if(-1===Q){if(oa(a))return!1;x=!0;continue}if(""!==F){let oe;oe=Q>g?"":u[Q+1].toLowerCase();const ye=8&a?oe:null;if(ye&&-1!==ah(ye,F,0)||2&a&&F!==oe){if(oa(a))return!1;x=!0}}}}else{if(!x&&!oa(a)&&!oa(I))return!1;if(x&&oa(I))continue;x=!1,a=I|1&a}}return oa(a)||x}function oa(t){return 0==(1&t)}function wg(t,n,i,a){if(null===n)return-1;let u=0;if(a||!i){let g=!1;for(;u<n.length;){const x=n[u];if(x===t)return u;if(3===x||6===x)g=!0;else{if(1===x||2===x){let w=n[++u];for(;"string"==typeof w;)w=n[++u];continue}if(4===x)break;if(0===x){u+=4;continue}}u+=g?1:2}return-1}return function(t,n){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){const a=t[i];if("number"==typeof a)return-1;if(a===n)return i;i++}return-1}(n,t)}function Lp(t,n,i=!1){for(let a=0;a<n.length;a++)if(bg(t,n[a],i))return!0;return!1}function Op(t,n){return t?":not("+n.trim()+")":n}function lh(t){let n=t[0],i=1,a=2,u="",g=!1;for(;i<t.length;){let x=t[i];if("string"==typeof x)if(2&a){const w=t[++i];u+="["+x+(w.length>0?'="'+w+'"':"")+"]"}else 8&a?u+="."+x:4&a&&(u+=" "+x);else""!==u&&!oa(x)&&(n+=Op(g,u),u=""),a=x,g=g||!oa(a);i++}return""!==u&&(n+=Op(g,u)),n}const yn={};function zp(t){Bp(zn(),ct(),wi()+t,Ja())}function Bp(t,n,i,a){if(!a)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&hs(n,g,i)}else{const g=t.preOrderHooks;null!==g&&xa(n,g,0,i)}Wi(i)}function Kd(t,n){const i=t.contentQueries;if(null!==i)for(let a=0;a<i.length;a+=2){const u=i[a],g=i[a+1];if(-1!==g){const x=t.data[g];_o(u),x.contentQueries(2,n[g],g)}}}function kc(t,n,i,a,u,g,x,w,I,F){const G=n.blueprint.slice();return G[0]=u,G[2]=140|a,Mo(G),G[3]=G[15]=t,G[8]=i,G[10]=x||t&&t[10],G[11]=w||t&&t[11],G[12]=I||t&&t[12]||null,G[9]=F||t&&t[9]||null,G[6]=g,G[16]=2==n.type?t[16]:G,G}function eu(t,n,i,a,u){let g=t.data[n];if(null===g)g=function(t,n,i,a,u){const g=Tl(),x=Ws(),I=t.data[n]=function(t,n,i,a,u,g){return{type:i,index:a,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,x?g:g&&g.parent,i,n,a,u);return null===t.firstChild&&(t.firstChild=I),null!==g&&(x?null==g.child&&null!==I.parent&&(g.child=I):null===g.next&&(g.next=I)),I}(t,n,i,a,u),sn.lFrame.inI18n&&(g.flags|=64);else if(64&g.type){g.type=i,g.value=a,g.attrs=u;const x=function(){const t=sn.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===x?-1:x.injectorIndex}return fi(g,!0),g}function tu(t,n,i,a){if(0===i)return-1;const u=n.length;for(let g=0;g<i;g++)n.push(a),t.blueprint.push(a),t.data.push(null);return u}function Ql(t,n,i){ko(n);try{const a=t.viewQuery;null!==a&&ec(1,a,i);const u=t.template;null!==u&&hh(t,n,u,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Kd(t,n),t.staticViewQueries&&ec(2,t.viewQuery,i);const g=t.components;null!==g&&function(t,n){for(let i=0;i<n.length;i++)im(t,n[i])}(n,g)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{n[2]&=-5,_a()}}function Jl(t,n,i,a){const u=n[2];if(256==(256&u))return;ko(n);const g=Ja();try{Mo(n),function(t){sn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==i&&hh(t,n,i,2,a);const x=3==(3&u);if(!g)if(x){const F=t.preOrderCheckHooks;null!==F&&hs(n,F,null)}else{const F=t.preOrderHooks;null!==F&&xa(n,F,0,null),ds(n,0)}if(function(t){for(let n=nh(t);null!==n;n=rh(n)){if(!n[2])continue;const i=n[9];for(let a=0;a<i.length;a++){const u=i[a],g=u[3];0==(1024&u[2])&&Cl(g,1),u[2]|=1024}}}(n),function(t){for(let n=nh(t);null!==n;n=rh(n))for(let i=10;i<n.length;i++){const a=n[i],u=a[1];qs(a)&&Jl(u,a,u.template,a[8])}}(n),null!==t.contentQueries&&Kd(t,n),!g)if(x){const F=t.contentCheckHooks;null!==F&&hs(n,F)}else{const F=t.contentHooks;null!==F&&xa(n,F,1),ds(n,1)}!function(t,n){const i=t.hostBindingOpCodes;if(null!==i)try{for(let a=0;a<i.length;a++){const u=i[a];if(u<0)Wi(~u);else{const g=u,x=i[++a],w=i[++a];Zi(x,g),w(2,n[g])}}}finally{Wi(-1)}}(t,n);const w=t.components;null!==w&&function(t,n){for(let i=0;i<n.length;i++)Hg(t,n[i])}(n,w);const I=t.viewQuery;if(null!==I&&ec(2,I,a),!g)if(x){const F=t.viewCheckHooks;null!==F&&hs(n,F)}else{const F=t.viewHooks;null!==F&&xa(n,F,2),ds(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,Cl(n[3],-1))}finally{_a()}}function Vg(t,n,i,a){const u=n[10],g=!Ja(),x=Ps(n);try{g&&!x&&u.begin&&u.begin(),x&&Ql(t,n,a),Jl(t,n,i,a)}finally{g&&!x&&u.end&&u.end()}}function hh(t,n,i,a,u){const g=wi(),x=2&a;try{Wi(-1),x&&n.length>20&&Bp(t,n,20,Ja()),i(a,u)}finally{Wi(g)}}function Ba(t,n,i){!Qa()||(function(t,n,i,a){const u=i.directiveStart,g=i.directiveEnd;t.firstCreatePass||Ta(i,n),Wr(a,n);const x=i.initialInputs;for(let w=u;w<g;w++){const I=t.data[w],F=hi(I);F&&nm(n,i,I);const G=Fs(n,t,w,i);Wr(G,n),null!==x&&Oo(0,w-u,G,I,0,x),F&&(qr(i.index,n)[8]=G)}}(t,n,i,mr(i,n)),128==(128&i.flags)&&function(t,n,i){const a=i.directiveStart,u=i.directiveEnd,x=i.index,w=sn.lFrame.currentDirectiveIndex;try{Wi(x);for(let I=a;I<u;I++){const F=t.data[I],G=n[I];Ho(I),(null!==F.hostBindings||0!==F.hostVars||null!==F.hostAttrs)&&yh(F,G)}}finally{Wi(-1),Ho(w)}}(t,n,i))}function Jd(t,n,i=mr){const a=n.localNames;if(null!==a){let u=n.index+1;for(let g=0;g<a.length;g+=2){const x=a[g+1],w=-1===x?i(n,t):t[x];t[u++]=w}}}function fh(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Iu(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function Iu(t,n,i,a,u,g,x,w,I,F){const G=20+a,Q=G+u,oe=function(t,n){const i=[];for(let a=0;a<n;a++)i.push(a<t?null:yn);return i}(G,Q),ye="function"==typeof F?F():F;return oe[1]={type:t,blueprint:oe,template:i,queries:null,viewQuery:w,declTNode:n,data:oe.slice().fill(null,G),bindingStartIndex:G,expandoStartIndex:Q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof x?x():x,firstChild:null,schemas:I,consts:ye,incompleteFirstPass:!1}}function Wp(t,n,i,a){const u=aa(n);null===i?u.push(a):(u.push(i),t.firstCreatePass&&Dh(t).push(a,u.length-1))}function Yp(t,n,i){for(let a in t)if(t.hasOwnProperty(a)){const u=t[a];(i=null===i?{}:i).hasOwnProperty(a)?i[a].push(n,u):i[a]=[n,u]}return i}function es(t,n,i,a,u,g,x,w){const I=mr(n,i);let G,F=n.inputs;!w&&null!=F&&(G=F[a])?(tc(t,i,G,a,u),no(n)&&function(t,n){const i=qr(n,t);16&i[2]||(i[2]|=64)}(i,n.index)):3&n.type&&(a=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),u=null!=x?x(u,n.value||"",a):u,Zt(g)?g.setProperty(I,a,u):kl(a)||(I.setProperty?I.setProperty(a,u):I[a]=u))}function gh(t,n,i,a){let u=!1;if(Qa()){const g=function(t,n,i){const a=t.directiveRegistry;let u=null;if(a)for(let g=0;g<a.length;g++){const x=a[g];Lp(i,x.selectors,!1)&&(u||(u=[]),sl(Ta(i,n),t,x.type),hi(x)?(vh(t,i),u.unshift(x)):u.push(x))}return u}(t,n,i),x=null===a?null:{"":-1};if(null!==g){u=!0,sf(i,t.data.length,g.length);for(let G=0;G<g.length;G++){const Q=g[G];Q.providersResolver&&Q.providersResolver(Q)}let w=!1,I=!1,F=tu(t,n,g.length,null);for(let G=0;G<g.length;G++){const Q=g[G];i.mergedAttrs=Fl(i.mergedAttrs,Q.hostAttrs),tm(t,i,n,F,Q),jg(F,Q,x),null!==Q.contentQueries&&(i.flags|=8),(null!==Q.hostBindings||null!==Q.hostAttrs||0!==Q.hostVars)&&(i.flags|=128);const oe=Q.type.prototype;!w&&(oe.ngOnChanges||oe.ngOnInit||oe.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(i.index),w=!0),!I&&(oe.ngOnChanges||oe.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(i.index),I=!0),F++}!function(t,n){const a=n.directiveEnd,u=t.data,g=n.attrs,x=[];let w=null,I=null;for(let F=n.directiveStart;F<a;F++){const G=u[F],Q=G.inputs,oe=null===g||Mc(n)?null:Au(Q,g);x.push(oe),w=Yp(Q,F,w),I=Yp(G.outputs,F,I)}null!==w&&(w.hasOwnProperty("class")&&(n.flags|=16),w.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=x,n.inputs=w,n.outputs=I}(t,i)}x&&function(t,n,i){if(n){const a=t.localNames=[];for(let u=0;u<n.length;u+=2){const g=i[n[u+1]];if(null==g)throw new Tn("301",`Export of name '${n[u+1]}' not found!`);a.push(n[u],g)}}}(i,a,x)}return i.mergedAttrs=Fl(i.mergedAttrs,i.attrs),u}function rf(t,n,i,a,u,g){const x=g.hostBindings;if(x){let w=t.hostBindingOpCodes;null===w&&(w=t.hostBindingOpCodes=[]);const I=~n.index;(function(t){let n=t.length;for(;n>0;){const i=t[--n];if("number"==typeof i&&i<0)return i}return 0})(w)!=I&&w.push(I),w.push(a,u,x)}}function yh(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function vh(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function jg(t,n,i){if(i){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)i[n.exportAs[a]]=t;hi(n)&&(i[""]=t)}}function sf(t,n,i){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+i,t.providerIndexes=n}function tm(t,n,i,a,u){t.data[a]=u;const g=u.factory||(u.factory=Gi(u.type)),x=new ba(g,hi(u),null);t.blueprint[a]=x,i[a]=x,rf(t,n,0,a,tu(t,i,u.hostVars,yn),u)}function nm(t,n,i){const a=mr(n,t),u=fh(i),g=t[10],x=Mu(t,kc(t,u,null,i.onPush?64:16,a,n,g,g.createRenderer(a,i),null,null));t[n.index]=x}function zs(t,n,i,a,u,g){const x=mr(t,n);!function(t,n,i,a,u,g,x){if(null==g)Zt(t)?t.removeAttribute(n,u,i):n.removeAttribute(u);else{const w=null==x?Ft(g):x(g,a||"",u);Zt(t)?t.setAttribute(n,u,w,i):i?n.setAttributeNS(i,u,w):n.setAttribute(u,w)}}(n[11],x,g,t.value,i,a,u)}function Oo(t,n,i,a,u,g){const x=g[n];if(null!==x){const w=a.setInput;for(let I=0;I<x.length;){const F=x[I++],G=x[I++],Q=x[I++];null!==w?a.setInput(i,Q,F,G):i[G]=Q}}}function Au(t,n){let i=null,a=0;for(;a<n.length;){const u=n[a];if(0!==u)if(5!==u){if("number"==typeof u)break;t.hasOwnProperty(u)&&(null===i&&(i=[]),i.push(u,t[u],n[a+1])),a+=2}else a+=2;else a+=4}return i}function af(t,n,i,a){return new Array(t,!0,!1,n,null,0,a,i,null,null)}function Hg(t,n){const i=qr(n,t);if(qs(i)){const a=i[1];80&i[2]?Jl(a,i,a.template,i[8]):i[5]>0&&bh(i)}}function bh(t){for(let a=nh(t);null!==a;a=rh(a))for(let u=10;u<a.length;u++){const g=a[u];if(1024&g[2]){const x=g[1];Jl(x,g,x.template,g[8])}else g[5]>0&&bh(g)}const i=t[1].components;if(null!==i)for(let a=0;a<i.length;a++){const u=qr(i[a],t);qs(u)&&u[5]>0&&bh(u)}}function im(t,n){const i=qr(n,t),a=i[1];(function(t,n){for(let i=n.length;i<t.blueprint.length;i++)n.push(t.blueprint[i])})(a,i),Ql(a,i,i[8])}function Mu(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function wh(t){for(;t;){t[2]|=64;const n=Na(t);if(Fi(t)&&!n)return t;t=n}return null}function Va(t,n,i){const a=n[10];a.begin&&a.begin();try{Jl(t,n,t.template,i)}catch(u){throw Bs(n,u),u}finally{a.end&&a.end()}}function lf(t){!function(t){for(let n=0;n<t.components.length;n++){const i=t.components[n],a=vd(i),u=a[1];Vg(u,a,u.template,i)}}(t[8])}function ec(t,n,i){_o(0),n(t,i)}const cf=(()=>Promise.resolve(null))();function aa(t){return t[7]||(t[7]=[])}function Dh(t){return t.cleanup||(t.cleanup=[])}function Bs(t,n){const i=t[9],a=i?i.get(ia,null):null;a&&a.handleError(n)}function tc(t,n,i,a,u){for(let g=0;g<i.length;){const x=i[g++],w=i[g++],I=n[x],F=t.data[x];null!==F.setInput?F.setInput(I,u,a,w):I[w]=u}}function Ua(t,n,i){const a=function(t,n){return Sn(n[t])}(n,t);!function(t,n,i){Zt(t)?t.setValue(n,i):n.textContent=i}(t[11],a,i)}function Pu(t,n,i){let a=i?t.styles:null,u=i?t.classes:null,g=0;if(null!==n)for(let x=0;x<n.length;x++){const w=n[x];"number"==typeof w?g=w:1==g?u=Qt(u,w):2==g&&(a=Qt(a,w+": "+n[++x]+";"))}i?t.styles=a:t.stylesWithoutHost=a,i?t.classes=u:t.classesWithoutHost=u}const iu=new V("INJECTOR",-1);class uf{get(n,i=ei){if(i===ei){const a=new Error(`NullInjectorError: No provider for ${et(n)}!`);throw a.name="NullInjectorError",a}return i}}const Ru=new V("Set Injector scope."),Fc={},cm={};let Ih;function o(){return void 0===Ih&&(Ih=new uf),Ih}function s(t,n=null,i=null,a){return new c(t,i,n||o(),a)}class c{constructor(n,i,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];i&&ce(i,w=>this.processProvider(w,n,i)),ce([n],w=>this.processInjectorType(w,[],g)),this.records.set(iu,E(void 0,this));const x=this.records.get(Ru);this.scope=null!=x?x.value:null,this.source=u||("object"==typeof n?null:et(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,i=ei,a=Nt.Default){this.assertNotDestroyed();const u=Br(this),g=qt(void 0);try{if(!(a&Nt.SkipSelf)){let w=this.records.get(n);if(void 0===w){const I=("function"==typeof(t=n)||"object"==typeof t&&t instanceof V)&&Or(n);w=I&&this.injectableDefInScope(I)?E(d(n),Fc):null,this.records.set(n,w)}if(null!=w)return this.hydrate(n,w)}return(a&Nt.Self?o():this.parent).get(n,i=a&Nt.Optional&&i===ei?null:i)}catch(x){if("NullInjectorError"===x.name){if((x[oo]=x[oo]||[]).unshift(et(n)),u)throw x;return jl(x,n,"R3InjectorError",this.source)}throw x}finally{qt(g),Br(u)}var t}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((a,u)=>n.push(et(u))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,i,a){if(!(n=Dt(n)))return!1;let u=ri(n);const g=null==u&&n.ngModule||void 0,x=void 0===g?n:g,w=-1!==a.indexOf(x);if(void 0!==g&&(u=ri(g)),null==u)return!1;if(null!=u.imports&&!w){let G;a.push(x);try{ce(u.imports,Q=>{this.processInjectorType(Q,i,a)&&(void 0===G&&(G=[]),G.push(Q))})}finally{}if(void 0!==G)for(let Q=0;Q<G.length;Q++){const{ngModule:oe,providers:ye}=G[Q];ce(ye,Pe=>this.processProvider(Pe,oe,ye||pn))}}this.injectorDefTypes.add(x);const I=Gi(x)||(()=>new x);this.records.set(x,E(I,Fc));const F=u.providers;if(null!=F&&!w){const G=n;ce(F,Q=>this.processProvider(Q,G,F))}return void 0!==g&&void 0!==n.providers}processProvider(n,i,a){let u=O(n=Dt(n))?n:Dt(n&&n.provide);const g=S(t=n)?E(void 0,t.useValue):E(function(t,n,i){let a;if(O(t)){const u=Dt(t);return Gi(u)||d(u)}if(S(t))a=()=>Dt(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...Os(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))a=()=>ur(Dt(t.useExisting));else{const u=Dt(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Gi(u)||d(u);a=()=>new u(...Os(t.deps))}return a}(t),Fc);var t;if(O(n)||!0!==n.multi)this.records.get(u);else{let x=this.records.get(u);x||(x=E(void 0,Fc,!0),x.factory=()=>Os(x.multi),this.records.set(u,x)),u=n,x.multi.push(n)}this.records.set(u,g)}hydrate(n,i){return i.value===Fc&&(i.value=cm,i.value=i.factory()),"object"==typeof i.value&&i.value&&null!==(t=i.value)&&"object"==typeof t&&"function"==typeof t.ngOnDestroy&&this.onDestroy.add(i.value),i.value;var t}injectableDefInScope(n){if(!n.providedIn)return!1;const i=Dt(n.providedIn);return"string"==typeof i?"any"===i||i===this.scope:this.injectorDefTypes.has(i)}}function d(t){const n=Or(t),i=null!==n?n.factory:Gi(t);if(null!==i)return i;if(t instanceof V)throw new Error(`Token ${et(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const a=function(t,n){const i=[];for(let a=0;a<t;a++)i.push(n);return i}(n,"?");throw new Error(`Can't resolve all parameters for ${et(t)}: (${a.join(", ")}).`)}const i=function(t){const n=t&&(t[Ai]||t[gi]);if(n){const i=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${i}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${i}" class.`),n}return null}(t);return null!==i?()=>i.factory(t):()=>new t}(t);throw new Error("unreachable")}function E(t,n,i=!1){return{factory:t,value:n,multi:i?[]:void 0}}function S(t){return null!==t&&"object"==typeof t&&Xi in t}function O(t){return"function"==typeof t}const Ne=function(t,n,i){return function(t,n=null,i=null,a){const u=s(t,n,i,a);return u._resolveInjectorDefTypes(),u}({name:i},n,t,i)};let Me=(()=>{class t{static create(i,a){return Array.isArray(i)?Ne(i,a,""):Ne(i.providers,i.parent,i.name||"")}}return t.THROW_IF_NOT_FOUND=ei,t.NULL=new uf,t.\u0275prov=tr({token:t,providedIn:"any",factory:()=>ur(iu)}),t.__NG_ELEMENT_ID__=-1,t})();function ja(t,n){Ei(vd(t)[1],gr())}let lo=null;function $a(){if(!lo){const t=vn.Symbol;if(t&&t.iterator)lo=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let i=0;i<n.length;++i){const a=n[i];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(lo=a)}}}return lo}class js{constructor(n){this.wrapped=n}static wrap(n){return new js(n)}static unwrap(n){return js.isWrapped(n)?n.wrapped:n}static isWrapped(n){return n instanceof js}}function ca(t){return!!Yg(t)&&(Array.isArray(t)||!(t instanceof Map)&&$a()in t)}function Yg(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function ic(t,n,i){return t[n]=i}function ns(t,n,i){return!Object.is(t[n],i)&&(t[n]=i,!0)}function ku(t,n,i,a){const u=ns(t,n,i);return ns(t,n+1,a)||u}function Xg(t,n,i,a){const u=ct();return ns(u,Go(),n)&&(zn(),zs(_r(),u,t,n,i,a)),Xg}function kh(t,n,i,a,u,g,x,w){const F=function(t,n,i,a,u){const g=ku(t,n,i,a);return ns(t,n+2,u)||g}(t,Po(),i,u,x);return function(t){const n=sn.lFrame,i=n.bindingIndex;n.bindingIndex=n.bindingIndex+t}(3),F?n+Ft(i)+a+Ft(u)+g+Ft(x)+w:yn}function Ny(t,n,i,a,u,g,x,w){const I=ct(),F=zn(),G=t+20,Q=F.firstCreatePass?function(t,n,i,a,u,g,x,w,I){const F=n.consts,G=eu(n,t,4,x||null,Hi(F,w));gh(n,i,G,Hi(F,I)),Ei(n,G);const Q=G.tViews=Iu(2,G,a,u,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,F);return null!==n.queries&&(n.queries.template(n,G),Q.queries=n.queries.embeddedTView(G)),G}(G,F,I,n,i,a,u,g,x):F.data[G];fi(Q,!1);const oe=I[11].createComment("");vs(F,I,oe,Q),Wr(oe,I),Mu(I,I[G]=af(oe,I,oe,Q)),da(Q)&&Ba(F,I,Q),null!=x&&Jd(I,Q,w)}function zy(t){return Qr(sn.lFrame.contextLView,20+t)}function mf(t,n=Nt.Default){const i=ct();return null===i?ur(t,n):Nl(gr(),i,Dt(t),n)}function t_(t,n,i){const a=ct();return ns(a,Go(),n)&&es(zn(),_r(),a,t,n,a[11],i,!1),t_}function n_(t,n,i,a,u){const x=u?"class":"style";tc(t,i,n.inputs[x],x,a)}function r_(t,n,i,a){const u=ct(),g=zn(),x=20+t,w=u[11],I=u[x]=ih(w,n,sn.lFrame.currentNamespace),F=g.firstCreatePass?function(t,n,i,a,u,g,x){const w=n.consts,F=eu(n,t,2,u,Hi(w,g));return gh(n,i,F,Hi(w,x)),null!==F.attrs&&Pu(F,F.attrs,!1),null!==F.mergedAttrs&&Pu(F,F.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,F),F}(x,g,u,0,n,i,a):g.data[x];fi(F,!0);const G=F.mergedAttrs;null!==G&&Ea(w,I,G);const Q=F.classes;null!==Q&&ir(w,I,Q);const oe=F.styles;null!==oe&&Xc(w,I,oe),64!=(64&F.flags)&&vs(g,u,I,F),0===sn.lFrame.elementDepthCount&&Wr(I,u),sn.lFrame.elementDepthCount++,da(F)&&(Ba(g,u,F),function(t,n,i){if(Wa(n)){const u=n.directiveEnd;for(let g=n.directiveStart;g<u;g++){const x=t.data[g];x.contentQueries&&x.contentQueries(1,i[g],g)}}}(g,F,u)),null!==a&&Jd(u,F)}function i_(){let t=gr();Ws()?sn.lFrame.isParent=!1:(t=t.parent,fi(t,!1));const n=t;sn.lFrame.elementDepthCount--;const i=zn();i.firstCreatePass&&(Ei(i,t),Wa(t)&&i.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&n_(i,n,ct(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&n_(i,n,ct(),n.stylesWithoutHost,!1)}function Xy(t,n,i,a){r_(t,n,i,a),i_()}function Jy(){return ct()}function o_(t){return!!t&&"function"==typeof t.then}function ev(t){return!!t&&"function"==typeof t.subscribe}const s_=ev;function a_(t,n,i,a){const u=ct(),g=zn(),x=gr();return function(t,n,i,a,u,g,x,w){const I=da(a),G=t.firstCreatePass&&Dh(t),Q=n[8],oe=aa(n);let ye=!0;if(3&a.type||w){const Be=mr(a,n),wt=w?w(Be):Be,ot=oe.length,Xt=w?gn=>w(Sn(gn[a.index])):a.index;if(Zt(i)){let gn=null;if(!w&&I&&(gn=function(t,n,i,a){const u=t.cleanup;if(null!=u)for(let g=0;g<u.length-1;g+=2){const x=u[g];if(x===i&&u[g+1]===a){const w=n[7],I=u[g+2];return w.length>I?w[I]:null}"string"==typeof x&&(g+=2)}return null}(t,n,u,a.index)),null!==gn)(gn.__ngLastListenerFn__||gn).__ngNextListenerFn__=g,gn.__ngLastListenerFn__=g,ye=!1;else{g=l_(a,n,Q,g,!1);const Yn=i.listen(wt,u,g);oe.push(g,Yn),G&&G.push(u,Xt,ot,ot+1)}}else g=l_(a,n,Q,g,!0),wt.addEventListener(u,g,x),oe.push(g),G&&G.push(u,Xt,ot,x)}else g=l_(a,n,Q,g,!1);const Pe=a.outputs;let Ze;if(ye&&null!==Pe&&(Ze=Pe[u])){const Be=Ze.length;if(Be)for(let wt=0;wt<Be;wt+=2){const uo=n[Ze[wt]][Ze[wt+1]].subscribe(g),Za=oe.length;oe.push(g,uo),G&&G.push(u,a.index,Za,-(Za+1))}}}(g,u,u[11],x,t,n,!!i,a),a_}function rv(t,n,i,a){try{return!1!==i(a)}catch(u){return Bs(t,u),!1}}function l_(t,n,i,a,u){return function g(x){if(x===Function)return a;const w=2&t.flags?qr(t.index,n):n;0==(32&n[2])&&wh(w);let I=rv(n,0,a,x),F=g.__ngNextListenerFn__;for(;F;)I=rv(n,0,F,x)&&I,F=F.__ngNextListenerFn__;return u&&!1===I&&(x.preventDefault(),x.returnValue=!1),I}}function iv(t=1){return function(t){return(sn.lFrame.contextLView=function(t,n){for(;t>0;)n=n[15],t--;return n}(t,sn.lFrame.contextLView))[8]}(t)}function Av(t,n=""){const i=ct(),a=zn(),u=t+20,g=a.firstCreatePass?eu(a,u,1,n,null):a.data[u],x=i[u]=function(t,n){return Zt(t)?t.createText(n):t.createTextNode(n)}(i[11],n);vs(a,i,x,g),fi(g,!1)}function h_(t){return fm("",t,""),h_}function fm(t,n,i){const a=ct(),u=function(t,n,i,a){return ns(t,Go(),i)?n+Ft(i)+a:yn}(a,t,n,i);return u!==yn&&Ua(a,wi(),u),fm}function d_(t,n,i,a,u,g,x){const w=ct(),I=kh(w,t,n,i,a,u,g,x);return I!==yn&&Ua(w,wi(),I),d_}function f_(t,n,i){const a=ct();return ns(a,Go(),n)&&es(zn(),_r(),a,t,n,a[11],i,!0),f_}const Fu=void 0;var X1=["en",[["a","p"],["AM","PM"],Fu],[["AM","PM"],Fu,Fu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Fu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Fu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Fu,"{1} 'at' {0}",Fu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===i?1:5}];let Uh={};function p_(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let i=Wv(n);if(i)return i;const a=n.split("-")[0];if(i=Wv(a),i)return i;if("en"===a)return X1;throw new Error(`Missing locale data for the locale "${t}".`)}function Zv(t){return p_(t)[cn.PluralCase]}function Wv(t){return t in Uh||(Uh[t]=vn.ng&&vn.ng.common&&vn.ng.common.locales&&vn.ng.common.locales[t]),Uh[t]}var cn=(()=>((cn=cn||{})[cn.LocaleId=0]="LocaleId",cn[cn.DayPeriodsFormat=1]="DayPeriodsFormat",cn[cn.DayPeriodsStandalone=2]="DayPeriodsStandalone",cn[cn.DaysFormat=3]="DaysFormat",cn[cn.DaysStandalone=4]="DaysStandalone",cn[cn.MonthsFormat=5]="MonthsFormat",cn[cn.MonthsStandalone=6]="MonthsStandalone",cn[cn.Eras=7]="Eras",cn[cn.FirstDayOfWeek=8]="FirstDayOfWeek",cn[cn.WeekendRange=9]="WeekendRange",cn[cn.DateFormat=10]="DateFormat",cn[cn.TimeFormat=11]="TimeFormat",cn[cn.DateTimeFormat=12]="DateTimeFormat",cn[cn.NumberSymbols=13]="NumberSymbols",cn[cn.NumberFormats=14]="NumberFormats",cn[cn.CurrencyCode=15]="CurrencyCode",cn[cn.CurrencySymbol=16]="CurrencySymbol",cn[cn.CurrencyName=17]="CurrencyName",cn[cn.Currencies=18]="Currencies",cn[cn.Directionality=19]="Directionality",cn[cn.PluralCase=20]="PluralCase",cn[cn.ExtraData=21]="ExtraData",cn))();const pm="en-US";let Yv=pm;function m_(t){Dr(t,"Expected localeId to be defined"),"string"==typeof t&&(Yv=t.toLowerCase().replace(/_/g,"-"))}class x0{}const w0="ngComponent";class Kw{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${et(t)}. Did you add it to @NgModule.entryComponents?`);return n[w0]=t,n}(n)}}let $h=(()=>{class t{}return t.NULL=new Kw,t})();function vm(...t){}function Gh(t,n){return new ac(mr(t,n))}const eE=function(){return Gh(gr(),ct())};let ac=(()=>{class t{constructor(i){this.nativeElement=i}}return t.__NG_ELEMENT_ID__=eE,t})();function E0(t){return t instanceof ac?t.nativeElement:t}class xm{}let tE=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>rE(),t})();const rE=function(){const t=ct(),i=qr(gr().index,t);return function(t){return t[11]}(ci(i)?i:t)};let E_=(()=>{class t{}return t.\u0275prov=tr({token:t,providedIn:"root",factory:()=>null}),t})();class C0{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const D0=new C0("12.2.12");class T0{constructor(){}supports(n){return ca(n)}create(n){return new aE(n)}}const sE=(t,n)=>n;class aE{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||sE}forEachItem(n){let i;for(i=this._itHead;null!==i;i=i._next)n(i)}forEachOperation(n){let i=this._itHead,a=this._removalsHead,u=0,g=null;for(;i||a;){const x=!a||i&&i.currentIndex<I0(a,u,g)?i:a,w=I0(x,u,g),I=x.currentIndex;if(x===a)u--,a=a._nextRemoved;else if(i=i._next,null==x.previousIndex)u++;else{g||(g=[]);const F=w-u,G=I-u;if(F!=G){for(let oe=0;oe<F;oe++){const ye=oe<g.length?g[oe]:g[oe]=0,Pe=ye+oe;G<=Pe&&Pe<F&&(g[oe]=ye+1)}g[x.previousIndex]=G-F}}w!==I&&n(x,w,I)}}forEachPreviousItem(n){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)n(i)}forEachMovedItem(n){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)n(i)}forEachIdentityChange(n){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)n(i)}diff(n){if(null==n&&(n=[]),!ca(n))throw new Error(`Error trying to diff '${et(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let u,g,x,i=this._itHead,a=!1;if(Array.isArray(n)){this.length=n.length;for(let w=0;w<this.length;w++)g=n[w],x=this._trackByFn(w,g),null!==i&&Object.is(i.trackById,x)?(a&&(i=this._verifyReinsertion(i,g,x,w)),Object.is(i.item,g)||this._addIdentityChange(i,g)):(i=this._mismatch(i,g,x,w),a=!0),i=i._next}else u=0,function(t,n){if(Array.isArray(t))for(let i=0;i<t.length;i++)n(t[i]);else{const i=t[$a()]();let a;for(;!(a=i.next()).done;)n(a.value)}}(n,w=>{x=this._trackByFn(u,w),null!==i&&Object.is(i.trackById,x)?(a&&(i=this._verifyReinsertion(i,w,x,u)),Object.is(i.item,w)||this._addIdentityChange(i,w)):(i=this._mismatch(i,w,x,u),a=!0),i=i._next,u++}),this.length=u;return this._truncate(i),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,i,a,u){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(n.item,i)||this._addIdentityChange(n,i),this._reinsertAfter(n,g,u)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(n.item,i)||this._addIdentityChange(n,i),this._moveAfter(n,g,u)):n=this._addAfter(new lE(i,a),g,u),n}_verifyReinsertion(n,i,a,u){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?n=this._reinsertAfter(g,n._prev,u):n.currentIndex!=u&&(n.currentIndex=u,this._addToMoves(n,u)),n}_truncate(n){for(;null!==n;){const i=n._next;this._addToRemovals(this._unlink(n)),n=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,i,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const u=n._prevRemoved,g=n._nextRemoved;return null===u?this._removalsHead=g:u._nextRemoved=g,null===g?this._removalsTail=u:g._prevRemoved=u,this._insertAfter(n,i,a),this._addToMoves(n,a),n}_moveAfter(n,i,a){return this._unlink(n),this._insertAfter(n,i,a),this._addToMoves(n,a),n}_addAfter(n,i,a){return this._insertAfter(n,i,a),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,i,a){const u=null===i?this._itHead:i._next;return n._next=u,n._prev=i,null===u?this._itTail=n:u._prev=n,null===i?this._itHead=n:i._next=n,null===this._linkedRecords&&(this._linkedRecords=new S0),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const i=n._prev,a=n._next;return null===i?this._itHead=a:i._next=a,null===a?this._itTail=i:a._prev=i,n}_addToMoves(n,i){return n.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new S0),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,i){return n.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class lE{constructor(n,i){this.item=n,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class cE{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,i){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===i||i<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){const i=n._prevDup,a=n._nextDup;return null===i?this._head=a:i._nextDup=a,null===a?this._tail=i:a._prevDup=i,null===this._head}}class S0{constructor(){this.map=new Map}put(n){const i=n.trackById;let a=this.map.get(i);a||(a=new cE,this.map.set(i,a)),a.add(n)}get(n,i){const u=this.map.get(n);return u?u.get(n,i):null}remove(n){const i=n.trackById;return this.map.get(i).remove(n)&&this.map.delete(i),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function I0(t,n,i){const a=t.previousIndex;if(null===a)return a;let u=0;return i&&a<i.length&&(u=i[a]),a+n+u}class A0{constructor(){}supports(n){return n instanceof Map||Yg(n)}create(){return new uE}}class uE{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let i;for(i=this._mapHead;null!==i;i=i._next)n(i)}forEachPreviousItem(n){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)n(i)}forEachChangedItem(n){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)n(i)}diff(n){if(n){if(!(n instanceof Map||Yg(n)))throw new Error(`Error trying to diff '${et(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,u)=>{if(i&&i.key===u)this._maybeAddToChanges(i,a),this._appendAfter=i,i=i._next;else{const g=this._getOrCreateRecordForKey(u,a);i=this._insertBeforeOrAppend(i,g)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let a=i;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,i){if(n){const a=n._prev;return i._next=n,i._prev=a,n._prev=i,a&&(a._next=i),n===this._mapHead&&(this._mapHead=i),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(n,i){if(this._records.has(n)){const u=this._records.get(n);this._maybeAddToChanges(u,i);const g=u._prev,x=u._next;return g&&(g._next=x),x&&(x._prev=g),u._next=null,u._prev=null,u}const a=new hE(n);return this._records.set(n,a),a.currentValue=i,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,i){Object.is(i,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=i,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,i){n instanceof Map?n.forEach(i):Object.keys(n).forEach(a=>i(n[a],a))}}class hE{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function M0(){return new bm([new T0])}let bm=(()=>{class t{constructor(i){this.factories=i}static create(i,a){if(null!=a){const u=a.factories.slice();i=i.concat(u)}return new t(i)}static extend(i){return{provide:t,useFactory:a=>t.create(i,a||M0()),deps:[[t,new ll,new Pa]]}}find(i){const a=this.factories.find(u=>u.supports(i));if(null!=a)return a;throw new Error(`Cannot find a differ supporting object '${i}' of type '${function(t){return t.name||typeof t}(i)}'`)}}return t.\u0275prov=tr({token:t,providedIn:"root",factory:M0}),t})();function P0(){return new wm([new A0])}let wm=(()=>{class t{constructor(i){this.factories=i}static create(i,a){if(a){const u=a.factories.slice();i=i.concat(u)}return new t(i)}static extend(i){return{provide:t,useFactory:a=>t.create(i,a||P0()),deps:[[t,new ll,new Pa]]}}find(i){const a=this.factories.find(u=>u.supports(i));if(a)return a;throw new Error(`Cannot find a differ supporting object '${i}'`)}}return t.\u0275prov=tr({token:t,providedIn:"root",factory:P0}),t})();function Em(t,n,i,a,u=!1){for(;null!==i;){const g=n[i.index];if(null!==g&&a.push(Sn(g)),ui(g))for(let w=10;w<g.length;w++){const I=g[w],F=I[1].firstChild;null!==F&&Em(I[1],I,F,a)}const x=i.type;if(8&x)Em(t,n,i.child,a);else if(32&x){const w=Dd(i,n);let I;for(;I=w();)a.push(I)}else if(16&x){const w=wu(n,i);if(Array.isArray(w))a.push(...w);else{const I=Na(n[16]);Em(I[1],I,w,a,!0)}}i=u?i.projectionNext:i.next}return a}class bf{constructor(n,i){this._lView=n,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,i=n[1];return Em(i,n,i.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(ui(n)){const i=n[8],a=i?i.indexOf(this):-1;a>-1&&(Ad(n,a),xe(i,a))}this._attachedToViewContainer=!1}Dp(this._lView[1],this._lView)}onDestroy(n){Wp(this._lView[1],this._lView,null,n)}markForCheck(){wh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Va(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,i){el(!0);try{Va(t,n,i)}finally{el(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var n;this._appRef=null,hl(this._lView[1],n=this._lView,n[11],2,null,null)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class fE extends bf{constructor(n){super(n),this._view=n}detectChanges(){lf(this._view)}checkNoChanges(){!function(t){el(!0);try{lf(t)}finally{el(!1)}}(this._view)}get context(){return null}}const mE=function(t){return function(t,n,i){if(no(t)&&!i){const a=qr(t.index,n);return new bf(a,a)}return 47&t.type?new bf(n[16],n):null}(gr(),ct(),16==(16&t))};let gE=(()=>{class t{}return t.__NG_ELEMENT_ID__=mE,t})();const vE=[new A0],bE=new bm([new T0]),wE=new wm(vE),CE=function(){return Cm(gr(),ct())};let wf=(()=>{class t{}return t.__NG_ELEMENT_ID__=CE,t})();const DE=wf,TE=class extends DE{constructor(n,i,a){super(),this._declarationLView=n,this._declarationTContainer=i,this.elementRef=a}createEmbeddedView(n){const i=this._declarationTContainer.tViews,a=kc(this._declarationLView,i,n,16,null,i.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(i)),Ql(i,a,n),new bf(a)}};function Cm(t,n){return 4&t.type?new TE(n,t,Gh(t,n)):null}class Lu{}class R0{}const AE=function(){return L0(gr(),ct())};let Dm=(()=>{class t{}return t.__NG_ELEMENT_ID__=AE,t})();const PE=Dm,k0=class extends PE{constructor(n,i,a){super(),this._lContainer=n,this._hostTNode=i,this._hostLView=a}get element(){return Gh(this._hostTNode,this._hostLView)}get injector(){return new Xo(this._hostTNode,this._hostLView)}get parentInjector(){const n=ps(this._hostTNode,this._hostLView);if(Ca(n)){const i=Ks(n,this._hostLView),a=Jr(n);return new Xo(i[1].data[a+8],i)}return new Xo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const i=F0(this._lContainer);return null!==i&&i[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,i,a){const u=n.createEmbeddedView(i||{});return this.insert(u,a),u}createComponent(n,i,a,u,g){const x=a||this.parentInjector;if(!g&&null==n.ngModule&&x){const I=x.get(Lu,null);I&&(g=I)}const w=n.create(x,u,void 0,g);return this.insert(w.hostView,i),w}insert(n,i){const a=n._lView,u=a[1];if(ui(a[3])){const G=this.indexOf(n);if(-1!==G)this.detach(G);else{const Q=a[3],oe=new k0(Q,Q[6],Q[3]);oe.detach(oe.indexOf(n))}}const g=this._adjustIndex(i),x=this._lContainer;!function(t,n,i,a){const u=10+a,g=i.length;a>0&&(i[u-1][4]=n),a<g-10?(n[4]=i[u],me(i,10+a,n)):(i.push(n),n[4]=null),n[3]=i;const x=n[17];null!==x&&i!==x&&function(t,n){const i=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===i?t[9]=[n]:i.push(n)}(x,n);const w=n[19];null!==w&&w.insertView(t),n[2]|=128}(u,a,x,g);const w=Wl(g,x),I=a[11],F=sh(I,x[7]);return null!==F&&function(t,n,i,a,u,g){a[0]=u,a[6]=n,hl(t,a,i,1,u,g)}(u,x[6],I,a,F,w),n.attachToViewContainerRef(),me(C_(x),g,n),n}move(n,i){return this.insert(n,i)}indexOf(n){const i=F0(this._lContainer);return null!==i?i.indexOf(n):-1}remove(n){const i=this._adjustIndex(n,-1),a=Ad(this._lContainer,i);a&&(xe(C_(this._lContainer),i),Dp(a[1],a))}detach(n){const i=this._adjustIndex(n,-1),a=Ad(this._lContainer,i);return a&&null!=xe(C_(this._lContainer),i)?new bf(a):null}_adjustIndex(n,i=0){return null==n?this.length+i:n}};function F0(t){return t[8]}function C_(t){return t[8]||(t[8]=[])}function L0(t,n){let i;const a=n[t.index];if(ui(a))i=a;else{let u;if(8&t.type)u=Sn(a);else{const g=n[11];u=g.createComment("");const x=mr(t,n);Ac(g,sh(g,x),u,function(t,n){return Zt(t)?t.nextSibling(n):n.nextSibling}(g,x),!1)}n[t.index]=i=af(a,n,u,t),Mu(n,i)}return new k0(i,t,n)}const Wh={};class tx extends $h{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const i=Lt(n);return new rx(i,this.ngModule)}}function nx(t){const n=[];for(let i in t)t.hasOwnProperty(i)&&n.push({propName:t[i],templateName:i});return n}const SC=new V("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>pp});class rx extends x0{constructor(n,i){super(),this.componentDef=n,this.ngModule=i,this.componentType=n.type,this.selector=n.selectors.map(lh).join(","),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!i}get inputs(){return nx(this.componentDef.inputs)}get outputs(){return nx(this.componentDef.outputs)}create(n,i,a,u){const g=(u=u||this.ngModule)?function(t,n){return{get:(i,a,u)=>{const g=t.get(i,Wh,u);return g!==Wh||a===Wh?g:n.get(i,a,u)}}}(n,u.injector):n,x=g.get(xm,jn),w=g.get(E_,null),I=x.createRenderer(null,this.componentDef),F=this.componentDef.selectors[0][0]||"div",G=a?function(t,n,i){if(Zt(t))return t.selectRootElement(n,i===Kt.ShadowDom);let a="string"==typeof n?t.querySelector(n):n;return a.textContent="",a}(I,a,this.componentDef.encapsulation):ih(x.createRenderer(null,this.componentDef),F,function(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(F)),Q=this.componentDef.onPush?576:528,oe=function(t,n){return{components:[],scheduler:t||pp,clean:cf,playerHandler:n||null,flags:0}}(),ye=Iu(0,null,null,1,0,null,null,null,null,null),Pe=kc(null,ye,oe,Q,null,null,x,I,w,g);let Ze,Be;ko(Pe);try{const wt=function(t,n,i,a,u,g){const x=i[1];i[20]=t;const I=eu(x,20,2,"#host",null),F=I.mergedAttrs=n.hostAttrs;null!==F&&(Pu(I,F,!0),null!==t&&(Ea(u,t,F),null!==I.classes&&ir(u,t,I.classes),null!==I.styles&&Xc(u,t,I.styles)));const G=a.createRenderer(t,n),Q=kc(i,fh(n),null,n.onPush?64:16,i[20],I,a,G,g||null,null);return x.firstCreatePass&&(sl(Ta(I,i),x,n.type),vh(x,I),sf(I,i.length,1)),Mu(i,Q),i[20]=Q}(G,this.componentDef,Pe,x,I);if(G)if(a)Ea(I,G,["ng-version",D0.full]);else{const{attrs:ot,classes:Xt}=function(t){const n=[],i=[];let a=1,u=2;for(;a<t.length;){let g=t[a];if("string"==typeof g)2===u?""!==g&&n.push(g,t[++a]):8===u&&i.push(g);else{if(!oa(u))break;u=g}a++}return{attrs:n,classes:i}}(this.componentDef.selectors[0]);ot&&Ea(I,G,ot),Xt&&Xt.length>0&&ir(I,G,Xt.join(" "))}if(Be=mo(ye,20),void 0!==i){const ot=Be.projection=[];for(let Xt=0;Xt<this.ngContentSelectors.length;Xt++){const gn=i[Xt];ot.push(null!=gn?Array.from(gn):null)}}Ze=function(t,n,i,a,u){const g=i[1],x=function(t,n,i){const a=gr();t.firstCreatePass&&(i.providersResolver&&i.providersResolver(i),tm(t,a,n,tu(t,n,1,null),i));const u=Fs(n,t,a.directiveStart,a);Wr(u,n);const g=mr(a,n);return g&&Wr(g,n),u}(g,i,n);if(a.components.push(x),t[8]=x,u&&u.forEach(I=>I(x,n)),n.contentQueries){const I=gr();n.contentQueries(1,x,I.directiveStart)}const w=gr();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(Wi(w.index),rf(i[1],w,0,w.directiveStart,w.directiveEnd,n),yh(n,x)),x}(wt,this.componentDef,Pe,oe,[ja]),Ql(ye,Pe,null)}finally{_a()}return new MC(this.componentType,Ze,Gh(Be,Pe),Pe,Be)}}class MC extends class{}{constructor(n,i,a,u,g){super(),this.location=a,this._rootLView=u,this._tNode=g,this.instance=i,this.hostView=this.changeDetectorRef=new fE(u),this.componentType=n}get injector(){return new Xo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const Yh=new Map;class kC extends Lu{constructor(n,i){super(),this._parent=i,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new tx(this);const a=hn(n),u=n[he]||null;u&&m_(u),this._bootstrapComponents=La(a.bootstrap),this._r3Injector=s(n,i,[{provide:Lu,useValue:this},{provide:$h,useValue:this.componentFactoryResolver}],et(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,i=Me.THROW_IF_NOT_FOUND,a=Nt.Default){return n===Me||n===Lu||n===iu?this:this._r3Injector.get(n,i,a)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class N_ extends R0{constructor(n){super(),this.moduleType=n,null!==hn(n)&&function(t){const n=new Set;!function i(a){const u=hn(a,!0),g=u.id;null!==g&&(function(t,n,i){if(n&&n!==i)throw new Error(`Duplicate module registered for ${t} - ${et(n)} vs ${et(n.name)}`)}(g,Yh.get(g),a),Yh.set(g,a));const x=La(u.imports);for(const w of x)n.has(w)||(n.add(w),i(w))}(t)}(n)}create(n){return new kC(this.moduleType,n)}}function sx(t,n,i,a){return function(t,n,i,a,u,g){const x=n+i;return ns(t,x,u)?ic(t,x+1,g?a.call(g,u):a(u)):Mf(t,x+1)}(ct(),Zr(),t,n,i,a)}function Mf(t,n){const i=t[n];return i===yn?void 0:i}function dx(t,n){const i=zn();let a;const u=t+20;i.firstCreatePass?(a=function(t,n){if(n)for(let i=n.length-1;i>=0;i--){const a=n[i];if(t===a.name)return a}throw new Tn("302",`The pipe '${t}' could not be found!`)}(n,i.pipeRegistry),i.data[u]=a,a.onDestroy&&(i.destroyHooks||(i.destroyHooks=[])).push(u,a.onDestroy)):a=i.data[u];const g=a.factory||(a.factory=Gi(a.type)),x=qt(mf);try{const w=St(!1),I=g();return St(w),function(t,n,i,a){i>=t.data.length&&(t.data[i]=null,t.blueprint[i]=null),n[i]=a}(i,ct(),u,I),I}finally{qt(x)}}function fx(t,n,i,a){const u=t+20,g=ct(),x=Qr(g,u);return function(t,n){js.isWrapped(n)&&(n=js.unwrap(n),t[Po()]=yn);return n}(g,function(t,n){return t[1].data[n].pure}(g,u)?function(t,n,i,a,u,g,x){const w=n+i;return ku(t,w,u,g)?ic(t,w+2,x?a.call(x,u,g):a(u,g)):Mf(t,w+2)}(g,Zr(),n,x.transform,i,a,x):x.transform(i,a))}function z_(t){return n=>{setTimeout(t,void 0,n)}}const lc=class extends it.xQ{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,i,a){var u,g,x;let w=n,I=i||(()=>null),F=a;if(n&&"object"==typeof n){const Q=n;w=null===(u=Q.next)||void 0===u?void 0:u.bind(Q),I=null===(g=Q.error)||void 0===g?void 0:g.bind(Q),F=null===(x=Q.complete)||void 0===x?void 0:x.bind(Q)}this.__isAsync&&(I=z_(I),w&&(w=z_(w)),F&&(F=z_(F)));const G=super.subscribe({next:w,error:I,complete:F});return n instanceof Pt.w&&n.add(G),G}};function YC(){return this._results[$a()]()}class Mm{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=$a(),a=Mm.prototype;a[i]||(a[i]=YC)}get changes(){return this._changes||(this._changes=new lc)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,i){return this._results.reduce(n,i)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,i){const a=this;a.dirty=!1;const u=ee(n);(this._changesDetected=!function(t,n,i){if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++){let u=t[a],g=n[a];if(i&&(u=i(u),g=i(g)),g!==u)return!1}return!0}(a._results,u,i))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class B_{constructor(n){this.queryList=n,this.matches=null}clone(){return new B_(this.queryList)}setDirty(){this.queryList.setDirty()}}class V_{constructor(n=[]){this.queries=n}createEmbeddedView(n){const i=n.queries;if(null!==i){const a=null!==n.contentQueries?n.contentQueries[0]:i.length,u=[];for(let g=0;g<a;g++){const x=i.getByIndex(g);u.push(this.queries[x.indexInDeclarationView].clone())}return new V_(u)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let i=0;i<this.queries.length;i++)null!==wx(n,i).matches&&this.queries[i].setDirty()}}class px{constructor(n,i,a=null){this.predicate=n,this.flags=i,this.read=a}}class U_{constructor(n=[]){this.queries=n}elementStart(n,i){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,i)}elementEnd(n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(n)}embeddedTView(n){let i=null;for(let a=0;a<this.length;a++){const u=null!==i?i.length:0,g=this.getByIndex(a).embeddedTView(n,u);g&&(g.indexInDeclarationView=a,null!==i?i.push(g):i=[g])}return null!==i?new U_(i):null}template(n,i){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,i)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class j_{constructor(n,i=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(n,i){this.isApplyingToNode(i)&&this.matchTNode(n,i)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,i){this.elementStart(n,i)}embeddedTView(n,i){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,i),new j_(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let a=n.parent;for(;null!==a&&8&a.type&&a.index!==i;)a=a.parent;return i===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(n,i){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const g=a[u];this.matchTNodeWithReadOption(n,i,QC(i,g)),this.matchTNodeWithReadOption(n,i,Aa(i,n,g,!1,!1))}else a===wf?4&i.type&&this.matchTNodeWithReadOption(n,i,-1):this.matchTNodeWithReadOption(n,i,Aa(i,n,a,!1,!1))}matchTNodeWithReadOption(n,i,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===ac||u===Dm||u===wf&&4&i.type)this.addMatch(i.index,-2);else{const g=Aa(i,n,u,!1,!1);null!==g&&this.addMatch(i.index,g)}else this.addMatch(i.index,a)}}addMatch(n,i){null===this.matches?this.matches=[n,i]:this.matches.push(n,i)}}function QC(t,n){const i=t.localNames;if(null!==i)for(let a=0;a<i.length;a+=2)if(i[a]===n)return i[a+1];return null}function eD(t,n,i,a){return-1===i?function(t,n){return 11&t.type?Gh(t,n):4&t.type?Cm(t,n):null}(n,t):-2===i?function(t,n,i){return i===ac?Gh(n,t):i===wf?Cm(n,t):i===Dm?L0(n,t):void 0}(t,n,a):Fs(t,t[1],i,n)}function mx(t,n,i,a){const u=n[19].queries[a];if(null===u.matches){const g=t.data,x=i.matches,w=[];for(let I=0;I<x.length;I+=2){const F=x[I];w.push(F<0?null:eD(n,g[F],x[I+1],i.metadata.read))}u.matches=w}return u.matches}function $_(t,n,i,a){const u=t.queries.getByIndex(i),g=u.matches;if(null!==g){const x=mx(t,n,u,i);for(let w=0;w<g.length;w+=2){const I=g[w];if(I>0)a.push(x[w/2]);else{const F=g[w+1],G=n[-I];for(let Q=10;Q<G.length;Q++){const oe=G[Q];oe[17]===oe[3]&&$_(oe[1],oe,F,a)}if(null!==G[9]){const Q=G[9];for(let oe=0;oe<Q.length;oe++){const ye=Q[oe];$_(ye[1],ye,F,a)}}}}}return a}function gx(t){const n=ct(),i=zn(),a=tl();_o(a+1);const u=wx(i,a);if(t.dirty&&Ps(n)===(2==(2&u.metadata.flags))){if(null===u.matches)t.reset([]);else{const g=u.crossesNgTemplate?$_(i,n,a,[]):mx(i,n,u,a);t.reset(g,E0),t.notifyOnChanges()}return!0}return!1}function _x(t,n,i){const a=zn();a.firstCreatePass&&(bx(a,new px(t,n,i),-1),2==(2&n)&&(a.staticViewQueries=!0)),xx(a,ct(),n)}function yx(t,n,i,a){const u=zn();if(u.firstCreatePass){const g=gr();bx(u,new px(n,i,a),g.index),function(t,n){const i=t.contentQueries||(t.contentQueries=[]);n!==(i.length?i[i.length-1]:-1)&&i.push(t.queries.length-1,n)}(u,t),2==(2&i)&&(u.staticContentQueries=!0)}xx(u,ct(),i)}function vx(){return t=ct(),n=tl(),t[19].queries[n].queryList;var t,n}function xx(t,n,i){const a=new Mm(4==(4&i));Wp(t,n,a,a.destroy),null===n[19]&&(n[19]=new V_),n[19].queries.push(new B_(a))}function bx(t,n,i){null===t.queries&&(t.queries=new U_),t.queries.track(new j_(n,i))}function wx(t,n){return t.queries.getByIndex(n)}const Y_=new V("Application Initializer");let Kh=(()=>{class t{constructor(i){this.appInits=i,this.resolve=vm,this.reject=vm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const i=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const g=this.appInits[u]();if(o_(g))i.push(g);else if(s_(g)){const x=new Promise((w,I)=>{g.subscribe({complete:w,error:I})});i.push(x)}}Promise.all(i).then(()=>{a()}).catch(u=>{this.reject(u)}),0===i.length&&a(),this.initialized=!0}}return t.\u0275fac=function(i){return new(i||t)(ur(Y_,8))},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();const Vx=new V("AppId"),PD={provide:Vx,useFactory:function(){return`${X_()}${X_()}${X_()}`},deps:[]};function X_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Ux=new V("Platform Initializer"),jx=new V("Platform ID"),$x=new V("appBootstrapListener");let Gx=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();const km=new V("LocaleId"),Hx=new V("DefaultCurrencyCode");class kD{constructor(n,i){this.ngModuleFactory=n,this.componentFactories=i}}const K_=function(t){return new N_(t)},FD=K_,LD=function(t){return Promise.resolve(K_(t))},qx=function(t){const n=K_(t),a=La(hn(t).declarations).reduce((u,g)=>{const x=Lt(g);return x&&u.push(new rx(x)),u},[]);return new kD(n,a)},OD=qx,ND=function(t){return Promise.resolve(qx(t))};let Ff=(()=>{class t{constructor(){this.compileModuleSync=FD,this.compileModuleAsync=LD,this.compileModuleAndAllComponentsSync=OD,this.compileModuleAndAllComponentsAsync=ND}clearCache(){}clearCacheFor(i){}getModuleId(i){}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();const VD=(()=>Promise.resolve(0))();function Q_(t){"undefined"==typeof Zone?VD.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class ua{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new lc(!1),this.onMicrotaskEmpty=new lc(!1),this.onStable=new lc(!1),this.onError=new lc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&i,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function(){let t=vn.requestAnimationFrame,n=vn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i);const a=n[Zone.__symbol__("OriginalDelegate")];a&&(n=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(vn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,ey(t),t.isCheckStableRunning=!0,J_(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),ey(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,a,u,g,x,w)=>{try{return Zx(t),i.invokeTask(u,g,x,w)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),Wx(t)}},onInvoke:(i,a,u,g,x,w,I)=>{try{return Zx(t),i.invoke(u,g,x,w,I)}finally{t.shouldCoalesceRunChangeDetection&&n(),Wx(t)}},onHasTask:(i,a,u,g)=>{i.hasTask(u,g),a===u&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,ey(t),J_(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(i,a,u,g)=>(i.handleError(u,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(u)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ua.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ua.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,i,a){return this._inner.run(n,i,a)}runTask(n,i,a,u){const g=this._inner,x=g.scheduleEventTask("NgZoneEvent: "+u,n,jD,vm,vm);try{return g.runTask(x,i,a)}finally{g.cancelTask(x)}}runGuarded(n,i,a){return this._inner.runGuarded(n,i,a)}runOutsideAngular(n){return this._outer.run(n)}}const jD={};function J_(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ey(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Zx(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Wx(t){t._nesting--,J_(t)}class HD{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new lc,this.onMicrotaskEmpty=new lc,this.onStable=new lc,this.onError=new lc}run(n,i,a){return n.apply(i,a)}runGuarded(n,i,a){return n.apply(i,a)}runOutsideAngular(n){return n()}runTask(n,i,a,u){return n.apply(i,a)}}let Yx=(()=>{class t{constructor(i){this._ngZone=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ua.assertNotInAngularZone(),Q_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Q_(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(i)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,a,u){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(x=>x.timeoutId!==g),i(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:i,timeoutId:g,updateCb:u})}whenStable(i,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(i,a,u){return[]}}return t.\u0275fac=function(i){return new(i||t)(ur(ua))},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})(),Xx=(()=>{class t{constructor(){this._applications=new Map,ty.addToWindow(this)}registerApplication(i,a){this._applications.set(i,a)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,a=!0){return ty.findTestabilityInTree(this,i,a)}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();class qD{addToWindow(n){}findTestabilityInTree(n,i,a){return null}}function ZD(t){ty=t}let ty=new qD,Kx=!0,Qx=!1;function WD(){if(Qx)throw new Error("Cannot enable prod mode after platform setup.");Kx=!1}let _l;const eb=new V("AllowMultipleToken");class tT{constructor(n,i){this.name=n,this.token=i}}function tb(t,n,i=[]){const a=`Platform: ${n}`,u=new V(a);return(g=[])=>{let x=nb();if(!x||x.injector.get(eb,!1))if(t)t(i.concat(g).concat({provide:u,useValue:!0}));else{const w=i.concat(g).concat({provide:u,useValue:!0},{provide:Ru,useValue:"platform"});!function(t){if(_l&&!_l.destroyed&&!_l.injector.get(eb,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");_l=t.get(rb);const n=t.get(Ux,null);n&&n.forEach(i=>i())}(Me.create({providers:w,name:a}))}return function(t){const n=nb();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(u)}}function nb(){return _l&&!_l.destroyed?_l:null}let rb=(()=>{class t{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,a){const w=function(t,n){let i;return i="noop"===t?new HD:("zone.js"===t?void 0:t)||new ua({enableLongStackTrace:(Qx=!0,Kx),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),i}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:ua,useValue:w}];return w.run(()=>{const F=Me.create({providers:I,parent:this.injector,name:i.moduleType.name}),G=i.create(F),Q=G.injector.get(ia,null);if(!Q)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return w.runOutsideAngular(()=>{const oe=w.onError.subscribe({next:ye=>{Q.handleError(ye)}});G.onDestroy(()=>{ny(this._modules,G),oe.unsubscribe()})}),function(t,n,i){try{const a=i();return o_(a)?a.catch(u=>{throw n.runOutsideAngular(()=>t.handleError(u)),u}):a}catch(a){throw n.runOutsideAngular(()=>t.handleError(a)),a}}(Q,w,()=>{const oe=G.injector.get(Kh);return oe.runInitializers(),oe.donePromise.then(()=>(m_(G.injector.get(km,pm)||pm),this._moduleDoBootstrap(G),G))})})}bootstrapModule(i,a=[]){const u=ib({},a);return function(t,n,i){const a=new N_(i);return Promise.resolve(a)}(0,0,i).then(g=>this.bootstrapModuleFactory(g,u))}_moduleDoBootstrap(i){const a=i.injector.get(Lf);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!i.instance.ngDoBootstrap)throw new Error(`The module ${et(i.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);i.instance.ngDoBootstrap(a)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(i){return new(i||t)(ur(Me))},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();function ib(t,n){return Array.isArray(n)?n.reduce(ib,t):Object.assign(Object.assign({},t),n)}let Lf=(()=>{class t{constructor(i,a,u,g,x){this._zone=i,this._injector=a,this._exceptionHandler=u,this._componentFactoryResolver=g,this._initStatus=x,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new ue.y(F=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{F.next(this._stable),F.complete()})}),I=new ue.y(F=>{let G;this._zone.runOutsideAngular(()=>{G=this._zone.onStable.subscribe(()=>{ua.assertNotInAngularZone(),Q_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,F.next(!0))})})});const Q=this._zone.onUnstable.subscribe(()=>{ua.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{F.next(!1)}))});return()=>{G.unsubscribe(),Q.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,i=null,a=t[t.length-1];return(0,ne.K)(a)?(i=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof a&&(n=t.pop()),null===i&&1===t.length&&t[0]instanceof ue.y?t[0]:(0,jt.J)(n)((0,f.n)(t,i))}(w,I.pipe(t=>(0,He.x)()(function(t,n){return function(a){let u;u="function"==typeof t?t:function(){return t};const g=Object.create(a,je.N);return g.source=a,g.subjectFactory=u,g}}(Qe)(t))))}bootstrap(i,a){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let u;u=i instanceof x0?i:this._componentFactoryResolver.resolveComponentFactory(i),this.componentTypes.push(u.componentType);const g=function(t){return t.isBoundToModule}(u)?void 0:this._injector.get(Lu),w=u.create(Me.NULL,[],a||u.selector,g),I=w.location.nativeElement,F=w.injector.get(Yx,null),G=F&&w.injector.get(Xx);return F&&G&&G.registerApplication(I,F),w.onDestroy(()=>{this.detachView(w.hostView),ny(this.components,w),G&&G.unregisterApplication(I)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(i))}finally{this._runningTick=!1}}attachView(i){const a=i;this._views.push(a),a.attachToAppRef(this)}detachView(i){const a=i;ny(this._views,a),a.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i),this._injector.get($x,[]).concat(this._bootstrapListeners).forEach(u=>u(i))}ngOnDestroy(){this._views.slice().forEach(i=>i.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(i){return new(i||t)(ur(ua),ur(Me),ur(ia),ur($h),ur(Kh))},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();function ny(t,n){const i=t.indexOf(n);i>-1&&t.splice(i,1)}class aT{}class cT{}const uT={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let hT=(()=>{class t{constructor(i,a){this._compiler=i,this._config=a||uT}load(i){return this.loadAndCompile(i)}loadAndCompile(i){let[a,u]=i.split("#");return void 0===u&&(u="default"),Ve(255)(a).then(g=>g[u]).then(g=>lb(g,a,u)).then(g=>this._compiler.compileModuleAsync(g))}loadFactory(i){let[a,u]=i.split("#"),g="NgFactory";return void 0===u&&(u="default",g=""),Ve(255)(this._config.factoryPathPrefix+a+this._config.factoryPathSuffix).then(x=>x[u+g]).then(x=>lb(x,a,u))}}return t.\u0275fac=function(i){return new(i||t)(ur(Ff),ur(cT,8))},t.\u0275prov=tr({token:t,factory:t.\u0275fac}),t})();function lb(t,n,i){if(!t)throw new Error(`Cannot find '${i}' in '${n}'`);return t}const vT=function(t){return null},bT=tb(null,"core",[{provide:jx,useValue:"unknown"},{provide:rb,deps:[Me]},{provide:Xx,deps:[]},{provide:Gx,deps:[]}]),TT=[{provide:Lf,useClass:Lf,deps:[ua,Me,ia,$h,Kh]},{provide:SC,deps:[ua],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(i){n.push(i)}}},{provide:Kh,useClass:Kh,deps:[[new Pa,Y_]]},{provide:Ff,useClass:Ff,deps:[]},PD,{provide:bm,useFactory:function(){return bE},deps:[]},{provide:wm,useFactory:function(){return wE},deps:[]},{provide:km,useFactory:function(t){return m_(t=t||"undefined"!=typeof $localize&&$localize.locale||pm),t},deps:[[new wc(km),new Pa,new ll]]},{provide:Hx,useValue:"USD"}];let IT=(()=>{class t{constructor(i){}}return t.\u0275fac=function(i){return new(i||t)(ur(Lf))},t.\u0275mod=kt({type:t}),t.\u0275inj=nr({providers:TT}),t})()},353:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{rH:()=>Da,Od:()=>mc,Bz:()=>Bl,lC:()=>Sa});var ue=Ve(583),ne=Ve(639),jt=Ve(869),f=Ve(693),Vt=Ve(87);function it(...M){let D=M[M.length-1];return(0,jt.K)(D)?(M.pop(),(0,Vt.r)(M,D)):(0,f.n)(M)}var Pt=Ve(709),je=Ve(971);class Ie extends Pt.xQ{constructor(D){super(),this._value=D}get value(){return this.getValue()}_subscribe(D){const C=super._subscribe(D);return C&&!C.closed&&D.next(this._value),C}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new je.N;return this._value}next(D){super.next(this._value=D)}}var Te=Ve(796),He=Ve(393);class Qe extends He.L{notifyNext(D,C,k,V,X){this.destination.next(C)}notifyError(D,C){this.destination.error(D)}notifyComplete(D){this.destination.complete()}}class _t extends He.L{constructor(D,C,k){super(),this.parent=D,this.outerValue=C,this.outerIndex=k,this.index=0}_next(D){this.parent.notifyNext(this.outerValue,D,this.outerIndex,this.index++,this)}_error(D){this.parent.notifyError(D,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var mt=Ve(444),Tt=Ve(574);function et(M,D,C,k,V=new _t(M,C,k)){if(!V.closed)return D instanceof Tt.y?D.subscribe(V):(0,mt.s)(D)(V)}const Qt={};class zt{constructor(D){this.resultSelector=D}call(D,C){return C.subscribe(new Dt(D,this.resultSelector))}}class Dt extends Qe{constructor(D,C){super(D),this.resultSelector=C,this.active=0,this.values=[],this.observables=[]}_next(D){this.values.push(Qt),this.observables.push(D)}_complete(){const D=this.observables,C=D.length;if(0===C)this.destination.complete();else{this.active=C,this.toRespond=C;for(let k=0;k<C;k++)this.add(et(this,D[k],void 0,k))}}notifyComplete(D){0==(this.active-=1)&&this.destination.complete()}notifyNext(D,C,k){const V=this.values,h=this.toRespond?V[k]===Qt?--this.toRespond:this.toRespond:0;V[k]=C,0===h&&(this.resultSelector?this._tryResultSelector(V):this.destination.next(V.slice()))}_tryResultSelector(D){let C;try{C=this.resultSelector.apply(this,D)}catch(k){return void this.destination.error(k)}this.destination.next(C)}}const Kr=(()=>{function M(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return M.prototype=Object.create(Error.prototype),M})();var Tn=Ve(282);function Bi(...M){return(0,Tn.J)(1)(it(...M))}var Ft=Ve(402);const _n=new Tt.y(M=>M.complete());function Xn(M){return M?function(M){return new Tt.y(D=>M.schedule(()=>D.complete()))}(M):_n}function Jt(M){return new Tt.y(D=>{let C;try{C=M()}catch(V){return void D.error(V)}return(C?(0,Ft.D)(C):Xn()).subscribe(D)})}var In=Ve(441),pt=Ve(2),Rn=Ve(345);function Ur(M,D){return"function"==typeof D?C=>C.pipe(Ur((k,V)=>(0,Ft.D)(M(k,V)).pipe((0,pt.U)((X,h)=>D(k,X,V,h))))):C=>C.lift(new er(M))}class er{constructor(D){this.project=D}call(D,C){return C.subscribe(new fr(D,this.project))}}class fr extends Rn.Ds{constructor(D,C){super(D),this.project=C,this.index=0}_next(D){let C;const k=this.index++;try{C=this.project(D,k)}catch(V){return void this.destination.error(V)}this._innerSub(C)}_innerSub(D){const C=this.innerSubscription;C&&C.unsubscribe();const k=new Rn.IY(this),V=this.destination;V.add(k),this.innerSubscription=(0,Rn.ft)(D,k),this.innerSubscription!==k&&V.add(this.innerSubscription)}_complete(){const{innerSubscription:D}=this;(!D||D.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(D){this.destination.next(D)}}const Ji=(()=>{function M(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return M.prototype=Object.create(Error.prototype),M})();function ho(M){return D=>0===M?Xn():D.lift(new Bo(M))}class Bo{constructor(D){if(this.total=D,this.total<0)throw new Ji}call(D,C){return C.subscribe(new fn(D,this.total))}}class fn extends He.L{constructor(D,C){super(D),this.total=C,this.count=0}_next(D){const C=this.total,k=++this.count;k<=C&&(this.destination.next(D),k===C&&(this.destination.complete(),this.unsubscribe()))}}function mi(M,D){let C=!1;return arguments.length>=2&&(C=!0),function(V){return V.lift(new Lr(M,D,C))}}class Lr{constructor(D,C,k=!1){this.accumulator=D,this.seed=C,this.hasSeed=k}call(D,C){return C.subscribe(new Dr(D,this.accumulator,this.seed,this.hasSeed))}}class Dr extends He.L{constructor(D,C,k,V){super(D),this.accumulator=C,this._seed=k,this.hasSeed=V,this.index=0}get seed(){return this._seed}set seed(D){this.hasSeed=!0,this._seed=D}_next(D){if(this.hasSeed)return this._tryNext(D);this.seed=D,this.destination.next(D)}_tryNext(D){const C=this.index++;let k;try{k=this.accumulator(this.seed,D,C)}catch(V){this.destination.error(V)}this.seed=k,this.destination.next(k)}}function an(M,D){return function(k){return k.lift(new eo(M,D))}}class eo{constructor(D,C){this.predicate=D,this.thisArg=C}call(D,C){return C.subscribe(new Fn(D,this.predicate,this.thisArg))}}class Fn extends He.L{constructor(D,C,k){super(D),this.predicate=C,this.thisArg=k,this.count=0}_next(D){let C;try{C=this.predicate.call(this.thisArg,D,this.count++)}catch(k){return void this.destination.error(k)}C&&this.destination.next(D)}}function jr(M){return function(C){const k=new tr(M),V=C.lift(k);return k.caught=V}}class tr{constructor(D){this.selector=D}call(D,C){return C.subscribe(new to(D,this.selector,this.caught))}}class to extends Rn.Ds{constructor(D,C,k){super(D),this.selector=C,this.caught=k}error(D){if(!this.isStopped){let C;try{C=this.selector(D,this.caught)}catch(X){return void super.error(X)}this._unsubscribeAndRecycle();const k=new Rn.IY(this);this.add(k);const V=(0,Rn.ft)(C,k);V!==k&&this.add(V)}}}var nr=Ve(773);function Or(M,D){return(0,nr.zg)(M,D,1)}function Vi(M){return function(C){return 0===M?Xn():C.lift(new Er(M))}}class Er{constructor(D){if(this.total=D,this.total<0)throw new Ji}call(D,C){return C.subscribe(new Ui(D,this.total))}}class Ui extends He.L{constructor(D,C){super(D),this.total=C,this.ring=new Array,this.count=0}_next(D){const C=this.ring,k=this.total,V=this.count++;C.length<k?C.push(D):C[V%k]=D}_complete(){const D=this.destination;let C=this.count;if(C>0){const k=this.count>=this.total?this.total:this.count,V=this.ring;for(let X=0;X<k;X++){const h=C++%k;D.next(V[h])}}D.complete()}}function ri(M=gi){return D=>D.lift(new Ai(M))}class Ai{constructor(D){this.errorFactory=D}call(D,C){return C.subscribe(new Do(D,this.errorFactory))}}class Do extends He.L{constructor(D,C){super(D),this.errorFactory=C,this.hasValue=!1}_next(D){this.hasValue=!0,this.destination.next(D)}_complete(){if(this.hasValue)return this.destination.complete();{let D;try{D=this.errorFactory()}catch(C){D=C}this.destination.error(D)}}}function gi(){return new Kr}function ii(M=null){return D=>D.lift(new Nt(M))}class Nt{constructor(D){this.defaultValue=D}call(D,C){return C.subscribe(new Kn(D,this.defaultValue))}}class Kn extends He.L{constructor(D,C){super(D),this.defaultValue=C,this.isEmpty=!0}_next(D){this.isEmpty=!1,this.destination.next(D)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var $t=Ve(487);function oi(M,D){const C=arguments.length>=2;return k=>k.pipe(M?an((V,X)=>M(V,X,k)):$t.y,ho(1),C?ii(D):ri(()=>new Kr))}function si(){}var Tr=Ve(105);function qn(M,D,C){return function(V){return V.lift(new $r(M,D,C))}}class $r{constructor(D,C,k){this.nextOrObserver=D,this.error=C,this.complete=k}call(D,C){return C.subscribe(new os(D,this.nextOrObserver,this.error,this.complete))}}class os extends He.L{constructor(D,C,k,V){super(D),this._tapNext=si,this._tapError=si,this._tapComplete=si,this._tapError=k||si,this._tapComplete=V||si,(0,Tr.m)(C)?(this._context=this,this._tapNext=C):C&&(this._context=C,this._tapNext=C.next||si,this._tapError=C.error||si,this._tapComplete=C.complete||si)}_next(D){try{this._tapNext.call(this._context,D)}catch(C){return void this.destination.error(C)}this.destination.next(D)}_error(D){try{this._tapError.call(this._context,D)}catch(C){return void this.destination.error(C)}this.destination.error(D)}_complete(){try{this._tapComplete.call(this._context)}catch(D){return void this.destination.error(D)}return this.destination.complete()}}var Kt=Ve(319);class Ln{constructor(D){this.callback=D}call(D,C){return C.subscribe(new ss(D,this.callback))}}class ss extends He.L{constructor(D,C){super(D),this.add(new Kt.w(C))}}var _i=Ve(307);class vn{constructor(D,C){this.id=D,this.url=C}}class Mi extends vn{constructor(D,C,k="imperative",V=null){super(D,C),this.navigationTrigger=k,this.restoredState=V}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ji extends vn{constructor(D,C,k){super(D,C),this.urlAfterRedirects=k}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ai extends vn{constructor(D,C,k){super(D,C),this.reason=k}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class pn extends vn{constructor(D,C,k){super(D,C),this.error=k}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class re extends vn{constructor(D,C,k,V){super(D,C),this.urlAfterRedirects=k,this.state=V}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class j extends vn{constructor(D,C,k,V){super(D,C),this.urlAfterRedirects=k,this.state=V}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Z extends vn{constructor(D,C,k,V,X){super(D,C),this.urlAfterRedirects=k,this.state=V,this.shouldActivate=X}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ie extends vn{constructor(D,C,k,V){super(D,C),this.urlAfterRedirects=k,this.state=V}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class he extends vn{constructor(D,C,k,V){super(D,C),this.urlAfterRedirects=k,this.state=V}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ge{constructor(D){this.route=D}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ke{constructor(D){this.route=D}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Le{constructor(D){this.snapshot=D}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ce{constructor(D){this.snapshot=D}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Oe{constructor(D){this.snapshot=D}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Xe{constructor(D){this.snapshot=D}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ut{constructor(D,C,k){this.routerEvent=D,this.position=C,this.anchor=k}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Ue="primary";class kt{constructor(D){this.params=D||{}}has(D){return Object.prototype.hasOwnProperty.call(this.params,D)}get(D){if(this.has(D)){const C=this.params[D];return Array.isArray(C)?C[0]:C}return null}getAll(D){if(this.has(D)){const C=this.params[D];return Array.isArray(C)?C:[C]}return[]}get keys(){return Object.keys(this.params)}}function ve(M){return new kt(M)}const Ge="ngNavigationCancelingError";function Ut(M){const D=Error("NavigationCancelingError: "+M);return D[Ge]=!0,D}function Lt(M,D,C){const k=C.path.split("/");if(k.length>M.length||"full"===C.pathMatch&&(D.hasChildren()||k.length<M.length))return null;const V={};for(let X=0;X<k.length;X++){const h=k[X],r=M[X];if(h.startsWith(":"))V[h.substring(1)]=r;else if(h!==r.path)return null}return{consumed:M.slice(0,k.length),posParams:V}}function Ht(M,D){const C=M?Object.keys(M):void 0,k=D?Object.keys(D):void 0;if(!C||!k||C.length!=k.length)return!1;let V;for(let X=0;X<C.length;X++)if(V=C[X],!hn(M[V],D[V]))return!1;return!0}function hn(M,D){if(Array.isArray(M)&&Array.isArray(D)){if(M.length!==D.length)return!1;const C=[...M].sort(),k=[...D].sort();return C.every((V,X)=>k[X]===V)}return M===D}function Pi(M){return Array.prototype.concat.apply([],M)}function ft(M){return M.length>0?M[M.length-1]:null}function gt(M,D){for(const C in M)M.hasOwnProperty(C)&&D(M[C],C)}function on(M){return(0,ne.CqO)(M)?M:(0,ne.QGY)(M)?(0,Ft.D)(Promise.resolve(M)):it(M)}const Wt={exact:function Sr(M,D,C){if(!Je(M.segments,D.segments)||!Gr(M.segments,D.segments,C)||M.numberOfChildren!==D.numberOfChildren)return!1;for(const k in D.children)if(!M.children[k]||!Sr(M.children[k],D.children[k],C))return!1;return!0},subset:ln},hr={exact:function(M,D){return Ht(M,D)},subset:function(M,D){return Object.keys(D).length<=Object.keys(M).length&&Object.keys(D).every(C=>hn(M[C],D[C]))},ignored:()=>!0};function Ri(M,D,C){return Wt[C.paths](M.root,D.root,C.matrixParams)&&hr[C.queryParams](M.queryParams,D.queryParams)&&!("exact"===C.fragment&&M.fragment!==D.fragment)}function ln(M,D,C){return ki(M,D,D.segments,C)}function ki(M,D,C,k){if(M.segments.length>C.length){const V=M.segments.slice(0,C.length);return!(!Je(V,C)||D.hasChildren()||!Gr(V,C,k))}if(M.segments.length===C.length){if(!Je(M.segments,C)||!Gr(M.segments,C,k))return!1;for(const V in D.children)if(!M.children[V]||!ln(M.children[V],D.children[V],k))return!1;return!0}{const V=C.slice(0,M.segments.length),X=C.slice(M.segments.length);return!!(Je(M.segments,V)&&Gr(M.segments,V,k)&&M.children[Ue])&&ki(M.children[Ue],D,X,k)}}function Gr(M,D,C){return D.every((k,V)=>hr[C](M[V].parameters,k.parameters))}class we{constructor(D,C,k){this.root=D,this.queryParams=C,this.fragment=k}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ve(this.queryParams)),this._queryParamMap}toString(){return yi.serialize(this)}}class pe{constructor(D,C){this.segments=D,this.children=C,this.parent=null,gt(C,(k,V)=>k.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return vi(this)}}class ae{constructor(D,C){this.path=D,this.parameters=C}get parameterMap(){return this._parameterMap||(this._parameterMap=ve(this.parameters)),this._parameterMap}toString(){return ui(this)}}function Je(M,D){return M.length===D.length&&M.every((C,k)=>C.path===D[k].path)}class Et{}class kn{parse(D){const C=new Xa(D);return new we(C.parseRootSegment(),C.parseQueryParams(),C.parseFragment())}serialize(D){var M;return`${`/${lr(D.root,!0)}`}${function(M){const D=Object.keys(M).map(C=>{const k=M[C];return Array.isArray(k)?k.map(V=>`${li(C)}=${li(V)}`).join("&"):`${li(C)}=${li(k)}`}).filter(C=>!!C);return D.length?`?${D.join("&")}`:""}(D.queryParams)}${"string"==typeof D.fragment?`#${M=D.fragment,encodeURI(M)}`:""}`}}const yi=new kn;function vi(M){return M.segments.map(D=>ui(D)).join("/")}function lr(M,D){if(!M.hasChildren())return vi(M);if(D){const C=M.children[Ue]?lr(M.children[Ue],!1):"",k=[];return gt(M.children,(V,X)=>{X!==Ue&&k.push(`${X}:${lr(V,!1)}`)}),k.length>0?`${C}(${k.join("//")})`:C}{const C=function(M,D){let C=[];return gt(M.children,(k,V)=>{V===Ue&&(C=C.concat(D(k,V)))}),gt(M.children,(k,V)=>{V!==Ue&&(C=C.concat(D(k,V)))}),C}(M,(k,V)=>V===Ue?[lr(M.children[Ue],!1)]:[`${V}:${lr(k,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[Ue]?`${vi(M)}/${C[0]}`:`${vi(M)}/(${C.join("//")})`}}function $i(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function li(M){return $i(M).replace(/%3B/gi,";")}function On(M){return $i(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function xi(M){return decodeURIComponent(M)}function ci(M){return xi(M.replace(/\+/g,"%20"))}function ui(M){return`${On(M.path)}${function(M){return Object.keys(M).map(D=>`;${On(D)}=${On(M[D])}`).join("")}(M.parameters)}`}const da=/^[^\/()?;=#]+/;function hi(M){const D=M.match(da);return D?D[0]:""}const Fi=/^[^=?&#]+/,Vo=/^[^?&#]+/;class Xa{constructor(D){this.url=D,this.remaining=D}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new pe([],{}):new pe([],this.parseChildren())}parseQueryParams(){const D={};if(this.consumeOptional("?"))do{this.parseQueryParam(D)}while(this.consumeOptional("&"));return D}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const D=[];for(this.peekStartsWith("(")||D.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),D.push(this.parseSegment());let C={};this.peekStartsWith("/(")&&(this.capture("/"),C=this.parseParens(!0));let k={};return this.peekStartsWith("(")&&(k=this.parseParens(!1)),(D.length>0||Object.keys(C).length>0)&&(k[Ue]=new pe(D,C)),k}parseSegment(){const D=hi(this.remaining);if(""===D&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(D),new ae(xi(D),this.parseMatrixParams())}parseMatrixParams(){const D={};for(;this.consumeOptional(";");)this.parseParam(D);return D}parseParam(D){const C=hi(this.remaining);if(!C)return;this.capture(C);let k="";if(this.consumeOptional("=")){const V=hi(this.remaining);V&&(k=V,this.capture(k))}D[xi(C)]=xi(k)}parseQueryParam(D){const C=function(M){const D=M.match(Fi);return D?D[0]:""}(this.remaining);if(!C)return;this.capture(C);let k="";if(this.consumeOptional("=")){const h=function(M){const D=M.match(Vo);return D?D[0]:""}(this.remaining);h&&(k=h,this.capture(k))}const V=ci(C),X=ci(k);if(D.hasOwnProperty(V)){let h=D[V];Array.isArray(h)||(h=[h],D[V]=h),h.push(X)}else D[V]=X}parseParens(D){const C={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const k=hi(this.remaining),V=this.remaining[k.length];if("/"!==V&&")"!==V&&";"!==V)throw new Error(`Cannot parse url '${this.url}'`);let X;k.indexOf(":")>-1?(X=k.substr(0,k.indexOf(":")),this.capture(X),this.capture(":")):D&&(X=Ue);const h=this.parseChildren();C[X]=1===Object.keys(h).length?h[Ue]:new pe([],h),this.consumeOptional("//")}return C}peekStartsWith(D){return this.remaining.startsWith(D)}consumeOptional(D){return!!this.peekStartsWith(D)&&(this.remaining=this.remaining.substring(D.length),!0)}capture(D){if(!this.consumeOptional(D))throw new Error(`Expected "${D}".`)}}class cc{constructor(D){this._root=D}get root(){return this._root.value}parent(D){const C=this.pathFromRoot(D);return C.length>1?C[C.length-2]:null}children(D){const C=xl(D,this._root);return C?C.children.map(k=>k.value):[]}firstChild(D){const C=xl(D,this._root);return C&&C.children.length>0?C.children[0].value:null}siblings(D){const C=fa(D,this._root);return C.length<2?[]:C[C.length-2].children.map(V=>V.value).filter(V=>V!==D)}pathFromRoot(D){return fa(D,this._root).map(C=>C.value)}}function xl(M,D){if(M===D.value)return D;for(const C of D.children){const k=xl(M,C);if(k)return k}return null}function fa(M,D){if(M===D.value)return[D];for(const C of D.children){const k=fa(M,C);if(k.length)return k.unshift(D),k}return[]}class To{constructor(D,C){this.value=D,this.children=C}toString(){return`TreeNode(${this.value})`}}function So(M){const D={};return M&&M.children.forEach(C=>D[C.value.outlet]=C),D}class bl extends cc{constructor(D,C){super(D),this.snapshot=C,di(this,D)}toString(){return this.snapshot.toString()}}function wl(M,D){const C=function(M,D){const h=new pa([],{},{},"",{},Ue,D,null,M.root,-1,{});return new $s("",new To(h,[]))}(M,D),k=new Ie([new ae("",{})]),V=new Ie({}),X=new Ie({}),h=new Ie({}),r=new Ie(""),l=new Io(k,V,h,r,X,Ue,D,C.root);return l.snapshot=C.root,new bl(new To(l,[]),C)}class Io{constructor(D,C,k,V,X,h,r,l){this.url=D,this.params=C,this.queryParams=k,this.fragment=V,this.data=X,this.outlet=h,this.component=r,this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,pt.U)(D=>ve(D)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,pt.U)(D=>ve(D)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Li(M,D="emptyOnly"){const C=M.pathFromRoot;let k=0;if("always"!==D)for(k=C.length-1;k>=1;){const V=C[k],X=C[k-1];if(V.routeConfig&&""===V.routeConfig.path)k--;else{if(X.component)break;k--}}return function(M){return M.reduce((D,C)=>({params:Object.assign(Object.assign({},D.params),C.params),data:Object.assign(Object.assign({},D.data),C.data),resolve:Object.assign(Object.assign({},D.resolve),C._resolvedData)}),{params:{},data:{},resolve:{}})}(C.slice(k))}class pa{constructor(D,C,k,V,X,h,r,l,p,y,v){this.url=D,this.params=C,this.queryParams=k,this.fragment=V,this.data=X,this.outlet=h,this.component=r,this.routeConfig=l,this._urlSegment=p,this._lastPathIndex=y,this._resolve=v}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ve(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ve(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(k=>k.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class $s extends cc{constructor(D,C){super(C),this.url=D,di(this,C)}toString(){return Uo(this._root)}}function di(M,D){D.value._routerState=M,D.children.forEach(C=>di(M,C))}function Uo(M){const D=M.children.length>0?` { ${M.children.map(Uo).join(", ")} } `:"";return`${M.value}${D}`}function as(M){if(M.snapshot){const D=M.snapshot,C=M._futureSnapshot;M.snapshot=C,Ht(D.queryParams,C.queryParams)||M.queryParams.next(C.queryParams),D.fragment!==C.fragment&&M.fragment.next(C.fragment),Ht(D.params,C.params)||M.params.next(C.params),function(M,D){if(M.length!==D.length)return!1;for(let C=0;C<M.length;++C)if(!Ht(M[C],D[C]))return!1;return!0}(D.url,C.url)||M.url.next(C.url),Ht(D.data,C.data)||M.data.next(C.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function Gs(M,D){return Ht(M.params,D.params)&&function(M,D){return Je(M,D)&&M.every((C,k)=>Ht(C.parameters,D[k].parameters))}(M.url,D.url)&&!(!M.parent!=!D.parent)&&(!M.parent||Gs(M.parent,D.parent))}function Gi(M,D,C){if(C&&M.shouldReuseRoute(D.value,C.value.snapshot)){const k=C.value;k._futureSnapshot=D.value;const V=function(M,D,C){return D.children.map(k=>{for(const V of C.children)if(M.shouldReuseRoute(k.value,V.value.snapshot))return Gi(M,k,V);return Gi(M,k)})}(M,D,C);return new To(k,V)}{if(M.shouldAttach(D.value)){const X=M.retrieve(D.value);if(null!==X){const h=X.route;return ma(D,h),h}}const k=function(M){return new Io(new Ie(M.url),new Ie(M.params),new Ie(M.queryParams),new Ie(M.fragment),new Ie(M.data),M.outlet,M.component,M)}(D.value),V=D.children.map(X=>Gi(M,X));return new To(k,V)}}function ma(M,D){if(M.value.routeConfig!==D.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(M.children.length!==D.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");D.value._futureSnapshot=M.value;for(let C=0;C<M.children.length;++C)ma(M.children[C],D.children[C])}function jo(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function Ao(M){return"object"==typeof M&&null!=M&&M.outlets}function ls(M,D,C,k,V){let X={};return k&&gt(k,(h,r)=>{X[r]=Array.isArray(h)?h.map(l=>`${l}`):`${h}`}),new we(C.root===M?D:Ka(C.root,M,D),X,V)}function Ka(M,D,C){const k={};return gt(M.children,(V,X)=>{k[X]=V===D?C:Ka(V,D,C)}),new pe(M.segments,k)}class Ms{constructor(D,C,k){if(this.isAbsolute=D,this.numberOfDoubleDots=C,this.commands=k,D&&k.length>0&&jo(k[0]))throw new Error("Root segment cannot have matrix parameters");const V=k.find(Ao);if(V&&V!==ft(k))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class W{constructor(D,C,k){this.segmentGroup=D,this.processChildren=C,this.index=k}}function We(M,D,C){if(M||(M=new pe([],{})),0===M.segments.length&&M.hasChildren())return ht(M,D,C);const k=function(M,D,C){let k=0,V=D;const X={match:!1,pathIndex:0,commandIndex:0};for(;V<M.segments.length;){if(k>=C.length)return X;const h=M.segments[V],r=C[k];if(Ao(r))break;const l=`${r}`,p=k<C.length-1?C[k+1]:null;if(V>0&&void 0===l)break;if(l&&p&&"object"==typeof p&&void 0===p.outlets){if(!bn(l,p,h))return X;k+=2}else{if(!bn(l,{},h))return X;k++}V++}return{match:!0,pathIndex:V,commandIndex:k}}(M,D,C),V=C.slice(k.commandIndex);if(k.match&&k.pathIndex<M.segments.length){const X=new pe(M.segments.slice(0,k.pathIndex),{});return X.children[Ue]=new pe(M.segments.slice(k.pathIndex),M.children),ht(X,0,V)}return k.match&&0===V.length?new pe(M.segments,{}):k.match&&!M.hasChildren()?Zt(M,D,C):k.match?ht(M,0,V):Zt(M,D,C)}function ht(M,D,C){if(0===C.length)return new pe(M.segments,{});{const k=function(M){return Ao(M[0])?M[0].outlets:{[Ue]:M}}(C),V={};return gt(k,(X,h)=>{"string"==typeof X&&(X=[X]),null!==X&&(V[h]=We(M.children[h],D,X))}),gt(M.children,(X,h)=>{void 0===k[h]&&(V[h]=X)}),new pe(M.segments,V)}}function Zt(M,D,C){const k=M.segments.slice(0,D);let V=0;for(;V<C.length;){const X=C[V];if(Ao(X)){const l=pr(X.outlets);return new pe(k,l)}if(0===V&&jo(C[0])){k.push(new ae(M.segments[D].path,jn(C[0]))),V++;continue}const h=Ao(X)?X.outlets[Ue]:`${X}`,r=V<C.length-1?C[V+1]:null;h&&r&&jo(r)?(k.push(new ae(h,jn(r))),V+=2):(k.push(new ae(h,{})),V++)}return new pe(k,{})}function pr(M){const D={};return gt(M,(C,k)=>{"string"==typeof C&&(C=[C]),null!==C&&(D[k]=Zt(new pe([],{}),0,C))}),D}function jn(M){const D={};return gt(M,(C,k)=>D[k]=`${C}`),D}function bn(M,D,C){return M==C.path&&Ht(D,C.parameters)}class Mn{constructor(D,C,k,V){this.routeReuseStrategy=D,this.futureState=C,this.currState=k,this.forwardEvent=V}activate(D){const C=this.futureState._root,k=this.currState?this.currState._root:null;this.deactivateChildRoutes(C,k,D),as(this.futureState.root),this.activateChildRoutes(C,k,D)}deactivateChildRoutes(D,C,k){const V=So(C);D.children.forEach(X=>{const h=X.value.outlet;this.deactivateRoutes(X,V[h],k),delete V[h]}),gt(V,(X,h)=>{this.deactivateRouteAndItsChildren(X,k)})}deactivateRoutes(D,C,k){const V=D.value,X=C?C.value:null;if(V===X)if(V.component){const h=k.getContext(V.outlet);h&&this.deactivateChildRoutes(D,C,h.children)}else this.deactivateChildRoutes(D,C,k);else X&&this.deactivateRouteAndItsChildren(C,k)}deactivateRouteAndItsChildren(D,C){this.routeReuseStrategy.shouldDetach(D.value.snapshot)?this.detachAndStoreRouteSubtree(D,C):this.deactivateRouteAndOutlet(D,C)}detachAndStoreRouteSubtree(D,C){const k=C.getContext(D.value.outlet);if(k&&k.outlet){const V=k.outlet.detach(),X=k.children.onOutletDeactivated();this.routeReuseStrategy.store(D.value.snapshot,{componentRef:V,route:D,contexts:X})}}deactivateRouteAndOutlet(D,C){const k=C.getContext(D.value.outlet),V=k&&D.value.component?k.children:C,X=So(D);for(const h of Object.keys(X))this.deactivateRouteAndItsChildren(X[h],V);k&&k.outlet&&(k.outlet.deactivate(),k.children.onOutletDeactivated(),k.attachRef=null,k.resolver=null,k.route=null)}activateChildRoutes(D,C,k){const V=So(C);D.children.forEach(X=>{this.activateRoutes(X,V[X.value.outlet],k),this.forwardEvent(new Xe(X.value.snapshot))}),D.children.length&&this.forwardEvent(new Ce(D.value.snapshot))}activateRoutes(D,C,k){const V=D.value,X=C?C.value:null;if(as(V),V===X)if(V.component){const h=k.getOrCreateContext(V.outlet);this.activateChildRoutes(D,C,h.children)}else this.activateChildRoutes(D,C,k);else if(V.component){const h=k.getOrCreateContext(V.outlet);if(this.routeReuseStrategy.shouldAttach(V.snapshot)){const r=this.routeReuseStrategy.retrieve(V.snapshot);this.routeReuseStrategy.store(V.snapshot,null),h.children.onOutletReAttached(r.contexts),h.attachRef=r.componentRef,h.route=r.route.value,h.outlet&&h.outlet.attach(r.componentRef,r.route.value),Hr(r.route)}else{const r=function(M){for(let D=M.parent;D;D=D.parent){const C=D.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig;if(C&&C.component)return null}return null}(V.snapshot),l=r?r.module.componentFactoryResolver:null;h.attachRef=null,h.route=V,h.resolver=l,h.outlet&&h.outlet.activateWith(V,l),this.activateChildRoutes(D,null,h.children)}}else this.activateChildRoutes(D,null,k)}}function Hr(M){as(M.value),M.children.forEach(Hr)}class mr{constructor(D,C){this.routes=D,this.module=C}}function bi(M){return"function"==typeof M}function Qr(M){return M instanceof we}const Hi=Symbol("INITIAL_VALUE");function Mo(){return Ur(M=>function(...M){let D,C;return(0,jt.K)(M[M.length-1])&&(C=M.pop()),"function"==typeof M[M.length-1]&&(D=M.pop()),1===M.length&&(0,Te.k)(M[0])&&(M=M[0]),(0,f.n)(M,C).lift(new zt(D))}(M.map(D=>D.pipe(ho(1),function(...M){const D=M[M.length-1];return(0,jt.K)(D)?(M.pop(),C=>Bi(M,C,D)):C=>Bi(M,C)}(Hi)))).pipe(mi((D,C)=>{let k=!1;return C.reduce((V,X,h)=>V!==Hi?V:(X===Hi&&(k=!0),k||!1!==X&&h!==C.length-1&&!Qr(X)?V:X),D)},Hi),an(D=>D!==Hi),(0,pt.U)(D=>Qr(D)?D:!0===D),ho(1)))}let Cl=(()=>{class M{}return M.\u0275fac=function(C){return new(C||M)},M.\u0275cmp=ne.Xpm({type:M,selectors:[["ng-component"]],decls:1,vars:0,template:function(C,k){1&C&&ne._UZ(0,"router-outlet")},directives:function(){return[Sa]},encapsulation:2}),M})();function sn(M,D=""){for(let C=0;C<M.length;C++){const k=M[C];au(k,lu(D,k))}}function au(M,D){M.children&&sn(M.children,D)}function lu(M,D){return D?M||D.path?M&&!D.path?`${M}/`:!M&&D.path?D.path:`${M}/${D.path}`:"":M}function uc(M){const D=M.children&&M.children.map(uc),C=D?Object.assign(Object.assign({},M),{children:D}):Object.assign({},M);return!C.component&&(D||C.loadChildren)&&C.outlet&&C.outlet!==Ue&&(C.component=Cl),C}function go(M){return M.outlet||Ue}function Qa(M,D){const C=M.filter(k=>go(k)===D);return C.push(...M.filter(k=>go(k)!==D)),C}const Zs={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function $o(M,D,C){var k;if(""===D.path)return"full"===D.pathMatch&&(M.hasChildren()||C.length>0)?Object.assign({},Zs):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const X=(D.matcher||Lt)(C,M,D);if(!X)return Object.assign({},Zs);const h={};gt(X.posParams,(l,p)=>{h[p]=l.path});const r=X.consumed.length>0?Object.assign(Object.assign({},h),X.consumed[X.consumed.length-1].parameters):h;return{matched:!0,consumedSegments:X.consumed,lastChild:X.consumed.length,parameters:r,positionalParamSegments:null!==(k=X.posParams)&&void 0!==k?k:{}}}function ct(M,D,C,k,V="corrected"){if(C.length>0&&function(M,D,C){return C.some(k=>qi(M,D,k)&&go(k)!==Ue)}(M,C,k)){const h=new pe(D,function(M,D,C,k){const V={};V[Ue]=k,k._sourceSegment=M,k._segmentIndexShift=D.length;for(const X of C)if(""===X.path&&go(X)!==Ue){const h=new pe([],{});h._sourceSegment=M,h._segmentIndexShift=D.length,V[go(X)]=h}return V}(M,D,k,new pe(C,M.children)));return h._sourceSegment=M,h._segmentIndexShift=D.length,{segmentGroup:h,slicedSegments:[]}}if(0===C.length&&function(M,D,C){return C.some(k=>qi(M,D,k))}(M,C,k)){const h=new pe(M.segments,function(M,D,C,k,V,X){const h={};for(const r of k)if(qi(M,C,r)&&!V[go(r)]){const l=new pe([],{});l._sourceSegment=M,l._segmentIndexShift="legacy"===X?M.segments.length:D.length,h[go(r)]=l}return Object.assign(Object.assign({},V),h)}(M,D,C,k,M.children,V));return h._sourceSegment=M,h._segmentIndexShift=D.length,{segmentGroup:h,slicedSegments:C}}const X=new pe(M.segments,M.children);return X._sourceSegment=M,X._segmentIndexShift=D.length,{segmentGroup:X,slicedSegments:C}}function qi(M,D,C){return(!(M.hasChildren()||D.length>0)||"full"!==C.pathMatch)&&""===C.path}function fi(M,D,C,k){return!!(go(M)===k||k!==Ue&&qi(D,C,M))&&("**"===M.path||$o(D,M,C).matched)}function Ws(M,D,C){return 0===D.length&&!M.children[C]}class cs{constructor(D){this.segmentGroup=D||null}}class $n{constructor(D){this.urlTree=D}}function Ys(M){return new Tt.y(D=>D.error(new cs(M)))}function Ja(M){return new Tt.y(D=>D.error(new $n(M)))}function el(M){return new Tt.y(D=>D.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${M}'`)))}class hc{constructor(D,C,k,V,X){this.configLoader=C,this.urlSerializer=k,this.urlTree=V,this.config=X,this.allowRedirects=!0,this.ngModule=D.get(ne.h0i)}apply(){const D=ct(this.urlTree.root,[],[],this.config).segmentGroup,C=new pe(D.segments,D.children);return this.expandSegmentGroup(this.ngModule,this.config,C,Ue).pipe((0,pt.U)(X=>this.createUrlTree(Ro(X),this.urlTree.queryParams,this.urlTree.fragment))).pipe(jr(X=>{if(X instanceof $n)return this.allowRedirects=!1,this.match(X.urlTree);throw X instanceof cs?this.noMatchError(X):X}))}match(D){return this.expandSegmentGroup(this.ngModule,this.config,D.root,Ue).pipe((0,pt.U)(V=>this.createUrlTree(Ro(V),D.queryParams,D.fragment))).pipe(jr(V=>{throw V instanceof cs?this.noMatchError(V):V}))}noMatchError(D){return new Error(`Cannot match any routes. URL Segment: '${D.segmentGroup}'`)}createUrlTree(D,C,k){const V=D.segments.length>0?new pe([],{[Ue]:D}):D;return new we(V,C,k)}expandSegmentGroup(D,C,k,V){return 0===k.segments.length&&k.hasChildren()?this.expandChildren(D,C,k).pipe((0,pt.U)(X=>new pe([],X))):this.expandSegment(D,k,C,k.segments,V,!0)}expandChildren(D,C,k){const V=[];for(const X of Object.keys(k.children))"primary"===X?V.unshift(X):V.push(X);return(0,Ft.D)(V).pipe(Or(X=>{const h=k.children[X],r=Qa(C,X);return this.expandSegmentGroup(D,r,h,X).pipe((0,pt.U)(l=>({segment:l,outlet:X})))}),mi((X,h)=>(X[h.outlet]=h.segment,X),{}),function(M,D){const C=arguments.length>=2;return k=>k.pipe(M?an((V,X)=>M(V,X,k)):$t.y,Vi(1),C?ii(D):ri(()=>new Kr))}())}expandSegment(D,C,k,V,X,h){return(0,Ft.D)(k).pipe(Or(r=>this.expandSegmentAgainstRoute(D,C,k,r,V,X,h).pipe(jr(p=>{if(p instanceof cs)return it(null);throw p}))),oi(r=>!!r),jr((r,l)=>{if(r instanceof Kr||"EmptyError"===r.name){if(Ws(C,V,X))return it(new pe([],{}));throw new cs(C)}throw r}))}expandSegmentAgainstRoute(D,C,k,V,X,h,r){return fi(V,C,X,h)?void 0===V.redirectTo?this.matchSegmentAgainstRoute(D,C,V,X,h):r&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(D,C,k,V,X,h):Ys(C):Ys(C)}expandSegmentAgainstRouteUsingRedirect(D,C,k,V,X,h){return"**"===V.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(D,k,V,h):this.expandRegularSegmentAgainstRouteUsingRedirect(D,C,k,V,X,h)}expandWildCardWithParamsAgainstRouteUsingRedirect(D,C,k,V){const X=this.applyRedirectCommands([],k.redirectTo,{});return k.redirectTo.startsWith("/")?Ja(X):this.lineralizeSegments(k,X).pipe((0,nr.zg)(h=>{const r=new pe(h,{});return this.expandSegment(D,r,C,h,V,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(D,C,k,V,X,h){const{matched:r,consumedSegments:l,lastChild:p,positionalParamSegments:y}=$o(C,V,X);if(!r)return Ys(C);const v=this.applyRedirectCommands(l,V.redirectTo,y);return V.redirectTo.startsWith("/")?Ja(v):this.lineralizeSegments(V,v).pipe((0,nr.zg)(T=>this.expandSegment(D,C,k,T.concat(X.slice(p)),h,!1)))}matchSegmentAgainstRoute(D,C,k,V,X){if("**"===k.path)return k.loadChildren?(k._loadedConfig?it(k._loadedConfig):this.configLoader.load(D.injector,k)).pipe((0,pt.U)(T=>(k._loadedConfig=T,new pe(V,{})))):it(new pe(V,{}));const{matched:h,consumedSegments:r,lastChild:l}=$o(C,k,V);if(!h)return Ys(C);const p=V.slice(l);return this.getChildConfig(D,k,V).pipe((0,nr.zg)(v=>{const T=v.module,A=v.routes,{segmentGroup:R,slicedSegments:N}=ct(C,r,p,A),U=new pe(R.segments,R.children);if(0===N.length&&U.hasChildren())return this.expandChildren(T,A,U).pipe((0,pt.U)(se=>new pe(r,se)));if(0===A.length&&0===N.length)return it(new pe(r,{}));const H=go(k)===X;return this.expandSegment(T,U,A,N,H?Ue:X,!0).pipe((0,pt.U)(Y=>new pe(r.concat(Y.segments),Y.children)))}))}getChildConfig(D,C,k){return C.children?it(new mr(C.children,D)):C.loadChildren?void 0!==C._loadedConfig?it(C._loadedConfig):this.runCanLoadGuards(D.injector,C,k).pipe((0,nr.zg)(V=>{return V?this.configLoader.load(D.injector,C).pipe((0,pt.U)(X=>(C._loadedConfig=X,X))):(M=C,new Tt.y(D=>D.error(Ut(`Cannot load children because the guard of the route "path: '${M.path}'" returned false`))));var M})):it(new mr([],D))}runCanLoadGuards(D,C,k){const V=C.canLoad;return V&&0!==V.length?it(V.map(h=>{const r=D.get(h);let l;if((M=r)&&bi(M.canLoad))l=r.canLoad(C,k);else{if(!bi(r))throw new Error("Invalid CanLoad guard");l=r(C,k)}var M;return on(l)})).pipe(Mo(),qn(h=>{if(!Qr(h))return;const r=Ut(`Redirecting to "${this.urlSerializer.serialize(h)}"`);throw r.url=h,r}),(0,pt.U)(h=>!0===h)):it(!0)}lineralizeSegments(D,C){let k=[],V=C.root;for(;;){if(k=k.concat(V.segments),0===V.numberOfChildren)return it(k);if(V.numberOfChildren>1||!V.children[Ue])return el(D.redirectTo);V=V.children[Ue]}}applyRedirectCommands(D,C,k){return this.applyRedirectCreatreUrlTree(C,this.urlSerializer.parse(C),D,k)}applyRedirectCreatreUrlTree(D,C,k,V){const X=this.createSegmentGroup(D,C.root,k,V);return new we(X,this.createQueryParams(C.queryParams,this.urlTree.queryParams),C.fragment)}createQueryParams(D,C){const k={};return gt(D,(V,X)=>{if("string"==typeof V&&V.startsWith(":")){const r=V.substring(1);k[X]=C[r]}else k[X]=V}),k}createSegmentGroup(D,C,k,V){const X=this.createSegments(D,C.segments,k,V);let h={};return gt(C.children,(r,l)=>{h[l]=this.createSegmentGroup(D,r,k,V)}),new pe(X,h)}createSegments(D,C,k,V){return C.map(X=>X.path.startsWith(":")?this.findPosParam(D,X,V):this.findOrReturn(X,k))}findPosParam(D,C,k){const V=k[C.path.substring(1)];if(!V)throw new Error(`Cannot redirect to '${D}'. Cannot find '${C.path}'.`);return V}findOrReturn(D,C){let k=0;for(const V of C){if(V.path===D.path)return C.splice(k),V;k++}return D}}function Ro(M){const D={};for(const k of Object.keys(M.children)){const X=Ro(M.children[k]);(X.segments.length>0||X.hasChildren())&&(D[k]=X)}return function(M){if(1===M.numberOfChildren&&M.children[Ue]){const D=M.children[Ue];return new pe(M.segments.concat(D.segments),D.children)}return M}(new pe(M.segments,D))}class ga{constructor(D){this.path=D,this.route=this.path[this.path.length-1]}}class Zi{constructor(D,C){this.component=D,this.route=C}}function Sl(M,D,C){const k=M._root;return _o(k,D?D._root:null,C,[k.value])}function Rs(M,D,C){const k=function(M){if(!M)return null;for(let D=M.parent;D;D=D.parent){const C=D.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig}return null}(D);return(k?k.module.injector:C).get(M)}function _o(M,D,C,k,V={canDeactivateChecks:[],canActivateChecks:[]}){const X=So(D);return M.children.forEach(h=>{(function(M,D,C,k,V={canDeactivateChecks:[],canActivateChecks:[]}){const X=M.value,h=D?D.value:null,r=C?C.getContext(M.value.outlet):null;if(h&&X.routeConfig===h.routeConfig){const l=function(M,D,C){if("function"==typeof C)return C(M,D);switch(C){case"pathParamsChange":return!Je(M.url,D.url);case"pathParamsOrQueryParamsChange":return!Je(M.url,D.url)||!Ht(M.queryParams,D.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Gs(M,D)||!Ht(M.queryParams,D.queryParams);case"paramsChange":default:return!Gs(M,D)}}(h,X,X.routeConfig.runGuardsAndResolvers);l?V.canActivateChecks.push(new ga(k)):(X.data=h.data,X._resolvedData=h._resolvedData),_o(M,D,X.component?r?r.children:null:C,k,V),l&&r&&r.outlet&&r.outlet.isActivated&&V.canDeactivateChecks.push(new Zi(r.outlet.component,h))}else h&&ko(D,r,V),V.canActivateChecks.push(new ga(k)),_o(M,null,X.component?r?r.children:null:C,k,V)})(h,X[h.value.outlet],C,k.concat([h.value]),V),delete X[h.value.outlet]}),gt(X,(h,r)=>ko(h,C.getContext(r),V)),V}function ko(M,D,C){const k=So(M),V=M.value;gt(k,(X,h)=>{ko(X,V.component?D?D.children.getContext(h):null:D,C)}),C.canDeactivateChecks.push(new Zi(V.component&&D&&D.outlet&&D.outlet.isActivated?D.outlet.component:null,V))}class Wi{}function _r(M){return new Tt.y(D=>D.error(M))}class Uc{constructor(D,C,k,V,X,h){this.rootComponentType=D,this.config=C,this.urlTree=k,this.url=V,this.paramsInheritanceStrategy=X,this.relativeLinkResolution=h}recognize(){const D=ct(this.urlTree.root,[],[],this.config.filter(h=>void 0===h.redirectTo),this.relativeLinkResolution).segmentGroup,C=this.processSegmentGroup(this.config,D,Ue);if(null===C)return null;const k=new pa([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Ue,this.rootComponentType,null,this.urlTree.root,-1,{}),V=new To(k,C),X=new $s(this.url,V);return this.inheritParamsAndData(X._root),X}inheritParamsAndData(D){const C=D.value,k=Li(C,this.paramsInheritanceStrategy);C.params=Object.freeze(k.params),C.data=Object.freeze(k.data),D.children.forEach(V=>this.inheritParamsAndData(V))}processSegmentGroup(D,C,k){return 0===C.segments.length&&C.hasChildren()?this.processChildren(D,C):this.processSegment(D,C,C.segments,k)}processChildren(D,C){const k=[];for(const X of Object.keys(C.children)){const h=C.children[X],r=Qa(D,X),l=this.processSegmentGroup(r,h,X);if(null===l)return null;k.push(...l)}const V=va(k);return V.sort((D,C)=>D.value.outlet===Ue?-1:C.value.outlet===Ue?1:D.value.outlet.localeCompare(C.value.outlet)),V}processSegment(D,C,k,V){for(const X of D){const h=this.processSegmentAgainstRoute(X,C,k,V);if(null!==h)return h}return Ws(C,k,V)?[]:null}processSegmentAgainstRoute(D,C,k,V){if(D.redirectTo||!fi(D,C,k,V))return null;let X,h=[],r=[];if("**"===D.path){const A=k.length>0?ft(k).parameters:{};X=new pa(k,A,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ds(D),go(D),D.component,D,hs(C),xa(C)+k.length,Pl(D))}else{const A=$o(C,D,k);if(!A.matched)return null;h=A.consumedSegments,r=k.slice(A.lastChild),X=new pa(h,A.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ds(D),go(D),D.component,D,hs(C),xa(C)+h.length,Pl(D))}const l=(M=D).children?M.children:M.loadChildren?M._loadedConfig.routes:[],{segmentGroup:p,slicedSegments:y}=ct(C,h,r,l.filter(A=>void 0===A.redirectTo),this.relativeLinkResolution);var M;if(0===y.length&&p.hasChildren()){const A=this.processChildren(l,p);return null===A?null:[new To(X,A)]}if(0===l.length&&0===y.length)return[new To(X,[])];const v=go(D)===V,T=this.processSegment(l,p,y,v?Ue:V);return null===T?null:[new To(X,T)]}}function rl(M){const D=M.value.routeConfig;return D&&""===D.path&&void 0===D.redirectTo}function va(M){const D=[],C=new Set;for(const k of M){if(!rl(k)){D.push(k);continue}const V=D.find(X=>k.value.routeConfig===X.value.routeConfig);void 0!==V?(V.children.push(...k.children),C.add(V)):D.push(k)}for(const k of C){const V=va(k.children);D.push(new To(k.value,V))}return D.filter(k=>!C.has(k))}function hs(M){let D=M;for(;D._sourceSegment;)D=D._sourceSegment;return D}function xa(M){let D=M,C=D._segmentIndexShift?D._segmentIndexShift:0;for(;D._sourceSegment;)D=D._sourceSegment,C+=D._segmentIndexShift?D._segmentIndexShift:0;return C-1}function ds(M){return M.data||{}}function Pl(M){return M.resolve||{}}function Pr(M){return Ur(D=>{const C=M(D);return C?(0,Ft.D)(C).pipe((0,pt.U)(()=>D)):it(D)})}class pc extends class{shouldDetach(D){return!1}store(D,C){}shouldAttach(D){return!1}retrieve(D){return null}shouldReuseRoute(D,C){return D.routeConfig===C.routeConfig}}{}const qo=new ne.OlP("ROUTES");class wa{constructor(D,C,k,V){this.loader=D,this.compiler=C,this.onLoadStartListener=k,this.onLoadEndListener=V}load(D,C){if(C._loader$)return C._loader$;this.onLoadStartListener&&this.onLoadStartListener(C);const V=this.loadModuleFactory(C.loadChildren).pipe((0,pt.U)(X=>{this.onLoadEndListener&&this.onLoadEndListener(C);const h=X.create(D);return new mr(Pi(h.injector.get(qo,void 0,ne.XFs.Self|ne.XFs.Optional)).map(uc),h)}),jr(X=>{throw C._loader$=void 0,X}));return C._loader$=new In.c(V,()=>new Pt.xQ).pipe((0,_i.x)()),C._loader$}loadModuleFactory(D){return"string"==typeof D?(0,Ft.D)(this.loader.load(D)):on(D()).pipe((0,nr.zg)(C=>C instanceof ne.YKP?it(C):(0,Ft.D)(this.compiler.compileModuleAsync(C))))}}class Ea{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Zo,this.attachRef=null}}class Zo{constructor(){this.contexts=new Map}onChildOutletCreated(D,C){const k=this.getOrCreateContext(D);k.outlet=C,this.contexts.set(D,k)}onChildOutletDestroyed(D){const C=this.getContext(D);C&&(C.outlet=null,C.attachRef=null)}onOutletDeactivated(){const D=this.contexts;return this.contexts=new Map,D}onOutletReAttached(D){this.contexts=D}getOrCreateContext(D){let C=this.getContext(D);return C||(C=new Ea,this.contexts.set(D,C)),C}getContext(D){return this.contexts.get(D)||null}}class Fl{shouldProcessUrl(D){return!0}extract(D){return D}merge(D,C){return D}}function Ll(M){throw M}function Ca(M,D,C){return D.parse("/")}function Jr(M,D){return it(null)}const Gc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Ks={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nr=(()=>{class M{constructor(C,k,V,X,h,r,l,p){this.rootComponentType=C,this.urlSerializer=k,this.rootContexts=V,this.location=X,this.config=p,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Pt.xQ,this.errorHandler=Ll,this.malformedUriErrorHandler=Ca,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Jr,afterPreactivation:Jr},this.urlHandlingStrategy=new Fl,this.routeReuseStrategy=new pc,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=h.get(ne.h0i),this.console=h.get(ne.c2e);const T=h.get(ne.R0b);this.isNgZoneEnabled=T instanceof ne.R0b&&ne.R0b.isInAngularZone(),this.resetConfig(p),this.currentUrlTree=new we(new pe([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new wa(r,l,A=>this.triggerEvent(new ge(A)),A=>this.triggerEvent(new ke(A))),this.routerState=wl(this.currentUrlTree,this.rootComponentType),this.transitions=new Ie({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var C;return null===(C=this.location.getState())||void 0===C?void 0:C.\u0275routerPageId}setupNavigations(C){const k=this.events;return C.pipe(an(V=>0!==V.id),(0,pt.U)(V=>Object.assign(Object.assign({},V),{extractedUrl:this.urlHandlingStrategy.extract(V.rawUrl)})),Ur(V=>{let X=!1,h=!1;return it(V).pipe(qn(r=>{this.currentNavigation={id:r.id,initialUrl:r.currentRawUrl,extractedUrl:r.extractedUrl,trigger:r.source,extras:r.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ur(r=>{const l=this.browserUrlTree.toString(),p=!this.navigated||r.extractedUrl.toString()!==l||l!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||p)&&this.urlHandlingStrategy.shouldProcessUrl(r.rawUrl))return ol(r.source)&&(this.browserUrlTree=r.extractedUrl),it(r).pipe(Ur(v=>{const T=this.transitions.getValue();return k.next(new Mi(v.id,this.serializeUrl(v.extractedUrl),v.source,v.restoredState)),T!==this.transitions.getValue()?_n:Promise.resolve(v)}),function(M,D,C,k){return Ur(V=>function(M,D,C,k,V){return new hc(M,D,C,k,V).apply()}(M,D,C,V.extractedUrl,k).pipe((0,pt.U)(X=>Object.assign(Object.assign({},V),{urlAfterRedirects:X}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),qn(v=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:v.urlAfterRedirects})}),function(M,D,C,k,V){return(0,nr.zg)(X=>function(M,D,C,k,V="emptyOnly",X="legacy"){try{const h=new Uc(M,D,C,k,V,X).recognize();return null===h?_r(new Wi):it(h)}catch(h){return _r(h)}}(M,D,X.urlAfterRedirects,C(X.urlAfterRedirects),k,V).pipe((0,pt.U)(h=>Object.assign(Object.assign({},X),{targetSnapshot:h}))))}(this.rootComponentType,this.config,v=>this.serializeUrl(v),this.paramsInheritanceStrategy,this.relativeLinkResolution),qn(v=>{"eager"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(v.urlAfterRedirects,v),this.browserUrlTree=v.urlAfterRedirects);const T=new re(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);k.next(T)}));if(p&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:T,extractedUrl:A,source:R,restoredState:N,extras:U}=r,H=new Mi(T,this.serializeUrl(A),R,N);k.next(H);const q=wl(A,this.rootComponentType).snapshot;return it(Object.assign(Object.assign({},r),{targetSnapshot:q,urlAfterRedirects:A,extras:Object.assign(Object.assign({},U),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=r.rawUrl,this.browserUrlTree=r.urlAfterRedirects,r.resolve(null),_n}),Pr(r=>{const{targetSnapshot:l,id:p,extractedUrl:y,rawUrl:v,extras:{skipLocationChange:T,replaceUrl:A}}=r;return this.hooks.beforePreactivation(l,{navigationId:p,appliedUrlTree:y,rawUrlTree:v,skipLocationChange:!!T,replaceUrl:!!A})}),qn(r=>{const l=new j(r.id,this.serializeUrl(r.extractedUrl),this.serializeUrl(r.urlAfterRedirects),r.targetSnapshot);this.triggerEvent(l)}),(0,pt.U)(r=>Object.assign(Object.assign({},r),{guards:Sl(r.targetSnapshot,r.currentSnapshot,this.rootContexts)})),function(M,D){return(0,nr.zg)(C=>{const{targetSnapshot:k,currentSnapshot:V,guards:{canActivateChecks:X,canDeactivateChecks:h}}=C;return 0===h.length&&0===X.length?it(Object.assign(Object.assign({},C),{guardsResult:!0})):function(M,D,C,k){return(0,Ft.D)(M).pipe((0,nr.zg)(V=>function(M,D,C,k,V){const X=D&&D.routeConfig?D.routeConfig.canDeactivate:null;return X&&0!==X.length?it(X.map(r=>{const l=Rs(r,D,V);let p;if(function(M){return M&&bi(M.canDeactivate)}(l))p=on(l.canDeactivate(M,D,C,k));else{if(!bi(l))throw new Error("Invalid CanDeactivate guard");p=on(l(M,D,C,k))}return p.pipe(oi())})).pipe(Mo()):it(!0)}(V.component,V.route,C,D,k)),oi(V=>!0!==V,!0))}(h,k,V,M).pipe((0,nr.zg)(r=>r&&function(M){return"boolean"==typeof M}(r)?function(M,D,C,k){return(0,Ft.D)(D).pipe(Or(V=>Bi(function(M,D){return null!==M&&D&&D(new Le(M)),it(!0)}(V.route.parent,k),function(M,D){return null!==M&&D&&D(new Oe(M)),it(!0)}(V.route,k),function(M,D,C){const k=D[D.length-1],X=D.slice(0,D.length-1).reverse().map(h=>function(M){const D=M.routeConfig?M.routeConfig.canActivateChild:null;return D&&0!==D.length?{node:M,guards:D}:null}(h)).filter(h=>null!==h).map(h=>Jt(()=>it(h.guards.map(l=>{const p=Rs(l,h.node,C);let y;if(function(M){return M&&bi(M.canActivateChild)}(p))y=on(p.canActivateChild(k,M));else{if(!bi(p))throw new Error("Invalid CanActivateChild guard");y=on(p(k,M))}return y.pipe(oi())})).pipe(Mo())));return it(X).pipe(Mo())}(M,V.path,C),function(M,D,C){const k=D.routeConfig?D.routeConfig.canActivate:null;return k&&0!==k.length?it(k.map(X=>Jt(()=>{const h=Rs(X,D,C);let r;if(function(M){return M&&bi(M.canActivate)}(h))r=on(h.canActivate(D,M));else{if(!bi(h))throw new Error("Invalid CanActivate guard");r=on(h(D,M))}return r.pipe(oi())}))).pipe(Mo()):it(!0)}(M,V.route,C))),oi(V=>!0!==V,!0))}(k,X,M,D):it(r)),(0,pt.U)(r=>Object.assign(Object.assign({},C),{guardsResult:r})))})}(this.ngModule.injector,r=>this.triggerEvent(r)),qn(r=>{if(Qr(r.guardsResult)){const p=Ut(`Redirecting to "${this.serializeUrl(r.guardsResult)}"`);throw p.url=r.guardsResult,p}const l=new Z(r.id,this.serializeUrl(r.extractedUrl),this.serializeUrl(r.urlAfterRedirects),r.targetSnapshot,!!r.guardsResult);this.triggerEvent(l)}),an(r=>!!r.guardsResult||(this.restoreHistory(r),this.cancelNavigationTransition(r,""),!1)),Pr(r=>{if(r.guards.canActivateChecks.length)return it(r).pipe(qn(l=>{const p=new ie(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(p)}),Ur(l=>{let p=!1;return it(l).pipe(function(M,D){return(0,nr.zg)(C=>{const{targetSnapshot:k,guards:{canActivateChecks:V}}=C;if(!V.length)return it(C);let X=0;return(0,Ft.D)(V).pipe(Or(h=>function(M,D,C,k){return function(M,D,C,k){const V=Object.keys(M);if(0===V.length)return it({});const X={};return(0,Ft.D)(V).pipe((0,nr.zg)(h=>function(M,D,C,k){const V=Rs(M,D,k);return on(V.resolve?V.resolve(D,C):V(D,C))}(M[h],D,C,k).pipe(qn(r=>{X[h]=r}))),Vi(1),(0,nr.zg)(()=>Object.keys(X).length===V.length?it(X):_n))}(M._resolve,M,D,k).pipe((0,pt.U)(X=>(M._resolvedData=X,M.data=Object.assign(Object.assign({},M.data),Li(M,C).resolve),null)))}(h.route,k,M,D)),qn(()=>X++),Vi(1),(0,nr.zg)(h=>X===V.length?it(C):_n))})}(this.paramsInheritanceStrategy,this.ngModule.injector),qn({next:()=>p=!0,complete:()=>{p||(this.restoreHistory(l),this.cancelNavigationTransition(l,"At least one route resolver didn't emit any value."))}}))}),qn(l=>{const p=new he(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(p)}))}),Pr(r=>{const{targetSnapshot:l,id:p,extractedUrl:y,rawUrl:v,extras:{skipLocationChange:T,replaceUrl:A}}=r;return this.hooks.afterPreactivation(l,{navigationId:p,appliedUrlTree:y,rawUrlTree:v,skipLocationChange:!!T,replaceUrl:!!A})}),(0,pt.U)(r=>{const l=function(M,D,C){const k=Gi(M,D._root,C?C._root:void 0);return new bl(k,D)}(this.routeReuseStrategy,r.targetSnapshot,r.currentRouterState);return Object.assign(Object.assign({},r),{targetRouterState:l})}),qn(r=>{this.currentUrlTree=r.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r),this.browserUrlTree=r.urlAfterRedirects)}),((M,D,C)=>(0,pt.U)(k=>(new Mn(D,k.targetRouterState,k.currentRouterState,C).activate(M),k)))(this.rootContexts,this.routeReuseStrategy,r=>this.triggerEvent(r)),qn({next(){X=!0},complete(){X=!0}}),function(M){return D=>D.lift(new Ln(M))}(()=>{var r;if(!X&&!h){const l=`Navigation ID ${V.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(V),this.cancelNavigationTransition(V,l)):this.cancelNavigationTransition(V,l)}(null===(r=this.currentNavigation)||void 0===r?void 0:r.id)===V.id&&(this.currentNavigation=null)}),jr(r=>{if(h=!0,function(M){return M&&M[Ge]}(r)){const l=Qr(r.url);l||(this.navigated=!0,this.restoreHistory(V,!0));const p=new ai(V.id,this.serializeUrl(V.extractedUrl),r.message);k.next(p),l?setTimeout(()=>{const y=this.urlHandlingStrategy.merge(r.url,this.rawUrlTree),v={skipLocationChange:V.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ol(V.source)};this.scheduleNavigation(y,"imperative",null,v,{resolve:V.resolve,reject:V.reject,promise:V.promise})},0):V.resolve(!1)}else{this.restoreHistory(V,!0);const l=new pn(V.id,this.serializeUrl(V.extractedUrl),r);k.next(l);try{V.resolve(this.errorHandler(r))}catch(p){V.reject(p)}}return _n}))}))}resetRootComponentType(C){this.rootComponentType=C,this.routerState.root.component=this.rootComponentType}getTransition(){const C=this.transitions.value;return C.urlAfterRedirects=this.browserUrlTree,C}setTransition(C){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),C))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(C=>{const k=this.extractLocationChangeInfoFromEvent(C);this.shouldScheduleNavigation(this.lastLocationChangeInfo,k)&&setTimeout(()=>{const{source:V,state:X,urlTree:h}=k,r={replaceUrl:!0};if(X){const l=Object.assign({},X);delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(r.state=l)}this.scheduleNavigation(h,V,X,r)},0),this.lastLocationChangeInfo=k}))}extractLocationChangeInfoFromEvent(C){var k;return{source:"popstate"===C.type?"popstate":"hashchange",urlTree:this.parseUrl(C.url),state:(null===(k=C.state)||void 0===k?void 0:k.navigationId)?C.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(C,k){if(!C)return!0;const V=k.urlTree.toString()===C.urlTree.toString();return k.transitionId!==C.transitionId||!V||!("hashchange"===k.source&&"popstate"===C.source||"popstate"===k.source&&"hashchange"===C.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(C){this.events.next(C)}resetConfig(C){sn(C),this.config=C.map(uc),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(C,k={}){const{relativeTo:V,queryParams:X,fragment:h,queryParamsHandling:r,preserveFragment:l}=k,p=V||this.routerState.root,y=l?this.currentUrlTree.fragment:h;let v=null;switch(r){case"merge":v=Object.assign(Object.assign({},this.currentUrlTree.queryParams),X);break;case"preserve":v=this.currentUrlTree.queryParams;break;default:v=X||null}return null!==v&&(v=this.removeEmptyProps(v)),function(M,D,C,k,V){if(0===C.length)return ls(D.root,D.root,D,k,V);const X=function(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new Ms(!0,0,M);let D=0,C=!1;const k=M.reduce((V,X,h)=>{if("object"==typeof X&&null!=X){if(X.outlets){const r={};return gt(X.outlets,(l,p)=>{r[p]="string"==typeof l?l.split("/"):l}),[...V,{outlets:r}]}if(X.segmentPath)return[...V,X.segmentPath]}return"string"!=typeof X?[...V,X]:0===h?(X.split("/").forEach((r,l)=>{0==l&&"."===r||(0==l&&""===r?C=!0:".."===r?D++:""!=r&&V.push(r))}),V):[...V,X]},[]);return new Ms(C,D,k)}(C);if(X.toRoot())return ls(D.root,new pe([],{}),D,k,V);const h=function(M,D,C){if(M.isAbsolute)return new W(D.root,!0,0);if(-1===C.snapshot._lastPathIndex){const X=C.snapshot._urlSegment;return new W(X,X===D.root,0)}const k=jo(M.commands[0])?0:1;return function(M,D,C){let k=M,V=D,X=C;for(;X>V;){if(X-=V,k=k.parent,!k)throw new Error("Invalid number of '../'");V=k.segments.length}return new W(k,!1,V-X)}(C.snapshot._urlSegment,C.snapshot._lastPathIndex+k,M.numberOfDoubleDots)}(X,D,M),r=h.processChildren?ht(h.segmentGroup,h.index,X.commands):We(h.segmentGroup,h.index,X.commands);return ls(h.segmentGroup,r,D,k,V)}(p,this.currentUrlTree,C,v,null!=y?y:null)}navigateByUrl(C,k={skipLocationChange:!1}){const V=Qr(C)?C:this.parseUrl(C),X=this.urlHandlingStrategy.merge(V,this.rawUrlTree);return this.scheduleNavigation(X,"imperative",null,k)}navigate(C,k={skipLocationChange:!1}){return function(M){for(let D=0;D<M.length;D++){const C=M[D];if(null==C)throw new Error(`The requested path contains ${C} segment at index ${D}`)}}(C),this.navigateByUrl(this.createUrlTree(C,k),k)}serializeUrl(C){return this.urlSerializer.serialize(C)}parseUrl(C){let k;try{k=this.urlSerializer.parse(C)}catch(V){k=this.malformedUriErrorHandler(V,this.urlSerializer,C)}return k}isActive(C,k){let V;if(V=!0===k?Object.assign({},Gc):!1===k?Object.assign({},Ks):k,Qr(C))return Ri(this.currentUrlTree,C,V);const X=this.parseUrl(C);return Ri(this.currentUrlTree,X,V)}removeEmptyProps(C){return Object.keys(C).reduce((k,V)=>{const X=C[V];return null!=X&&(k[V]=X),k},{})}processNavigations(){this.navigations.subscribe(C=>{this.navigated=!0,this.lastSuccessfulId=C.id,this.currentPageId=C.targetPageId,this.events.next(new ji(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,C.resolve(!0)},C=>{this.console.warn(`Unhandled Navigation Error: ${C}`)})}scheduleNavigation(C,k,V,X,h){var r,l;if(this.disposed)return Promise.resolve(!1);const p=this.getTransition(),y=ol(k)&&p&&!ol(p.source),A=(this.lastSuccessfulId===p.id||this.currentNavigation?p.rawUrl:p.urlAfterRedirects).toString()===C.toString();if(y&&A)return Promise.resolve(!0);let R,N,U;h?(R=h.resolve,N=h.reject,U=h.promise):U=new Promise((Y,se)=>{R=Y,N=se});const H=++this.navigationId;let q;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(V=this.location.getState()),q=V&&V.\u0275routerPageId?V.\u0275routerPageId:X.replaceUrl||X.skipLocationChange?null!==(r=this.browserPageId)&&void 0!==r?r:0:(null!==(l=this.browserPageId)&&void 0!==l?l:0)+1):q=0,this.setTransition({id:H,targetPageId:q,source:k,restoredState:V,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:C,extras:X,resolve:R,reject:N,promise:U,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),U.catch(Y=>Promise.reject(Y))}setBrowserUrl(C,k){const V=this.urlSerializer.serialize(C),X=Object.assign(Object.assign({},k.extras.state),this.generateNgRouterState(k.id,k.targetPageId));this.location.isCurrentPathEqualTo(V)||k.extras.replaceUrl?this.location.replaceState(V,"",X):this.location.go(V,"",X)}restoreHistory(C,k=!1){var V,X;if("computed"===this.canceledNavigationResolution){const h=this.currentPageId-C.targetPageId;"popstate"!==C.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(V=this.currentNavigation)||void 0===V?void 0:V.finalUrl)||0===h?this.currentUrlTree===(null===(X=this.currentNavigation)||void 0===X?void 0:X.finalUrl)&&0===h&&(this.resetState(C),this.browserUrlTree=C.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(h)}else"replace"===this.canceledNavigationResolution&&(k&&this.resetState(C),this.resetUrlToCurrentUrlTree())}resetState(C){this.routerState=C.currentRouterState,this.currentUrlTree=C.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,C.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(C,k){const V=new ai(C.id,this.serializeUrl(C.extractedUrl),k);this.triggerEvent(V),C.resolve(!1)}generateNgRouterState(C,k){return"computed"===this.canceledNavigationResolution?{navigationId:C,\u0275routerPageId:k}:{navigationId:C}}}return M.\u0275fac=function(C){return new(C||M)(ne.LFG(ne.DyG),ne.LFG(Et),ne.LFG(Zo),ne.LFG(ue.Ye),ne.LFG(ne.zs3),ne.LFG(ne.v3s),ne.LFG(ne.Sil),ne.LFG(void 0))},M.\u0275prov=ne.Yz7({token:M,factory:M.\u0275fac}),M})();function ol(M){return"imperative"!==M}let Da=(()=>{class M{constructor(C,k,V,X,h){this.router=C,this.route=k,this.commands=[],this.onChanges=new Pt.xQ,null==V&&X.setAttribute(h.nativeElement,"tabindex","0")}ngOnChanges(C){this.onChanges.next(this)}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:[]}onClick(){const C={skipLocationChange:Wo(this.skipLocationChange),replaceUrl:Wo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Wo(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(ne.Y36(Nr),ne.Y36(Io),ne.$8M("tabindex"),ne.Y36(ne.Qsj),ne.Y36(ne.SBq))},M.\u0275dir=ne.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(C,k){1&C&&ne.NdJ("click",function(){return k.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[ne.TTD]}),M})(),ks=(()=>{class M{constructor(C,k,V){this.router=C,this.route=k,this.locationStrategy=V,this.commands=[],this.onChanges=new Pt.xQ,this.subscription=C.events.subscribe(X=>{X instanceof ji&&this.updateTargetUrlAndHref()})}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:[]}ngOnChanges(C){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(C,k,V,X,h){if(0!==C||k||V||X||h||"string"==typeof this.target&&"_self"!=this.target)return!0;const r={skipLocationChange:Wo(this.skipLocationChange),replaceUrl:Wo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,r),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Wo(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(ne.Y36(Nr),ne.Y36(Io),ne.Y36(ue.S$))},M.\u0275dir=ne.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(C,k){1&C&&ne.NdJ("click",function(X){return k.onClick(X.button,X.ctrlKey,X.shiftKey,X.altKey,X.metaKey)}),2&C&&(ne.Ikx("href",k.href,ne.LSH),ne.uIk("target",k.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[ne.TTD]}),M})();function Wo(M){return""===M||!!M}let mc=(()=>{class M{constructor(C,k,V,X,h,r){this.router=C,this.element=k,this.renderer=V,this.cdr=X,this.link=h,this.linkWithHref=r,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.routerEventsSubscription=C.events.subscribe(l=>{l instanceof ji&&this.update()})}ngAfterContentInit(){it(this.links.changes,this.linksWithHrefs.changes,it(null)).pipe((0,Tn.J)()).subscribe(C=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var C;null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe();const k=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(V=>!!V).map(V=>V.onChanges);this.linkInputChangesSubscription=(0,Ft.D)(k).pipe((0,Tn.J)()).subscribe(V=>{this.isActive!==this.isLinkActive(this.router)(V)&&this.update()})}set routerLinkActive(C){const k=Array.isArray(C)?C:C.split(" ");this.classes=k.filter(V=>!!V)}ngOnChanges(C){this.update()}ngOnDestroy(){var C;this.routerEventsSubscription.unsubscribe(),null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const C=this.hasActiveLinks();this.isActive!==C&&(this.isActive=C,this.cdr.markForCheck(),this.classes.forEach(k=>{C?this.renderer.addClass(this.element.nativeElement,k):this.renderer.removeClass(this.element.nativeElement,k)}))})}isLinkActive(C){const k=function(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return V=>C.isActive(V.urlTree,k)}hasActiveLinks(){const C=this.isLinkActive(this.router);return this.link&&C(this.link)||this.linkWithHref&&C(this.linkWithHref)||this.links.some(C)||this.linksWithHrefs.some(C)}}return M.\u0275fac=function(C){return new(C||M)(ne.Y36(Nr),ne.Y36(ne.SBq),ne.Y36(ne.Qsj),ne.Y36(ne.sBO),ne.Y36(Da,8),ne.Y36(ks,8))},M.\u0275dir=ne.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(C,k,V){if(1&C&&(ne.Suo(V,Da,5),ne.Suo(V,ks,5)),2&C){let X;ne.iGM(X=ne.CRH())&&(k.links=X),ne.iGM(X=ne.CRH())&&(k.linksWithHrefs=X)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},exportAs:["routerLinkActive"],features:[ne.TTD]}),M})(),Sa=(()=>{class M{constructor(C,k,V,X,h){this.parentContexts=C,this.location=k,this.resolver=V,this.changeDetector=h,this.activated=null,this._activatedRoute=null,this.activateEvents=new ne.vpe,this.deactivateEvents=new ne.vpe,this.name=X||Ue,C.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const C=this.parentContexts.getContext(this.name);C&&C.route&&(C.attachRef?this.attach(C.attachRef,C.route):this.activateWith(C.route,C.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const C=this.activated;return this.activated=null,this._activatedRoute=null,C}attach(C,k){this.activated=C,this._activatedRoute=k,this.location.insert(C.hostView)}deactivate(){if(this.activated){const C=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(C)}}activateWith(C,k){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=C;const h=(k=k||this.resolver).resolveComponentFactory(C._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,l=new Ol(C,r,this.location.injector);this.activated=this.location.createComponent(h,this.location.length,l),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(C){return new(C||M)(ne.Y36(Zo),ne.Y36(ne.s_b),ne.Y36(ne._Vd),ne.$8M("name"),ne.Y36(ne.sBO))},M.\u0275dir=ne.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),M})();class Ol{constructor(D,C,k){this.route=D,this.childContexts=C,this.parent=k}get(D,C){return D===Io?this.route:D===Zo?this.childContexts:this.parent.get(D,C)}}class ps{}class gc{preload(D,C){return it(null)}}let ms=(()=>{class M{constructor(C,k,V,X,h){this.router=C,this.injector=X,this.preloadingStrategy=h,this.loader=new wa(k,V,p=>C.triggerEvent(new ge(p)),p=>C.triggerEvent(new ke(p)))}setUpPreloading(){this.subscription=this.router.events.pipe(an(C=>C instanceof ji),Or(()=>this.preload())).subscribe(()=>{})}preload(){const C=this.injector.get(ne.h0i);return this.processRoutes(C,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(C,k){const V=[];for(const X of k)if(X.loadChildren&&!X.canLoad&&X._loadedConfig){const h=X._loadedConfig;V.push(this.processRoutes(h.module,h.routes))}else X.loadChildren&&!X.canLoad?V.push(this.preloadConfig(C,X)):X.children&&V.push(this.processRoutes(C,X.children));return(0,Ft.D)(V).pipe((0,Tn.J)(),(0,pt.U)(X=>{}))}preloadConfig(C,k){return this.preloadingStrategy.preload(k,()=>(k._loadedConfig?it(k._loadedConfig):this.loader.load(C.injector,k)).pipe((0,nr.zg)(X=>(k._loadedConfig=X,this.processRoutes(X.module,X.routes)))))}}return M.\u0275fac=function(C){return new(C||M)(ne.LFG(Nr),ne.LFG(ne.v3s),ne.LFG(ne.Sil),ne.LFG(ne.zs3),ne.LFG(ps))},M.\u0275prov=ne.Yz7({token:M,factory:M.\u0275fac}),M})(),Ia=(()=>{class M{constructor(C,k,V={}){this.router=C,this.viewportScroller=k,this.options=V,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},V.scrollPositionRestoration=V.scrollPositionRestoration||"disabled",V.anchorScrolling=V.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(C=>{C instanceof Mi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=C.navigationTrigger,this.restoredId=C.restoredState?C.restoredState.navigationId:0):C instanceof ji&&(this.lastId=C.id,this.scheduleScrollEvent(C,this.router.parseUrl(C.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(C=>{C instanceof ut&&(C.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(C.position):C.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(C.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(C,k){this.router.triggerEvent(new ut(C,"popstate"===this.lastSource?this.store[this.restoredId]:null,k))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(C){return new(C||M)(ne.LFG(Nr),ne.LFG(ue.EM),ne.LFG(void 0))},M.\u0275prov=ne.Yz7({token:M,factory:M.\u0275fac}),M})();const Yo=new ne.OlP("ROUTER_CONFIGURATION"),zl=new ne.OlP("ROUTER_FORROOT_GUARD"),Aa=[ue.Ye,{provide:Et,useClass:kn},{provide:Nr,useFactory:function(M,D,C,k,V,X,h,r={},l,p){const y=new Nr(null,M,D,C,k,V,X,Pi(h));return l&&(y.urlHandlingStrategy=l),p&&(y.routeReuseStrategy=p),function(M,D){M.errorHandler&&(D.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(D.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(D.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(D.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(D.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(D.urlUpdateStrategy=M.urlUpdateStrategy)}(r,y),r.enableTracing&&y.events.subscribe(v=>{var T,A;null===(T=console.group)||void 0===T||T.call(console,`Router Event: ${v.constructor.name}`),console.log(v.toString()),console.log(v),null===(A=console.groupEnd)||void 0===A||A.call(console)}),y},deps:[Et,Zo,ue.Ye,ne.zs3,ne.v3s,ne.Sil,qo,Yo,[class{},new ne.FiY],[class{},new ne.FiY]]},Zo,{provide:Io,useFactory:function(M){return M.routerState.root},deps:[Nr]},{provide:ne.v3s,useClass:ne.EAV},ms,gc,class{preload(D,C){return C().pipe(jr(()=>it(null)))}},{provide:Yo,useValue:{enableTracing:!1}}];function Fs(){return new ne.PXZ("Router",Nr)}let Bl=(()=>{class M{constructor(C,k){}static forRoot(C,k){return{ngModule:M,providers:[Aa,vc(C),{provide:zl,useFactory:Xo,deps:[[Nr,new ne.FiY,new ne.tp0]]},{provide:Yo,useValue:k||{}},{provide:ue.S$,useFactory:Vl,deps:[ue.lw,[new ne.tBr(ue.mr),new ne.FiY],Yo]},{provide:Ia,useFactory:yc,deps:[Nr,ue.EM,Yo]},{provide:ps,useExisting:k&&k.preloadingStrategy?k.preloadingStrategy:gc},{provide:ne.PXZ,multi:!0,useFactory:Fs},[_s,{provide:ne.ip1,multi:!0,useFactory:Ls,deps:[_s]},{provide:Lo,useFactory:Ma,deps:[_s]},{provide:ne.tb,multi:!0,useExisting:Lo}]]}}static forChild(C){return{ngModule:M,providers:[vc(C)]}}}return M.\u0275fac=function(C){return new(C||M)(ne.LFG(zl,8),ne.LFG(Nr,8))},M.\u0275mod=ne.oAB({type:M}),M.\u0275inj=ne.cJS({}),M})();function yc(M,D,C){return C.scrollOffset&&D.setOffset(C.scrollOffset),new Ia(M,D,C)}function Vl(M,D,C={}){return C.useHash?new ue.Do(M,D):new ue.b0(M,D)}function Xo(M){return"guarded"}function vc(M){return[{provide:ne.deG,multi:!0,useValue:M},{provide:qo,multi:!0,useValue:M}]}let _s=(()=>{class M{constructor(C){this.injector=C,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Pt.xQ}appInitializer(){return this.injector.get(ue.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let k=null;const V=new Promise(r=>k=r),X=this.injector.get(Nr),h=this.injector.get(Yo);return"disabled"===h.initialNavigation?(X.setUpLocationChangeListener(),k(!0)):"enabled"===h.initialNavigation||"enabledBlocking"===h.initialNavigation?(X.hooks.afterPreactivation=()=>this.initNavigation?it(null):(this.initNavigation=!0,k(!0),this.resultOfPreactivationDone),X.initialNavigation()):k(!0),V})}bootstrapListener(C){const k=this.injector.get(Yo),V=this.injector.get(ms),X=this.injector.get(Ia),h=this.injector.get(Nr),r=this.injector.get(ne.z2F);C===r.components[0]&&(("enabledNonBlocking"===k.initialNavigation||void 0===k.initialNavigation)&&h.initialNavigation(),V.setUpPreloading(),X.init(),h.resetRootComponentType(r.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return M.\u0275fac=function(C){return new(C||M)(ne.LFG(ne.zs3))},M.\u0275prov=ne.Yz7({token:M,factory:M.\u0275fac}),M})();function Ls(M){return M.appInitializer.bind(M)}function Ma(M){return M.bootstrapListener.bind(M)}const Lo=new ne.OlP("Router Initializer")},958:function(Un){Un.exports=function(){"use strict";var Rt,Ve,ue;function ne(f,Vt){if(Rt)if(Ve){var it="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+Rt+")(sharedChunk); ("+Ve+")(sharedChunk); self.onerror = null;",Pt={};Rt(Pt),ue=Vt(Pt),"undefined"!=typeof window&&(ue.workerUrl=window.URL.createObjectURL(new Blob([it],{type:"text/javascript"})))}else Ve=Vt;else Rt=Vt}return ne(0,function(f){var it=Pt;function Pt(o,e,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=s,this.p2y=c}Pt.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Pt.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Pt.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Pt.prototype.solveCurveX=function(o,e){var s,c,d,m,_;for(void 0===e&&(e=1e-6),d=o,_=0;_<8;_++){if(m=this.sampleCurveX(d)-o,Math.abs(m)<e)return d;var b=this.sampleCurveDerivativeX(d);if(Math.abs(b)<1e-6)break;d-=m/b}if((d=o)<(s=0))return s;if(d>(c=1))return c;for(;s<c;){if(m=this.sampleCurveX(d),Math.abs(m-o)<e)return d;o>m?s=d:c=d,d=.5*(c-s)+s}return d},Pt.prototype.solve=function(o,e){return this.sampleCurveY(this.solveCurveX(o,e))};var je=Ie;function Ie(o,e){this.x=o,this.y=e}Ie.prototype={clone:function(){return new Ie(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,e){return this.clone()._rotateAround(o,e)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var e=o.x-this.x,s=o.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult:function(o){var e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var e=Math.cos(o),s=Math.sin(o),c=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,e){var s=Math.cos(o),c=Math.sin(o),d=e.y+c*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-c*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ie.convert=function(o){return o instanceof Ie?o:Array.isArray(o)?new Ie(o[0],o[1]):o};var Te="undefined"!=typeof self?self:{};const He=Math.pow(2,53)-1,Qe=Math.PI/180,_t=180/Math.PI;function mt(o){return o*Qe}const Tt=[[0,0],[1,0],[1,1],[0,1]];function et(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,s=e*o;return 4*(o<.5?s:3*(o-e)+s-.75)}function Qt(o,e,s,c){const d=new it(o,e,s,c);return function(m){return d.solve(m)}}const Pn=Qt(.25,.1,.25,1);function zt(o,e,s){return Math.min(s,Math.max(e,o))}function Dt(o,e,s){const c=s-e,d=((o-e)%c+c)%c+e;return d===e?s:d}function ni(o,e,s){if(!o.length)return s(null,[]);let c=o.length;const d=new Array(o.length);let m=null;o.forEach((_,b)=>{e(_,(E,S)=>{E&&(m=E),d[b]=S,0==--c&&s(m,d)})})}function Kr(o){const e=[];for(const s in o)e.push(o[s]);return e}function Tn(o,...e){for(const s of e)for(const c in s)o[c]=s[c];return o}let ha=1;function Bi(){return ha++}function Ft(){return function o(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function _n(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Xn(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Hn(o,e){o.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function Jt(o,e){return-1!==o.indexOf(e,o.length-e.length)}function In(o,e,s){const c={};for(const d in o)c[d]=e.call(s||this,o[d],d,o);return c}function pt(o,e,s){const c={};for(const d in o)e.call(s||this,o[d],d,o)&&(c[d]=o[d]);return c}function Rn(o){return Array.isArray(o)?o.map(Rn):"object"==typeof o&&o?In(o,Rn):o}const Ur={};function er(o){Ur[o]||("undefined"!=typeof console&&console.warn(o),Ur[o]=!0)}function fr(o,e,s){return(s.y-o.y)*(e.x-o.x)>(e.y-o.y)*(s.x-o.x)}function Ss(o){let e=0;for(let s,c,d=0,m=o.length,_=m-1;d<m;_=d++)s=o[d],c=o[_],e+=(c.x-s.x)*(s.y+c.y);return e}function Ji(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ho(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,d,m)=>{const _=d||m;return e[c]=!_||_.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Bo,fn,fo,mi=null;function Lr(o){if(null==mi){const e=o.navigator?o.navigator.userAgent:null;mi=!!o.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return mi}function Dr(o){try{const e=Te[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const an={now:()=>void 0!==fo?fo:Te.performance.now(),setNow(o){fo=o},restoreNow(){fo=void 0},frame(o){const e=Te.requestAnimationFrame(o);return{cancel:()=>Te.cancelAnimationFrame(e)}},getImageData(o,e=0){const s=Te.document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return s.width=o.width,s.height=o.height,c.drawImage(o,0,0,o.width,o.height),c.getImageData(-e,-e,o.width+2*e,o.height+2*e)},resolveURL:o=>(Bo||(Bo=Te.document.createElement("a")),Bo.href=o,Bo.href),get devicePixelRatio(){return Te.devicePixelRatio},get prefersReducedMotion(){return!!Te.matchMedia&&(null==fn&&(fn=Te.matchMedia("(prefers-reduced-motion: reduce)")),fn.matches)}};let eo;const Fn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==eo){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{eo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(e){eo=o}}return eo},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},jr={supported:!1,testSupport:function(o){!nr&&to&&(Or?Vi(o):tr=o)}};let tr,to,nr=!1,Or=!1;function Vi(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,to),o.isContextLost())return;jr.supported=!0}catch(s){}o.deleteTexture(e),nr=!0}Te.document&&(to=Te.document.createElement("img"),to.onload=function(){tr&&Vi(tr),tr=null,Or=!0},to.onerror=function(){nr=!0,tr=null},to.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Er="01",Ui="NO_ACCESS_TOKEN";function ri(o){return 0===o.indexOf("mapbox:")}function Ai(o){return Fn.API_URL_REGEX.test(o)}const Do=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gi(o){const e=o.match(Do);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ii(o){const e=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${e}`}function Nt(o){if(!o)return null;const e=o.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Te.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class Kn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=Nt(Fn.ACCESS_TOKEN);let c="";return c=s&&s.u?Te.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):Fn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const e=Dr("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{const d=Te.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));const m=Te.localStorage.getItem(c);m&&(this.anonId=m)}catch(d){er("Unable to read from LocalStorage")}}saveEventData(){const e=Dr("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{Te.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Te.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(d){er("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,c,d){if(!Fn.EVENTS_URL)return;const m=gi(Fn.EVENTS_URL);m.params.push(`access_token=${d||Fn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:Er,userId:this.anonId},b=s?Tn(_,s):_,E={url:ii(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=Z(E,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(d)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const $t=new class extends Kn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,e){Fn.EVENTS_URL&&Fn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>ri(s)||Ai(s))&&this.queueRequest(Date.now(),e)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Nt(Fn.ACCESS_TOKEN),s=e?e.u:Fn.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Xn(this.anonId)||(this.anonId=Ft(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),b=(d-this.eventData.lastSuccess)/864e5;c=c||b>=1||b<-1||m.getDate()!==_.getDate()}else c=!0;if(!c)return this.processRequests();this.postEvent(d,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=s)},o)}},qt=$t.postTurnstileEvent.bind($t),oi=new class extends Kn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,e,s,c){this.skuToken=e,this.errorCb=c,Fn.EVENTS_URL&&(s||Fn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ui)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xn(this.anonId)||(this.anonId=Ft()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o))}},si=oi.postMapLoadEvent.bind(oi),Tr=new class extends Kn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,e,s,c){if(!Fn.API_URL||!Fn.SESSION_PATH)return;const d=gi(Fn.API_URL+Fn.SESSION_PATH);d.params.push(`sku=${e||""}`),d.params.push(`access_token=${c||Fn.ACCESS_TOKEN||""}`);const m={url:ii(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ie(m,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,e,s,c){this.skuToken=e,this.errorCb=c,Fn.SESSION_PATH&&Fn.API_URL&&(s||Fn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ui)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o)}},qn=Tr.getSessionAPI.bind(Tr),$r=new Set,os="mapbox-tiles";let Kt,po,Ln=500,ss=50;function _i(){Te.caches&&!Kt&&(Kt=Te.caches.open(os))}function vn(o){const e=o.indexOf("?");return e<0?o:o.slice(0,e)}let Mi=1/0;const ji={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ji);class ai extends Error{constructor(e,s,c){401===s&&Ai(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pn=Ji()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Te.location.protocol?Te.parent:Te).location.href,re=function(o,e){if(!(/^file:/.test(s=o.url)||/^file:/.test(pn())&&!/^\w+:/.test(s))){if(Te.fetch&&Te.Request&&Te.AbortController&&Te.Request.prototype.hasOwnProperty("signal"))return function(c,d){const m=new Te.AbortController,_=new Te.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:pn(),signal:m.signal});let b=!1,E=!1;const S=(P=_.url).indexOf("sku=")>0&&Ai(P);var P;"json"===c.type&&_.headers.set("Accept","application/json");const L=($,K,te)=>{if(E)return;if($&&"SecurityError"!==$.message&&er($),K&&te)return O(K);const de=Date.now();Te.fetch(_).then(be=>{if(be.ok){const Ae=S?be.clone():null;return O(be,Ae,de)}return d(new ai(be.statusText,be.status,c.url))}).catch(be=>{20!==be.code&&d(new Error(be.message))})},O=($,K,te)=>{("arrayBuffer"===c.type?$.arrayBuffer():"json"===c.type?$.json():$.text()).then(de=>{E||(K&&te&&function(be,Ae,Ne){if(_i(),!Kt)return;const Me={status:Ae.status,statusText:Ae.statusText,headers:new Te.Headers};Ae.headers.forEach(($e,Ye)=>Me.headers.set(Ye,$e));const ze=ho(Ae.headers.get("Cache-Control")||"");ze["no-store"]||(ze["max-age"]&&Me.headers.set("Expires",new Date(Ne+1e3*ze["max-age"]).toUTCString()),new Date(Me.headers.get("Expires")).getTime()-Ne<42e4||function($e,Ye){if(void 0===po)try{new Response(new ReadableStream),po=!0}catch(lt){po=!1}po?Ye($e.body):$e.blob().then(Ye)}(Ae,$e=>{const Ye=new Te.Response($e,Me);_i(),Kt&&Kt.then(lt=>lt.put(vn(be.url),Ye)).catch(lt=>er(lt.message))}))}(_,K,te),b=!0,d(null,de,$.headers.get("Cache-Control"),$.headers.get("Expires")))}).catch(de=>{E||d(new Error(de.message))})};return S?function($,K){if(_i(),!Kt)return K(null);const te=vn($.url);Kt.then(de=>{de.match(te).then(be=>{const Ae=function(Ne){if(!Ne)return!1;const Me=new Date(Ne.headers.get("Expires")||0),ze=ho(Ne.headers.get("Cache-Control")||"");return Me>Date.now()&&!ze["no-cache"]}(be);de.delete(te),Ae&&de.put(te,be.clone()),K(null,be,Ae)}).catch(K)}).catch(K)}(_,L):L(null,null),{cancel:()=>{E=!0,b||m.abort()}}}(o,e);if(Ji()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var s;return function(c,d){const m=new Te.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(m.responseType="arraybuffer");for(const _ in c.headers)m.setRequestHeader(_,c.headers[_]);return"json"===c.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===c.credentials,m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===c.type)try{_=JSON.parse(m.response)}catch(b){return d(b)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new ai(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(o,e)},j=function(o,e){return re(Tn(o,{type:"arrayBuffer"}),e)},Z=function(o,e){return re(Tn(o,{method:"POST"}),e)},ie=function(o,e){return re(Tn(o,{method:"GET"}),e)};function he(o){const e=Te.document.createElement("a");return e.href=o,e.protocol===Te.document.location.protocol&&e.host===Te.document.location.host}const ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ke,Le;ke=[],Le=0;const Ce=function(o,e){if(jr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Le>=Fn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ke.push(m),m}Le++;let s=!1;const c=()=>{if(!s)for(s=!0,Le--;ke.length&&Le<Fn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=ke.shift(),{requestParameters:_,callback:b,cancelled:E}=m;E||(m.cancel=Ce(_,b).cancel)}},d=j(o,(m,_,b,E)=>{c(),m?e(m):_&&(Te.createImageBitmap?function(S,P){const L=new Te.Blob([new Uint8Array(S)],{type:"image/png"});Te.createImageBitmap(L).then(O=>{P(null,O)}).catch(O=>{P(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,P)=>e(S,P,b,E)):function(S,P){const L=new Te.Image,O=Te.URL;L.onload=()=>{P(null,L),O.revokeObjectURL(L.src),L.onload=null,Te.requestAnimationFrame(()=>{L.src=ge})},L.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Te.Blob([new Uint8Array(S)],{type:"image/png"});L.src=S.byteLength?O.createObjectURL($):ge}(_,(S,P)=>e(S,P,b,E)))});return{cancel:()=>{d.cancel(),c()}}};function Oe(o,e,s){s[o]&&-1!==s[o].indexOf(e)||(s[o]=s[o]||[],s[o].push(e))}function Xe(o,e,s){if(s&&s[o]){const c=s[o].indexOf(e);-1!==c&&s[o].splice(c,1)}}class ut{constructor(e,s={}){Tn(this,s),this.type=e}}class Ue extends ut{constructor(e,s={}){super("error",Tn({error:e},s))}}class kt{on(e,s){return this._listeners=this._listeners||{},Oe(e,s,this._listeners),this}off(e,s){return Xe(e,s,this._listeners),Xe(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Oe(e,s,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,s){"string"==typeof e&&(e=new ut(e,s||{}));const c=e.type;if(this.listens(c)){e.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of d)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of m)Xe(c,b,this._oneTimeListeners),b.call(this,e);const _=this._eventedParent;_&&(Tn(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Ue&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ge{constructor(e,s,c,d){this.message=(e?`${e}: `:"")+c,d&&(this.identifier=d),null!=s&&s.__line__&&(this.line=s.__line__)}}function Ut(o){const e=o.value;return e?[new Ge(o.key,e,"constants have been deprecated as of v8")]:[]}function rn(o,...e){for(const s of e)for(const c in s)o[c]=s[c];return o}function Lt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function un(o){if(Array.isArray(o))return o.map(un);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const s in o)e[s]=un(o[s]);return e}return Lt(o)}class Ht extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class hn{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[c,d]of s)this.bindings[c]=d}concat(e){return new hn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Pi={kind:"null"},ft={kind:"number"},nt={kind:"string"},gt={kind:"boolean"},on={kind:"color"},xn={kind:"object"},Wt={kind:"value"},hr={kind:"collator"},Ri={kind:"formatted"},Zn={kind:"resolvedImage"};function Sr(o,e){return{kind:"array",itemType:o,N:e}}function Vn(o){if("array"===o.kind){const e=Vn(o.itemType);return"number"==typeof o.N?`array<${e}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${e}>`}return o.kind}const ln=[Pi,ft,nt,gt,on,Ri,xn,Sr(Wt),Zn];function ki(o,e){if("error"===e.kind)return null;if("array"===o.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ki(o.itemType,e.itemType))&&("number"!=typeof o.N||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if("value"===o.kind)for(const s of ln)if(!ki(s,e))return null}return`Expected ${Vn(o)} but found ${Vn(e)} instead.`}function Gr(o,e){return e.some(s=>s.kind===o.kind)}function we(o,e){return e.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}function pe(o){var e={exports:{}};return o(e,e.exports),e.exports}var ae=pe(function(o,e){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(b){return(b=Math.round(b))<0?0:b>255?255:b}function d(b){return c("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function m(b){return(E="%"===b[b.length-1]?parseFloat(b)/100:parseFloat(b))<0?0:E>1?1:E;var E}function _(b,E,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?b+(E-b)*S*6:2*S<1?E:3*S<2?b+(E-b)*(2/3-S)*6:b}try{e.parseCSSColor=function(b){var E,S=b.replace(/ /g,"").toLowerCase();if(S in s)return s[S].slice();if("#"===S[0])return 4===S.length?(E=parseInt(S.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===S.length&&(E=parseInt(S.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var P=S.indexOf("("),L=S.indexOf(")");if(-1!==P&&L+1===S.length){var O=S.substr(0,P),$=S.substr(P+1,L-(P+1)).split(","),K=1;switch(O){case"rgba":if(4!==$.length)return null;K=m($.pop());case"rgb":return 3!==$.length?null:[d($[0]),d($[1]),d($[2]),K];case"hsla":if(4!==$.length)return null;K=m($.pop());case"hsl":if(3!==$.length)return null;var te=(parseFloat($[0])%360+360)%360/360,de=m($[1]),be=m($[2]),Ae=be<=.5?be*(de+1):be+de-be*de,Ne=2*be-Ae;return[c(255*_(Ne,Ae,te+1/3)),c(255*_(Ne,Ae,te)),c(255*_(Ne,Ae,te-1/3)),K];default:return null}}return null}}catch(b){}});class De{constructor(e,s,c,d=1){this.r=e,this.g=s,this.b=c,this.a=d}static parse(e){if(!e)return;if(e instanceof De)return e;if("string"!=typeof e)return;const s=ae.parseCSSColor(e);return s?new De(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,c,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(c)},${d})`}toArray(){const{r:e,g:s,b:c,a:d}=this;return 0===d?[0,0,0,0]:[255*e/d,255*s/d,255*c/d,d]}}De.black=new De(0,0,0,1),De.white=new De(1,1,1,1),De.transparent=new De(0,0,0,0),De.red=new De(1,0,0,1),De.blue=new De(0,0,1,1);class Je{constructor(e,s,c){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ot{constructor(e,s,c,d,m){this.text=e,this.image=s,this.scale=c,this.fontStack=d,this.textColor=m}}class Et{constructor(e){this.sections=e}static fromString(e){return new Et([new Ot(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Et?e:Et.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(c)}return e}}class kn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new kn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function yi(o,e,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,e,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,e,s,c]:[o,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vi(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof De||o instanceof Je||o instanceof Et||o instanceof kn)return!0;if(Array.isArray(o)){for(const e of o)if(!vi(e))return!1;return!0}if("object"==typeof o){for(const e in o)if(!vi(o[e]))return!1;return!0}return!1}function lr(o){if(null===o)return Pi;if("string"==typeof o)return nt;if("boolean"==typeof o)return gt;if("number"==typeof o)return ft;if(o instanceof De)return on;if(o instanceof Je)return hr;if(o instanceof Et)return Ri;if(o instanceof kn)return Zn;if(Array.isArray(o)){const e=o.length;let s;for(const c of o){const d=lr(c);if(s){if(s===d)continue;s=Wt;break}s=d}return Sr(s||Wt,e)}return xn}function $i(o){const e=typeof o;return null===o?"":"string"===e||"number"===e||"boolean"===e?String(o):o instanceof De||o instanceof Et||o instanceof kn?o.toString():JSON.stringify(o)}class li{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(2!==e.length)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!vi(e[1]))return s.error("invalid value");const c=e[1];let d=lr(c);const m=s.expectedType;return"array"!==d.kind||0!==d.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(d=m),new li(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof De?["rgba"].concat(this.value.toArray()):this.value instanceof Et?this.value.serialize():this.value}}class vr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const On={string:nt,number:ft,boolean:gt,object:xn};class xi{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c,d=1;const m=e[0];if("array"===m){let b,E;if(e.length>2){const S=e[1];if("string"!=typeof S||!(S in On)||"object"===S)return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=On[S],d++}else b=Wt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=e[2],d++}c=Sr(b,E)}else c=On[m];const _=[];for(;d<e.length;d++){const b=s.parse(e[d],d,Wt);if(!b)return null;_.push(b)}return new xi(c,_)}evaluate(e){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(e);if(!ki(this.type,lr(c)))return c;if(s===this.args.length-1)throw new vr(`Expected value to be of type ${Vn(this.type)}, but found ${Vn(lr(c))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if("array"===e.kind){const c=e.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const d=e.N;("number"==typeof d||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(c=>c.serialize()))}}class ci{constructor(e){this.type=Ri,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=e.length-1;++_){const b=e[_];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let E=null;if(b["font-scale"]&&(E=s.parse(b["font-scale"],1,ft),!E))return null;let S=null;if(b["text-font"]&&(S=s.parse(b["text-font"],1,Sr(nt)),!S))return null;let P=null;if(b["text-color"]&&(P=s.parse(b["text-color"],1,on),!P))return null;const L=d[d.length-1];L.scale=E,L.font=S,L.textColor=P}else{const E=s.parse(e[_],1,Wt);if(!E)return null;const S=E.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:E,scale:null,font:null,textColor:null})}}return new ci(d)}evaluate(e){return new Et(this.sections.map(s=>{const c=s.content.evaluate(e);return lr(c)===Zn?new Ot("",c,null,null,null):new Ot($i(c),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),e.push(c)}return e}}class ui{constructor(e){this.type=Zn,this.input=e}static parse(e,s){if(2!==e.length)return s.error("Expected two arguments.");const c=s.parse(e[1],1,nt);return c?new ui(c):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),c=kn.fromString(s);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(s)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wa={"to-boolean":gt,"to-color":on,"to-number":ft,"to-string":nt};class no{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[0];if(("to-boolean"===c||"to-string"===c)&&2!==e.length)return s.error("Expected one argument.");const d=Wa[c],m=[];for(let _=1;_<e.length;_++){const b=s.parse(e[_],_,Wt);if(!b)return null;m.push(b)}return new no(d,m)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let s,c;for(const d of this.args){if(s=d.evaluate(e),c=null,s instanceof De)return s;if("string"==typeof s){const m=e.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:yi(s[0],s[1],s[2],s[3]),!c))return new De(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new vr(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(e),null===s)return 0;const d=Number(s);if(!isNaN(d))return d}throw new vr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Et.fromString($i(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?kn.fromString($i(this.args[0].evaluate(e))):$i(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ci([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ui(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const da=["Unknown","Point","LineString","Polygon"];class hi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?da[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=De.parse(e)),s}}class Fi{constructor(e,s,c,d){this.name=e,this.type=s,this._evaluate=c,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const c=e[0],d=Fi.definitions[c];if(!d)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=_.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let E=null;for(const[S,P]of b){E=new Gi(s.registry,s.path,null,s.scope);const L=[];let O=!1;for(let $=1;$<e.length;$++){const K=e[$],te=Array.isArray(S)?S[$-1]:S.type,de=E.parse(K,1+L.length,te);if(!de){O=!0;break}L.push(de)}if(!O)if(Array.isArray(S)&&S.length!==L.length)E.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let $=0;$<L.length;$++){const K=Array.isArray(S)?S[$]:S.type,te=L[$];E.concat($+1).checkSubtype(K,te.type)}if(0===E.errors.length)return new Fi(c,m,P,L)}}if(1===b.length)s.errors.push(...E.errors);else{const S=(b.length?b:_).map(([L])=>{return O=L,Array.isArray(O)?`(${O.map(Vn).join(", ")})`:`(${Vn(O.type)}...)`;var O}).join(" | "),P=[];for(let L=1;L<e.length;L++){const O=s.parse(e[L],1+P.length);if(!O)return null;P.push(Vn(O.type))}s.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(e,s){Fi.definitions=s;for(const c in s)e[c]=Fi}}class Is{constructor(e,s,c){this.type=hr,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(2!==e.length)return s.error("Expected one argument.");const c=e[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const d=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,gt);if(!d)return null;const m=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,gt);if(!m)return null;let _=null;return c.locale&&(_=s.parse(c.locale,1,nt),!_)?null:new Is(d,m,_)}evaluate(e){return new Je(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Vo=8192;function Ya(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Xa(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function cc(o,e){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(s*d*Vo),Math.round(c*d*Vo)]}function xl(o,e,s){const c=o[0]-e[0],d=o[1]-e[1],m=o[0]-s[0],_=o[1]-s[1];return c*_-m*d==0&&c*m<=0&&d*_<=0}function fa(o,e){let s=!1;for(let _=0,b=e.length;_<b;_++){const E=e[_];for(let S=0,P=E.length;S<P-1;S++){if(xl(o,E[S],E[S+1]))return!1;(d=E[S])[1]>(c=o)[1]!=(m=E[S+1])[1]>c[1]&&c[0]<(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1])+d[0]&&(s=!s)}}var c,d,m;return s}function To(o,e){for(let s=0;s<e.length;s++)if(fa(o,e[s]))return!0;return!1}function So(o,e,s,c){const d=c[0]-s[0],m=c[1]-s[1],_=(o[0]-s[0])*m-d*(o[1]-s[1]),b=(e[0]-s[0])*m-d*(e[1]-s[1]);return _>0&&b<0||_<0&&b>0}function bl(o,e,s){for(const S of s)for(let P=0;P<S.length-1;++P)if((b=[(_=S[P+1])[0]-(m=S[P])[0],_[1]-m[1]])[0]*(E=[(d=e)[0]-(c=o)[0],d[1]-c[1]])[1]-b[1]*E[0]!=0&&So(c,d,m,_)&&So(m,_,c,d))return!0;var c,d,m,_,b,E;return!1}function wl(o,e){for(let s=0;s<o.length;++s)if(!fa(o[s],e))return!1;for(let s=0;s<o.length-1;++s)if(bl(o[s],o[s+1],e))return!1;return!0}function Nc(o,e){for(let s=0;s<e.length;s++)if(wl(o,e[s]))return!0;return!1}function Io(o,e,s){const c=[];for(let d=0;d<o.length;d++){const m=[];for(let _=0;_<o[d].length;_++){const b=cc(o[d][_],s);Ya(e,b),m.push(b)}c.push(m)}return c}function Li(o,e,s){const c=[];for(let d=0;d<o.length;d++){const m=Io(o[d],e,s);c.push(m)}return c}function El(o,e,s,c){if(o[0]<s[0]||o[0]>s[2]){const d=.5*c;let m=o[0]-s[0]>d?-c:s[0]-o[0]>d?c:0;0===m&&(m=o[0]-s[2]>d?-c:s[2]-o[0]>d?c:0),o[0]+=m}Ya(e,o)}function pa(o,e,s,c){const d=Math.pow(2,c.z)*Vo,m=[c.x*Vo,c.y*Vo],_=[];for(const b of o)for(const E of b){const S=[E.x+m[0],E.y+m[1]];El(S,e,s,d),_.push(S)}return _}function $s(o,e,s,c){const d=Math.pow(2,c.z)*Vo,m=[c.x*Vo,c.y*Vo],_=[];for(const E of o){const S=[];for(const P of E){const L=[P.x+m[0],P.y+m[1]];Ya(e,L),S.push(L)}_.push(S)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of _)for(const S of E)El(S,e,s,d)}var b;return _}class di{constructor(e,s){this.type=gt,this.geojson=e,this.geometries=s}static parse(e,s){if(2!==e.length)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(vi(e[1])){const c=e[1];if("FeatureCollection"===c.type)for(let d=0;d<c.features.length;++d){const m=c.features[d].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new di(c,c.features[d].geometry)}else if("Feature"===c.type){const d=c.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new di(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new di(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===c.type){const b=Io(c.coordinates,m,_),E=pa(s.geometry(),d,m,_);if(!Xa(d,m))return!1;for(const S of E)if(!fa(S,b))return!1}if("MultiPolygon"===c.type){const b=Li(c.coordinates,m,_),E=pa(s.geometry(),d,m,_);if(!Xa(d,m))return!1;for(const S of E)if(!To(S,b))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===c.type){const b=Io(c.coordinates,m,_),E=$s(s.geometry(),d,m,_);if(!Xa(d,m))return!1;for(const S of E)if(!wl(S,b))return!1}if("MultiPolygon"===c.type){const b=Li(c.coordinates,m,_),E=$s(s.geometry(),d,m,_);if(!Xa(d,m))return!1;for(const S of E)if(!Nc(S,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Uo(o){if(o instanceof Fi&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof di)return!1;let e=!0;return o.eachChild(s=>{e&&!Uo(s)&&(e=!1)}),e}function as(o){if(o instanceof Fi&&"feature-state"===o.name)return!1;let e=!0;return o.eachChild(s=>{e&&!as(s)&&(e=!1)}),e}function Gs(o,e){if(o instanceof Fi&&e.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!Gs(c,e)&&(s=!1)}),s}class An{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(2!==e.length||"string"!=typeof e[1])return s.error("'var' expression requires exactly one string literal argument.");const c=e[1];return s.scope.has(c)?new An(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Gi{constructor(e,s=[],c,d=new hn,m=[]){this.registry=e,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=m,this.expectedType=c}parse(e,s,c,d,m={}){return s?this.concat(s,c,d)._parse(e,m):this._parse(e,m)}_parse(e,s){function c(d,m,_){return"assert"===_?new xi(m,[d]):"coerce"===_?new no(m,[d]):d}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let _=m.parse(e,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,E=_.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==E.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(b,E))return null}else _=c(_,b,s.typeAnnotation||"coerce");else _=c(_,b,s.typeAnnotation||"assert")}if(!(_ instanceof li)&&"resolvedImage"!==_.type.kind&&ma(_)){const b=new hi;try{_=new li(_.type,_.evaluate(b))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,c){const d="number"==typeof e?this.path.concat(e):this.path,m=c?this.scope.concat(c):this.scope;return new Gi(this.registry,d,s||null,m,this.errors)}error(e,...s){const c=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ht(c,e))}checkSubtype(e,s){const c=ki(e,s);return c&&this.error(c),c}}function ma(o){if(o instanceof An)return ma(o.boundExpression);if(o instanceof Fi&&"error"===o.name||o instanceof Is||o instanceof di)return!1;const e=o instanceof no||o instanceof xi;let s=!0;return o.eachChild(c=>{s=e?s&&ma(c):s&&c instanceof li}),!!s&&Uo(o)&&Gs(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function Hs(o,e){const s=o.length-1;let c,d,m=0,_=s,b=0;for(;m<=_;)if(b=Math.floor((m+_)/2),c=o[b],d=o[b+1],c<=e){if(b===s||e<d)return b;m=b+1}else{if(!(c>e))throw new vr("Input is not a number.");_=b-1}return 0}class As{constructor(e,s,c){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(e[1],1,ft);if(!c)return null;const d=[];let m=null;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);for(let _=1;_<e.length;_+=2){const b=1===_?-1/0:e[_],E=e[_+1],S=_,P=_+1;if("number"!=typeof b)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(d.length&&d[d.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=s.parse(E,P,m);if(!L)return null;m=m||L.type,d.push([b,L])}return new As(m,c,d)}evaluate(e){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=s[0])return c[0].evaluate(e);const m=s.length;return d>=s[m-1]?c[m-1].evaluate(e):c[Hs(s,d)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}function Nn(o,e,s){return o*(1-s)+e*s}var jo=Object.freeze({__proto__:null,number:Nn,color:function(o,e,s){return new De(Nn(o.r,e.r,s),Nn(o.g,e.g,s),Nn(o.b,e.b,s),Nn(o.a,e.a,s))},array:function(o,e,s){return o.map((c,d)=>Nn(c,e[d],s))}});const Ka=4/29,Ms=6/29,z=3*Ms*Ms,W=Math.PI/180,B=180/Math.PI;function J(o){return o>.008856451679035631?Math.pow(o,1/3):o/z+Ka}function Ee(o){return o>Ms?o*o*o:z*(o-Ka)}function We(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ht(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Gt(o){const e=ht(o.r),s=ht(o.g),c=ht(o.b),d=J((.4124564*e+.3575761*s+.1804375*c)/.95047),m=J((.2126729*e+.7151522*s+.072175*c)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-J((.0193339*e+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Zt(o){let e=(o.l+16)/116,s=isNaN(o.a)?e:e+o.a/500,c=isNaN(o.b)?e:e-o.b/200;return e=1*Ee(e),s=.95047*Ee(s),c=1.08883*Ee(c),new De(We(3.2404542*s-1.5371385*e-.4985314*c),We(-.969266*s+1.8760108*e+.041556*c),We(.0556434*s-.2040259*e+1.0572252*c),o.alpha)}function pr(o,e,s){const c=e-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const jn={forward:Gt,reverse:Zt,interpolate:function(o,e,s){return{l:Nn(o.l,e.l,s),a:Nn(o.a,e.a,s),b:Nn(o.b,e.b,s),alpha:Nn(o.alpha,e.alpha,s)}}},bn={forward:function(o){const{l:e,a:s,b:c}=Gt(o),d=Math.atan2(c,s)*B;return{h:d<0?d+360:d,c:Math.sqrt(s*s+c*c),l:e,alpha:o.a}},reverse:function(o){const e=o.h*W,s=o.c;return Zt({l:o.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:o.alpha})},interpolate:function(o,e,s){return{h:pr(o.h,e.h,s),c:Nn(o.c,e.c,s),l:Nn(o.l,e.l,s),alpha:Nn(o.alpha,e.alpha,s)}}};var Sn=Object.freeze({__proto__:null,lab:jn,hcl:bn});class Mn{constructor(e,s,c,d,m){this.type=e,this.operator=s,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[_,b]of m)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(e,s,c,d){let m=0;if("exponential"===e.name)m=Hr(s,e.base,c,d);else if("linear"===e.name)m=Hr(s,1,c,d);else if("cubic-bezier"===e.name){const _=e.controlPoints;m=new it(_[0],_[1],_[2],_[3]).solve(Hr(s,1,c,d))}return m}static parse(e,s){let[c,d,m,..._]=e;if(!Array.isArray(d)||0===d.length)return s.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const S=d[1];if("number"!=typeof S)return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:S}}else{if("cubic-bezier"!==d[0])return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const S=d.slice(1);if(4!==S.length||S.some(P=>"number"!=typeof P||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,ft),!m)return null;const b=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=on:s.expectedType&&"value"!==s.expectedType.kind&&(E=s.expectedType);for(let S=0;S<_.length;S+=2){const P=_[S],L=_[S+1],O=S+3,$=S+4;if("number"!=typeof P)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const K=s.parse(L,$,E);if(!K)return null;E=E||K.type,b.push([P,K])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Mn(E,c,d,m,b):s.error(`Type ${Vn(E)} is not interpolatable.`)}evaluate(e){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=s[0])return c[0].evaluate(e);const m=s.length;if(d>=s[m-1])return c[m-1].evaluate(e);const _=Hs(s,d),b=Mn.interpolationFactor(this.interpolation,d,s[_],s[_+1]),E=c[_].evaluate(e),S=c[_+1].evaluate(e);return"interpolate"===this.operator?jo[this.type.kind.toLowerCase()](E,S,b):"interpolate-hcl"===this.operator?bn.reverse(bn.interpolate(bn.forward(E),bn.forward(S),b)):jn.reverse(jn.interpolate(jn.forward(E),jn.forward(S),b))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Hr(o,e,s,c){const d=c-s,m=o-s;return 0===d?0:1===e?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class ro{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let c=null;const d=s.expectedType;d&&"value"!==d.kind&&(c=d);const m=[];for(const b of e.slice(1)){const E=s.parse(b,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,m.push(E)}const _=d&&m.some(b=>ki(d,b.type));return new ro(_?Wt:c,m)}evaluate(e){let s,c=null,d=0;for(const m of this.args)if(d++,c=m.evaluate(e),c&&c instanceof kn&&!c.available&&(s||(s=c.name),c=null,d===this.args.length&&(c=s)),null!==c)break;return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class mr{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=s.parse(e[m+1],m+1);if(!b)return null;c.push([_,b])}const d=s.parse(e[e.length-1],e.length-1,s.expectedType,c);return d?new mr(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,c]of this.bindings)e.push(s,c.serialize());return e.push(this.result.serialize()),e}}class bi{constructor(e,s,c){this.type=e,this.index=s,this.input=c}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,ft),d=s.parse(e[2],2,Sr(s.expectedType||Wt));return c&&d?new bi(d.type.itemType,c,d):null}evaluate(e){const s=this.index.evaluate(e),c=this.input.evaluate(e);if(s<0)throw new vr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new vr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new vr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class mo{constructor(e,s){this.type=gt,this.needle=e,this.haystack=s}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Wt),d=s.parse(e[2],2,Wt);return c&&d?Gr(c.type,[gt,nt,ft,Pi,Wt])?new mo(c,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(c.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!we(s,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(lr(s))} instead.`);if(!we(c,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Vn(lr(c))} instead.`);return c.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qr{constructor(e,s,c){this.type=ft,this.needle=e,this.haystack=s,this.fromIndex=c}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Wt),d=s.parse(e[2],2,Wt);if(!c||!d)return null;if(!Gr(c.type,[gt,nt,ft,Pi,Wt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(c.type)} instead`);if(4===e.length){const m=s.parse(e[3],3,ft);return m?new Qr(c,d,m):null}return new Qr(c,d)}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!we(s,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(lr(s))} instead.`);if(!we(c,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${Vn(lr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return c.indexOf(s,d)}return c.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class qr{constructor(e,s,c,d,m,_){this.inputType=e,this.type=s,this.input=c,this.cases=d,this.outputs=m,this.otherwise=_}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let c,d;s.expectedType&&"value"!==s.expectedType.kind&&(d=s.expectedType);const m={},_=[];for(let S=2;S<e.length-1;S+=2){let P=e[S];const L=e[S+1];Array.isArray(P)||(P=[P]);const O=s.concat(S);if(0===P.length)return O.error("Expected at least one branch label.");for(const K of P){if("number"!=typeof K&&"string"!=typeof K)return O.error("Branch labels must be numbers or strings.");if("number"==typeof K&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof K&&Math.floor(K)!==K)return O.error("Numeric branch labels must be integer values.");if(c){if(O.checkSubtype(c,lr(K)))return null}else c=lr(K);if(void 0!==m[String(K)])return O.error("Branch labels must be unique.");m[String(K)]=_.length}const $=s.parse(L,S,d);if(!$)return null;d=d||$.type,_.push($)}const b=s.parse(e[1],1,Wt);if(!b)return null;const E=s.parse(e[e.length-1],e.length-1,d);return E?"value"!==b.type.kind&&s.concat(1).checkSubtype(c,b.type)?null:new qr(c,d,b,m,_,E):null}evaluate(e){const s=this.input.evaluate(e);return(lr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],d={};for(const _ of s){const b=d[this.cases[_]];void 0===b?(d[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[b][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,b]of c)e.push(1===b.length?m(b[0]):b.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Ps{constructor(e,s,c){this.type=e,this.branches=s,this.otherwise=c}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const b=s.parse(e[_],_,gt);if(!b)return null;const E=s.parse(e[_+1],_+1,c);if(!E)return null;d.push([b,E]),c=c||E.type}const m=s.parse(e[e.length-1],e.length-1,c);return m?new Ps(c,d,m):null}evaluate(e){for(const[s,c]of this.branches)if(s.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,c]of this.branches)e(s),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class qs{constructor(e,s,c,d){this.type=e,this.input=s,this.beginIndex=c,this.endIndex=d}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Wt),d=s.parse(e[2],2,ft);if(!c||!d)return null;if(!Gr(c.type,[Sr(Wt),nt,Wt]))return s.error(`Expected first argument to be of type array or string, but found ${Vn(c.type)} instead`);if(4===e.length){const m=s.parse(e[3],3,ft);return m?new qs(c.type,c,d,m):null}return new qs(c.type,c,d)}evaluate(e){const s=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!we(s,["string","array"]))throw new vr(`Expected first argument to be of type array or string, but found ${Vn(lr(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return s.slice(c,d)}return s.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zc(o,e){return"=="===o||"!="===o?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Hi(o,e,s,c){return 0===c.compare(e,s)}function Mo(o,e,s){const c="=="!==o&&"!="!==o;return class Rb{constructor(m,_,b){this.type=gt,this.lhs=m,this.rhs=_,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const b=m[0];let E=_.parse(m[1],1,Wt);if(!E)return null;if(!zc(b,E.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Vn(E.type)}'.`);let S=_.parse(m[2],2,Wt);if(!S)return null;if(!zc(b,S.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Vn(S.type)}'.`);if(E.type.kind!==S.type.kind&&"value"!==E.type.kind&&"value"!==S.type.kind)return _.error(`Cannot compare types '${Vn(E.type)}' and '${Vn(S.type)}'.`);c&&("value"===E.type.kind&&"value"!==S.type.kind?E=new xi(S.type,[E]):"value"!==E.type.kind&&"value"===S.type.kind&&(S=new xi(E.type,[S])));let P=null;if(4===m.length){if("string"!==E.type.kind&&"string"!==S.type.kind&&"value"!==E.type.kind&&"value"!==S.type.kind)return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(m[3],3,hr),!P)return null}return new Rb(E,S,P)}evaluate(m){const _=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const E=lr(_),S=lr(b);if(E.kind!==S.kind||"string"!==E.kind&&"number"!==E.kind)throw new vr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=lr(_),S=lr(b);if("string"!==E.kind||"string"!==S.kind)return e(m,_,b)}return this.collator?s(m,_,b,this.collator.evaluate(m)):e(m,_,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const Cl=Mo("==",function(o,e,s){return e===s},Hi),sn=Mo("!=",function(o,e,s){return e!==s},function(o,e,s,c){return!Hi(0,e,s,c)}),au=Mo("<",function(o,e,s){return e<s},function(o,e,s,c){return c.compare(e,s)<0}),lu=Mo(">",function(o,e,s){return e>s},function(o,e,s,c){return c.compare(e,s)>0}),uc=Mo("<=",function(o,e,s){return e<=s},function(o,e,s,c){return c.compare(e,s)<=0}),go=Mo(">=",function(o,e,s){return e>=s},function(o,e,s,c){return c.compare(e,s)>=0});class Qa{constructor(e,s,c,d,m){this.type=nt,this.number=e,this.locale=s,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,s){if(3!==e.length)return s.error("Expected two arguments.");const c=s.parse(e[1],1,ft);if(!c)return null;const d=e[2];if("object"!=typeof d||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=s.parse(d.locale,1,nt),!m))return null;let _=null;if(d.currency&&(_=s.parse(d.currency,1,nt),!_))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parse(d["min-fraction-digits"],1,ft),!b))return null;let E=null;return d["max-fraction-digits"]&&(E=s.parse(d["max-fraction-digits"],1,ft),!E)?null:new Qa(c,m,_,b,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Zs{constructor(e){this.type=ft,this.input=e}static parse(e,s){if(2!==e.length)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=s.parse(e[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${Vn(c.type)} instead.`):new Zs(c):null}evaluate(e){const s=this.input.evaluate(e);if("string"==typeof s||Array.isArray(s))return s.length;throw new vr(`Expected value to be of type string or array, but found ${Vn(lr(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const $o={"==":Cl,"!=":sn,">":lu,"<":au,">=":go,"<=":uc,array:xi,at:bi,boolean:xi,case:Ps,coalesce:ro,collator:Is,format:ci,image:ui,in:mo,"index-of":Qr,interpolate:Mn,"interpolate-hcl":Mn,"interpolate-lab":Mn,length:Zs,let:mr,literal:li,match:qr,number:xi,"number-format":Qa,object:xi,slice:qs,step:As,string:xi,"to-boolean":no,"to-color":no,"to-number":no,"to-string":no,var:An,within:di};function ct(o,[e,s,c,d]){e=e.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const m=d?d.evaluate(o):1,_=yi(e,s,c,m);if(_)throw new vr(_);return new De(e/255*m,s/255*m,c/255*m,m)}function zn(o,e){return o in e}function Dl(o,e){const s=e[o];return void 0===s?null:s}function gr(o){return{type:o}}function Tl(o){return{result:"success",value:o}}function qi(o){return{result:"error",value:o}}function fi(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function Ws(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function cs(o){return!!o.expression&&o.expression.interpolated}function $n(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Ys(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Ja(o){return o}function el(o,e){const s="color"===e.type,c=o.stops&&"object"==typeof o.stops[0][0],d=c||!(c||void 0!==o.property),m=o.type||(cs(e)?"exponential":"interval");if(s&&((o=rn({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],De.parse(S[1])])),o.default=De.parse(o.default?o.default:e.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!Sn[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,b,E;if("exponential"===m)_=Go;else if("interval"===m)_=hc;else if("categorical"===m){_=Po,b=Object.create(null);for(const S of o.stops)b[S[0]]=S[1];E=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=Ro}if(c){const S={},P=[];for(let $=0;$<o.stops.length;$++){const K=o.stops[$],te=K[0].zoom;void 0===S[te]&&(S[te]={zoom:te,type:o.type,property:o.property,default:o.default,stops:[]},P.push(te)),S[te].stops.push([K[0].value,K[1]])}const L=[];for(const $ of P)L.push([S[$].zoom,el(S[$],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Mn.interpolationFactor.bind(void 0,O),zoomStops:L.map($=>$[0]),evaluate:({zoom:$},K)=>Go({stops:L,base:o.base},e,$).evaluate($,K)}}if(d){const S="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Mn.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(o,e,P,b,E)}}return{kind:"source",evaluate(S,P){const L=P&&P.properties?P.properties[o.property]:void 0;return void 0===L?Zr(o.default,e.default):_(o,e,L,b,E)}}}function Zr(o,e,s){return void 0!==o?o:void 0!==e?e:void 0!==s?s:void 0}function Po(o,e,s,c,d){return Zr(typeof s===d?c[s]:void 0,o.default,e.default)}function hc(o,e,s){if("number"!==$n(s))return Zr(o.default,e.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const d=Hs(o.stops.map(m=>m[0]),s);return o.stops[d][1]}function Go(o,e,s){const c=void 0!==o.base?o.base:1;if("number"!==$n(s))return Zr(o.default,e.default);const d=o.stops.length;if(1===d||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[d-1][0])return o.stops[d-1][1];const m=Hs(o.stops.map(P=>P[0]),s),_=function(P,L,O,$){const K=$-O,te=P-O;return 0===K?0:1===L?te/K:(Math.pow(L,te)-1)/(Math.pow(L,K)-1)}(s,c,o.stops[m][0],o.stops[m+1][0]),b=o.stops[m][1],E=o.stops[m+1][1];let S=jo[e.type]||Ja;if(o.colorSpace&&"rgb"!==o.colorSpace){const P=Sn[o.colorSpace];S=(L,O)=>P.reverse(P.interpolate(P.forward(L),P.forward(O),_))}return"function"==typeof b.evaluate?{evaluate(...P){const L=b.evaluate.apply(void 0,P),O=E.evaluate.apply(void 0,P);if(void 0!==L&&void 0!==O)return S(L,O,_)}}:S(b,E,_)}function Ro(o,e,s){return"color"===e.type?s=De.parse(s):"formatted"===e.type?s=Et.fromString(s.toString()):"resolvedImage"===e.type?s=kn.fromString(s.toString()):$n(s)===e.type||"enum"===e.type&&e.values[s]||(s=void 0),Zr(s,o.default,e.default)}Fi.register($o,{error:[{kind:"error"},[nt],(o,[e])=>{throw new vr(e.evaluate(o))}],typeof:[nt,[Wt],(o,[e])=>Vn(lr(e.evaluate(o)))],"to-rgba":[Sr(ft,4),[on],(o,[e])=>e.evaluate(o).toArray()],rgb:[on,[ft,ft,ft],ct],rgba:[on,[ft,ft,ft,ft],ct],has:{type:gt,overloads:[[[nt],(o,[e])=>zn(e.evaluate(o),o.properties())],[[nt,xn],(o,[e,s])=>zn(e.evaluate(o),s.evaluate(o))]]},get:{type:Wt,overloads:[[[nt],(o,[e])=>Dl(e.evaluate(o),o.properties())],[[nt,xn],(o,[e,s])=>Dl(e.evaluate(o),s.evaluate(o))]]},"feature-state":[Wt,[nt],(o,[e])=>Dl(e.evaluate(o),o.featureState||{})],properties:[xn,[],o=>o.properties()],"geometry-type":[nt,[],o=>o.geometryType()],id:[Wt,[],o=>o.id()],zoom:[ft,[],o=>o.globals.zoom],"heatmap-density":[ft,[],o=>o.globals.heatmapDensity||0],"line-progress":[ft,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[ft,[],o=>o.globals.skyRadialProgress||0],accumulated:[Wt,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[ft,gr(ft),(o,e)=>{let s=0;for(const c of e)s+=c.evaluate(o);return s}],"*":[ft,gr(ft),(o,e)=>{let s=1;for(const c of e)s*=c.evaluate(o);return s}],"-":{type:ft,overloads:[[[ft,ft],(o,[e,s])=>e.evaluate(o)-s.evaluate(o)],[[ft],(o,[e])=>-e.evaluate(o)]]},"/":[ft,[ft,ft],(o,[e,s])=>e.evaluate(o)/s.evaluate(o)],"%":[ft,[ft,ft],(o,[e,s])=>e.evaluate(o)%s.evaluate(o)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(o,[e,s])=>Math.pow(e.evaluate(o),s.evaluate(o))],sqrt:[ft,[ft],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[ft,[ft],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[ft,[ft],(o,[e])=>Math.log(e.evaluate(o))],log2:[ft,[ft],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[ft,[ft],(o,[e])=>Math.sin(e.evaluate(o))],cos:[ft,[ft],(o,[e])=>Math.cos(e.evaluate(o))],tan:[ft,[ft],(o,[e])=>Math.tan(e.evaluate(o))],asin:[ft,[ft],(o,[e])=>Math.asin(e.evaluate(o))],acos:[ft,[ft],(o,[e])=>Math.acos(e.evaluate(o))],atan:[ft,[ft],(o,[e])=>Math.atan(e.evaluate(o))],min:[ft,gr(ft),(o,e)=>Math.min(...e.map(s=>s.evaluate(o)))],max:[ft,gr(ft),(o,e)=>Math.max(...e.map(s=>s.evaluate(o)))],abs:[ft,[ft],(o,[e])=>Math.abs(e.evaluate(o))],round:[ft,[ft],(o,[e])=>{const s=e.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[ft,[ft],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[ft,[ft],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[gt,[nt,Wt],(o,[e,s])=>o.properties()[e.value]===s.value],"filter-id-==":[gt,[Wt],(o,[e])=>o.id()===e.value],"filter-type-==":[gt,[nt],(o,[e])=>o.geometryType()===e.value],"filter-<":[gt,[nt,Wt],(o,[e,s])=>{const c=o.properties()[e.value],d=s.value;return typeof c==typeof d&&c<d}],"filter-id-<":[gt,[Wt],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s<c}],"filter->":[gt,[nt,Wt],(o,[e,s])=>{const c=o.properties()[e.value],d=s.value;return typeof c==typeof d&&c>d}],"filter-id->":[gt,[Wt],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s>c}],"filter-<=":[gt,[nt,Wt],(o,[e,s])=>{const c=o.properties()[e.value],d=s.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[gt,[Wt],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s<=c}],"filter->=":[gt,[nt,Wt],(o,[e,s])=>{const c=o.properties()[e.value],d=s.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[gt,[Wt],(o,[e])=>{const s=o.id(),c=e.value;return typeof s==typeof c&&s>=c}],"filter-has":[gt,[Wt],(o,[e])=>e.value in o.properties()],"filter-has-id":[gt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[gt,[Sr(nt)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[gt,[Sr(Wt)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[gt,[nt,Sr(Wt)],(o,[e,s])=>s.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[gt,[nt,Sr(Wt)],(o,[e,s])=>function(c,d,m,_){for(;m<=_;){const b=m+_>>1;if(d[b]===c)return!0;d[b]>c?_=b-1:m=b+1}return!1}(o.properties()[e.value],s.value,0,s.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(o,[e,s])=>e.evaluate(o)&&s.evaluate(o)],[gr(gt),(o,e)=>{for(const s of e)if(!s.evaluate(o))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(o,[e,s])=>e.evaluate(o)||s.evaluate(o)],[gr(gt),(o,e)=>{for(const s of e)if(s.evaluate(o))return!0;return!1}]]},"!":[gt,[gt],(o,[e])=>!e.evaluate(o)],"is-supported-script":[gt,[nt],(o,[e])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(e.evaluate(o))}],upcase:[nt,[nt],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[nt,[nt],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[nt,gr(Wt),(o,e)=>e.map(s=>$i(s.evaluate(o))).join("")],"resolved-locale":[nt,[hr],(o,[e])=>e.evaluate(o).resolvedLocale()]});class dc{constructor(e,s){var c;this.expression=e,this._warningHistory={},this._evaluator=new hi,this._defaultValue=s?"color"===(c=s).type&&Ys(c.default)?new De(0,0,0,0):"color"===c.type?De.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(e,s,c,d,m,_){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,s,c,d,m,_){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null;try{const b=this.expression.evaluate(this._evaluator);if(null==b||"number"==typeof b&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new vr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,"undefined"!=typeof console&&console.warn(b.message)),this._defaultValue}}}function ga(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in $o}function Zi(o,e){const s=new Gi($o,[],e?function(d){const m={color:on,string:nt,number:ft,enum:nt,boolean:gt,formatted:Ri,resolvedImage:Zn};return"array"===d.type?Sr(m[d.value]||Wt,d.length):m[d.type]}(e):void 0),c=s.parse(o,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return c?Tl(new dc(c,e)):qi(s.errors)}class Sl{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent="constant"!==e&&!as(s.expression)}evaluateWithoutErrorHandling(e,s,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,d,m,_)}evaluate(e,s,c,d,m,_){return this._styleExpression.evaluate(e,s,c,d,m,_)}}class Ho{constructor(e,s,c,d){this.kind=e,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==e&&!as(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,s,c,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,d,m,_)}evaluate(e,s,c,d,m,_){return this._styleExpression.evaluate(e,s,c,d,m,_)}interpolationFactor(e,s,c){return this.interpolationType?Mn.interpolationFactor(this.interpolationType,e,s,c):0}}function Rs(o,e){if("error"===(o=Zi(o,e)).result)return o;const s=o.value.expression,c=Uo(s);if(!c&&!fi(e))return qi([new Ht("","data expressions not supported")]);const d=Gs(s,["zoom"]);if(!d&&!Ws(e))return qi([new Ht("","zoom expressions not supported")]);const m=_o(s);return m||d?m instanceof Ht?qi([m]):m instanceof Mn&&!cs(e)?qi([new Ht("",'"interpolate" expressions cannot be used with this property')]):Tl(m?new Ho(c?"camera":"composite",o.value,m.labels,m instanceof Mn?m.interpolation:void 0):new Sl(c?"constant":"source",o.value)):qi([new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tl{constructor(e,s){this._parameters=e,this._specification=s,rn(this,el(this._parameters,this._specification))}static deserialize(e){return new tl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function _o(o){let e=null;if(o instanceof mr)e=_o(o.result);else if(o instanceof ro){for(const s of o.args)if(e=_o(s),e)break}else(o instanceof As||o instanceof Mn)&&o.input instanceof Fi&&"zoom"===o.input.name&&(e=o);return e instanceof Ht||o.eachChild(s=>{const c=_o(s);c instanceof Ht?e=c:!e&&c?e=new Ht("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new Ht("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Oi(o){const e=o.key,s=o.value,c=o.valueSpec||{},d=o.objectElementValidators||{},m=o.style,_=o.styleSpec;let b=[];const E=$n(s);if("object"!==E)return[new Ge(e,s,`object expected, ${E} found`)];for(const S in s){const P=S.split(".")[0],L=c[P]||c["*"];let O;if(d[P])O=d[P];else if(c[P])O=Pr;else if(d["*"])O=d["*"];else{if(!c["*"]){b.push(new Ge(e,s[S],`unknown property "${S}"`));continue}O=Pr}b=b.concat(O({key:(e&&`${e}.`)+S,value:s[S],valueSpec:L,style:m,styleSpec:_,object:s,objectKey:S},s))}for(const S in c)d[S]||c[S].required&&void 0===c[S].default&&void 0===s[S]&&b.push(new Ge(e,s,`missing required property "${S}"`));return b}function Il(o){const e=o.value,s=o.valueSpec,c=o.style,d=o.styleSpec,m=o.key,_=o.arrayElementValidator||Pr;if("array"!==$n(e))return[new Ge(m,e,`array expected, ${$n(e)} found`)];if(s.length&&e.length!==s.length)return[new Ge(m,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Ge(m,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};d.$version<7&&(b.function=s.function),"object"===$n(s.value)&&(b=s.value);let E=[];for(let S=0;S<e.length;S++)E=E.concat(_({array:e,arrayIndex:S,value:e[S],valueSpec:b,style:c,styleSpec:d,key:`${m}[${S}]`}));return E}function ko(o){const e=o.key,s=o.value,c=o.valueSpec;let d=$n(s);if("number"===d&&s!=s&&(d="NaN"),"number"!==d)return[new Ge(e,s,`number expected, ${d} found`)];if("minimum"in c){let m=c.minimum;if("array"===$n(c.minimum)&&(m=c.minimum[o.arrayIndex]),s<m)return[new Ge(e,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if("array"===$n(c.maximum)&&(m=c.maximum[o.arrayIndex]),s>m)return[new Ge(e,s,`${s} is greater than the maximum value ${m}`)]}return[]}function Al(o){const e=o.valueSpec,s=Lt(o.value.type);let c,d,m,_={};const b="categorical"!==s&&void 0===o.value.property,E=!b,S="array"===$n(o.value.stops)&&"array"===$n(o.value.stops[0])&&"object"===$n(o.value.stops[0][0]),P=Oi({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function($){if("identity"===s)return[new Ge($.key,$.value,'identity function may not have a "stops" property')];let K=[];const te=$.value;return K=K.concat(Il({key:$.key,value:te,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:L})),"array"===$n(te)&&0===te.length&&K.push(new Ge($.key,te,"array must have at least one stop")),K},default:function($){return Pr({key:$.key,value:$.value,valueSpec:e,style:$.style,styleSpec:$.styleSpec})}}});return"identity"===s&&b&&P.push(new Ge(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||P.push(new Ge(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!cs(o.valueSpec)&&P.push(new Ge(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!fi(o.valueSpec)?P.push(new Ge(o.key,o.value,"property functions not supported")):b&&!Ws(o.valueSpec)&&P.push(new Ge(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!S||void 0!==o.value.property||P.push(new Ge(o.key,o.value,'"property" property is required')),P;function L($){let K=[];const te=$.value,de=$.key;if("array"!==$n(te))return[new Ge(de,te,`array expected, ${$n(te)} found`)];if(2!==te.length)return[new Ge(de,te,`array length 2 expected, length ${te.length} found`)];if(S){if("object"!==$n(te[0]))return[new Ge(de,te,`object expected, ${$n(te[0])} found`)];if(void 0===te[0].zoom)return[new Ge(de,te,"object stop key must have zoom")];if(void 0===te[0].value)return[new Ge(de,te,"object stop key must have value")];if(m&&m>Lt(te[0].zoom))return[new Ge(de,te[0].zoom,"stop zoom values must appear in ascending order")];Lt(te[0].zoom)!==m&&(m=Lt(te[0].zoom),d=void 0,_={}),K=K.concat(Oi({key:`${de}[0]`,value:te[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:ko,value:O}}))}else K=K.concat(O({key:`${de}[0]`,value:te[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},te));return ga(un(te[1]))?K.concat([new Ge(`${de}[1]`,te[1],"expressions are not allowed in function stops.")]):K.concat(Pr({key:`${de}[1]`,value:te[1],valueSpec:e,style:$.style,styleSpec:$.styleSpec}))}function O($,K){const te=$n($.value),de=Lt($.value),be=null!==$.value?$.value:K;if(c){if(te!==c)return[new Ge($.key,be,`${te} stop domain type must match previous stop domain type ${c}`)]}else c=te;if("number"!==te&&"string"!==te&&"boolean"!==te)return[new Ge($.key,be,"stop domain value must be a number, string, or boolean")];if("number"!==te&&"categorical"!==s){let Ae=`number expected, ${te} found`;return fi(e)&&void 0===s&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge($.key,be,Ae)]}return"categorical"!==s||"number"!==te||isFinite(de)&&Math.floor(de)===de?"categorical"!==s&&"number"===te&&void 0!==d&&de<d?[new Ge($.key,be,"stop domain values must appear in ascending order")]:(d=de,"categorical"===s&&de in _?[new Ge($.key,be,"stop domain values must be unique")]:(_[de]=!0,[])):[new Ge($.key,be,`integer expected, found ${de}`)]}}function us(o){const e=("property"===o.expressionContext?Rs:Zi)(un(o.value),o.valueSpec);if("error"===e.result)return e.value.map(c=>new Ge(`${o.key}${c.key}`,o.value,c.message));const s=e.value.expression||e.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new Ge(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!as(s))return[new Ge(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext&&!as(s))return[new Ge(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Gs(s,["zoom","feature-state"]))return[new Ge(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!Uo(s))return[new Ge(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xs(o){const e=o.key,s=o.value,c=o.valueSpec,d=[];return Array.isArray(c.values)?-1===c.values.indexOf(Lt(s))&&d.push(new Ge(e,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Lt(s))&&d.push(new Ge(e,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function nl(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!nl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const _a={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ya(o){if(null==o)return{filter:()=>!0,needGeometry:!1};nl(o)||(o=Wi(o));const e=Zi(o,_a);if("error"===e.result)throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,d)=>e.value.evaluate(s,c,{},d),needGeometry:wi(o)}}function Bc(o,e){return o<e?-1:o>e?1:0}function wi(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let e=1;e<o.length;e++)if(wi(o[e]))return!0;return!1}function Wi(o){if(!o)return!0;const e=o[0];return o.length<=1?"any"!==e:"=="===e?_r(o[1],o[2],"=="):"!="===e?Ml(_r(o[1],o[2],"==")):"<"===e||">"===e||"<="===e||">="===e?_r(o[1],o[2],e):"any"===e?(s=o.slice(1),["any"].concat(s.map(Wi))):"all"===e?["all"].concat(o.slice(1).map(Wi)):"none"===e?["all"].concat(o.slice(1).map(Wi).map(Ml)):"in"===e?Vc(o[1],o.slice(2)):"!in"===e?Ml(Vc(o[1],o.slice(2))):"has"===e?Uc(o[1]):"!has"===e?Ml(Uc(o[1])):"within"!==e||o;var s}function _r(o,e,s){switch(o){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,o,e]}}function Vc(o,e){if(0===e.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",o,["literal",e.sort(Bc)]]:["filter-in-small",o,["literal",e]]}}function Uc(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ml(o){return["!",o]}function fc(o){return nl(un(o.value))?us(rn({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rl(o)}function rl(o){const e=o.value,s=o.key;if("array"!==$n(e))return[new Ge(s,e,`array expected, ${$n(e)} found`)];const c=o.styleSpec;let d,m=[];if(e.length<1)return[new Ge(s,e,"filter array must have at least 1 element")];switch(m=m.concat(Xs({key:`${s}[0]`,value:e[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Lt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Lt(e[1])&&m.push(new Ge(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&m.push(new Ge(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=$n(e[1]),"string"!==d&&m.push(new Ge(`${s}[1]`,e[1],`string expected, ${d} found`)));for(let _=2;_<e.length;_++)d=$n(e[_]),"$type"===Lt(e[1])?m=m.concat(Xs({key:`${s}[${_}]`,value:e[_],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&m.push(new Ge(`${s}[${_}]`,e[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)m=m.concat(rl({key:`${s}[${_}]`,value:e[_],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=$n(e[1]),2!==e.length?m.push(new Ge(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==d&&m.push(new Ge(`${s}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=$n(e[1]),2!==e.length?m.push(new Ge(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==d&&m.push(new Ge(`${s}[1]`,e[1],`object expected, ${d} found`))}return m}function va(o,e){const s=o.key,c=o.style,d=o.styleSpec,m=o.value,_=o.objectKey,b=d[`${e}_${o.layerType}`];if(!b)return[];const E=_.match(/^(.*)-transition$/);if("paint"===e&&E&&b[E[1]]&&b[E[1]].transition)return Pr({key:s,value:m,valueSpec:d.transition,style:c,styleSpec:d});const S=o.valueSpec||b[_];if(!S)return[new Ge(s,m,`unknown property "${_}"`)];let P;if("string"===$n(m)&&fi(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(m)))return[new Ge(s,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const L=[];return"symbol"===o.layerType&&("text-field"===_&&c&&!c.glyphs&&L.push(new Ge(s,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ys(un(m))&&"identity"===Lt(m.type)&&L.push(new Ge(s,m,'"text-font" does not support identity functions'))),L.concat(Pr({key:o.key,value:m,valueSpec:S,style:c,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:_}))}function Ei(o){return va(o,"paint")}function hs(o){return va(o,"layout")}function xa(o){let e=[];const s=o.value,c=o.key,d=o.style,m=o.styleSpec;s.type||s.ref||e.push(new Ge(c,s,'either "type" or "ref" is required'));let _=Lt(s.type);const b=Lt(s.ref);if(s.id){const E=Lt(s.id);for(let S=0;S<o.arrayIndex;S++){const P=d.layers[S];Lt(P.id)===E&&e.push(new Ge(c,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&e.push(new Ge(c,s[S],`"${S}" is prohibited for ref layers`))}),d.layers.forEach(S=>{Lt(S.id)===b&&(E=S)}),E?E.ref?e.push(new Ge(c,s.ref,"ref cannot reference another ref layer")):_=Lt(E.type):e.push(new Ge(c,s.ref,`ref layer "${b}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const E=d.sources&&d.sources[s.source],S=E&&Lt(E.type);E?"vector"===S&&"raster"===_?e.push(new Ge(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===S&&"raster"!==_?e.push(new Ge(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==S||s["source-layer"]?"raster-dem"===S&&"hillshade"!==_?e.push(new Ge(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===S&&E.lineMetrics||e.push(new Ge(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ge(c,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Ge(c,s.source,`source "${s.source}" not found`))}else e.push(new Ge(c,s,'missing required property "source"'));return e=e.concat(Oi({key:c,value:s,valueSpec:m.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pr({key:`${c}.type`,value:s.type,valueSpec:m.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:fc,layout:E=>Oi({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>hs(rn({layerType:_},S))}}),paint:E=>Oi({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>Ei(rn({layerType:_},S))}})}})),e}function ds(o){const e=o.value,s=o.key,c=$n(e);return"string"!==c?[new Ge(s,e,`string expected, ${c} found`)]:[]}const Pl={promoteId:function({key:o,value:e}){if("string"===$n(e))return ds({key:o,value:e});{const s=[];for(const c in e)s.push(...ds({key:`${o}.${c}`,value:e[c]}));return s}}};function jc(o){const e=o.value,s=o.key,c=o.styleSpec,d=o.style;if(!e.type)return[new Ge(s,e,'"type" is required')];const m=Lt(e.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Oi({key:s,value:e,valueSpec:c[`source_${m.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:Pl}),_;case"geojson":if(_=Oi({key:s,value:e,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:Pl}),e.cluster)for(const b in e.clusterProperties){const[E,S]=e.clusterProperties[b],P="string"==typeof E?[E,["accumulated"],["get",b]]:E;_.push(...us({key:`${s}.${b}.map`,value:S,expressionContext:"cluster-map"})),_.push(...us({key:`${s}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return Oi({key:s,value:e,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return Oi({key:s,value:e,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new Ge(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xs({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:c})}}function Fo(o){const e=o.value,s=o.styleSpec,c=s.light,d=o.style;let m=[];const _=$n(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ge("light",e,`object expected, ${_} found`)]),m;for(const b in e){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&c[E[1]]&&c[E[1]].transition?Pr({key:b,value:e[b],valueSpec:s.transition,style:d,styleSpec:s}):c[b]?Pr({key:b,value:e[b],valueSpec:c[b],style:d,styleSpec:s}):[new Ge(b,e[b],`unknown property "${b}"`)])}return m}function ba(o){const e=o.value,s=o.key,c=o.style,d=o.styleSpec,m=d.terrain;let _=[];const b=$n(e);if(void 0===e)return _;if("object"!==b)return _=_.concat([new Ge("terrain",e,`object expected, ${b} found`)]),_;for(const E in e){const S=E.match(/^(.*)-transition$/);_=_.concat(S&&m[S[1]]&&m[S[1]].transition?Pr({key:E,value:e[E],valueSpec:d.transition,style:c,styleSpec:d}):m[E]?Pr({key:E,value:e[E],valueSpec:m[E],style:c,styleSpec:d}):[new Ge(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=c.sources&&c.sources[e.source],S=E&&Lt(E.type);E?"raster-dem"!==S&&_.push(new Ge(s,e.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):_.push(new Ge(s,e.source,`source "${e.source}" not found`))}else _.push(new Ge(s,e,'terrain is missing required property "source"'));return _}function Rl(o){const e=o.value,s=o.style,c=o.styleSpec,d=c.fog;let m=[];const _=$n(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ge("fog",e,`object expected, ${_} found`)]),m;for(const b in e){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&d[E[1]]&&d[E[1]].transition?Pr({key:b,value:e[b],valueSpec:c.transition,style:s,styleSpec:c}):d[b]?Pr({key:b,value:e[b],valueSpec:d[b],style:s,styleSpec:c}):[new Ge(b,e[b],`unknown property "${b}"`)])}return m}const $c={"*":()=>[],array:Il,boolean:function(o){const e=o.value,s=o.key,c=$n(e);return"boolean"!==c?[new Ge(s,e,`boolean expected, ${c} found`)]:[]},number:ko,color:function(o){const e=o.key,s=o.value,c=$n(s);return"string"!==c?[new Ge(e,s,`color expected, ${c} found`)]:null===ae.parseCSSColor(s)?[new Ge(e,s,`color expected, "${s}" found`)]:[]},constants:Ut,enum:Xs,filter:fc,function:Al,layer:xa,object:Oi,source:jc,light:Fo,terrain:ba,fog:Rl,string:ds,formatted:function(o){return 0===ds(o).length?[]:us(o)},resolvedImage:function(o){return 0===ds(o).length?[]:us(o)}};function Pr(o){const e=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Ys(Lt(e))?Al(o):s.expression&&ga(un(e))?us(o):s.type&&$c[s.type]?$c[s.type](o):Oi(rn({},o,{valueSpec:s.type?c[s.type]:s}))}function il(o){const e=o.value,s=o.key,c=ds(o);return c.length||(-1===e.indexOf("{fontstack}")&&c.push(new Ge(s,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&c.push(new Ge(s,e,'"glyphs" url must include a "{range}" token'))),c}function fs(o,e=ve){let s=[];return s=s.concat(Pr({key:"",value:o,valueSpec:e.$root,styleSpec:e,style:o,objectElementValidators:{glyphs:il,"*":()=>[]}})),o.constants&&(s=s.concat(Ut({key:"constants",value:o.constants,style:o,styleSpec:e}))),pc(s)}function pc(o){return[].concat(o).sort((e,s)=>e.line-s.line)}function qo(o){return function(...e){return pc(o.apply(this,e))}}fs.source=qo(jc),fs.light=qo(Fo),fs.terrain=qo(ba),fs.fog=qo(Rl),fs.layer=qo(xa),fs.filter=qo(fc),fs.paintProperty=qo(Ei),fs.layoutProperty=qo(hs);const wa=fs,Ea=wa.light,Zo=wa.fog,kl=wa.paintProperty,Fl=wa.layoutProperty;function Ll(o,e){let s=!1;if(e&&e.length)for(const c of e)o.fire(new Ue(new Error(c.message))),s=!0;return s}var Ca=Jr;function Jr(o,e,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(e=d[1])+2*(s=d[2]);for(var m=0;m<this.d*this.d;m++){var _=d[3+m],b=d[3+m+1];c.push(_===b?null:d.subarray(_,b))}var E=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],E),this.bboxes=d.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=o,this.padding=s,this.scale=e/o,this.uid=0;var P=s/e*o;this.min=-P,this.max=o+P}Jr.prototype.insert=function(o,e,s,c,d){this._forEachCell(e,s,c,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)},Jr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Jr.prototype._insertCell=function(o,e,s,c,d,m){this.cells[d].push(m)},Jr.prototype.query=function(o,e,s,c,d){var m=this.min,_=this.max;if(o<=m&&e<=m&&_<=s&&_<=c&&!d)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(o,e,s,c,this._queryCell,b,{},d),b},Jr.prototype._queryCell=function(o,e,s,c,d,m,_,b){var E=this.cells[d];if(null!==E)for(var S=this.keys,P=this.bboxes,L=0;L<E.length;L++){var O=E[L];if(void 0===_[O]){var $=4*O;(b?b(P[$+0],P[$+1],P[$+2],P[$+3]):o<=P[$+2]&&e<=P[$+3]&&s>=P[$+0]&&c>=P[$+1])?(_[O]=!0,m.push(S[O])):_[O]=!1}}},Jr.prototype._forEachCell=function(o,e,s,c,d,m,_,b){for(var E=this._convertToCellCoord(o),S=this._convertToCellCoord(e),P=this._convertToCellCoord(s),L=this._convertToCellCoord(c),O=E;O<=P;O++)for(var $=S;$<=L;$++){var K=this.d*$+O;if((!b||b(this._convertFromCellCoord(O),this._convertFromCellCoord($),this._convertFromCellCoord(O+1),this._convertFromCellCoord($+1)))&&d.call(this,o,e,s,c,K,m,_,b))return}},Jr.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Jr.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Jr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,e=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var d=new Int32Array(e+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=e,_=0;_<o.length;_++){var b=o[_];d[3+_]=m,d.set(b,m),m+=b.length}return d[3+o.length]=m,d.set(this.keys,m),d[3+o.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};const{ImageData:Gc,ImageBitmap:Ks}=Te,Nr={};function St(o,e,s={}){Object.defineProperty(e,"_classRegistryKey",{value:o,writeable:!1}),Nr[o]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}St("Object",Object),Ca.serialize=function(o,e){const s=o.toArrayBuffer();return e&&e.push(s),{buffer:s}},Ca.deserialize=function(o){return new Ca(o.buffer)},St("Grid",Ca),St("Color",De),St("Error",Error),St("ResolvedImage",kn),St("StylePropertyFunction",tl),St("StyleExpression",dc,{omit:["_evaluator"]}),St("ZoomDependentExpression",Ho),St("ZoomConstantExpression",Sl),St("CompoundExpression",Fi,{omit:["_evaluate"]});for(const o in $o)$o[o]._classRegistryKey||St(`Expression_${o}`,$o[o]);function ol(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Da(o){return Ks&&o instanceof Ks}function ks(o,e){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(ol(o)||Da(o))return e&&e.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return e&&e.push(s.buffer),s}if(o instanceof Gc)return e&&e.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(ks(c,e));return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");const d=s.serialize?s.serialize(o,e):{};if(!s.serialize){for(const m in o){if(!o.hasOwnProperty(m)||Nr[c].omit.indexOf(m)>=0)continue;const _=o[m];d[m]=Nr[c].shallow.indexOf(m)>=0?_:ks(_,e)}o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof o)}function Wo(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||ol(o)||Da(o)||ArrayBuffer.isView(o)||o instanceof Gc)return o;if(Array.isArray(o))return o.map(Wo);if("object"==typeof o){const e=o.$name||"Object",{klass:s}=Nr[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const d of Object.keys(o)){if("$name"===d)continue;const m=o[d];c[d]=Nr[e].shallow.indexOf(d)>=0?m:Wo(m)}return c}throw new Error("can't deserialize object of type "+typeof o)}class mc{constructor(){this.first=!0}update(e,s){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}const Ta=o=>o>=1536&&o<=1791,Sa=o=>o>=1872&&o<=1919,Ol=o=>o>=2208&&o<=2303,ps=o=>o>=11904&&o<=12031,sl=o=>o>=12032&&o<=12255,gc=o=>o>=12272&&o<=12287,ms=o=>o>=12288&&o<=12351,Ia=o=>o>=12352&&o<=12447,Nl=o=>o>=12448&&o<=12543,Yo=o=>o>=12544&&o<=12591,zl=o=>o>=12704&&o<=12735,_c=o=>o>=12736&&o<=12783,Aa=o=>o>=12784&&o<=12799,Fs=o=>o>=12800&&o<=13055,Bl=o=>o>=13056&&o<=13311,yc=o=>o>=13312&&o<=19903,Vl=o=>o>=19968&&o<=40959,Xo=o=>o>=40960&&o<=42127,vc=o=>o>=42128&&o<=42191,gs=o=>o>=44032&&o<=55215,Ul=o=>o>=63744&&o<=64255,Ko=o=>o>=64336&&o<=65023,_s=o=>o>=65040&&o<=65055,Ls=o=>o>=65072&&o<=65103,Ma=o=>o>=65104&&o<=65135,Lo=o=>o>=65136&&o<=65279,yo=o=>o>=65280&&o<=65519;function al(o){for(const e of o)if(C(e.charCodeAt(0)))return!0;return!1}function M(o){for(const e of o)if(!D(e.charCodeAt(0)))return!1;return!0}function D(o){return!(Ta(o)||Sa(o)||Ol(o)||Ko(o)||Lo(o))}function C(o){return!(746!==o&&747!==o&&(o<4352||!(zl(o)||Yo(o)||Ls(o)&&!(o>=65097&&o<=65103)||Ul(o)||Bl(o)||ps(o)||_c(o)||!(!ms(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||yc(o)||Vl(o)||Fs(o)||(e=o,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(o)||(e=>e>=55216&&e<=55295)(o)||(e=>e>=4352&&e<=4607)(o)||gs(o)||Ia(o)||gc(o)||(e=>e>=12688&&e<=12703)(o)||sl(o)||Aa(o)||Nl(o)&&12540!==o||!(!yo(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Ma(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(e=>e>=5120&&e<=5759)(o)||(e=>e>=6320&&e<=6399)(o)||_s(o)||(e=>e>=19904&&e<=19967)(o)||Xo(o)||vc(o))));var e}function k(o){return!(C(o)||(e=o,(s=e)>=128&&s<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(s=>s>=8192&&s<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(s=>s>=8448&&s<=8527)(e)||(s=>s>=8528&&s<=8591)(e)||(s=>s>=8960&&s<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(s=>s>=9216&&s<=9279)(e)&&9251!==e||(s=>s>=9280&&s<=9311)(e)||(s=>s>=9312&&s<=9471)(e)||(s=>s>=9632&&s<=9727)(e)||(s=>s>=9728&&s<=9983)(e)&&!(e>=9754&&e<=9759)||(s=>s>=11008&&s<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ms(e)||Nl(e)||(s=>s>=57344&&s<=63743)(e)||Ls(e)||Ma(e)||yo(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,s}function V(o){return o>=1424&&o<=2303||Ko(o)||Lo(o)}function X(o,e){return!(!e&&V(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=o,s>=6016&&s<=6143));var s}function h(o){for(const e of o)if(V(e.charCodeAt(0)))return!0;return!1}const r="deferred",l="loading",p="loaded";let y=null,v="unavailable",T=null;const A=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(v="error"),y&&y(o)};function R(){N.fire(new ut("pluginStateChange",{pluginStatus:v,pluginURL:T}))}const N=new kt,U=function(){return v},H=function(){if(v!==r||!T)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");v=l,R(),T&&j({url:T},o=>{o?A(o):(v=p,R())})},q={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>v===p||null!=q.applyArabicShaping,isLoading:()=>v===l,setState(o){v=o.pluginStatus,T=o.pluginURL},isParsed:()=>null!=q.applyArabicShaping&&null!=q.processBidirectionalText&&null!=q.processStyledBidirectionalText,getPluginURL:()=>T};class Y{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mc,this.transition={})}isSupportedScript(e){return function(s,c){for(const d of s)if(!X(d.charCodeAt(0),c))return!1;return!0}(e,q.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class se{constructor(e,s){this.property=e,this.value=s,this.expression=function(c,d){if(Ys(c))return new tl(c,d);if(ga(c)){const m=Rs(c,d);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=c;return"string"==typeof c&&"color"===d.type&&(m=De.parse(c)),{kind:"constant",evaluate:()=>m}}}(void 0===s?e.specification.default:s,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,s,c){return this.property.possiblyEvaluate(this,e,s,c)}}class le{constructor(e){this.property=e,this.value=new se(e,void 0)}transitioned(e,s){return new ee(this.property,this.value,s,Tn({},e.transition,this.transition),e.now)}untransitioned(){return new ee(this.property,this.value,null,{},0)}}class _e{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rn(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new le(this._values[e].property)),this._values[e].value=new se(this._values[e].property,null===s?void 0:Rn(s))}getTransition(e){return Rn(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new le(this._values[e].property)),this._values[e].transition=Rn(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(e[s]=c);const d=this.getTransition(s);void 0!==d&&(e[`${s}-transition`]=d)}return e}transitioned(e,s){const c=new ce(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(e,s._values[d]);return c}untransitioned(){const e=new ce(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class ee{constructor(e,s,c,d,m){const _=d.delay||0,b=d.duration||0;m=m||0,this.property=e,this.value=s,this.begin=m+_,this.end=this.begin+b,e.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(e,s,c){const d=e.now||0,m=this.value.possiblyEvaluate(e,s,c),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(e,s,c);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,s,c),m,et(b))}}return m}}class ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,c){const d=new Se(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,s,c);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class me{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Rn(this._values[e].value)}setValue(e,s){this._values[e]=new se(this._values[e].property,null===s?void 0:Rn(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(e[s]=c)}return e}possiblyEvaluate(e,s,c){const d=new Se(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,s,c);return d}}class xe{constructor(e,s,c){this.property=e,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,s,c,d){return this.property.evaluate(this.value,this.parameters,e,s,c,d)}}class Se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class fe{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,c){const d=jo[this.specification.type];return d?d(e,s,c):e}}class Fe{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,c,d){return new xe(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(s,null,{},c,d)}:e.expression,s)}interpolate(e,s,c){if("constant"!==e.value.kind||"constant"!==s.value.kind)return e;if(void 0===e.value.value||void 0===s.value.value)return new xe(this,{kind:"constant",value:void 0},e.parameters);const d=jo[this.specification.type];return d?new xe(this,{kind:"constant",value:d(e.value.value,s.value.value,c)},e.parameters):e}evaluate(e,s,c,d,m,_){return"constant"===e.kind?e.value:e.evaluate(s,c,d,m,_)}}class Ke extends Fe{possiblyEvaluate(e,s,c,d){if(void 0===e.value)return new xe(this,{kind:"constant",value:void 0},s);if("constant"===e.expression.kind){const m=e.expression.evaluate(s,null,{},c,d),_="resolvedImage"===e.property.specification.type&&"string"!=typeof m?m.name:m,b=this._calculate(_,_,_,s);return new xe(this,{kind:"constant",value:b},s)}if("camera"===e.expression.kind){const m=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new xe(this,{kind:"constant",value:m},s)}return new xe(this,e.expression,s)}evaluate(e,s,c,d,m,_){if("source"===e.kind){const b=e.evaluate(s,c,d,m,_);return this._calculate(b,b,b,s)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},c,d),e.evaluate({zoom:Math.floor(s.zoom)},c,d),e.evaluate({zoom:Math.floor(s.zoom)+1},c,d),s):e.value}_calculate(e,s,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:s,other:c}:{from:c,to:s,other:e}}interpolate(e){return e}}class st{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,d){if(void 0!==e.value){if("constant"===e.expression.kind){const m=e.expression.evaluate(s,null,{},c,d);return this._calculate(m,m,m,s)}return this._calculate(e.expression.evaluate(new Y(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Y(Math.floor(s.zoom),s)),e.expression.evaluate(new Y(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:c,to:s}}interpolate(e){return e}}class Re{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,d){return!!e.expression.evaluate(s,null,{},c,d)}interpolate(){return!1}}class qe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new se(c,void 0),m=this.defaultTransitionablePropertyValues[s]=new le(c);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}function vt(o,e){return 256*(o=zt(Math.floor(o),0,255))+zt(Math.floor(e),0,255)}St("DataDrivenProperty",Fe),St("DataConstantProperty",fe),St("CrossFadedDataDrivenProperty",Ke),St("CrossFadedProperty",st),St("ColorRampProperty",Re);const It={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ct{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mt(o,e=1){let s=0,c=0;return{members:o.map(d=>{const m=It[d.type].BYTES_PER_ELEMENT,_=s=wn(s,Math.max(e,m)),b=d.components||1;return c=Math.max(c,m),s+=m*b,{name:d.name,type:d.type,components:b,offset:_}}),size:wn(s,Math.max(c,e)),alignment:e}}function wn(o,e){return Math.ceil(o/e)*e}class nn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const d=2*e;return this.int16[d+0]=s,this.int16[d+1]=c,e}}nn.prototype.bytesPerElement=4,St("StructArrayLayout2i4",nn);class Rr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,d)}emplace(e,s,c,d,m){const _=4*e;return this.int16[_+0]=s,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=m,e}}Rr.prototype.bytesPerElement=8,St("StructArrayLayout4i8",Rr);class xr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,s,c,d,m,_,b)}emplace(e,s,c,d,m,_,b,E){const S=6*e,P=12*e,L=3*e;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[P+4]=d,this.uint8[P+5]=m,this.uint8[P+6]=_,this.uint8[P+7]=b,this.float32[L+2]=E,e}}xr.prototype.bytesPerElement=12,St("StructArrayLayout2i4ub1f12",xr);class mn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,c)}emplace(e,s,c,d){const m=3*e;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=d,e}}mn.prototype.bytesPerElement=12,St("StructArrayLayout3f12",mn);class dn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E,S,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,s,c,d,m,_,b,E,S,P)}emplace(e,s,c,d,m,_,b,E,S,P,L){const O=10*e;return this.uint16[O+0]=s,this.uint16[O+1]=c,this.uint16[O+2]=d,this.uint16[O+3]=m,this.uint16[O+4]=_,this.uint16[O+5]=b,this.uint16[O+6]=E,this.uint16[O+7]=S,this.uint16[O+8]=P,this.uint16[O+9]=L,e}}dn.prototype.bytesPerElement=20,St("StructArrayLayout10ui20",dn);class yr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,c,d,m,_,b,E)}emplace(e,s,c,d,m,_,b,E,S){const P=8*e;return this.uint16[P+0]=s,this.uint16[P+1]=c,this.uint16[P+2]=d,this.uint16[P+3]=m,this.uint16[P+4]=_,this.uint16[P+5]=b,this.uint16[P+6]=E,this.uint16[P+7]=S,e}}yr.prototype.bytesPerElement=16,St("StructArrayLayout8ui16",yr);class io extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de){const be=this.length;return this.resize(be+1),this.emplace(be,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de)}emplace(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be){const Ae=16*e;return this.int16[Ae+0]=s,this.int16[Ae+1]=c,this.int16[Ae+2]=d,this.int16[Ae+3]=m,this.uint16[Ae+4]=_,this.uint16[Ae+5]=b,this.uint16[Ae+6]=E,this.uint16[Ae+7]=S,this.int16[Ae+8]=P,this.int16[Ae+9]=L,this.int16[Ae+10]=O,this.int16[Ae+11]=$,this.int16[Ae+12]=K,this.int16[Ae+13]=te,this.int16[Ae+14]=de,this.int16[Ae+15]=be,e}}io.prototype.bytesPerElement=32,St("StructArrayLayout4i4ui4i4i32",io);class Qs extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}Qs.prototype.bytesPerElement=4,St("StructArrayLayout1ul4",Qs);class ei extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E,S,P,L,O,$){const K=this.length;return this.resize(K+1),this.emplace(K,e,s,c,d,m,_,b,E,S,P,L,O,$)}emplace(e,s,c,d,m,_,b,E,S,P,L,O,$,K){const te=20*e,de=10*e;return this.int16[te+0]=s,this.int16[te+1]=c,this.int16[te+2]=d,this.int16[te+3]=m,this.int16[te+4]=_,this.float32[de+3]=b,this.float32[de+4]=E,this.float32[de+5]=S,this.float32[de+6]=P,this.int16[te+14]=L,this.uint32[de+8]=O,this.uint16[te+18]=$,this.uint16[te+19]=K,e}}ei.prototype.bytesPerElement=40,St("StructArrayLayout5i4f1i1ul2ui40",ei);class Yi extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,s,c,d,m,_,b)}emplace(e,s,c,d,m,_,b,E){const S=8*e;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+4]=m,this.int16[S+5]=_,this.int16[S+6]=b,this.int16[S+7]=E,e}}Yi.prototype.bytesPerElement=16,St("StructArrayLayout3i2i2i16",Yi);class oo extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,c,d,m)}emplace(e,s,c,d,m,_){const b=4*e,E=8*e;return this.float32[b+0]=s,this.float32[b+1]=c,this.float32[b+2]=d,this.int16[E+6]=m,this.int16[E+7]=_,e}}oo.prototype.bytesPerElement=16,St("StructArrayLayout2f1f2i16",oo);class Js extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,d)}emplace(e,s,c,d,m){const _=12*e,b=3*e;return this.uint8[_+0]=s,this.uint8[_+1]=c,this.float32[b+1]=d,this.float32[b+2]=m,e}}Js.prototype.bytesPerElement=12,St("StructArrayLayout2ub2f12",Js);class cr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,c)}emplace(e,s,c,d){const m=3*e;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=d,e}}cr.prototype.bytesPerElement=6,St("StructArrayLayout3ui6",cr);class Ir extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze){const $e=this.length;return this.resize($e+1),this.emplace($e,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze)}emplace(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze,$e){const Ye=30*e,lt=15*e,dt=60*e;return this.int16[Ye+0]=s,this.int16[Ye+1]=c,this.int16[Ye+2]=d,this.float32[lt+2]=m,this.float32[lt+3]=_,this.uint16[Ye+8]=b,this.uint16[Ye+9]=E,this.uint32[lt+5]=S,this.uint32[lt+6]=P,this.uint32[lt+7]=L,this.uint16[Ye+16]=O,this.uint16[Ye+17]=$,this.uint16[Ye+18]=K,this.float32[lt+10]=te,this.float32[lt+11]=de,this.uint8[dt+48]=be,this.uint8[dt+49]=Ae,this.uint8[dt+50]=Ne,this.uint32[lt+13]=Me,this.int16[Ye+28]=ze,this.uint8[dt+58]=$e,e}}Ir.prototype.bytesPerElement=60,St("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Ir);class Gn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze,$e,Ye,lt,dt,xt,tt,at,bt,rt){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze,$e,Ye,lt,dt,xt,tt,at,bt,rt)}emplace(e,s,c,d,m,_,b,E,S,P,L,O,$,K,te,de,be,Ae,Ne,Me,ze,$e,Ye,lt,dt,xt,tt,at,bt,rt,Yt){const At=38*e,Wn=19*e;return this.int16[At+0]=s,this.int16[At+1]=c,this.int16[At+2]=d,this.float32[Wn+2]=m,this.float32[Wn+3]=_,this.int16[At+8]=b,this.int16[At+9]=E,this.int16[At+10]=S,this.int16[At+11]=P,this.int16[At+12]=L,this.int16[At+13]=O,this.uint16[At+14]=$,this.uint16[At+15]=K,this.uint16[At+16]=te,this.uint16[At+17]=de,this.uint16[At+18]=be,this.uint16[At+19]=Ae,this.uint16[At+20]=Ne,this.uint16[At+21]=Me,this.uint16[At+22]=ze,this.uint16[At+23]=$e,this.uint16[At+24]=Ye,this.uint16[At+25]=lt,this.uint16[At+26]=dt,this.uint16[At+27]=xt,this.uint16[At+28]=tt,this.uint32[Wn+15]=at,this.float32[Wn+16]=bt,this.float32[Wn+17]=rt,this.float32[Wn+18]=Yt,e}}Gn.prototype.bytesPerElement=76,St("StructArrayLayout3i2f6i15ui1ul3f76",Gn);class zr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}zr.prototype.bytesPerElement=4,St("StructArrayLayout1f4",zr);class Xi extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,s,c)}emplace(e,s,c,d){const m=3*e;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=d,e}}Xi.prototype.bytesPerElement=6,St("StructArrayLayout3i6",Xi);class rr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,d)}emplace(e,s,c,d,m){const _=6*e;return this.uint32[3*e+0]=s,this.uint16[_+2]=c,this.uint16[_+3]=d,this.uint16[_+4]=m,e}}rr.prototype.bytesPerElement=12,St("StructArrayLayout1ul3ui12",rr);class Br extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const d=2*e;return this.uint16[d+0]=s,this.uint16[d+1]=c,e}}Br.prototype.bytesPerElement=4,St("StructArrayLayout2ui4",Br);class Qo extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}Qo.prototype.bytesPerElement=2,St("StructArrayLayout1ui2",Qo);class ur extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,c,d,m)}emplace(e,s,c,d,m,_){const b=5*e;return this.float32[b+0]=s,this.float32[b+1]=c,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=_,e}}ur.prototype.bytesPerElement=20,St("StructArrayLayout5f20",ur);class xc extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const d=2*e;return this.float32[d+0]=s,this.float32[d+1]=c,e}}xc.prototype.bytesPerElement=8,St("StructArrayLayout2f8",xc);class Vu extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,d)}emplace(e,s,c,d,m){const _=4*e;return this.float32[_+0]=s,this.float32[_+1]=c,this.float32[_+2]=d,this.float32[_+3]=m,e}}Vu.prototype.bytesPerElement=16,St("StructArrayLayout4f16",Vu);class Os extends Ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Os.prototype.size=40;class ys extends ei{get(e){return new Os(this,e)}}St("CollisionBoxArray",ys);class Uu extends Ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Uu.prototype.size=60;class jl extends Ir{get(e){return new Uu(this,e)}}St("PlacedSymbolArray",jl);class bc extends Ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}bc.prototype.size=76;class Gm extends Gn{get(e){return new bc(this,e)}}St("SymbolInstanceArray",Gm);class wc extends zr{getoffsetX(e){return this.float32[1*e+0]}}St("GlyphOffsetArray",wc);class Pa extends Xi{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}St("SymbolLineVertexArray",Pa);class cu extends Ct{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}cu.prototype.size=12;class ll extends rr{get(e){return new cu(this,e)}}St("FeatureIndexArray",ll);class Uf extends Ct{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Uf.prototype.size=4;class rd extends Br{get(e){return new Uf(this,e)}}St("FillExtrusionCentroidArray",rd);const id=Mt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ju=Mt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var od=pe(function(o){o.exports=function(e,s){var c,d,m,_,b,E,S,P;for(d=e.length-(c=3&e.length),m=s,b=3432918353,E=461845907,P=0;P<d;)S=255&e.charCodeAt(P)|(255&e.charCodeAt(++P))<<8|(255&e.charCodeAt(++P))<<16|(255&e.charCodeAt(++P))<<24,++P,m=27492+(65535&(_=5*(65535&(m=(m^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&e.charCodeAt(P+2))<<16;case 2:S^=(255&e.charCodeAt(P+1))<<8;case 1:m^=S=(65535&(S=(S=(65535&(S^=255&e.charCodeAt(P)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295}return m^=e.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Hm=pe(function(o){o.exports=function(e,s){for(var c,d=e.length,m=s^d,_=0;d>=4;)c=1540483477*(65535&(c=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++_;switch(d){case 3:m^=(255&e.charCodeAt(_+2))<<16;case 2:m^=(255&e.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&e.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),uu=od,Hc=Hm;uu.murmur3=od,uu.murmur2=Hc;class $l{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,c,d){this.ids.push(jf(e)),this.positions.push(s,c,d)}getPositions(e){const s=jf(e);let c=0,d=this.ids.length-1;for(;c<d;){const _=c+d>>1;this.ids[_]>=s?d=_:c=_+1}const m=[];for(;this.ids[c]===s;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(e,s){const c=new Float64Array(e.ids),d=new Uint32Array(e.positions);return $f(c,d,0,c.length-1),s&&s.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(e){const s=new $l;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function jf(o){const e=+o;return!isNaN(e)&&e<=He?e:uu(String(o))}function $f(o,e,s,c){for(;s<c;){const d=o[s+c>>1];let m=s-1,_=c+1;for(;;){do{m++}while(o[m]<d);do{_--}while(o[_]>d);if(m>=_)break;hu(o,m,_),hu(e,3*m,3*_),hu(e,3*m+1,3*_+1),hu(e,3*m+2,3*_+2)}_-s<c-_?($f(o,e,s,_),s=_+1):($f(o,e,_+1,c),c=_)}}function hu(o,e,s){const c=o[e];o[e]=o[s],o[s]=c}St("FeaturePositionMap",$l);class Gl{constructor(e,s){this.gl=e.gl,this.location=s}}class sd extends Gl{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Gf extends Gl{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Hf extends Gl{constructor(e,s){super(e,s),this.current=De.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qm=new Float32Array(16),$u=new Float32Array(9);function du(o){return[vt(255*o.r,255*o.g),vt(255*o.b,255*o.a)]}class Ra{constructor(e,s,c){this.value=e,this.uniformNames=s.map(d=>`u_${d}`),this.type=c}setUniform(e,s,c){e.set(c.constantOr(this.value))}getBinding(e,s,c){return"color"===this.type?new Hf(e,s):new sd(e,s)}}class qc{constructor(e,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,s,c,d){const m="u_pattern_to"===d||"u_dash_to"===d?this.patternTo:"u_pattern_from"===d||"u_dash_from"===d?this.patternFrom:"u_pixel_ratio_to"===d?this.pixelRatioTo:"u_pixel_ratio_from"===d?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,s,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Gf(e,s):new sd(e,s)}}class cl{constructor(e,s,c,d){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,s,c,d,m){const _=this.paintVertexArray.length,b=this.expression.evaluate(new Y(0),s,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(_,e,b)}updatePaintArray(e,s,c,d){const m=this.expression.evaluate({zoom:0},c,d);this._setPaintValue(e,s,m)}_setPaintValue(e,s,c){if("color"===this.type){const d=du(c);for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<s;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ka{constructor(e,s,c,d,m,_){this.expression=e,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,s,c,d,m){const _=this.expression.evaluate(new Y(this.zoom),s,{},d,[],m),b=this.expression.evaluate(new Y(this.zoom+1),s,{},d,[],m),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,_,b)}updatePaintArray(e,s,c,d){const m=this.expression.evaluate({zoom:this.zoom},c,d),_=this.expression.evaluate({zoom:this.zoom+1},c,d);this._setPaintValue(e,s,m,_)}_setPaintValue(e,s,c,d){if("color"===this.type){const m=du(c),_=du(d);for(let b=e;b<s;b++)this.paintVertexArray.emplace(b,m[0],m[1],_[0],_[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=zt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,s,c){return new sd(e,s)}}class ea{constructor(e,s,c,d,m,_,b){this.expression=e,this.type=c,this.useIntegerZoom=d,this.zoom=m,this.layerId=b,this.paintVertexAttributes=("array"===c?ju:id).members;for(let E=0;E<s.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,s,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(e,s,c,d,m){this._setPaintValues(e,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,s,c,d){if(!d||!c)return;const{min:m,mid:_,max:b}=c,E=d[m],S=d[_],P=d[b];if(E&&S&&P)for(let L=e;L<s;L++)this._setPaintValue(this.zoomInPaintVertexArray,L,S,E),this._setPaintValue(this.zoomOutPaintVertexArray,L,S,P)}_setPaintValue(e,s,c,d){e.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],c.pixelRatio,d.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ta{constructor(e,s,c=(()=>!0)){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!c(m))continue;const _=e.paint.get(m);if(!(_ instanceof xe&&fi(_.property.specification)))continue;const b=Zf(m,e.type),E=_.value,S=_.property.specification.type,P=_.property.useIntegerZoom,L=_.property.specification["property-type"],O="cross-faded"===L||"cross-faded-data-driven"===L,$="line-dasharray"===String(m)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==E.kind||$)if("source"===E.kind||$||O){const K=Wf(m,S,"source");this.binders[m]=O?new ea(E,b,S,P,s,K,e.id):new cl(E,b,S,K),d.push(`/a_${m}`)}else{const K=Wf(m,S,"composite");this.binders[m]=new ka(E,b,S,P,s,K),d.push(`/z_${m}`)}else this.binders[m]=O?new qc(E.value,b):new Ra(E.value,b,S),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof cl||s instanceof ka?s.maxValue:0}populatePaintArrays(e,s,c,d,m){for(const _ in this.binders){const b=this.binders[_];(b instanceof cl||b instanceof ka||b instanceof ea)&&b.populatePaintArray(e,s,c,d,m)}}setConstantPatternPositions(e,s){for(const c in this.binders){const d=this.binders[c];d instanceof qc&&d.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,c,d,m){let _=!1;for(const b in e){const E=s.getPositions(b);for(const S of E){const P=c.feature(S.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof cl||O instanceof ka||O instanceof ea)&&!0===O.expression.isStateDependent){const $=d.paint.get(L);O.expression=$.value,O.updatePaintArray(S.start,S.end,P,e[b],m),_=!0}}}}return _}defines(){const e=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Ra||c instanceof qc)&&e.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof cl||c instanceof ka||c instanceof ea)for(let d=0;d<c.paintVertexAttributes.length;d++)e.push(c.paintVertexAttributes[d].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ra||c instanceof qc||c instanceof ka)for(const d of c.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const c=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof Ra||m instanceof qc||m instanceof ka)for(const _ of m.uniformNames)if(s[_]){const b=m.getBinding(e,s[_],_);c.push({name:_,property:d,binding:b})}}return c}setUniforms(e,s,c,d){for(const{name:m,property:_,binding:b}of s)this.binders[_].setUniform(b,d,c.get(_),m)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(e&&c instanceof ea){const d=2===e.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof cl||c instanceof ka)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const s in this.binders){const c=this.binders[s];(c instanceof cl||c instanceof ka||c instanceof ea)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof cl||s instanceof ka||s instanceof ea)&&s.destroy()}}}class Hl{constructor(e,s,c=(()=>!0)){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new ta(d,s,c);this.needsUpload=!1,this._featureMap=new $l,this._bufferOffset=0}populatePaintArrays(e,s,c,d,m,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,s,d,m,_);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,c,d){for(const m of c)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,s,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Zf(o,e){return qf[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Ec={"line-pattern":{source:dn,composite:dn},"fill-pattern":{source:dn,composite:dn},"fill-extrusion-pattern":{source:dn,composite:dn},"line-dasharray":{source:yr,composite:yr}},Zm={color:{source:xc,composite:Vu},number:{source:zr,composite:xc}};function Wf(o,e,s){const c=Ec[o];return c&&c[s]||Zm[e][s]}St("ConstantBinder",Ra),St("CrossFadedConstantBinder",qc),St("SourceExpressionBinder",cl),St("CrossFadedCompositeBinder",ea),St("CompositeExpressionBinder",ka),St("ProgramConfiguration",ta,{omit:["_buffers"]}),St("ProgramConfigurationSet",Hl);const Gu="-transition";class na extends kt{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new me(s.layout)),s.paint)){this._transitionablePaint=new _e(s.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Se(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,c={}){null!=s&&this._validate(Fl,`layers.${this.id}.layout.${e}`,e,s,c)||("visibility"!==e?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return Jt(e,Gu)?this._transitionablePaint.getTransition(e.slice(0,-Gu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,c={}){if(null!=s&&this._validate(kl,`layers.${this.id}.paint.${e}`,e,s,c))return!1;if(Jt(e,Gu))return this._transitionablePaint.setTransition(e.slice(0,-Gu.length),s||void 0),!1;{const d=this._transitionablePaint._values[e],m="cross-faded-data-driven"===d.property.specification["property-type"],_=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(e,b,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),pt(e,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(e,s,c,d,m={}){return(!m||!1!==m.validate)&&Ll(this,e.call(wa,{key:s,layerType:this.type,objectKey:c,value:d,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof xe&&fi(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}}const Wm=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ul}=Wm;class ti{constructor(e=[]){this.segments=e}prepareSegment(e,s,c,d){let m=this.segments[this.segments.length-1];return e>ti.MAX_VERTEX_ARRAY_LENGTH&&er(`Max vertices per segment is ${ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>ti.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==d&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,c,d){return new ti([{vertexOffset:e,primitiveOffset:s,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St("SegmentVector",ti);var Qn=8192;const ad=Math.pow(2,14)-1,Yf=-ad-1;function Cc(o){const e=Qn/o.extent,s=o.loadGeometry();for(let c=0;c<s.length;c++){const d=s[c];for(let m=0;m<d.length;m++){const _=d[m],b=Math.round(_.x*e),E=Math.round(_.y*e);_.x=zt(b,Yf,ad),_.y=zt(E,Yf,ad),(b<_.x||b>_.x+1||E<_.y||E>_.y+1)&&er("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Dc(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Cc(o):[]}}function Hu(o,e,s,c,d){o.emplaceBack(2*e+(c+1)/2,2*s+(d+1)/2)}class qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new nn,this.indexArray=new cr,this.segments=new ti,this.programConfigurations=new Hl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c){const d=this.layers[0],m=[];let _=null;"circle"===d.type&&(_=d.layout.get("circle-sort-key"));for(const{feature:b,id:E,index:S,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Dc(b,L);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),O,c))continue;const $=_?_.evaluate(O,{},c):void 0,K={id:E,properties:b.properties,type:b.type,sourceLayerIndex:P,index:S,geometry:L?O.geometry:Cc(b),patterns:{},sortKey:$};m.push(K)}_&&m.sort((b,E)=>b.sortKey-E.sortKey);for(const b of m){const{geometry:E,index:S,sourceLayerIndex:P}=b,L=e[S].feature;this.addFeature(b,E,S,c),s.featureIndex.insert(L,E,S,P,this.index)}}update(e,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ul),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,d){for(const m of s)for(const _ of m){const b=_.x,E=_.y;if(b<0||b>=Qn||E<0||E>=Qn)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=S.vertexLength;Hu(this.layoutVertexArray,b,E,-1,-1),Hu(this.layoutVertexArray,b,E,1,-1),Hu(this.layoutVertexArray,b,E,1,1),Hu(this.layoutVertexArray,b,E,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},d)}}function Xf(o,e){for(let s=0;s<o.length;s++)if(Fa(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(Fa(o,e[s]))return!0;return!!Qf(o,e)}function Ym(o,e,s){return!!Fa(o,e)||!!Tc(e,o,s)}function Kf(o,e){if(1===o.length)return ra(e,o[0]);for(let s=0;s<e.length;s++){const c=e[s];for(let d=0;d<c.length;d++)if(Fa(o,c[d]))return!0}for(let s=0;s<o.length;s++)if(ra(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(Qf(o,e[s]))return!0;return!1}function Xm(o,e,s){if(o.length>1){if(Qf(o,e))return!0;for(let c=0;c<e.length;c++)if(Tc(e[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Tc(o[c],e,s))return!0;return!1}function Qf(o,e){if(0===o.length||0===e.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],d=o[s+1];for(let m=0;m<e.length-1;m++)if(Km(c,d,e[m],e[m+1]))return!0}return!1}function Km(o,e,s,c){return fr(o,s,c)!==fr(e,s,c)&&fr(o,e,s)!==fr(o,e,c)}function Tc(o,e,s){const c=s*s;if(1===e.length)return o.distSqr(e[0])<c;for(let d=1;d<e.length;d++)if(ld(o,e[d-1],e[d])<c)return!0;return!1}function ld(o,e,s){const c=e.distSqr(s);if(0===c)return o.distSqr(e);const d=((o.x-e.x)*(s.x-e.x)+(o.y-e.y)*(s.y-e.y))/c;return o.distSqr(d<0?e:d>1?s:s.sub(e)._mult(d)._add(e))}function ra(o,e){let s,c,d,m=!1;for(let _=0;_<o.length;_++){s=o[_];for(let b=0,E=s.length-1;b<s.length;E=b++)c=s[b],d=s[E],c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(m=!m)}return m}function Fa(o,e){let s=!1;for(let c=0,d=o.length-1;c<o.length;d=c++){const m=o[c],_=o[d];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(s=!s)}return s}function cd(o,e,s,c,d){for(const _ of o)if(e<=_.x&&s<=_.y&&c>=_.x&&d>=_.y)return!0;const m=[new je(e,s),new je(e,d),new je(c,d),new je(c,s)];if(o.length>2)for(const _ of m)if(Fa(o,_))return!0;for(let _=0;_<o.length-1;_++)if(Jf(o[_],o[_+1],m))return!0;return!1}function Jf(o,e,s){const c=s[0],d=s[2];if(o.x<c.x&&e.x<c.x||o.x>d.x&&e.x>d.x||o.y<c.y&&e.y<c.y||o.y>d.y&&e.y>d.y)return!1;const m=fr(o,e,s[0]);return m!==fr(o,e,s[1])||m!==fr(o,e,s[2])||m!==fr(o,e,s[3])}function Sc(o,e,s){const c=e.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(e.id).getMaxValue(o)}function ud(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Qm(o,e,s,c,d){if(!e[0]&&!e[1])return o;const m=je.convert(e)._mult(d);"viewport"===s&&m._rotate(-c);const _=[];for(let b=0;b<o.length;b++)_.push(o[b].sub(m));return _}function Jm(o,e,s,c){const d=je.convert(o)._mult(c);return"viewport"===e&&d._rotate(-s),d}St("CircleBucket",qu,{omit:["layers"]});const hd=new qe({"circle-sort-key":new Fe(ve.layout_circle["circle-sort-key"])});var dd={paint:new qe({"circle-radius":new Fe(ve.paint_circle["circle-radius"]),"circle-color":new Fe(ve.paint_circle["circle-color"]),"circle-blur":new Fe(ve.paint_circle["circle-blur"]),"circle-opacity":new Fe(ve.paint_circle["circle-opacity"]),"circle-translate":new fe(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new fe(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fe(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fe(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(ve.paint_circle["circle-stroke-opacity"])}),layout:hd},vo="undefined"!=typeof Float32Array?Float32Array:Array;function eg(){var o=new vo(9);return vo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function ep(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function fd(o,e,s){var c=e[0],d=e[1],m=e[2],_=e[3],b=e[4],E=e[5],S=e[6],P=e[7],L=e[8],O=e[9],$=e[10],K=e[11],te=e[12],de=e[13],be=e[14],Ae=e[15],Ne=s[0],Me=s[1],ze=s[2],$e=s[3];return o[0]=Ne*c+Me*b+ze*L+$e*te,o[1]=Ne*d+Me*E+ze*O+$e*de,o[2]=Ne*m+Me*S+ze*$+$e*be,o[3]=Ne*_+Me*P+ze*K+$e*Ae,o[4]=(Ne=s[4])*c+(Me=s[5])*b+(ze=s[6])*L+($e=s[7])*te,o[5]=Ne*d+Me*E+ze*O+$e*de,o[6]=Ne*m+Me*S+ze*$+$e*be,o[7]=Ne*_+Me*P+ze*K+$e*Ae,o[8]=(Ne=s[8])*c+(Me=s[9])*b+(ze=s[10])*L+($e=s[11])*te,o[9]=Ne*d+Me*E+ze*O+$e*de,o[10]=Ne*m+Me*S+ze*$+$e*be,o[11]=Ne*_+Me*P+ze*K+$e*Ae,o[12]=(Ne=s[12])*c+(Me=s[13])*b+(ze=s[14])*L+($e=s[15])*te,o[13]=Ne*d+Me*E+ze*O+$e*de,o[14]=Ne*m+Me*S+ze*$+$e*be,o[15]=Ne*_+Me*P+ze*K+$e*Ae,o}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var tg=fd;function Zu(){var o=new vo(3);return vo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function tp(o){return Math.hypot(o[0],o[1],o[2])}function Zc(o,e,s){var c=new vo(3);return c[0]=o,c[1]=e,c[2]=s,c}function pd(o,e,s){return o[0]=e[0]-s[0],o[1]=e[1]-s[1],o[2]=e[2]-s[2],o}function fu(o,e,s){return o[0]=e[0]*s[0],o[1]=e[1]*s[1],o[2]=e[2]*s[2],o}function md(o,e,s,c){return o[0]=e[0]+s[0]*c,o[1]=e[1]+s[1]*c,o[2]=e[2]+s[2]*c,o}function Wu(o,e){var s=e[0],c=e[1],d=e[2],m=s*s+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),o[0]=e[0]*m,o[1]=e[1]*m,o[2]=e[2]*m,o}function np(o,e,s){var c=s[0],d=s[1],m=s[2],_=e[0],b=e[1],E=e[2],S=d*E-m*b,P=m*_-c*E,L=c*b-d*_,O=d*L-m*P,$=m*S-c*L,K=c*P-d*S,te=2*s[3];return P*=te,L*=te,$*=2,K*=2,o[0]=_+(S*=te)+(O*=2),o[1]=b+P+$,o[2]=E+L+K,o}var Ar,ng=pd,rg=fu,gd=tp;function Wc(o,e,s){var c=e[0],d=e[1],m=e[2],_=e[3];return o[0]=s[0]*c+s[4]*d+s[8]*m+s[12]*_,o[1]=s[1]*c+s[5]*d+s[9]*m+s[13]*_,o[2]=s[2]*c+s[6]*d+s[10]*m+s[14]*_,o[3]=s[3]*c+s[7]*d+s[11]*m+s[15]*_,o}function _d(){var o=new vo(4);return vo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function rp(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function ip(o,e,s){s*=.5;var c=e[0],d=e[1],m=e[2],_=e[3],b=Math.sin(s),E=Math.cos(s);return o[0]=c*E+_*b,o[1]=d*E+m*b,o[2]=m*E-d*b,o[3]=_*E-c*b,o}function op(o,e,s,c,d,m,_,b,E){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(E*=o.pixelToTileUnitsFactor);for(const S of e)for(const P of S){const L=P.add(b),O=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(L.x,L.y,!0):0,$=m?L:ig(L,O,c),K=m?o.tilespaceRays.map(de=>pu(de,O)):o.queryGeometry.screenGeometry,te=Wc([],[P.x,P.y,O,1],c);if(!_&&m?E*=te[3]/s.cameraToCenterDistance:_&&!m&&(E*=s.cameraToCenterDistance/te[3]),Ym(K,$,E))return!0}return!1}function ig(o,e,s){const c=Wc([],[o.x,o.y,e,1],s);return new je(c[0]/c[3],c[1]/c[3])}Zu(),Ar=new vo(4),vo!=Float32Array&&(Ar[0]=0,Ar[1]=0,Ar[2]=0,Ar[3]=0),Zu(),Zc(1,0,0),Zc(0,1,0),_d(),_d(),eg();const og=Zc(0,0,0),wy=Zc(0,0,1);function pu(o,e){const s=Zu();return og[2]=e,o.intersectsPlane(og,wy,s),new je(s[0],s[1])}class xo extends qu{}function mu(o,{width:e,height:s},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*s*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*s*c);return o.width=e,o.height=s,o.data=d,o}function yd(o,{width:e,height:s},c){if(e===o.width&&s===o.height)return;const d=mu({},{width:e,height:s},c);Yu(o,d,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,e),height:Math.min(o.height,s)},c),o.width=e,o.height=s,o.data=d.data}function Yu(o,e,s,c,d,m){if(0===d.width||0===d.height)return e;if(d.width>o.width||d.height>o.height||s.x>o.width-d.width||s.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||c.x>e.width-d.width||c.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=o.data,b=e.data;for(let E=0;E<d.height;E++){const S=((s.y+E)*o.width+s.x)*m,P=((c.y+E)*e.width+c.x)*m;for(let L=0;L<d.width*m;L++)b[P+L]=_[S+L]}return e}St("HeatmapBucket",xo,{omit:["layers"]});class Wr{constructor(e,s){mu(this,e,1,s)}resize(e){yd(this,e,1)}clone(){return new Wr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,d,m){Yu(e,s,c,d,m,1)}}class so{constructor(e,s){mu(this,e,4,s)}resize(e){yd(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new so({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,d,m){Yu(e,s,c,d,m,4)}}St("AlphaImage",Wr),St("RGBAImage",so);var vd={paint:new qe({"heatmap-radius":new Fe(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fe(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Re(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fe(ve.paint_heatmap["heatmap-opacity"])})};function xd(o){const e={},s=o.resolution||256,c=o.clips?o.clips.length:1,d=o.image||new so({width:s,height:c}),m=(_,b,E)=>{e[o.evaluationKey]=E;const S=o.expression.evaluate(e);d.data[_+b+0]=Math.floor(255*S.r/S.a),d.data[_+b+1]=Math.floor(255*S.g/S.a),d.data[_+b+2]=Math.floor(255*S.b/S.a),d.data[_+b+3]=Math.floor(255*S.a)};if(o.clips)for(let _=0,b=0;_<c;++_,b+=4*s)for(let E=0,S=0;E<s;E++,S+=4){const P=E/(s-1),{start:L,end:O}=o.clips[_];m(b,S,L*(1-P)+O*P)}else for(let _=0,b=0;_<s;_++,b+=4)m(0,b,_/(s-1));return d}var sg={paint:new qe({"hillshade-illumination-direction":new fe(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new fe(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new fe(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new fe(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new fe(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new fe(ve.paint_hillshade["hillshade-accent-color"])})};const sp=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ag}=sp;var Xu=gu,lg=gu;function gu(o,e,s){s=s||2;var c,d,m,_,b,E,S,P=e&&e.length,L=P?e[0]*s:o.length,O=ap(o,0,L,s,!0),$=[];if(!O||O.next===O.prev)return $;if(P&&(O=function(te,de,be,Ae){var Ne,Me,ze,$e=[];for(Ne=0,Me=de.length;Ne<Me;Ne++)(ze=ap(te,de[Ne]*Ae,Ne<Me-1?de[Ne+1]*Ae:te.length,Ae,!1))===ze.next&&(ze.steiner=!0),$e.push(ug(ze));for($e.sort(Ey),Ne=0;Ne<$e.length;Ne++)up($e[Ne],be),be=ql(be,be.next);return be}(o,e,O,s)),o.length>80*s){c=m=o[0],d=_=o[1];for(var K=s;K<L;K+=s)(b=o[K])<c&&(c=b),(E=o[K+1])<d&&(d=E),b>m&&(m=b),E>_&&(_=E);S=0!==(S=Math.max(m-c,_-d))?1/S:0}return _u(O,$,s,c,d,S),$}function ap(o,e,s,c,d){var m,_;if(d===fp(o,e,s,c)>0)for(m=e;m<s;m+=c)_=dp(m,o[m],o[m+1],_);else for(m=s-c;m>=e;m-=c)_=dp(m,o[m],o[m+1],_);return _&&Qu(_,_.next)&&(yu(_),_=_.next),_}function ql(o,e){if(!o)return o;e||(e=o);var s,c=o;do{if(s=!1,c.steiner||!Qu(c,c.next)&&0!==Yr(c.prev,c,c.next))c=c.next;else{if(yu(c),(c=e=c.prev)===c.next)break;s=!0}}while(s||c!==e);return e}function _u(o,e,s,c,d,m,_){if(o){!_&&m&&function(P,L,O,$){var K=P;do{null===K.z&&(K.z=wd(K.x,K.y,L,O,$)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next}while(K!==P);K.prevZ.nextZ=null,K.prevZ=null,function(te){var de,be,Ae,Ne,Me,ze,$e,Ye,lt=1;do{for(be=te,te=null,Me=null,ze=0;be;){for(ze++,Ae=be,$e=0,de=0;de<lt&&($e++,Ae=Ae.nextZ);de++);for(Ye=lt;$e>0||Ye>0&&Ae;)0!==$e&&(0===Ye||!Ae||be.z<=Ae.z)?(Ne=be,be=be.nextZ,$e--):(Ne=Ae,Ae=Ae.nextZ,Ye--),Me?Me.nextZ=Ne:te=Ne,Ne.prevZ=Me,Me=Ne;be=Ae}Me.nextZ=null,lt*=2}while(ze>1)}(K)}(o,c,d,m);for(var b,E,S=o;o.prev!==o.next;)if(b=o.prev,E=o.next,m?bd(o,c,d,m):lp(o))e.push(b.i/s),e.push(o.i/s),e.push(E.i/s),yu(o),o=E.next,S=E.next;else if((o=E)===S){_?1===_?_u(o=cp(ql(o),e,s),e,s,c,d,m,2):2===_&&cg(o,e,s,c,d,m):_u(ql(o),e,s,c,d,m,1);break}}}function lp(o){var e=o.prev,s=o,c=o.next;if(Yr(e,s,c)>=0)return!1;for(var d=o.next.next;d!==o.prev;){if(ia(e.x,e.y,s.x,s.y,c.x,c.y,d.x,d.y)&&Yr(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function bd(o,e,s,c){var d=o.prev,m=o,_=o.next;if(Yr(d,m,_)>=0)return!1;for(var b=d.x>m.x?d.x>_.x?d.x:_.x:m.x>_.x?m.x:_.x,E=d.y>m.y?d.y>_.y?d.y:_.y:m.y>_.y?m.y:_.y,S=wd(d.x<m.x?d.x<_.x?d.x:_.x:m.x<_.x?m.x:_.x,d.y<m.y?d.y<_.y?d.y:_.y:m.y<_.y?m.y:_.y,e,s,c),P=wd(b,E,e,s,c),L=o.prevZ,O=o.nextZ;L&&L.z>=S&&O&&O.z<=P;){if(L!==o.prev&&L!==o.next&&ia(d.x,d.y,m.x,m.y,_.x,_.y,L.x,L.y)&&Yr(L.prev,L,L.next)>=0||(L=L.prevZ,O!==o.prev&&O!==o.next&&ia(d.x,d.y,m.x,m.y,_.x,_.y,O.x,O.y)&&Yr(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;L&&L.z>=S;){if(L!==o.prev&&L!==o.next&&ia(d.x,d.y,m.x,m.y,_.x,_.y,L.x,L.y)&&Yr(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;O&&O.z<=P;){if(O!==o.prev&&O!==o.next&&ia(d.x,d.y,m.x,m.y,_.x,_.y,O.x,O.y)&&Yr(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function cp(o,e,s){var c=o;do{var d=c.prev,m=c.next.next;!Qu(d,m)&&hp(d,c,c.next,m)&&bo(d,m)&&bo(m,d)&&(e.push(d.i/s),e.push(c.i/s),e.push(m.i/s),yu(c),yu(c.next),c=o=m),c=c.next}while(c!==o);return ql(c)}function cg(o,e,s,c,d,m){var _=o;do{for(var b=_.next.next;b!==_.prev;){if(_.i!==b.i&&hg(_,b)){var E=Ed(_,b);return _=ql(_,_.next),E=ql(E,E.next),_u(_,e,s,c,d,m),void _u(E,e,s,c,d,m)}b=b.next}_=_.next}while(_!==o)}function Ey(o,e){return o.x-e.x}function up(o,e){if(e=function(c,d){var m,_=d,b=c.x,E=c.y,S=-1/0;do{if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){var P=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(P<=b&&P>S){if(S=P,P===b){if(E===_.y)return _;if(E===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==d);if(!m)return null;if(b===S)return m;var L,O=m,$=m.x,K=m.y,te=1/0;_=m;do{b>=_.x&&_.x>=$&&b!==_.x&&ia(E<K?b:S,E,$,K,E<K?S:b,E,_.x,_.y)&&(L=Math.abs(E-_.y)/(b-_.x),bo(_,c)&&(L<te||L===te&&(_.x>m.x||_.x===m.x&&Ku(m,_)))&&(m=_,te=L)),_=_.next}while(_!==O);return m}(o,e)){var s=Ed(e,o);ql(e,e.next),ql(s,s.next)}}function Ku(o,e){return Yr(o.prev,o,e.prev)<0&&Yr(e.next,o,o.next)<0}function wd(o,e,s,c,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*d)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-c)*d)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ug(o){var e=o,s=o;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==o);return s}function ia(o,e,s,c,d,m,_,b){return(d-_)*(e-b)-(o-_)*(m-b)>=0&&(o-_)*(c-b)-(s-_)*(e-b)>=0&&(s-_)*(m-b)-(d-_)*(c-b)>=0}function hg(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(s,c){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==c.i&&d.next.i!==c.i&&hp(d,d.next,s,c))return!0;d=d.next}while(d!==s);return!1}(o,e)&&(bo(o,e)&&bo(e,o)&&function(s,c){var d=s,m=!1,_=(s.x+c.x)/2,b=(s.y+c.y)/2;do{d.y>b!=d.next.y>b&&d.next.y!==d.y&&_<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next}while(d!==s);return m}(o,e)&&(Yr(o.prev,o,e.prev)||Yr(o,e.prev,e))||Qu(o,e)&&Yr(o.prev,o,o.next)>0&&Yr(e.prev,e,e.next)>0)}function Yr(o,e,s){return(e.y-o.y)*(s.x-e.x)-(e.x-o.x)*(s.y-e.y)}function Qu(o,e){return o.x===e.x&&o.y===e.y}function hp(o,e,s,c){var d=Ic(Yr(o,e,s)),m=Ic(Yr(o,e,c)),_=Ic(Yr(s,c,o)),b=Ic(Yr(s,c,e));return d!==m&&_!==b||!(0!==d||!Ju(o,s,e))||!(0!==m||!Ju(o,c,e))||!(0!==_||!Ju(s,o,c))||!(0!==b||!Ju(s,e,c))}function Ju(o,e,s){return e.x<=Math.max(o.x,s.x)&&e.x>=Math.min(o.x,s.x)&&e.y<=Math.max(o.y,s.y)&&e.y>=Math.min(o.y,s.y)}function Ic(o){return o>0?1:o<0?-1:0}function bo(o,e){return Yr(o.prev,o,o.next)<0?Yr(o,e,o.next)>=0&&Yr(o,o.prev,e)>=0:Yr(o,e,o.prev)<0||Yr(o,o.next,e)<0}function Ed(o,e){var s=new eh(o.i,o.x,o.y),c=new eh(e.i,e.x,e.y),d=o.next,m=e.prev;return o.next=e,e.prev=o,s.next=d,d.prev=s,c.next=s,s.prev=c,m.next=c,c.prev=m,c}function dp(o,e,s,c){var d=new eh(o,e,s);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function yu(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function eh(o,e,s){this.i=o,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fp(o,e,s,c){for(var d=0,m=e,_=s-c;m<s;m+=c)d+=(o[_]-o[m])*(o[m+1]+o[_+1]),_=m;return d}function pp(o,e,s,c,d){mp(o,e,s||0,c||o.length-1,d||dg)}function mp(o,e,s,c,d){for(;c>s;){if(c-s>600){var m=c-s+1,_=e-s+1,b=Math.log(m),E=.5*Math.exp(2*b/3),S=.5*Math.sqrt(b*E*(m-E)/m)*(_-m/2<0?-1:1);mp(o,e,Math.max(s,Math.floor(e-_*E/m+S)),Math.min(c,Math.floor(e+(m-_)*E/m+S)),d)}var P=o[e],L=s,O=c;for(vu(o,s,e),d(o[c],P)>0&&vu(o,s,c);L<O;){for(vu(o,L,O),L++,O--;d(o[L],P)<0;)L++;for(;d(o[O],P)>0;)O--}0===d(o[s],P)?vu(o,s,O):vu(o,++O,c),O<=e&&(s=O+1),e<=O&&(c=O-1)}}function vu(o,e,s){var c=o[e];o[e]=o[s],o[s]=c}function dg(o,e){return o<e?-1:o>e?1:0}function Zl(o,e){const s=o.length;if(s<=1)return[o];const c=[];let d,m;for(let _=0;_<s;_++){const b=Ss(o[_]);0!==b&&(o[_].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(d&&c.push(d),d=[o[_]]):d.push(o[_]))}if(d&&c.push(d),e>1)for(let _=0;_<c.length;_++)c[_].length<=e||(pp(c[_],e,1,c[_].length-1,La),c[_]=c[_].slice(0,e));return c}function La(o,e){return e.area-o.area}function gp(o,e,s){const c=s.patternDependencies;let d=!1;for(const m of e){const _=m.paint.get(`${o}-pattern`);_.isConstant()||(d=!0);const b=_.constantOr(null);b&&(d=!0,c[b.to]=!0,c[b.from]=!0)}return d}function _p(o,e,s,c,d){const m=d.patternDependencies;for(const _ of e){const b=_.paint.get(`${o}-pattern`).value;if("constant"!==b.kind){let E=b.evaluate({zoom:c-1},s,{},d.availableImages),S=b.evaluate({zoom:c},s,{},d.availableImages),P=b.evaluate({zoom:c+1},s,{},d.availableImages);E=E&&E.name?E.name:E,S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,m[E]=!0,m[S]=!0,m[P]=!0,s.patterns[_.id]={min:E,mid:S,max:P}}}return s}gu.deviation=function(o,e,s,c){var d=e&&e.length,m=Math.abs(fp(o,0,d?e[0]*s:o.length,s));if(d)for(var _=0,b=e.length;_<b;_++)m-=Math.abs(fp(o,e[_]*s,_<b-1?e[_+1]*s:o.length,s));var E=0;for(_=0;_<c.length;_+=3){var S=c[_]*s,P=c[_+1]*s,L=c[_+2]*s;E+=Math.abs((o[S]-o[L])*(o[P+1]-o[S+1])-(o[S]-o[P])*(o[L+1]-o[S+1]))}return 0===m&&0===E?0:Math.abs((E-m)/m)},gu.flatten=function(o){for(var e=o[0][0].length,s={vertices:[],holes:[],dimensions:e},c=0,d=0;d<o.length;d++){for(var m=0;m<o[d].length;m++)for(var _=0;_<e;_++)s.vertices.push(o[d][m][_]);d>0&&s.holes.push(c+=o[d-1].length)}return s},Xu.default=lg;class th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new nn,this.indexArray=new cr,this.indexArray2=new Br,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new ti,this.segments2=new ti,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c){this.hasPattern=gp("fill",this.layers,s);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:_,id:b,index:E,sourceLayerIndex:S}of e){const P=this.layers[0]._featureFilter.needGeometry,L=Dc(_,P);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),L,c))continue;const O=d?d.evaluate(L,{},c,s.availableImages):void 0,$={id:b,properties:_.properties,type:_.type,sourceLayerIndex:S,index:E,geometry:P?L.geometry:Cc(_),patterns:{},sortKey:O};m.push($)}d&&m.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of m){const{geometry:b,index:E,sourceLayerIndex:S}=_;if(this.hasPattern){const P=_p("fill",this.layers,_,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(_,b,E,c,{});s.featureIndex.insert(e[E].feature,b,E,S,this.index)}}update(e,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c)}addFeatures(e,s,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,c,d,m){for(const _ of Zl(s,500)){let b=0;for(const $ of _)b+=$.length;const E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=E.vertexLength,P=[],L=[];for(const $ of _){if(0===$.length)continue;$!==_[0]&&L.push(P.length/2);const K=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),te=K.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(te+$.length-1,te),P.push($[0].x),P.push($[0].y);for(let de=1;de<$.length;de++)this.layoutVertexArray.emplaceBack($[de].x,$[de].y),this.indexArray2.emplaceBack(te+de-1,te+de),P.push($[de].x),P.push($[de].y);K.vertexLength+=$.length,K.primitiveLength+=$.length}const O=Xu(P,L);for(let $=0;$<O.length;$+=3)this.indexArray.emplaceBack(S+O[$],S+O[$+1],S+O[$+2]);E.vertexLength+=b,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}}St("FillBucket",th,{omit:["layers","patternFeatures"]});const Cy=new qe({"fill-sort-key":new Fe(ve.layout_fill["fill-sort-key"])});var Oa={paint:new qe({"fill-antialias":new fe(ve.paint_fill["fill-antialias"]),"fill-opacity":new Fe(ve.paint_fill["fill-opacity"]),"fill-color":new Fe(ve.paint_fill["fill-color"]),"fill-outline-color":new Fe(ve.paint_fill["fill-outline-color"]),"fill-translate":new fe(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new fe(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ke(ve.paint_fill["fill-pattern"])}),layout:Cy};const Cd=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dd=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:fg}=Cd;var Td=Na;function Na(o,e,s,c,d){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=d,o.readFields(yp,this,e)}function yp(o,e,s){1==o?e.id=s.readVarint():2==o?function(c,d){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=d._keys[c.readVarint()],b=d._values[c.readVarint()];d.properties[_]=b}}(s,e):3==o?e.type=s.readVarint():4==o&&(e._geometry=s.pos)}function vp(o){for(var e,s,c=0,d=0,m=o.length,_=m-1;d<m;_=d++)c+=((s=o[_]).x-(e=o[d]).x)*(e.y+s.y);return c}Na.types=["Unknown","Point","LineString","Polygon"],Na.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var e,s=o.readVarint()+o.pos,c=1,d=0,m=0,_=0,b=[];o.pos<s;){if(d<=0){var E=o.readVarint();c=7&E,d=E>>3}if(d--,1===c||2===c)m+=o.readSVarint(),_+=o.readSVarint(),1===c&&(e&&b.push(e),e=[]),e.push(new je(m,_));else{if(7!==c)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Na.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var e=o.readVarint()+o.pos,s=1,c=0,d=0,m=0,_=1/0,b=-1/0,E=1/0,S=-1/0;o.pos<e;){if(c<=0){var P=o.readVarint();s=7&P,c=P>>3}if(c--,1===s||2===s)(d+=o.readSVarint())<_&&(_=d),d>b&&(b=d),(m+=o.readSVarint())<E&&(E=m),m>S&&(S=m);else if(7!==s)throw new Error("unknown command "+s)}return[_,E,b,S]},Na.prototype.toGeoJSON=function(o,e,s){var c,d,m=this.extent*Math.pow(2,s),_=this.extent*o,b=this.extent*e,E=this.loadGeometry(),S=Na.types[this.type];function P($){for(var K=0;K<$.length;K++){var te=$[K];$[K]=[360*(te.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(c=0;c<E.length;c++)L[c]=E[c][0];P(E=L);break;case 2:for(c=0;c<E.length;c++)P(E[c]);break;case 3:for(E=function($){var K=$.length;if(K<=1)return[$];for(var te,de,be=[],Ae=0;Ae<K;Ae++){var Ne=vp($[Ae]);0!==Ne&&(void 0===de&&(de=Ne<0),de===Ne<0?(te&&be.push(te),te=[$[Ae]]):te.push($[Ae]))}return te&&be.push(te),be}(E),c=0;c<E.length;c++)for(d=0;d<E[c].length;d++)P(E[c][d])}1===E.length?E=E[0]:S="Multi"+S;var O={type:"Feature",geometry:{type:S,coordinates:E},properties:this.properties};return"id"in this&&(O.id=this.id),O};var nh=rh;function rh(o,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(xp,this,e),this.length=this._features.length}function xp(o,e,s){15===o?e.version=s.readVarint():1===o?e.name=s.readString():5===o?e.extent=s.readVarint():2===o?e._features.push(s.pos):3===o?e._keys.push(s.readString()):4===o&&e._values.push(function(c){for(var d=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;d=1===_?c.readString():2===_?c.readFloat():3===_?c.readDouble():4===_?c.readVarint64():5===_?c.readVarint():6===_?c.readSVarint():7===_?c.readBoolean():null}return d}(s))}function Dy(o,e,s){if(3===o){var c=new nh(s,s.readVarint()+s.pos);c.length&&(e[c.name]=c)}}rh.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var e=this._pbf.readVarint()+this._pbf.pos;return new Td(this._pbf,e,this.extent,this._keys,this._values)};var Ns={VectorTile:function(o,e){this.layers=o.readFields(Dy,{},e)},VectorTileFeature:Td,VectorTileLayer:nh};const Sd=Ns.VectorTileFeature.types,bp=Math.pow(2,13);function xu(o,e,s,c,d,m,_,b){o.emplaceBack((e<<1)+_,(s<<1)+m,(Math.floor(c*bp)<<1)+d,Math.round(b))}class ih{constructor(){this.acc=new je(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new je(e.x,e.y),this.max=new je(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let c=!!this.borders;const d=this.min,m=this.max;e.x<d.x?(d.x=e.x,c=!0):e.x>m.x&&(m.x=e.x,c=!0),e.y<d.y?(d.y=e.y,c=!0):e.y>m.y&&(m.y=e.y,c=!0),((0===e.x||e.x===Qn)&&e.x===s.x)!=((0===e.y||e.y===Qn)&&e.y===s.y)&&this.processBorderOverlap(e,s),c&&this.checkBorderIntersection(e,s)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,Nn(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Qn!=e.x>Qn&&this.addBorderIntersection(1,Nn(s.y,e.y,(Qn-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Nn(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Qn!=e.y>Qn&&this.addBorderIntersection(3,Nn(s.x,e.x,(Qn-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const c=0===e.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,e.y)}else{const c=0===e.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,e.x)}}centroid(){const e=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==e?this.acc.div(e)._round():new je(0,0)}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class Id{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Rr,this.centroidVertexArray=new rd,this.indexArray=new cr,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new ti,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,c){this.features=[],this.hasPattern=gp("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/Qn/(1<<d.z)}(c);for(const{feature:d,id:m,index:_,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,S=Dc(d,E);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),S,c))continue;const P={id:m,sourceLayerIndex:b,index:_,geometry:E?S.geometry:Cc(d),properties:d.properties,type:d.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(_p("fill-extrusion",this.layers,P,this.zoom,s)):this.addFeature(P,P.geometry,_,c,{}),s.featureIndex.insert(d,P.geometry,_,b,this.index,L)}this.sortBorders()}addFeatures(e,s,c){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,s,c)}this.sortBorders()}update(e,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,d,m){const _=this.enableTerrain?new ih:null;for(const E of Zl(s,500)){let S=0,P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===E.length||(b=E[0]).every(te=>te.x<=0)||b.every(te=>te.x>=Qn)||b.every(te=>te.y<=0)||b.every(te=>te.y>=Qn))continue;for(let te=0;te<E.length;te++){const de=E[te];if(0===de.length)continue;S+=de.length;let be=0;_&&_.startRing(de[0]);for(let Ae=0;Ae<de.length;Ae++){const Ne=de[Ae];if(Ae>=1){const Me=de[Ae-1];if(!pg(Ne,Me)){_&&_.append(Ne,Me),P.vertexLength+4>ti.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ze=Ne.sub(Me)._perp(),$e=ze.x/(Math.abs(ze.x)+Math.abs(ze.y)),Ye=ze.y>0?1:0,lt=Me.dist(Ne);be+lt>32768&&(be=0),xu(this.layoutVertexArray,Ne.x,Ne.y,$e,Ye,0,0,be),xu(this.layoutVertexArray,Ne.x,Ne.y,$e,Ye,0,1,be),be+=lt,xu(this.layoutVertexArray,Me.x,Me.y,$e,Ye,0,0,be),xu(this.layoutVertexArray,Me.x,Me.y,$e,Ye,0,1,be);const dt=P.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+S>ti.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),"Polygon"!==Sd[e.type])continue;const L=[],O=[],$=P.vertexLength;for(let te=0;te<E.length;te++){const de=E[te];if(0!==de.length){de!==E[0]&&O.push(L.length/2);for(let be=0;be<de.length;be++){const Ae=de[be];xu(this.layoutVertexArray,Ae.x,Ae.y,0,0,1,1,0),L.push(Ae.x),L.push(Ae.y),_&&_.currentPolyCount.top++}}}const K=Xu(L,O);for(let te=0;te<K.length;te+=3)this.indexArray.emplaceBack($+K[te],$+K[te+2],$+K[te+1]);P.primitiveLength+=K.length/3,P.vertexLength+=S}var b;if(_&&_.polyCount.length>0){if(_.borders){_.vertexArrayOffset=this.centroidVertexArray.length;const E=_.borders,S=this.featuresOnBorder.push(_)-1;for(let P=0;P<4;P++)E[P][0]!==Number.MAX_VALUE&&this.borders[P].push(S)}this.encodeCentroid(_.borders?void 0:_.centroid(),_)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,c)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}encodeCentroid(e,s,c=!0){let d,m;if(e)if(0!==e.y){const b=s.span()._mult(this.tileToMeter);d=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else d=Math.ceil(7*(e.x+450)),m=0;else d=0,m=+c;let _=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const b of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let E=0;E<2*b.edges;E++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,d,m);for(let E=0;E<b.top;E++)this.centroidVertexArray.emplace(_++,d,m)}}}function pg(o,e){return o.x===e.x&&(o.x<0||o.x>Qn)||o.y===e.y&&(o.y<0||o.y>Qn)}St("FillExtrusionBucket",Id,{omit:["layers","features"]}),St("PartMetadata",ih);var mg={paint:new qe({"fill-extrusion-opacity":new fe(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new fe(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new fe(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ke(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new fe(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function bu(o,e){return o.x*e.x+o.y*e.y}function wp(o,e){if(1===o.length){let s=0;const c=e[s++];let d;for(;!d||c.equals(d);)if(d=e[s++],!d)return 1/0;for(;s<e.length;s++){const m=e[s],_=o[0],b=d.sub(c),E=m.sub(c),S=_.sub(c),P=bu(b,b),L=bu(b,E),O=bu(E,E),$=bu(S,b),K=bu(S,E),te=P*O-L*L,de=(O*$-L*K)/te,be=(P*K-L*$)/te,Ae=c.z*(1-de-be)+d.z*de+m.z*be;if(isFinite(Ae))return Ae}return 1/0}{let s=1/0;for(const c of e)s=Math.min(s,c.z);return s}}function Ep(o){const e=new je(o[0],o[1]);return e.z=o[2],e}function Cp(o,e,s,c,d,m,_,b){const E=_*d.getElevationAt(o,e,!0,!0),S=0!==m[0],P=S?0===m[1]?_*(m[0]/7-450):_*function(L,O,$){const K=Math.floor(O[0]/8),te=Math.floor(O[1]/8),de=10*(O[0]-8*K),be=10*(O[1]-8*te),Ae=L.getElevationAt(K,te,!0,!0),Ne=L.getMeterToDEM($),Me=Math.floor(.5*(de*Ne-1)),ze=Math.floor(.5*(be*Ne-1)),$e=L.tileCoordToPixel(K,te),Ye=2*Me+1,lt=2*ze+1,dt=(en=Ye,En=lt,[(Yt=L).getElevationAtPixel(At=$e.x-Me,Wn=$e.y-ze,!0),Yt.getElevationAtPixel(At+En,Wn,!0),Yt.getElevationAtPixel(At,Wn+En,!0),Yt.getElevationAtPixel(At+en,Wn+En,!0)]),xt=Math.abs(dt[0]-dt[1]),tt=Math.abs(dt[2]-dt[3]),at=Math.abs(dt[0]-dt[2])+Math.abs(dt[1]-dt[3]),bt=Math.min(.25,.5*Ne*(xt+tt)/Ye),rt=Math.min(.25,.5*Ne*at/lt);var Yt,At,Wn,en,En;return Ae+Math.max(bt*de,rt*be)}(d,m,b):E;return{base:E+(0===s)?-1:s,top:S?Math.max(P+c,E+s+2):E+c}}const Ad=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Dp}=Ad,Md=Mt([{name:"a_packed",components:3,type:"Float32"}]),{members:gg}=Md,_g=Ns.VectorTileFeature.types,Tp=Math.cos(Math.PI/180*37.5);class oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new xr,this.layoutVertexArray2=new mn,this.indexArray=new cr,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c){this.hasPattern=gp("line",this.layers,s);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:S,id:P,index:L,sourceLayerIndex:O}of e){const $=this.layers[0]._featureFilter.needGeometry,K=Dc(S,$);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),K,c))continue;const te=d?d.evaluate(K,{},c):void 0,de={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:L,geometry:$?K.geometry:Cc(S),patterns:{},sortKey:te};m.push(de)}d&&m.sort((S,P)=>S.sortKey-P.sortKey);const{lineAtlas:_,featureIndex:b}=s,E=this.addConstantDashes(_);for(const S of m){const{geometry:P,index:L,sourceLayerIndex:O}=S;if(E&&this.addFeatureDashes(S,_),this.hasPattern){const $=_p("line",this.layers,S,this.zoom,s);this.patternFeatures.push($)}else this.addFeature(S,P,L,c,_.positions);b.insert(e[L].feature,P,L,O,this.index)}}addConstantDashes(e){let s=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==m.kind)s=!0;else{const _=m.value,b=d.value;if(!b)continue;e.addDash(b.from,_),e.addDash(b.to,_),b.other&&e.addDash(b.other,_)}}return s}addFeatureDashes(e,s){const c=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let b,E,S,P,L,O;if("constant"===m.kind){const de=m.value;if(!de)continue;b=de.other||de.to,E=de.to,S=de.from}else b=m.evaluate({zoom:c-1},e),E=m.evaluate({zoom:c},e),S=m.evaluate({zoom:c+1},e);"constant"===_.kind?P=L=O=_.value:(P=_.evaluate({zoom:c-1},e),L=_.evaluate({zoom:c},e),O=_.evaluate({zoom:c+1},e)),s.addDash(b,P),s.addDash(E,L),s.addDash(S,O);const $=s.getKey(b,P),K=s.getKey(E,L),te=s.getKey(S,O);e.patterns[d.id]={min:$,mid:K,max:te}}}update(e,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c)}addFeatures(e,s,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,c,d,m){const _=this.layers[0].layout,b=_.get("line-join").evaluate(e,{}),E=_.get("line-cap").evaluate(e,{}),S=_.get("line-miter-limit"),P=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of s)this.addLine(L,e,b,E,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}addLine(e,s,c,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<e.length-1;be++)this.totalDistance+=e[be].dist(e[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===_g[s.type];let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let S=0;for(;S<E-1&&e[S].equals(e[S+1]);)S++;if(E<(b?3:2))return;"bevel"===c&&(m=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let O,$,K,te,de;this.e1=this.e2=-1,b&&(O=e[E-2],de=e[S].sub(O)._unit()._perp());for(let be=S;be<E;be++){if(K=be===E-1?b?e[S+1]:void 0:e[be+1],K&&e[be].equals(K))continue;de&&(te=de),O&&($=O),O=e[be],de=K?K.sub(O)._unit()._perp():te,te=te||de;let Ae=te.add(de);0===Ae.x&&0===Ae.y||Ae._unit();const Ne=te.x*de.x+te.y*de.y,Me=Ae.x*de.x+Ae.y*de.y,ze=0!==Me?1/Me:1/0,$e=2*Math.sqrt(2-2*Me),Ye=Me<Tp&&$&&K,lt=te.x*de.y-te.y*de.x>0;if(Ye&&be>S){const tt=O.dist($);if(tt>2*P){const at=O.sub(O.sub($)._mult(P/tt)._round());this.updateDistance($,at),this.addCurrentVertex(at,te,0,0,L),$=at}}const dt=$&&K;let xt=dt?c:b?"butt":d;if(dt&&"round"===xt&&(ze<_?xt="miter":ze<=2&&(xt="fakeround")),"miter"===xt&&ze>m&&(xt="bevel"),"bevel"===xt&&(ze>2&&(xt="flipbevel"),ze<m&&(xt="miter")),$&&this.updateDistance($,O),"miter"===xt)Ae._mult(ze),this.addCurrentVertex(O,Ae,0,0,L);else if("flipbevel"===xt){if(ze>100)Ae=de.mult(-1);else{const tt=ze*te.add(de).mag()/te.sub(de).mag();Ae._perp()._mult(tt*(lt?-1:1))}this.addCurrentVertex(O,Ae,0,0,L),this.addCurrentVertex(O,Ae.mult(-1),0,0,L)}else if("bevel"===xt||"fakeround"===xt){const tt=-Math.sqrt(ze*ze-1),at=lt?tt:0,bt=lt?0:tt;if($&&this.addCurrentVertex(O,te,at,bt,L),"fakeround"===xt){const rt=Math.round(180*$e/Math.PI/20);for(let Yt=1;Yt<rt;Yt++){let At=Yt/rt;if(.5!==At){const en=At-.5;At+=At*en*(At-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*en*en+(.848013+Ne*(.215638*Ne-1.06021)))}const Wn=de.sub(te)._mult(At)._add(te)._unit()._mult(lt?-1:1);this.addHalfVertex(O,Wn.x,Wn.y,!1,lt,0,L)}}K&&this.addCurrentVertex(O,de,-at,-bt,L)}else if("butt"===xt)this.addCurrentVertex(O,Ae,0,0,L);else if("square"===xt){const tt=$?1:-1;$||this.addCurrentVertex(O,Ae,tt,tt,L),this.addCurrentVertex(O,Ae,0,0,L),$&&this.addCurrentVertex(O,Ae,tt,tt,L)}else"round"===xt&&($&&(this.addCurrentVertex(O,te,0,0,L),this.addCurrentVertex(O,te,1,1,L,!0)),K&&(this.addCurrentVertex(O,de,-1,-1,L,!0),this.addCurrentVertex(O,de,0,0,L)));if(Ye&&be<E-1){const tt=O.dist(K);if(tt>2*P){const at=O.add(K.sub(O)._mult(P/tt)._round());this.updateDistance(O,at),this.addCurrentVertex(at,de,0,0,L),O=at}}}}addCurrentVertex(e,s,c,d,m,_=!1){const b=s.y*d-s.x,E=-s.y-s.x*d;this.addHalfVertex(e,s.x+s.y*c,s.y-s.x*c,_,!1,c,m),this.addHalfVertex(e,b,E,_,!0,-d,m)}addHalfVertex({x:e,y:s},c,d,m,_,b,E){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(s<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const S=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),E.primitiveLength++),_?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}St("LineBucket",oh,{omit:["layers","patternFeatures"]});const Ac=new qe({"line-cap":new Fe(ve.layout_line["line-cap"]),"line-join":new Fe(ve.layout_line["line-join"]),"line-miter-limit":new fe(ve.layout_line["line-miter-limit"]),"line-round-limit":new fe(ve.layout_line["line-round-limit"]),"line-sort-key":new Fe(ve.layout_line["line-sort-key"])});var Pd={paint:new qe({"line-opacity":new Fe(ve.paint_line["line-opacity"]),"line-color":new Fe(ve.paint_line["line-color"]),"line-translate":new fe(ve.paint_line["line-translate"]),"line-translate-anchor":new fe(ve.paint_line["line-translate-anchor"]),"line-width":new Fe(ve.paint_line["line-width"]),"line-gap-width":new Fe(ve.paint_line["line-gap-width"]),"line-offset":new Fe(ve.paint_line["line-offset"]),"line-blur":new Fe(ve.paint_line["line-blur"]),"line-dasharray":new Ke(ve.paint_line["line-dasharray"]),"line-pattern":new Ke(ve.paint_line["line-pattern"]),"line-gradient":new Re(ve.paint_line["line-gradient"])}),layout:Ac};const Rd=new class extends Fe{possiblyEvaluate(o,e){return e=new Y(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(o,e)}evaluate(o,e,s,c){return e=Tn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(o,e,s,c)}}(Pd.paint.properties["line-width"].specification);function Sp(o,e){return e>0?e+2*o:o}Rd.useIntegerZoom=!0;const sh=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),yg=Mt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ip=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ap=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kd=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fd=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const vs=128;function Yc(o,e){const{expression:s}=e;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new Y(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:d}=s;let m=0;for(;m<c.length&&c[m]<=o;)m++;m=Math.max(0,m-1);let _=m;for(;_<c.length&&c[_]<o+1;)_++;_=Math.min(c.length-1,_);const b=c[m],E=c[_];return"composite"===s.kind?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:E,minSize:s.evaluate(new Y(b)),maxSize:s.evaluate(new Y(E)),interpolationType:d}}}function wu(o,{uSize:e,uSizeT:s},{lowerSize:c,upperSize:d}){return"source"===o.kind?c/vs:"composite"===o.kind?Nn(c/vs,d/vs,s):e}function Wl(o,e){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:d,minZoom:m,maxZoom:_}=o,b=d?zt(Mn.interpolationFactor(d,e,m,_),0,1):0;"camera"===o.kind?c=Nn(o.minSize,o.maxSize,b):s=b}return{uSizeT:s,uSize:c}}var Mp=Object.freeze({__proto__:null,getSizeData:Yc,evaluateSizeForFeature:wu,evaluateSizeForZoom:Wl,SIZE_PACK_FACTOR:vs});function Ld(o,e,s){return o.sections.forEach(c=>{c.text=function(d,m,_){const b=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===b?d=d.toLocaleUpperCase():"lowercase"===b&&(d=d.toLocaleLowerCase()),q.applyArabicShaping&&(d=q.applyArabicShaping(d)),d}(c.text,e,s)}),o}const hl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function vg(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function Pp(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Rp=function(o,e,s,c,d){var m,_,b=8*d-c-1,E=(1<<b)-1,S=E>>1,P=-7,L=s?d-1:0,O=s?-1:1,$=o[e+L];for(L+=O,m=$&(1<<-P)-1,$>>=-P,P+=b;P>0;m=256*m+o[e+L],L+=O,P-=8);for(_=m&(1<<-P)-1,m>>=-P,P+=c;P>0;_=256*_+o[e+L],L+=O,P-=8);if(0===m)m=1-S;else{if(m===E)return _?NaN:1/0*($?-1:1);_+=Math.pow(2,c),m-=S}return($?-1:1)*_*Math.pow(2,m-c)},kp=function(o,e,s,c,d,m){var _,b,E,S=8*m-d-1,P=(1<<S)-1,L=P>>1,O=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,$=c?0:m-1,K=c?1:-1,te=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,_=P):(_=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-_))<1&&(_--,E*=2),(e+=_+L>=1?O/E:O*Math.pow(2,1-L))*E>=2&&(_++,E/=2),_+L>=P?(b=0,_=P):_+L>=1?(b=(e*E-1)*Math.pow(2,d),_+=L):(b=e*Math.pow(2,L-1)*Math.pow(2,d),_=0));d>=8;o[s+$]=255&b,$+=K,b/=256,d-=8);for(_=_<<d|b,S+=d;S>0;o[s+$]=255&_,$+=K,_/=256,S-=8);o[s+$-K]|=128*te},Xc=ir;function ir(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}ir.Varint=0,ir.Fixed64=1,ir.Bytes=2,ir.Fixed32=5;var ah=4294967296,xg=1/ah,Od="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function dl(o){return o.type===ir.Bytes?o.readVarint()+o.pos:o.pos+1}function Fp(o,e,s){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(c);for(var d=s.pos-1;d>=o;d--)s.buf[d+c]=s.buf[d]}function bg(o,e){for(var s=0;s<o.length;s++)e.writeVarint(o[s])}function oa(o,e){for(var s=0;s<o.length;s++)e.writeSVarint(o[s])}function wg(o,e){for(var s=0;s<o.length;s++)e.writeFloat(o[s])}function Lp(o,e){for(var s=0;s<o.length;s++)e.writeDouble(o[s])}function Eg(o,e){for(var s=0;s<o.length;s++)e.writeBoolean(o[s])}function Cg(o,e){for(var s=0;s<o.length;s++)e.writeFixed32(o[s])}function Dg(o,e){for(var s=0;s<o.length;s++)e.writeSFixed32(o[s])}function Tg(o,e){for(var s=0;s<o.length;s++)e.writeFixed64(o[s])}function Op(o,e){for(var s=0;s<o.length;s++)e.writeSFixed64(o[s])}function lh(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+16777216*o[e+3]}function Kc(o,e,s){o[s]=e,o[s+1]=e>>>8,o[s+2]=e>>>16,o[s+3]=e>>>24}function Np(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+(o[e+3]<<24)}function yn(o,e,s){e.glyphs=[],1===o&&s.readMessage(zp,e)}function zp(o,e,s){if(3===o){const{id:c,bitmap:d,width:m,height:_,left:b,top:E,advance:S}=s.readMessage(Bp,{});e.glyphs.push({id:c,bitmap:new Wr({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:b,top:E,advance:S}})}else 4===o?e.ascender=s.readSVarint():5===o&&(e.descender=s.readSVarint())}function Bp(o,e,s){1===o?e.id=s.readVarint():2===o?e.bitmap=s.readBytes():3===o?e.width=s.readVarint():4===o?e.height=s.readVarint():5===o?e.left=s.readSVarint():6===o?e.top=s.readSVarint():7===o&&(e.advance=s.readVarint())}function Qc(o){let e=0,s=0;for(const _ of o)e+=_.w*_.h,s=Math.max(s,_.w);o.sort((_,b)=>b.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let d=0,m=0;for(const _ of o)for(let b=c.length-1;b>=0;b--){const E=c[b];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===E.w&&_.h===E.h){const S=c.pop();b<c.length&&(c[b]=S)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(c.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}ir.prototype={destroy:function(){this.buf=null},readFields:function(o,e,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),d=c>>3,m=this.pos;this.type=7&c,o(d,e,this),this.pos===m&&this.skip(c)}return e},readMessage:function(o,e){return this.readFields(o,e,this.readVarint()+this.pos)},readFixed32:function(){var o=lh(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Np(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=lh(this.buf,this.pos)+lh(this.buf,this.pos+4)*ah;return this.pos+=8,o},readSFixed64:function(){var o=lh(this.buf,this.pos)+Np(this.buf,this.pos+4)*ah;return this.pos+=8,o},readFloat:function(){var o=Rp(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Rp(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var e,s,c=this.buf;return e=127&(s=c[this.pos++]),s<128?e:(e|=(127&(s=c[this.pos++]))<<7,s<128?e:(e|=(127&(s=c[this.pos++]))<<14,s<128?e:(e|=(127&(s=c[this.pos++]))<<21,s<128?e:function(d,m,_){var b,E,S=_.buf;if(b=(112&(E=S[_.pos++]))>>4,E<128||(b|=(127&(E=S[_.pos++]))<<3,E<128)||(b|=(127&(E=S[_.pos++]))<<10,E<128)||(b|=(127&(E=S[_.pos++]))<<17,E<128)||(b|=(127&(E=S[_.pos++]))<<24,E<128)||(b|=(1&(E=S[_.pos++]))<<31,E<128))return function(o,e,s){return s?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}(d,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&Od?Od.decode(this.buf.subarray(e,o)):function(s,c,d){for(var m="",_=c;_<d;){var b,E,S,P=s[_],L=null,O=P>239?4:P>223?3:P>191?2:1;if(_+O>d)break;1===O?P<128&&(L=P):2===O?128==(192&(b=s[_+1]))&&(L=(31&P)<<6|63&b)<=127&&(L=null):3===O?(E=s[_+2],128==(192&(b=s[_+1]))&&128==(192&E)&&((L=(15&P)<<12|(63&b)<<6|63&E)<=2047||L>=55296&&L<=57343)&&(L=null)):4===O&&(E=s[_+2],S=s[_+3],128==(192&(b=s[_+1]))&&128==(192&E)&&128==(192&S)&&((L=(15&P)<<18|(63&b)<<12|(63&E)<<6|63&S)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,O=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),_+=O}return m}(this.buf,e,o)},readBytes:function(){var o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e},readPackedVarint:function(o,e){if(this.type!==ir.Bytes)return o.push(this.readVarint(e));var s=dl(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(e));return o},readPackedSVarint:function(o){if(this.type!==ir.Bytes)return o.push(this.readSVarint());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==ir.Bytes)return o.push(this.readBoolean());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==ir.Bytes)return o.push(this.readFloat());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==ir.Bytes)return o.push(this.readDouble());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==ir.Bytes)return o.push(this.readFixed32());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==ir.Bytes)return o.push(this.readSFixed32());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==ir.Bytes)return o.push(this.readFixed64());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==ir.Bytes)return o.push(this.readSFixed64());var e=dl(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed64());return o},skip:function(o){var e=7&o;if(e===ir.Varint)for(;this.buf[this.pos++]>127;);else if(e===ir.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ir.Fixed32)this.pos+=4;else{if(e!==ir.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(o,e){this.writeVarint(o<<3|e)},realloc:function(o){for(var e=this.length||16;e<this.pos+o;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Kc(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Kc(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Kc(this.buf,-1&o,this.pos),Kc(this.buf,Math.floor(o*xg),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Kc(this.buf,-1&o,this.pos),Kc(this.buf,Math.floor(o*xg),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(e,s){var c,d,m,b;if(e>=0?(c=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,d=d+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),m=c,(b=s).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,_){var b=(7&m)<<4;_.buf[_.pos++]|=b|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var e=this.pos;this.pos=function(c,d,m){for(var _,b,E=0;E<d.length;E++){if((_=d.charCodeAt(E))>55295&&_<57344){if(!b){_>56319||E+1===d.length?(c[m++]=239,c[m++]=191,c[m++]=189):b=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(c[m++]=239,c[m++]=191,c[m++]=189,b=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,o,this.pos);var s=this.pos-e;s>=128&&Fp(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),kp(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),kp(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var e=o.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,e){this.pos++;var s=this.pos;o(e,this);var c=this.pos-s;c>=128&&Fp(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,e,s){this.writeTag(o,ir.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(o,e){e.length&&this.writeMessage(o,bg,e)},writePackedSVarint:function(o,e){e.length&&this.writeMessage(o,oa,e)},writePackedBoolean:function(o,e){e.length&&this.writeMessage(o,Eg,e)},writePackedFloat:function(o,e){e.length&&this.writeMessage(o,wg,e)},writePackedDouble:function(o,e){e.length&&this.writeMessage(o,Lp,e)},writePackedFixed32:function(o,e){e.length&&this.writeMessage(o,Cg,e)},writePackedSFixed32:function(o,e){e.length&&this.writeMessage(o,Dg,e)},writePackedFixed64:function(o,e){e.length&&this.writeMessage(o,Tg,e)},writePackedSFixed64:function(o,e){e.length&&this.writeMessage(o,Op,e)},writeBytesField:function(o,e){this.writeTag(o,ir.Bytes),this.writeBytes(e)},writeFixed32Field:function(o,e){this.writeTag(o,ir.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(o,e){this.writeTag(o,ir.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(o,e){this.writeTag(o,ir.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(o,e){this.writeTag(o,ir.Fixed64),this.writeSFixed64(e)},writeVarintField:function(o,e){this.writeTag(o,ir.Varint),this.writeVarint(e)},writeSVarintField:function(o,e){this.writeTag(o,ir.Varint),this.writeSVarint(e)},writeStringField:function(o,e){this.writeTag(o,ir.Bytes),this.writeString(e)},writeFloatField:function(o,e){this.writeTag(o,ir.Fixed32),this.writeFloat(e)},writeDoubleField:function(o,e){this.writeTag(o,ir.Fixed64),this.writeDouble(e)},writeBooleanField:function(o,e){this.writeVarintField(o,Boolean(e))}};class xs{constructor(e,{pixelRatio:s,version:c,stretchX:d,stretchY:m,content:_}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=d,this.stretchY=m,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Nd{constructor(e,s){const c={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,c,m),this.addImages(s,d,m);const{w:_,h:b}=Qc(m),E=new so({width:_||1,height:b||1});for(const S in e){const P=e[S],L=c[S].paddedRect;so.copy(P.data,E,{x:0,y:0},{x:L.x+1,y:L.y+1},P.data)}for(const S in s){const P=s[S],L=d[S].paddedRect,O=L.x+1,$=L.y+1,K=P.data.width,te=P.data.height;so.copy(P.data,E,{x:0,y:0},{x:O,y:$},P.data),so.copy(P.data,E,{x:0,y:te-1},{x:O,y:$-1},{width:K,height:1}),so.copy(P.data,E,{x:0,y:0},{x:O,y:$+te},{width:K,height:1}),so.copy(P.data,E,{x:K-1,y:0},{x:O-1,y:$},{width:1,height:te}),so.copy(P.data,E,{x:0,y:0},{x:O+K,y:$},{width:1,height:te})}this.image=E,this.iconPositions=c,this.patternPositions=d}addImages(e,s,c){for(const d in e){const m=e[d],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};c.push(_),s[d]=new xs(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),s)}patchUpdatedImage(e,s,c){if(!e||!s||e.version===s.version)return;e.version=s.version;const[d,m]=e.tl;c.update(s.data,void 0,{x:d,y:m})}}St("ImagePosition",xs),St("ImageAtlas",Nd);const bs={horizontal:1,vertical:2,horizontalOnly:3};class Pc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const c=new Pc;return c.scale=e||1,c.fontStack=s,c}static forImage(e){const s=new Pc;return s.imageName=e,s}}class Jo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const c=new Jo;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?c.addImageSection(m):c.addTextSection(m,s)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,c){let d="";for(let m=0;m<s.length;m++){const _=s.charCodeAt(m+1)||null,b=s.charCodeAt(m-1)||null;d+=!c&&(_&&k(_)&&!hl[s[m+1]]||b&&k(b)&&!hl[s[m-1]])||!hl[s[m]]?s[m]:hl[s[m]]}return d}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&Cu[this.text.charCodeAt(c)];c++)e++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&Cu[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const c=new Jo;return c.text=this.text.substring(e,s),c.sectionIndex=this.sectionIndex.slice(e,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Pc.forText(e.scale,e.fontStack||s));const c=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(c)}addImageSection(e){const s=e.image?e.image.name:"";if(0===s.length)return void er("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Pc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):er("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Eu(o,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te){const de=Jo.fromFeature(o,d);let be;L===bs.vertical&&de.verticalizePunctuation(O);const{processBidirectionalText:Ae,processStyledBidirectionalText:Ne}=q;if(Ae&&1===de.sections.length){be=[];const $e=Ae(de.toString(),Jc(de,S,m,e,c,$,K));for(const Ye of $e){const lt=new Jo;lt.text=Ye,lt.sections=de.sections;for(let dt=0;dt<Ye.length;dt++)lt.sectionIndex.push(0);be.push(lt)}}else if(Ne){be=[];const $e=Ne(de.text,de.sectionIndex,Jc(de,S,m,e,c,$,K));for(const Ye of $e){const lt=new Jo;lt.text=Ye[0],lt.sectionIndex=Ye[1],lt.sections=de.sections,be.push(lt)}}else be=function($e,Ye){const lt=[],dt=$e.text;let xt=0;for(const tt of Ye)lt.push($e.substring(xt,tt)),xt=tt;return xt<dt.length&&lt.push($e.substring(xt,dt.length)),lt}(de,Jc(de,S,m,e,c,$,K));const Me=[],ze={positionedLines:Me,text:de.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function($e,Ye,lt,dt,xt,tt,at,bt,rt,Yt,At,Wn){let en=0,En=0,Bt=0;const tn="right"===bt?1:"left"===bt?0:.5;let Bn=!1;for(const or of xt){const sr=or.getSections();for(const Ki of sr){if(Ki.imageName)continue;const kr=Ye[Ki.fontStack];if(kr&&(Bn=void 0!==kr.ascender&&void 0!==kr.descender,!Bn))break}if(!Bn)break}let Ci=0;for(const or of xt){or.trim();const sr=or.getMaxScale(),Ki=24*(sr-1),kr={positionedGlyphs:[],lineOffset:0};$e.positionedLines[Ci]=kr;const zi=kr.positionedGlyphs;let Si=0;if(!or.length()){En+=tt,++Ci;continue}let dr=0,No=0;for(let br=0;br<or.length();br++){const Fr=or.getSection(br),ao=or.getSectionIndex(br),Qi=or.getCharCode(br);let ar=Fr.scale,Jn=null,zo=null,ws=null,Vs=24,Es=0;const Us=!(rt===bs.horizontal||!At&&!C(Qi)||At&&(Cu[Qi]||(Mr=Qi,Ta(Mr)||Sa(Mr)||Ol(Mr)||Ko(Mr)||Lo(Mr))));if(Fr.imageName){const ja=dt[Fr.imageName];if(!ja)continue;ws=Fr.imageName,$e.iconsInText=$e.iconsInText||!0,zo=ja.paddedRect;const wo=ja.displaySize;ar=24*ar/Wn,Jn={width:wo[0],height:wo[1],left:1,top:-3,advance:Us?wo[1]:wo[0],localGlyph:!1},Es=Bn?-Jn.height*ar:24*sr-17-wo[1]*ar,Vs=Jn.advance;const la=(Us?wo[0]:wo[1])*ar-24*sr;la>0&&la>Si&&(Si=la)}else{const ja=lt[Fr.fontStack];if(!ja)continue;ja[Qi]&&(zo=ja[Qi]);const wo=Ye[Fr.fontStack];if(!wo)continue;const la=wo.glyphs[Qi];if(!la)continue;if(Jn=la.metrics,Vs=8203!==Qi?24:0,Bn){const nc=void 0!==wo.ascender?Math.abs(wo.ascender):0,Cs=void 0!==wo.descender?Math.abs(wo.descender):0,Lc=(nc+Cs)*ar;dr<Lc&&(dr=Lc,No=(nc-Cs)/2*ar),Es=-nc*ar}else Es=24*(sr-ar)-17}Us?($e.verticalizable=!0,zi.push({glyph:Qi,imageName:ws,x:en,y:En+Es,vertical:Us,scale:ar,localGlyph:Jn.localGlyph,fontStack:Fr.fontStack,sectionIndex:ao,metrics:Jn,rect:zo}),en+=Vs*ar+Yt):(zi.push({glyph:Qi,imageName:ws,x:en,y:En+Es,vertical:Us,scale:ar,localGlyph:Jn.localGlyph,fontStack:Fr.fontStack,sectionIndex:ao,metrics:Jn,rect:zo}),en+=Jn.advance*ar+Yt)}0!==zi.length&&(Bt=Math.max(en-Yt,Bt),Bn?Ig(zi,tn,Si,No,tt*sr/2):Ig(zi,tn,Si,0,tt/2)),en=0;const Cr=tt*sr+Si;kr.lineOffset=Math.max(Si,Ki),En+=Cr,++Ci}var Mr;const Di=En,{horizontalAlign:Ti,verticalAlign:Vr}=Tu(at);(function(or,sr,Ki,kr,zi,Si){const dr=(sr-Ki)*zi,No=-Si*kr;for(const Cr of or)for(const br of Cr.positionedGlyphs)br.x+=dr,br.y+=No})($e.positionedLines,tn,Ti,Vr,Bt,Di),$e.top+=-Vr*Di,$e.bottom=$e.top+Di,$e.left+=-Ti*Bt,$e.right=$e.left+Bt,$e.hasBaseline=Bn}(ze,e,s,c,be,_,b,E,L,S,O,te),!function($e){for(const Ye of $e)if(0!==Ye.positionedGlyphs.length)return!1;return!0}(Me)&&ze}const Cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sg(o,e,s,c,d,m){if(e.imageName){const _=c[e.imageName];return _?_.displaySize[0]*e.scale*24/m+d:0}{const _=s[e.fontStack],b=_&&_.glyphs[o];return b?b.metrics.advance*e.scale+d:0}}function Bd(o,e,s,c){const d=Math.pow(o-e,2);return c?o<e?d/2:2*d:d+Math.abs(s)*s}function Ty(o,e,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==e&&65289!==e||(c+=50),c}function za(o,e,s,c,d,m){let _=null,b=Bd(e,s,d,m);for(const E of c){const S=Bd(e-E.x,s,d,m)+E.badness;S<=b&&(_=E,b=S)}return{index:o,x:e,priorBreak:_,badness:b}}function Du(o){return o?Du(o.priorBreak).concat(o.index):[]}function Jc(o,e,s,c,d,m,_){if("point"!==m)return[];if(!o)return[];const b=[],E=function(O,$,K,te,de,be){let Ae=0;for(let Ne=0;Ne<O.length();Ne++){const Me=O.getSection(Ne);Ae+=Sg(O.getCharCode(Ne),Me,te,de,$,be)}return Ae/Math.max(1,Math.ceil(Ae/K))}(o,e,s,c,d,_),S=o.text.indexOf("\u200b")>=0;let P=0;for(let O=0;O<o.length();O++){const $=o.getSection(O),K=o.getCharCode(O);if(Cu[K]||(P+=Sg(K,$,c,d,e,_)),O<o.length()-1){const te=!((L=K)<11904||!(zl(L)||Yo(L)||Ls(L)||Ul(L)||Bl(L)||ps(L)||_c(L)||ms(L)||yc(L)||Vl(L)||Fs(L)||yo(L)||Ia(L)||gc(L)||sl(L)||Aa(L)||Nl(L)||_s(L)||vc(L)||Xo(L)));(zd[K]||te||$.imageName)&&b.push(za(O+1,P,E,b,Ty(K,o.getCharCode(O+1),te&&S),!1))}}var L;return Du(za(o.length(),P,E,b,0,!0))}function Tu(o){let e=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Ig(o,e,s,c,d){if(!(e||s||c||d))return;const m=o.length-1,_=o[m],b=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=m;E++)o[E].x-=b,o[E].y+=s+c+d}function Ag(o,e,s){const{horizontalAlign:c,verticalAlign:d}=Tu(s),m=e[0]-o.displaySize[0]*c,_=e[1]-o.displaySize[1]*d;return{image:o,top:_,bottom:_+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function Vd(o,e,s,c,d,m){const _=o.image;let b;if(_.content){const de=_.content,be=_.pixelRatio||1;b=[de[0]/be,de[1]/be,_.displaySize[0]-de[2]/be,_.displaySize[1]-de[3]/be]}const E=e.left*m,S=e.right*m;let P,L,O,$;"width"===s||"both"===s?($=d[0]+E-c[3],L=d[0]+S+c[1]):($=d[0]+(E+S-_.displaySize[0])/2,L=$+_.displaySize[0]);const K=e.top*m,te=e.bottom*m;return"height"===s||"both"===s?(P=d[1]+K-c[0],O=d[1]+te+c[2]):(P=d[1]+(K+te-_.displaySize[1])/2,O=P+_.displaySize[1]),{image:_,top:P,right:L,bottom:O,left:$,collisionPadding:b}}class Rc extends je{constructor(e,s,c,d,m){super(e,s),this.angle=d,this.z=c,void 0!==m&&(this.segment=m)}clone(){return new Rc(this.x,this.y,this.z,this.angle,this.segment)}}function Vp(o,e,s,c,d){if(void 0===e.segment)return!0;let m=e,_=e.segment+1,b=0;for(;b>-s/2;){if(_--,_<0)return!1;b-=o[_].dist(m),m=o[_]}b+=o[_].dist(o[_+1]),_++;const E=[];let S=0;for(;b<s/2;){const P=o[_],L=o[_+1];if(!L)return!1;let O=o[_-1].angleTo(P)-P.angleTo(L);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:O}),S+=O;b-E[0].distance>c;)S-=E.shift().angleDelta;if(S>d)return!1;_++,b+=P.dist(L)}return!0}function Mg(o){let e=0;for(let s=0;s<o.length-1;s++)e+=o[s].dist(o[s+1]);return e}function Ud(o,e,s){return o?.6*e*s:0}function jd(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function Pg(o,e,s,c,d,m){const _=Ud(s,d,m),b=jd(s,c)*m;let E=0;const S=Mg(o)/2;for(let P=0;P<o.length-1;P++){const L=o[P],O=o[P+1],$=L.dist(O);if(E+$>S){const K=(S-E)/$,te=Nn(L.x,O.x,K),de=Nn(L.y,O.y,K),be=new Rc(te,de,0,O.angleTo(L),P);return!_||Vp(o,be,b,_,e)?be:void 0}E+=$}}function $d(o,e,s,c,d,m,_,b,E){const S=Ud(c,m,_),P=jd(c,d),L=P*_,O=0===o[0].x||o[0].x===E||0===o[0].y||o[0].y===E;return e-L<e/4&&(e=L+e/4),Rg(o,O?e/2*b%e:(P/2+2*m)*_*b%e,e,S,s,L,O,!1,E)}function Rg(o,e,s,c,d,m,_,b,E){const S=m/2,P=Mg(o);let L=0,O=e-s,$=[];for(let K=0;K<o.length-1;K++){const te=o[K],de=o[K+1],be=te.dist(de),Ae=de.angleTo(te);for(;O+s<L+be;){O+=s;const Ne=(O-L)/be,Me=Nn(te.x,de.x,Ne),ze=Nn(te.y,de.y,Ne);if(Me>=0&&Me<E&&ze>=0&&ze<E&&O-S>=0&&O+S<=P){const $e=new Rc(Me,ze,0,Ae,K);$e._round(),c&&!Vp(o,$e,m,c,d)||$.push($e)}}L+=be}return b||$.length||_||($=Rg(o,L/2,s,c,d,m,_,!0,E)),$}function kg(o,e,s,c,d){const m=[];for(let _=0;_<o.length;_++){const b=o[_];let E;for(let S=0;S<b.length-1;S++){let P=b[S],L=b[S+1];P.x<e&&L.x<e||(P.x<e?P=new je(e,P.y+(e-P.x)/(L.x-P.x)*(L.y-P.y))._round():L.x<e&&(L=new je(e,P.y+(e-P.x)/(L.x-P.x)*(L.y-P.y))._round()),P.y<s&&L.y<s||(P.y<s?P=new je(P.x+(s-P.y)/(L.y-P.y)*(L.x-P.x),s)._round():L.y<s&&(L=new je(P.x+(s-P.y)/(L.y-P.y)*(L.x-P.x),s)._round()),P.x>=c&&L.x>=c||(P.x>=c?P=new je(c,P.y+(c-P.x)/(L.x-P.x)*(L.y-P.y))._round():L.x>=c&&(L=new je(c,P.y+(c-P.x)/(L.x-P.x)*(L.y-P.y))._round()),P.y>=d&&L.y>=d||(P.y>=d?P=new je(P.x+(d-P.y)/(L.y-P.y)*(L.x-P.x),d)._round():L.y>=d&&(L=new je(P.x+(d-P.y)/(L.y-P.y)*(L.x-P.x),d)._round()),E&&P.equals(E[E.length-1])||(E=[P],m.push(E)),E.push(L)))))}}return m}St("Anchor",Rc);const ch=1e20;function Fg(o,e,s,c,d,m,_,b,E){for(let S=e;S<e+c;S++)Lg(o,s*m+S,m,d,_,b,E);for(let S=s;S<s+d;S++)Lg(o,S*m+e,1,c,_,b,E)}function Lg(o,e,s,c,d,m,_){m[0]=0,_[0]=-ch,_[1]=ch,d[0]=o[e];for(let b=1,E=0,S=0;b<c;b++){d[b]=o[e+b*s];const P=b*b;do{const L=m[E];S=(d[b]-d[L]+P-L*L)/(b-L)/2}while(S<=_[E]&&--E>-1);E++,m[E]=b,_[E]=S,_[E+1]=ch}for(let b=0,E=0;b<c;b++){for(;_[E+1]<b;)E++;const S=m[E],P=b-S;o[e+b*s]=d[S]+P*P}}const Up={none:0,ideographs:1,all:2};class Su{constructor(e,s,c){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const c=[];for(const d in e)for(const m of e[d])c.push({stack:d,id:m});ni(c,({stack:d,id:m},_)=>{let b=this.entries[d];b||(b=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=b.glyphs[m];if(void 0!==E)return void _(null,{stack:d,id:m,glyph:E});if(E=this._tinySDF(b,d,m),E)return b.glyphs[m]=E,void _(null,{stack:d,id:m,glyph:E});const S=Math.floor(m/256);if(256*S>65535)return void _(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void _(null,{stack:d,id:m,glyph:E});let P=b.requests[S];P||(P=b.requests[S]=[],Su.loadGlyphRange(d,S,this.url,this.requestManager,(L,O)=>{if(O){b.ascender=O.ascender,b.descender=O.descender;for(const $ in O.glyphs)this._doesCharSupportLocalGlyph(+$)||(b.glyphs[+$]=O.glyphs[+$]);b.ranges[S]=!0}for(const $ of P)$(L,O);delete b.requests[S]})),P.push((L,O)=>{L?_(L):O&&_(null,{stack:d,id:m,glyph:O.glyphs[m]||null})})},(d,m)=>{if(d)s(d);else if(m){const _={};for(const{stack:b,id:E,glyph:S}of m)void 0===_[b]&&(_[b]={}),void 0===_[b].glyphs&&(_[b].glyphs={}),_[b].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},_[b].ascender=this.entries[b].ascender,_[b].descender=this.entries[b].descender;s(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Up.none&&(this.localGlyphMode===Up.all?!!this.localFontFamily:!!this.localFontFamily&&(Vl(e)||gs(e)||Ia(e)||Nl(e))||ms(e))}_tinySDF(e,s,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let m=e.tinySDF;if(!m){let te="400";/bold/i.test(s)?te="900":/medium/i.test(s)?te="500":/light/i.test(s)&&(te="200"),m=e.tinySDF=new Su.TinySDF({fontFamily:d,fontWeight:te,fontSize:48,buffer:6,radius:16}),m.fontWeight=te}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const _=String.fromCharCode(c),{data:b,width:E,height:S,glyphWidth:P,glyphHeight:L,glyphLeft:O,glyphTop:$,glyphAdvance:K}=m.draw(_);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new Wr({width:E,height:S},b),metrics:{width:P/2,height:L/2,left:O/2,top:$/2-27,advance:K/2,localGlyph:!0}}}}function Og(o,e,s,c){const d=[],m=o.image,_=m.pixelRatio,b=m.paddedRect.w-2,E=m.paddedRect.h-2,S=o.right-o.left,P=o.bottom-o.top,L=m.stretchX||[[0,b]],O=m.stretchY||[[0,E]],$=(tt,at)=>tt+at[1]-at[0],K=L.reduce($,0),te=O.reduce($,0),de=b-K,be=E-te;let Ae=0,Ne=K,Me=0,ze=te,$e=0,Ye=de,lt=0,dt=be;if(m.content&&c){const tt=m.content;Ae=Gd(L,0,tt[0]),Me=Gd(O,0,tt[1]),Ne=Gd(L,tt[0],tt[2]),ze=Gd(O,tt[1],tt[3]),$e=tt[0]-Ae,lt=tt[1]-Me,Ye=tt[2]-tt[0]-Ne,dt=tt[3]-tt[1]-ze}const xt=(tt,at,bt,rt)=>{const Yt=Hd(tt.stretch-Ae,Ne,S,o.left),At=sa(tt.fixed-$e,Ye,tt.stretch,K),Wn=Hd(at.stretch-Me,ze,P,o.top),en=sa(at.fixed-lt,dt,at.stretch,te),En=Hd(bt.stretch-Ae,Ne,S,o.left),Bt=sa(bt.fixed-$e,Ye,bt.stretch,K),tn=Hd(rt.stretch-Me,ze,P,o.top),Bn=sa(rt.fixed-lt,dt,rt.stretch,te),Ci=new je(Yt,Wn),Mr=new je(En,Wn),Di=new je(En,tn),Ti=new je(Yt,tn),Vr=new je(At/_,en/_),or=new je(Bt/_,Bn/_),sr=e*Math.PI/180;if(sr){const zi=Math.sin(sr),Si=Math.cos(sr),dr=[Si,-zi,zi,Si];Ci._matMult(dr),Mr._matMult(dr),Ti._matMult(dr),Di._matMult(dr)}const Ki=tt.stretch+tt.fixed,kr=at.stretch+at.fixed;return{tl:Ci,tr:Mr,bl:Ti,br:Di,tex:{x:m.paddedRect.x+1+Ki,y:m.paddedRect.y+1+kr,w:bt.stretch+bt.fixed-Ki,h:rt.stretch+rt.fixed-kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:or,minFontScaleX:Ye/_/S,minFontScaleY:dt/_/P,isSDF:s}};if(c&&(m.stretchX||m.stretchY)){const tt=Ng(L,de,K),at=Ng(O,be,te);for(let bt=0;bt<tt.length-1;bt++){const rt=tt[bt],Yt=tt[bt+1];for(let At=0;At<at.length-1;At++)d.push(xt(rt,at[At],Yt,at[At+1]))}}else d.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return d}function Gd(o,e,s){let c=0;for(const d of o)c+=Math.max(e,Math.min(s,d[1]))-Math.max(e,Math.min(s,d[0]));return c}function Ng(o,e,s){const c=[{fixed:-1,stretch:0}];for(const[d,m]of o){const _=c[c.length-1];c.push({fixed:d-_.stretch,stretch:_.stretch}),c.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return c.push({fixed:e+1,stretch:s}),c}function Hd(o,e,s,c){return o/e*s+c}function sa(o,e,s,c){return o-e*s/c}function qd(o,e,s,c){const d=e+o.positionedLines[c].lineOffset;return 0===c?s+d/2:s+(d+(e+o.positionedLines[c-1].lineOffset))/2}Su.loadGlyphRange=function(o,e,s,c,d){const m=256*e,_=m+255,b=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),ji.Glyphs);j(b,(E,S)=>{if(E)d(E);else if(S){const P={},L=new Xc(S).readFields(yn,{});for(const O of L.glyphs)P[O.id]=O;d(null,{glyphs:P,ascender:L.ascender,descender:L.descender})}})},Su.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:s=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=c,this.radius=s;const b=this.size=o+4*e,E=this._createCanvas(b),S=this.ctx=E.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${m} ${o}px ${d}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.floor(s),b=Math.min(this.size-this.buffer,Math.ceil(m-d)),E=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(c)),S=b+2*this.buffer,P=E+2*this.buffer,L=S*P,O=new Uint8ClampedArray(L),$={data:O,width:S,height:P,glyphWidth:b,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===b||0===E)return $;const{ctx:K,buffer:te,gridInner:de,gridOuter:be}=this;K.clearRect(te,te,b,E),K.fillText(o,te,te+_+1);const Ae=K.getImageData(te,te,b,E);be.fill(ch,0,L),de.fill(0,0,L);for(let Ne=0;Ne<E;Ne++)for(let Me=0;Me<b;Me++){const ze=Ae.data[4*(Ne*b+Me)+3]/255;if(0===ze)continue;const $e=(Ne+te)*S+Me+te;if(1===ze)be[$e]=0,de[$e]=ch;else{const Ye=.5-ze;be[$e]=Ye>0?Ye*Ye:0,de[$e]=Ye<0?Ye*Ye:0}}Fg(be,0,0,S,P,S,this.f,this.v,this.z),Fg(de,te,te,b,E,S,this.f,this.v,this.z);for(let Ne=0;Ne<L;Ne++){const Me=Math.sqrt(be[Ne])-Math.sqrt(de[Ne]);O[Ne]=Math.round(255-255*(Me/this.radius+this.cutoff))}return $}};class zg{constructor(e=[],s=jp){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:c}=this,d=s[e];for(;e>0;){const m=e-1>>1,_=s[m];if(c(d,_)>=0)break;s[e]=_,e=m}s[e]=d}_down(e){const{data:s,compare:c}=this,d=this.length>>1,m=s[e];for(;e<d;){let _=1+(e<<1),b=s[_];const E=_+1;if(E<this.length&&c(s[E],b)<0&&(_=E,b=s[E]),c(b,m)>=0)break;s[e]=b,e=_}s[e]=m}}function jp(o,e){return o<e?-1:o>e?1:0}function Zd(o,e=1,s=!1){let c=1/0,d=1/0,m=-1/0,_=-1/0;const b=o[0];for(let $=0;$<b.length;$++){const K=b[$];(!$||K.x<c)&&(c=K.x),(!$||K.y<d)&&(d=K.y),(!$||K.x>m)&&(m=K.x),(!$||K.y>_)&&(_=K.y)}const E=Math.min(m-c,_-d);let S=E/2;const P=new zg([],$p);if(0===E)return new je(c,d);for(let $=c;$<m;$+=E)for(let K=d;K<_;K+=E)P.push(new Yl($+S,K+S,S,o));let L=function($){let K=0,te=0,de=0;const be=$[0];for(let Ae=0,Ne=be.length,Me=Ne-1;Ae<Ne;Me=Ae++){const ze=be[Ae],$e=be[Me],Ye=ze.x*$e.y-$e.x*ze.y;te+=(ze.x+$e.x)*Ye,de+=(ze.y+$e.y)*Ye,K+=3*Ye}return new Yl(te/K,de/K,0,$)}(o),O=P.length;for(;P.length;){const $=P.pop();($.d>L.d||!L.d)&&(L=$,s&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,O)),$.max-L.d<=e||(S=$.h/2,P.push(new Yl($.p.x-S,$.p.y-S,S,o)),P.push(new Yl($.p.x+S,$.p.y-S,S,o)),P.push(new Yl($.p.x-S,$.p.y+S,S,o)),P.push(new Yl($.p.x+S,$.p.y+S,S,o)),O+=4)}return s&&(console.log(`num probes: ${O}`),console.log(`best distance: ${L.d}`)),L.p}function $p(o,e){return e.max-o.max}function Yl(o,e,s,c){this.p=new je(o,e),this.h=s,this.d=function(d,m){let _=!1,b=1/0;for(let E=0;E<m.length;E++){const S=m[E];for(let P=0,L=S.length,O=L-1;P<L;O=P++){const $=S[P],K=S[O];$.y>d.y!=K.y>d.y&&d.x<(K.x-$.x)*(d.y-$.y)/(K.y-$.y)+$.x&&(_=!_),b=Math.min(b,ld(d,$,K))}}return(_?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Wd=Number.POSITIVE_INFINITY,Xl=Math.sqrt(2);function Yd(o,e){return e[1]!==Wd?function(s,c,d){let m=0,_=0;switch(c=Math.abs(c),d=Math.abs(d),s){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(s){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(o,e[0],e[1]):function(s,c){let d=0,m=0;c<0&&(c=0);const _=c/Xl;switch(s){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(s){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=c;break;case"right":d=-c}return[d,m]}(o,e[0])}function Bg(o,e,s,c,d,m,_,b){o.createArrays(),o.tilePixelRatio=Qn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const E=o.layers[0].layout,S=o.layers[0]._unevaluatedLayout._values,P={};if("composite"===o.textSizeData.kind){const{minZoom:$,maxZoom:K}=o.textSizeData;P.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Y($),_),S["text-size"].possiblyEvaluate(new Y(K),_)]}if("composite"===o.iconSizeData.kind){const{minZoom:$,maxZoom:K}=o.iconSizeData;P.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Y($),_),S["icon-size"].possiblyEvaluate(new Y(K),_)]}P.layoutTextSize=S["text-size"].possiblyEvaluate(new Y(b+1),_),P.layoutIconSize=S["icon-size"].possiblyEvaluate(new Y(b+1),_),P.textMaxSize=S["text-size"].possiblyEvaluate(new Y(18),_);const L="map"===E.get("text-rotation-alignment")&&"point"!==E.get("symbol-placement"),O=E.get("text-size");for(const $ of o.features){const K=E.get("text-font").evaluate($,{},_).join(","),te=O.evaluate($,{},_),de=P.layoutTextSize.evaluate($,{},_),be=(P.layoutIconSize.evaluate($,{},_),{horizontal:{},vertical:void 0}),Ae=$.text;let Ne,Me=[0,0];if(Ae){const Ye=Ae.toString(),lt=24*E.get("text-letter-spacing").evaluate($,{},_),dt=24*E.get("text-line-height").evaluate($,{},_),xt=M(Ye)?lt:0,tt=E.get("text-anchor").evaluate($,{},_),at=E.get("text-variable-anchor");if(!at){const en=E.get("text-radial-offset").evaluate($,{},_);Me=en?Yd(tt,[24*en,Wd]):E.get("text-offset").evaluate($,{},_).map(En=>24*En)}let bt=L?"center":E.get("text-justify").evaluate($,{},_);const rt=E.get("symbol-placement"),Yt="point"===rt,At="point"===rt?24*E.get("text-max-width").evaluate($,{},_):0,Wn=en=>{o.allowVerticalPlacement&&al(Ye)&&(be.vertical=Eu(Ae,e,s,d,K,At,dt,tt,en,xt,Me,bs.vertical,!0,rt,de,te))};if(!L&&at){const en="auto"===bt?at.map(Bt=>Gp(Bt)):[bt];let En=!1;for(let Bt=0;Bt<en.length;Bt++){const tn=en[Bt];if(!be.horizontal[tn])if(En)be.horizontal[tn]=be.horizontal[0];else{const Bn=Eu(Ae,e,s,d,K,At,dt,"center",tn,xt,Me,bs.horizontal,!1,rt,de,te);Bn&&(be.horizontal[tn]=Bn,En=1===Bn.positionedLines.length)}}Wn("left")}else{if("auto"===bt&&(bt=Gp(tt)),Yt||E.get("text-writing-mode").indexOf("horizontal")>=0||!al(Ye)){const en=Eu(Ae,e,s,d,K,At,dt,tt,bt,xt,Me,bs.horizontal,!1,rt,de,te);en&&(be.horizontal[bt]=en)}Wn("point"===rt?"left":bt)}}let ze=!1;if($.icon&&$.icon.name){const Ye=c[$.icon.name];Ye&&(Ne=Ag(d[$.icon.name],E.get("icon-offset").evaluate($,{},_),E.get("icon-anchor").evaluate($,{},_)),ze=Ye.sdf,void 0===o.sdfIcons?o.sdfIcons=Ye.sdf:o.sdfIcons!==Ye.sdf&&er("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==o.pixelRatio||0!==E.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const $e=Hp(be.horizontal)||be.vertical;o.iconsInText||(o.iconsInText=!!$e&&$e.iconsInText),($e||Ne)&&Xd(o,$,be,Ne,c,P,de,0,Me,ze,_)}m&&o.generateCollisionDebugBuffers(b,o.collisionBoxArray)}function Gp(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xd(o,e,s,c,d,m,_,b,E,S,P){let L=m.textMaxSize.evaluate(e,{},P);void 0===L&&(L=_);const O=o.layers[0].layout,$=O.get("icon-offset").evaluate(e,{},P),K=Hp(s.horizontal)||s.vertical,te=_/24,de=o.tilePixelRatio*L/24,be=o.tilePixelRatio*O.get("symbol-spacing"),Ae=O.get("text-padding")*o.tilePixelRatio,Ne=O.get("icon-padding")*o.tilePixelRatio,Me=mt(O.get("text-max-angle")),ze="map"===O.get("text-rotation-alignment")&&"point"!==O.get("symbol-placement"),$e="map"===O.get("icon-rotation-alignment")&&"point"!==O.get("symbol-placement"),Ye=O.get("symbol-placement"),lt=be/2,dt=O.get("icon-text-fit");let xt;c&&"none"!==dt&&(o.allowVerticalPlacement&&s.vertical&&(xt=Vd(c,s.vertical,dt,O.get("icon-text-fit-padding"),$,te)),K&&(c=Vd(c,K,dt,O.get("icon-text-fit-padding"),$,te)));const tt=(at,bt)=>{bt.x<0||bt.x>=Qn||bt.y<0||bt.y>=Qn||function(rt,Yt,At,Wn,en,En,Bt,tn,Bn,Ci,Mr,Di,Ti,Vr,or,sr,Ki,kr,zi,Si,dr,No,Cr,br){const Fr=rt.addToLineVertexArray(Yt,Wn);let ao,Qi,ar,Jn,zo,ws,Vs,Es=0,Us=0,ja=0,wo=0,la=-1,nc=-1;const Cs={};let Lc=uu(""),hf=0,df=0;if(void 0===Bn._unevaluatedLayout.getValue("text-radial-offset")?[hf,df]=Bn.layout.get("text-offset").evaluate(dr,{},br).map(ts=>24*ts):(hf=24*Bn.layout.get("text-radial-offset").evaluate(dr,{},br),df=Wd),rt.allowVerticalPlacement&&en.vertical){const ts=en.vertical;if(or)ws=kc(ts),tn&&(Vs=kc(tn));else{const lo=Bn.layout.get("text-rotate").evaluate(dr,{},br)+90;ar=uh(Ci,At,Yt,Mr,Di,Ti,ts,Vr,lo,sr),tn&&(Jn=uh(Ci,At,Yt,Mr,Di,Ti,tn,kr,lo))}}if(En){const ts=Bn.layout.get("icon-rotate").evaluate(dr,{},br),lo="none"!==Bn.layout.get("icon-text-fit"),$a=Og(En,ts,Cr,lo),Ah=tn?Og(tn,ts,Cr,lo):void 0;Qi=uh(Ci,At,Yt,Mr,Di,Ti,En,kr,ts),Es=4*$a.length;const js=rt.iconSizeData;let ca=null;"source"===js.kind?(ca=[vs*Bn.layout.get("icon-size").evaluate(dr,{},br)],ca[0]>Kl&&er(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===js.kind&&(ca=[vs*No.compositeIconSizes[0].evaluate(dr,{},br),vs*No.compositeIconSizes[1].evaluate(dr,{},br)],(ca[0]>Kl||ca[1]>Kl)&&er(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,$a,ca,Si,zi,dr,!1,At,Yt,Fr.lineStartIndex,Fr.lineLength,-1,br),la=rt.icon.placedSymbolArray.length-1,Ah&&(Us=4*Ah.length,rt.addSymbols(rt.icon,Ah,ca,Si,zi,dr,bs.vertical,At,Yt,Fr.lineStartIndex,Fr.lineLength,-1,br),nc=rt.icon.placedSymbolArray.length-1)}for(const ts in en.horizontal){const lo=en.horizontal[ts];ao||(Lc=uu(lo.text),or?zo=kc(lo):ao=uh(Ci,At,Yt,Mr,Di,Ti,lo,Vr,Bn.layout.get("text-rotate").evaluate(dr,{},br),sr));const $a=1===lo.positionedLines.length;if(ja+=Kd(rt,At,Yt,lo,Bt,Bn,or,dr,sr,Fr,en.vertical?bs.horizontal:bs.horizontalOnly,$a?Object.keys(en.horizontal):[ts],Cs,la,No,br),$a)break}en.vertical&&(wo+=Kd(rt,At,Yt,en.vertical,Bt,Bn,or,dr,sr,Fr,bs.vertical,["vertical"],Cs,nc,No,br));let rc=-1;const ff=(ts,lo)=>ts?Math.max(ts,lo):lo;rc=ff(zo,rc),rc=ff(ws,rc),rc=ff(Vs,rc);const Wg=rc>-1?1:0;rt.glyphOffsetArray.length>=Ba.MAX_GLYPHS&&er("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==dr.sortKey&&rt.addToSortKeyRanges(rt.symbolInstances.length,dr.sortKey),rt.symbolInstances.emplaceBack(At.x,At.y,At.z,Yt.x,Yt.y,Cs.right>=0?Cs.right:-1,Cs.center>=0?Cs.center:-1,Cs.left>=0?Cs.left:-1,Cs.vertical>=0?Cs.vertical:-1,la,nc,Lc,void 0!==ao?ao:rt.collisionBoxArray.length,void 0!==ao?ao+1:rt.collisionBoxArray.length,void 0!==ar?ar:rt.collisionBoxArray.length,void 0!==ar?ar+1:rt.collisionBoxArray.length,void 0!==Qi?Qi:rt.collisionBoxArray.length,void 0!==Qi?Qi+1:rt.collisionBoxArray.length,Jn||rt.collisionBoxArray.length,Jn?Jn+1:rt.collisionBoxArray.length,Mr,ja,wo,Es,Us,Wg,0,hf,df,rc)}(o,bt,bt,at,s,c,d,xt,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Ae,ze,E,0,Ne,$e,$,e,m,S,P)};if("line"===Ye)for(const at of kg(e.geometry,0,0,Qn,Qn)){const bt=$d(at,be,Me,s.vertical||K,c,24,de,o.overscaling,Qn);for(const rt of bt){const Yt=K;Yt&&eu(o,Yt.text,lt,rt)||tt(at,rt)}}else if("line-center"===Ye){for(const at of e.geometry)if(at.length>1){const bt=Pg(at,Me,s.vertical||K,c,24,de);bt&&tt(at,bt)}}else if("Polygon"===e.type)for(const at of Zl(e.geometry,0)){const bt=Zd(at,16);tt(at[0],new Rc(bt.x,bt.y,0,0,void 0))}else if("LineString"===e.type)for(const at of e.geometry)tt(at,new Rc(at[0].x,at[0].y,0,0,void 0));else if("Point"===e.type)for(const at of e.geometry)for(const bt of at)tt([bt],new Rc(bt.x,bt.y,0,0,void 0))}const Kl=32640;function Kd(o,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te){const de=function(Ne,Me,ze,$e,Ye,lt,dt,xt){const tt=[];if(0===Me.positionedLines.length)return tt;const at=$e.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,bt=function(en){const En=en[0],Bt=en[1],tn=En*Bt;return tn>0?[En,-Bt]:tn<0?[-En,Bt]:0===En?[Bt,En]:[Bt,-En]}(ze);let rt=Math.abs(Me.top-Me.bottom);for(const en of Me.positionedLines)rt-=en.lineOffset;const Yt=Me.positionedLines.length,At=rt/Yt;let Wn=Me.top-ze[1];for(let en=0;en<Yt;++en){const En=Me.positionedLines[en];Wn=qd(Me,At,Wn,en);for(const Bt of En.positionedGlyphs){if(!Bt.rect)continue;const tn=Bt.rect||{};let Bn=4,Ci=!0,Mr=1,Di=0;if(Bt.imageName){const Jn=dt[Bt.imageName];if(!Jn)continue;if(Jn.sdf){er("SDF images are not supported in formatted text and will be ignored.");continue}Ci=!1,Mr=Jn.pixelRatio,Bn=1/Mr}const Ti=(Ye||xt)&&Bt.vertical,Vr=Bt.metrics.advance*Bt.scale/2,or=Bt.metrics,sr=Bt.rect;if(null===sr)continue;xt&&Me.verticalizable&&(Di=Bt.imageName?Vr-Bt.metrics.width*Bt.scale/2:0);const Ki=Ye?[Bt.x+Vr,Bt.y]:[0,0];let kr=[0,0],zi=[0,0],Si=!1;Ye||(Ti?(zi=[Bt.x+Vr+bt[0],Bt.y+bt[1]-Di],Si=!0):kr=[Bt.x+Vr+ze[0],Bt.y+ze[1]-Di]);const dr=sr.w*Bt.scale/(Mr*(Bt.localGlyph?2:1)),No=sr.h*Bt.scale/(Mr*(Bt.localGlyph?2:1));let Cr,br,Fr,ao;if(Ti){const Jn=Bt.y-Wn,zo=new je(-Vr,Vr-Jn),ws=-Math.PI/2,Vs=new je(...zi);Cr=new je(-Vr+kr[0],kr[1]),Cr._rotateAround(ws,zo)._add(Vs),Cr.x+=-Jn+Vr,Cr.y-=(or.left-Bn)*Bt.scale;const Es=Bt.imageName?or.advance*Bt.scale:24*Bt.scale,Us=String.fromCharCode(Bt.glyph);vg(Us)?Cr.x+=(1-Bn)*Bt.scale:Pp(Us)?Cr.x+=Es-or.height*Bt.scale+(-Bn-1)*Bt.scale:Cr.x+=Bt.imageName||or.width+2*Bn===sr.w&&or.height+2*Bn===sr.h?(Es-No)/2:(Es-(or.height+2*Bn)*Bt.scale)/2,br=new je(Cr.x,Cr.y-dr),Fr=new je(Cr.x+No,Cr.y),ao=new je(Cr.x+No,Cr.y-dr)}else{const Jn=(or.left-Bn)*Bt.scale-Vr+kr[0],zo=(-or.top-Bn)*Bt.scale+kr[1],ws=Jn+dr,Vs=zo+No;Cr=new je(Jn,zo),br=new je(ws,zo),Fr=new je(Jn,Vs),ao=new je(ws,Vs)}if(at){let Jn;Jn=Ye?new je(0,0):Si?new je(bt[0],bt[1]):new je(ze[0],ze[1]),Cr._rotateAround(at,Jn),br._rotateAround(at,Jn),Fr._rotateAround(at,Jn),ao._rotateAround(at,Jn)}const Qi=new je(0,0),ar=new je(0,0);tt.push({tl:Cr,tr:br,bl:Fr,br:ao,tex:tn,writingMode:Me.writingMode,glyphOffset:Ki,sectionIndex:Bt.sectionIndex,isSDF:Ci,pixelOffsetTL:Qi,pixelOffsetBR:ar,minFontScaleX:0,minFontScaleY:0})}}return tt}(0,c,E,m,_,b,d,o.allowVerticalPlacement),be=o.textSizeData;let Ae=null;"source"===be.kind?(Ae=[vs*m.layout.get("text-size").evaluate(b,{},te)],Ae[0]>Kl&&er(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===be.kind&&(Ae=[vs*K.compositeTextSizes[0].evaluate(b,{},te),vs*K.compositeTextSizes[1].evaluate(b,{},te)],(Ae[0]>Kl||Ae[1]>Kl)&&er(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,de,Ae,E,_,b,P,e,s,S.lineStartIndex,S.lineLength,$,te);for(const Ne of L)O[Ne]=o.text.placedSymbolArray.length-1;return 4*de.length}function Hp(o){for(const e in o)return o[e];return null}function uh(o,e,s,c,d,m,_,b,E,S){let P=_.top,L=_.bottom,O=_.left,$=_.right;const K=_.collisionPadding;if(K&&(O-=K[0],P-=K[1],$+=K[2],L+=K[3]),E){const te=new je(O,P),de=new je($,P),be=new je(O,L),Ae=new je($,L),Ne=mt(E);let Me=new je(0,0);S&&(Me=new je(S[0],S[1])),te._rotateAround(Ne,Me),de._rotateAround(Ne,Me),be._rotateAround(Ne,Me),Ae._rotateAround(Ne,Me),O=Math.min(te.x,de.x,be.x,Ae.x),$=Math.max(te.x,de.x,be.x,Ae.x),P=Math.min(te.y,de.y,be.y,Ae.y),L=Math.max(te.y,de.y,be.y,Ae.y)}return o.emplaceBack(e.x,e.y,e.z,s.x,s.y,O,P,$,L,b,c,d,m),o.length-1}function kc(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function eu(o,e,s,c){const d=o.compareText;if(e in d){const m=d[e];for(let _=m.length-1;_>=0;_--)if(c.dist(m[_])<s)return!0}else d[e]=[];return d[e].push(c),!1}const Qd=Ns.VectorTileFeature.types,tu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ql(o,e,s,c,d,m,_,b,E,S,P,L,O,$,K,te){const de=P?Math.min(Kl,Math.round(P[0])):0,be=P?Math.min(Kl,Math.round(P[1])):0;o.emplaceBack(e,s,Math.round(32*_),Math.round(32*b),E,S,(de<<1)+(L?1:0),be,16*O,16*$,256*K,256*te,c,d,m,0)}function Jl(o,e,s){o.emplaceBack(e.x,e.y,s),o.emplaceBack(e.x,e.y,s),o.emplaceBack(e.x,e.y,s),o.emplaceBack(e.x,e.y,s)}function Vg(o){for(const e of o.sections)if(h(e.text))return!0;return!1}class hh{constructor(e){this.layoutVertexArray=new io,this.indexArray=new cr,this.programConfigurations=e,this.segments=new ti,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new Qs,this.placedSymbolArray=new jl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,s,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,yg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,tu,!0),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}St("SymbolBuffers",hh);class dh{constructor(e,s,c){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ti,this.collisionVertexArray=new Js,this.collisionVertexArrayExt=new mn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ip.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ap.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}St("CollisionBuffers",dh);class Ba{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ep([]),this.placementViewportMatrix=ep([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yc(this.zoom,s["text-size"]),this.iconSizeData=Yc(this.zoom,s["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>bs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new hh(new Hl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new hh(new Hl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new wc,this.lineVertexArray=new Pa,this.symbolInstances=new Gm}calculateGlyphDependencies(e,s,c,d,m){for(let _=0;_<e.length;_++)if(s[e.charCodeAt(_)]=!0,d&&m){const b=hl[e.charAt(_)];b&&(s[b.charCodeAt(0)]=!0)}}populate(e,s,c){const d=this.layers[0],m=d.layout,_=m.get("text-font"),b=m.get("text-field"),E=m.get("icon-image"),S=("constant"!==b.value.kind||b.value.value instanceof Et&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),P="constant"!==E.value.kind||!!E.value.value||Object.keys(E.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!S&&!P)return;const O=s.iconDependencies,$=s.glyphDependencies,K=s.availableImages,te=new Y(this.zoom);for(const{feature:de,id:be,index:Ae,sourceLayerIndex:Ne}of e){const Me=d._featureFilter.needGeometry,ze=Dc(de,Me);if(!d._featureFilter.filter(te,ze,c))continue;let $e,Ye;if(Me||(ze.geometry=Cc(de)),S){const dt=d.getValueAndResolveTokens("text-field",ze,c,K),xt=Et.factory(dt);Vg(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===U()||this.hasRTLText&&q.isParsed())&&($e=Ld(xt,d,ze))}if(P){const dt=d.getValueAndResolveTokens("icon-image",ze,c,K);Ye=dt instanceof kn?dt:kn.fromString(dt)}if(!$e&&!Ye)continue;const lt=this.sortFeaturesByKey?L.evaluate(ze,{},c):void 0;if(this.features.push({id:be,text:$e,icon:Ye,index:Ae,sourceLayerIndex:Ne,geometry:ze.geometry,properties:de.properties,type:Qd[de.type],sortKey:lt}),Ye&&(O[Ye.name]=!0),$e){const dt=_.evaluate(ze,{},c).join(","),xt="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bs.vertical)>=0;for(const tt of $e.sections)if(tt.image)O[tt.image.name]=!0;else{const at=al($e.toString()),bt=tt.fontStack||dt,rt=$[bt]=$[bt]||{};this.calculateGlyphDependencies(tt.text,rt,xt,this.allowVerticalPlacement,at)}}}"line"===m.get("symbol-placement")&&(this.features=function(de){const be={},Ae={},Ne=[];let Me=0;function ze(dt){Ne.push(de[dt]),Me++}function $e(dt,xt,tt){const at=Ae[dt];return delete Ae[dt],Ae[xt]=at,Ne[at].geometry[0].pop(),Ne[at].geometry[0]=Ne[at].geometry[0].concat(tt[0]),at}function Ye(dt,xt,tt){const at=be[xt];return delete be[xt],be[dt]=at,Ne[at].geometry[0].shift(),Ne[at].geometry[0]=tt[0].concat(Ne[at].geometry[0]),at}function lt(dt,xt,tt){const at=tt?xt[0][xt[0].length-1]:xt[0][0];return`${dt}:${at.x}:${at.y}`}for(let dt=0;dt<de.length;dt++){const xt=de[dt],tt=xt.geometry,at=xt.text?xt.text.toString():null;if(!at){ze(dt);continue}const bt=lt(at,tt),rt=lt(at,tt,!0);if(bt in Ae&&rt in be&&Ae[bt]!==be[rt]){const Yt=Ye(bt,rt,tt),At=$e(bt,rt,Ne[Yt].geometry);delete be[bt],delete Ae[rt],Ae[lt(at,Ne[At].geometry,!0)]=At,Ne[Yt].geometry=null}else bt in Ae?$e(bt,rt,tt):rt in be?Ye(bt,rt,tt):(ze(dt),be[bt]=Me-1,Ae[rt]=Me-1)}return Ne.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,be)=>de.sortKey-be.sortKey)}update(e,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const c=this.lineVertexArray.length;if(void 0!==e.segment){let d=e.dist(s[e.segment+1]),m=e.dist(s[e.segment]);const _={};for(let b=e.segment+1;b<s.length;b++)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:d},b<s.length-1&&(d+=s[b+1].dist(s[b]));for(let b=e.segment||0;b>=0;b--)_[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=s[b-1].dist(s[b]));for(let b=0;b<s.length;b++){const E=_[b];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,s,c,d,m,_,b,E,S,P,L,O,$){const K=e.indexArray,te=e.layoutVertexArray,de=e.segments.prepareSegment(4*s.length,te,K,this.canOverlap?_.sortKey:void 0),be=this.glyphOffsetArray.length,Ae=de.vertexLength,Ne=this.allowVerticalPlacement&&b===bs.vertical?Math.PI/2:0,Me=_.text&&_.text.sections;for(let ze=0;ze<s.length;ze++){const{tl:$e,tr:Ye,bl:lt,br:dt,tex:xt,pixelOffsetTL:tt,pixelOffsetBR:at,minFontScaleX:bt,minFontScaleY:rt,glyphOffset:Yt,isSDF:At,sectionIndex:Wn}=s[ze],en=de.vertexLength,En=Yt[1];Ql(te,E.x,E.y,E.z,S.x,S.y,$e.x,En+$e.y,xt.x,xt.y,c,At,tt.x,tt.y,bt,rt),Ql(te,E.x,E.y,E.z,S.x,S.y,Ye.x,En+Ye.y,xt.x+xt.w,xt.y,c,At,at.x,tt.y,bt,rt),Ql(te,E.x,E.y,E.z,S.x,S.y,lt.x,En+lt.y,xt.x,xt.y+xt.h,c,At,tt.x,at.y,bt,rt),Ql(te,E.x,E.y,E.z,S.x,S.y,dt.x,En+dt.y,xt.x+xt.w,xt.y+xt.h,c,At,at.x,at.y,bt,rt),Jl(e.dynamicLayoutVertexArray,E,Ne),K.emplaceBack(en,en+1,en+2),K.emplaceBack(en+1,en+2,en+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),ze!==s.length-1&&Wn===s[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,_,_.index,{},$,Me&&Me[Wn])}e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,S.x,S.y,be,this.glyphOffsetArray.length-be,Ae,P,L,S.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],b,0,!1,0,O,0)}_commitLayoutVertex(e,s,c,d,m,_,b){e.emplaceBack(s,c,d,m,_,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,s,c,d,m,_,b){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=E.vertexLength,P=b.tileAnchorX,L=b.tileAnchorY;for(let $=0;$<4;$++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),c.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,P,L,new je(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,P,L,new je(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,P,L,new je(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,m,_,P,L,new je(e.x1,e.y2)),E.vertexLength+=4;const O=c.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,c,d,m,_){for(let b=d;b<m;b++){const E=c.get(b),S=this.getSymbolInstanceTextSize(e,_,s,b);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,s,c,d,m,_){for(let b=d;b<m;b++){const E=c.get(b),S=this.getSymbolInstanceIconSize(e,s,b);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dh(Yi,kd.members,Br),this.iconCollisionBox=new dh(Yi,kd.members,Br);const c=Wl(this.iconSizeData,e),d=Wl(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,s,c,d){const m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),_=wu(this.textSizeData,e,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,s,c){const d=this.icon.placedSymbolArray.get(c),m=wu(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,s,c){e.emplaceBack(s,-c,-c),e.emplaceBack(s,c,-c),e.emplaceBack(s,c,c),e.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(e,s,c,d,m,_){for(let b=d;b<m;b++){const E=c.get(b),S=this.getSymbolInstanceTextSize(e,_,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,E.padding)}}_updateIconDebugCollisionBoxes(e,s,c,d,m){for(let _=d;_<m;_++){const b=c.get(_),E=this.getSymbolInstanceIconSize(e,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Wl(this.iconSizeData,e),d=Wl(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(d,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,c,d,m,_,b,E,S){const P={};for(let L=s;L<c;L++){const O=e.get(L);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.textFeatureIndex=O.featureIndex;break}for(let L=d;L<m;L++){const O=e.get(L);P.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.verticalTextFeatureIndex=O.featureIndex;break}for(let L=_;L<b;L++){const O=e.get(L);P.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.iconFeatureIndex=O.featureIndex;break}for(let L=E;L<S;L++){const O=e.get(L);P.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.verticalIconFeatureIndex=O.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const c=e.placedSymbolArray.get(s),d=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(e),c=Math.cos(e),d=[],m=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const E=this.symbolInstances.get(b);d.push(0|Math.round(s*E.tileAnchorX+c*E.tileAnchorY)),m.push(E.featureIndex)}return _.sort((b,E)=>d[b]-d[E]||m[E]-m[b]),_}addToSortKeyRanges(e,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,m,_)=>{d>=0&&_.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}St("SymbolBucket",Ba,{omit:["layers","collisionBoxArray","features","compareText"]}),Ba.MAX_GLYPHS=65535,Ba.addDynamicAttributes=Jl;const Jd=new qe({"symbol-placement":new fe(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new fe(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fe(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fe(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new fe(ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new fe(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new fe(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fe(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(ve.layout_symbol["icon-size"]),"icon-text-fit":new fe(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fe(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(ve.layout_symbol["icon-image"]),"icon-rotate":new Fe(ve.layout_symbol["icon-rotate"]),"icon-padding":new fe(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new fe(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(ve.layout_symbol["icon-offset"]),"icon-anchor":new Fe(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fe(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fe(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fe(ve.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(ve.layout_symbol["text-field"]),"text-font":new Fe(ve.layout_symbol["text-font"]),"text-size":new Fe(ve.layout_symbol["text-size"]),"text-max-width":new Fe(ve.layout_symbol["text-max-width"]),"text-line-height":new Fe(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(ve.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(ve.layout_symbol["text-justify"]),"text-radial-offset":new Fe(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new fe(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(ve.layout_symbol["text-anchor"]),"text-max-angle":new fe(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new fe(ve.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(ve.layout_symbol["text-rotate"]),"text-padding":new fe(ve.layout_symbol["text-padding"]),"text-keep-upright":new fe(ve.layout_symbol["text-keep-upright"]),"text-transform":new Fe(ve.layout_symbol["text-transform"]),"text-offset":new Fe(ve.layout_symbol["text-offset"]),"text-allow-overlap":new fe(ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new fe(ve.layout_symbol["text-ignore-placement"]),"text-optional":new fe(ve.layout_symbol["text-optional"])});var fh={paint:new qe({"icon-opacity":new Fe(ve.paint_symbol["icon-opacity"]),"icon-color":new Fe(ve.paint_symbol["icon-color"]),"icon-halo-color":new Fe(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new fe(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new fe(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fe(ve.paint_symbol["text-opacity"]),"text-color":new Fe(ve.paint_symbol["text-color"],{runtimeType:on,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Fe(ve.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(ve.paint_symbol["text-halo-blur"]),"text-translate":new fe(ve.paint_symbol["text-translate"]),"text-translate-anchor":new fe(ve.paint_symbol["text-translate-anchor"])}),layout:Jd};class Iu{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Pi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St("FormatSectionOverride",Iu,{omit:["defaultValue"]});class ph extends na{constructor(e){super(e,fh)}recalculate(e,s){super.recalculate(e,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const m of c)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,c,d){const m=this.layout.get(e).evaluate(s,{},c,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||ga(_.value)||!m?m:(b=s.properties,m.replace(/{([^{}]+)}/g,(S,P)=>P in b?String(b[P]):""));var b}createBucket(e){return new Ba(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of fh.paint.overridableProperties){if(!ph.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),c=new Iu(s),d=new dc(c,s.property.specification);let m=null;m="constant"===s.value.kind||"source"===s.value.kind?new Sl("source",d):new Ho("composite",d,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new xe(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&ph.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const c=e.get("text-field"),d=fh.paint.properties[s];let m=!1;const _=b=>{for(const E of b)if(d.overrides&&d.overrides.hasOverride(E))return void(m=!0)};if("constant"===c.value.kind&&c.value.value instanceof Et)_(c.value.value.sections);else if("source"===c.value.kind){const b=S=>{m||(S instanceof li&&lr(S.value)===Ri?_(S.value.sections):S instanceof ci?_(S.sections):S.eachChild(b))},E=c.value;E._styleExpression&&b(E._styleExpression.expression)}return m}getProgramConfiguration(e){return new ta(this,e)}}var qp={paint:new qe({"background-color":new fe(ve.paint_background["background-color"]),"background-pattern":new st(ve.paint_background["background-pattern"]),"background-opacity":new fe(ve.paint_background["background-opacity"])})},Sy={paint:new qe({"raster-opacity":new fe(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new fe(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fe(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fe(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new fe(ve.paint_raster["raster-saturation"]),"raster-contrast":new fe(ve.paint_raster["raster-contrast"]),"raster-resampling":new fe(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new fe(ve.paint_raster["raster-fade-duration"])})};class Zp extends na{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Wp={paint:new qe({"sky-type":new fe(ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new fe(ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new fe(ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new fe(ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new fe(ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new Re(ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new fe(ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new fe(ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new fe(ve.paint_sky["sky-opacity"])})};function ef(o,e,s){const c=Zc(0,0,1),d=rp(_d());return function(m,_,b){b*=.5;var E=_[0],S=_[1],P=_[2],L=_[3],O=Math.sin(b),$=Math.cos(b);m[0]=E*$-P*O,m[1]=S*$+L*O,m[2]=P*$+E*O,m[3]=L*$-S*O}(d,d,s?-mt(o)+Math.PI:mt(o)),ip(d,d,-mt(e)),np(c,c,d),Wu(c,c)}const Yp={circle:class extends na{constructor(o){super(o,dd)}createBucket(o){return new qu(o)}queryRadius(o){const e=o;return Sc("circle-radius",this,e)+Sc("circle-stroke-width",this,e)+ud(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,s,c,d,m,_,b){const E=Jm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return op(o,c,m,_,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new ta(this,o)}},heatmap:class extends na{createBucket(o){return new xo(o)}constructor(o){super(o,vd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Sc("heatmap-radius",this,o)}queryIntersectsFeature(o,e,s,c,d,m,_,b){const E=this.paint.get("heatmap-radius").evaluate(e,s);return op(o,c,m,_,b,!0,!0,new je(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new ta(this,o)}},hillshade:class extends na{constructor(o){super(o,sg)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(o){return new ta(this,o)}},fill:class extends na{constructor(o){super(o,Oa)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new ta(this,o)}recalculate(o,e){super.recalculate(o,e);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new th(o)}queryRadius(){return ud(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,s,c,d,m){return!o.queryGeometry.isAboveHorizon&&Kf(Qm(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends na{constructor(o){super(o,mg)}createBucket(o){return new Id(o)}queryRadius(){return ud(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new ta(this,o)}queryIntersectsFeature(o,e,s,c,d,m,_,b,E){const S=Jm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,s),L=this.paint.get("fill-extrusion-base").evaluate(e,s),O=[0,0],$=b&&m.elevation,K=m.elevation?m.elevation.exaggeration():1;if($){const be=o.tile.getBucket(this).centroidVertexArray,Ae=E+1;if(Ae<be.length){const Ne=be.get(Ae);O[0]=Ne.a_centroid_pos0,O[1]=Ne.a_centroid_pos1}}if(0===O[0]&&1===O[1])return!1;const te=(be=c,Ae=L,Ne=P,Me=S,ze=_,($e=$?b:null)?function(xt,tt,at,bt,rt,Yt,At,Wn,en){const En=[],Bt=[],tn=[0,0,0,1];for(const Bn of xt){const Ci=[],Mr=[];for(const Di of Bn){const Ti=Di.x+bt.x,Vr=Di.y+bt.y,or=Cp(Ti,Vr,tt,at,Yt,At,Wn,en);tn[0]=Ti,tn[1]=Vr,tn[2]=or.base,tn[3]=1,Wc(tn,tn,rt),tn[3]=Math.max(tn[3],1e-5);const sr=Ep([tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]]);tn[0]=Ti,tn[1]=Vr,tn[2]=or.top,tn[3]=1,Wc(tn,tn,rt),tn[3]=Math.max(tn[3],1e-5);const Ki=Ep([tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]]);Ci.push(sr),Mr.push(Ki)}En.push(Ci),Bt.push(Mr)}return[En,Bt]}(be,Ae,Ne,Me,ze,$e,O,K,m.center.lat):function(xt,tt,at,bt,rt){const Yt=[],At=[],Wn=rt[8]*tt,en=rt[9]*tt,En=rt[10]*tt,Bt=rt[11]*tt,tn=rt[8]*at,Bn=rt[9]*at,Ci=rt[10]*at,Mr=rt[11]*at;for(const Di of xt){const Ti=[],Vr=[];for(const or of Di){const sr=or.x+bt.x,Ki=or.y+bt.y,kr=rt[0]*sr+rt[4]*Ki+rt[12],zi=rt[1]*sr+rt[5]*Ki+rt[13],Si=rt[2]*sr+rt[6]*Ki+rt[14],dr=rt[3]*sr+rt[7]*Ki+rt[15],No=kr+Wn,Cr=zi+en,br=Si+En,Fr=Math.max(dr+Bt,1e-5),ao=kr+tn,Qi=zi+Bn,ar=Si+Ci,Jn=Math.max(dr+Mr,1e-5),zo=new je(No/Fr,Cr/Fr);zo.z=br/Fr,Ti.push(zo);const ws=new je(ao/Jn,Qi/Jn);ws.z=ar/Jn,Vr.push(ws)}Yt.push(Ti),At.push(Vr)}return[Yt,At]}(be,Ae,Ne,Me,ze)),de=o.queryGeometry;var be,Ae,Ne,Me,ze,$e;return function(be,Ae,Ne){let Me=1/0;Kf(Ne,Ae)&&(Me=wp(Ne,Ae[0]));for(let ze=0;ze<Ae.length;ze++){const $e=Ae[ze],Ye=be[ze];for(let lt=0;lt<$e.length-1;lt++){const dt=$e[lt],xt=[dt,$e[lt+1],Ye[lt+1],Ye[lt],dt];Xf(Ne,xt)&&(Me=Math.min(Me,wp(Ne,xt)))}}return Me!==1/0&&Me}(te[0],te[1],de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends na{constructor(o){super(o,Pd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof As,this.gradientVersion=(this.gradientVersion+1)%He}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=Rd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new oh(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new ta(this,o)}queryRadius(o){const e=o,s=Sp(Sc("line-width",this,e),Sc("line-gap-width",this,e)),c=Sc("line-offset",this,e);return s/2+Math.abs(c)+ud(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,s,c,d,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=Qm(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*Sp(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),E=this.paint.get("line-offset").evaluate(e,s);return E&&(c=function(S,P){const L=[],O=new je(0,0);for(let $=0;$<S.length;$++){const K=S[$],te=[];for(let de=0;de<K.length;de++){const be=K[de-1],Ae=K[de],Ne=K[de+1],Me=0===de?O:Ae.sub(be)._unit()._perp(),ze=de===K.length-1?O:Ne.sub(Ae)._unit()._perp(),$e=Me._add(ze)._unit();$e._mult(1/($e.x*ze.x+$e.y*ze.y)),te.push($e._mult(P)._add(Ae))}L.push(te)}return L}(c,E*o.pixelToTileUnitsFactor)),function(S,P,L){for(let O=0;O<P.length;O++){const $=P[O];if(S.length>=3)for(let K=0;K<$.length;K++)if(Fa(S,$[K]))return!0;if(Xm(S,$,L))return!0}return!1}(_,c,b)}isTileClipped(){return!0}},symbol:ph,background:class extends na{constructor(o){super(o,qp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends na{constructor(o){super(o,Sy)}getProgramIds(){return["raster"]}},sky:class extends na{constructor(o){super(o,Wp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=xd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(o,e){const s=this.paint.get("sky-type");if("atmosphere"===s){const c=this.paint.get("sky-atmosphere-sun"),d=!c,m=o.style.light,_=m.properties.get("position");return d&&"viewport"===m.properties.get("anchor")&&er("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?ef(_.azimuthal,90-_.polar,e):ef(c[0],90-c[1],e)}if("gradient"===s){const c=this.paint.get("sky-gradient-center");return ef(c[0],90-c[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}},{HTMLImageElement:Xp,HTMLCanvasElement:Kp,HTMLVideoElement:es,ImageData:Qp,ImageBitmap:mh}=Te;class tf{constructor(e,s,c,d){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,c){const{width:d,height:m}=e,_=!(this.size&&this.size[0]===d&&this.size[1]===m||c),{context:b}=this,{gl:E}=b;if(this.useMipmap=Boolean(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||!1!==s.premultiply)),_)this.size=[d,m],e instanceof Xp||e instanceof Kp||e instanceof es||e instanceof Qp||mh&&e instanceof mh?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,d,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:S,y:P}=c||{x:0,y:0};e instanceof Xp||e instanceof Kp||e instanceof es||e instanceof Qp||mh&&e instanceof mh?E.texSubImage2D(E.TEXTURE_2D,0,S,P,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,S,P,d,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,s,c){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||e),this.filter=e),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class nu{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}extend(e){const s=this._sw,c=this._ne;let d,m;if(e instanceof Xr)d=e,m=e;else{if(!(e instanceof nu))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(nu.convert(e)):this.extend(Xr.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return s||c?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new Xr(d.lng,d.lat),this._ne=new Xr(m.lng,m.lat)),this}getCenter(){return new Xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xr(this.getWest(),this.getNorth())}getSouthEast(){return new Xr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:c}=Xr.convert(e);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(e){return!e||e instanceof nu?e:new nu(e)}}const nf=6371008.8;class Xr{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xr(Dt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,c=this.lat*s,d=e.lat*s,m=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((e.lng-this.lng)*s);return nf*Math.acos(Math.min(m,1))}toBounds(e=0){const s=360*e/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new nu(new Xr(this.lng-c,this.lat-s),new Xr(this.lng+c,this.lat+s))}static convert(e){if(e instanceof Xr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Xr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Xr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Jp=2*Math.PI*nf;function gh(o){return Jp*Math.cos(o*Math.PI/180)}function rf(o){return(180+o)/360}function em(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function of(o,e){return o/gh(e)}function _h(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function yh(o,e){return o*gh(_h(e))}class ru{constructor(e,s,c=0){this.x=+e,this.y=+s,this.z=+c}static fromLngLat(e,s=0){const c=Xr.convert(e);return new ru(rf(c.lng),em(c.lat),of(s,c.lat))}toLngLat(){return new Xr(360*this.x-180,_h(this.y))}toAltitude(){return yh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jp*(e=_h(this.y),1/Math.cos(e*Math.PI/180));var e}}class vh{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Wr({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const c=this.getKey(e,s);return this.positions[c]}trim(){const e=this.width,s=this.height=_n(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,c){const d=[];let m=e.length%2==1?-e[e.length-1]*c:0,_=e[0]*c,b=!0;d.push({left:m,right:_,isDash:b,zeroLength:0===e[0]});let E=e[0];for(let S=1;S<e.length;S++){b=!b;const P=e[S];m=E*c,E+=P,_=E*c,d.push({left:m,right:_,isDash:b,zeroLength:0===P})}return d}addRoundDash(e,s,c){const d=s/2;for(let m=-c;m<=c;m++){const _=this.width*(this.nextRow+c+m);let b=0,E=e[b];for(let S=0;S<this.width;S++){S/E.right>1&&(E=e[++b]);const P=Math.abs(S-E.left),L=Math.abs(S-E.right),O=Math.min(P,L);let $;const K=m/c*(d+1);if(E.isDash){const te=d-Math.abs(K);$=Math.sqrt(O*O+te*te)}else $=d-Math.sqrt(O*O+K*K);this.image.data[_+S]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e,s){for(let E=e.length-1;E>=0;--E){const S=e[E],P=e[E+1];S.zeroLength?e.splice(E,1):P&&P.isDash===S.isDash&&(P.left=S.left,e.splice(E,1))}const c=e[0],d=e[e.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const m=this.width*this.nextRow;let _=0,b=e[_];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++_]);const S=Math.abs(E-b.left),P=Math.abs(E-b.right),L=Math.min(S,P);this.image.data[m+E]=Math.max(0,Math.min(255,(b.isDash?L:-L)+s+128))}}addDash(e,s){const c=this.getKey(e,s);if(this.positions[c])return this.positions[c];const d="round"===s,m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return er("LineAtlas out of space"),null;0===e.length&&e.push(1);let b=0;for(let P=0;P<e.length;P++)e[P]<0&&(er("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),b+=e[P];if(0!==b){const P=this.width/b,L=this.getDashRanges(e,this.width,P);d?this.addRoundDash(L,P,m):this.addRegularDash(L,"square"===s?.5*P:0)}const E=this.nextRow+m;this.nextRow+=_;const S={tl:[E,m],br:[b,0]};return this.positions[c]=S,S}}St("LineAtlas",vh);class Ug{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const jg=Te.performance;function sf(o){const e=o?o.url.toString():void 0;return jg.getEntriesByName(e)}class tm{constructor(){this.tasks={},this.taskQueue=[],Hn(["process"],this),this.invoker=new Ug(this.process),this.nextId=0}add(e,s){const c=this.nextId++,d=function({type:m,isSymbolTile:_,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-b:"maybePrepare"===m&&_?400-b:500:200-b:100-b}(s);if(0===d){Ji();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:e,metadata:s,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Ji();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<s&&(s=m.priority,e=d)}if(null===e)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}function nm(o,e,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class zs{constructor(e,s,c){this.z=e,this.x=s,this.y=c,this.key=Au(0,e,e,s,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const c=(m=this.y,_=this.z,b=nm(256*(d=this.x),256*(m=Math.pow(2,_)-m-1),_),E=nm(256*(d+1),256*(m+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]);var d,m,_,b,E;const S=function(P,L,O){let $,K="";for(let te=P;te>0;te--)$=1<<te-1,K+=(L&$?1:0)+(O&$?2:0);return K}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",S).replace("{bbox-epsg-3857}",c)}getTilePoint(e){const s=Math.pow(2,this.z);return new je((e.x*s-this.x)*Qn,(e.y*s-this.y)*Qn)}getTileVec3(e){const s=Math.pow(2,this.z);return Zc((e.x*s-this.x)*Qn,(e.y*s-this.y)*Qn,yh(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class xh{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Au(e,s.z,s.z,s.x,s.y)}}class Oo{constructor(e,s,c,d,m){this.overscaledZ=e,this.wrap=s,this.canonical=new zs(c,+d,+m),this.key=0===s&&e===c?this.canonical.key:Au(s,e,c,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new Oo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oo(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Au(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return Au(this.wrap*+s,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Oo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Oo(s,this.wrap,s,c,d),new Oo(s,this.wrap,s,c+1,d),new Oo(s,this.wrap,s,c,d+1),new Oo(s,this.wrap,s,c+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Oo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Oo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ru(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new ru(e.x-this.wrap,e.y,e.z))}}function Au(o,e,s,c,d){const m=1<<Math.min(s,22);let _=m*(d%m)+c%m;return o&&s<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*_+s)+(e-s)}St("CanonicalTileID",zs),St("OverscaledTileID",Oo,{omit:["projMatrix"]});class $g{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const c=e[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class af{constructor(e,s,c,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=c,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(e[s]=this[s]);return e}}var Gg=Mt([{name:"a_pos",type:"Int16",components:2}]);class rm{constructor(e,s,c){this.tileID=e,this.uid=Bi(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<an.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,m){const _={};if(!m)return _;for(const b of d){const E=b.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(0!==E.length){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>E.filter(P=>P.id===S)[0]));for(const S of E)_[S.id]=b}}return _}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof Ba){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof Ba&&m.hasRTLText){this.hasRTLText=!0,q.isLoading()||q.isLoaded()||"deferred"!==U()||H();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ys}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tf(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tf(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new tf(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,c,d,m,_,b,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:b,transform:_,params:m},e,s,c):{}}querySourceFeatures(e,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),m=s?s.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const b=ya(s&&s.filter),{z:E,x:S,y:P}=this.tileID.canonical,L={z:E,x:S,y:P};for(let O=0;O<_.length;O++){const $=_.feature(O);if(b.needGeometry){const de=Dc($,!0);if(!b.filter(new Y(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!b.filter(new Y(this.tileID.overscaledZ),$))continue;const K=c.getId($,m),te=new af($,E,S,P,K);te.tile=L,e.push(te)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const c=ho(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const m=this.expirationTime-s;m?this.expirationTime=c+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const m=this.buckets[d],_=m.layers[0].sourceLayer||"_geojsonTileLayer",b=c[_],E=e[_];if(!b||!E||0===Object.keys(E).length)continue;m.update(E,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=s&&s.style&&s.style.getLayer(d);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<an.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=an.now()+e}setDependencies(e,s){const c={};for(const d of s)c[d]=!0;this.dependencies[e]=c}hasDependency(e,s){for(const c of e){const d=this.dependencies[c];if(d)for(const m of s)if(d[m])return!0}return!1}clearQueryDebugViz(){}}class Hg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,c){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},Tn(this.stateChanges[e][d],c),null===this.deletedStates[e]){this.deletedStates[e]={};for(const m in this.state[e])m!==d&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][d]){this.deletedStates[e][d]={};for(const m in this.state[e][d])c[m]||(this.deletedStates[e][d][m]=null)}else for(const m in c)this.deletedStates[e]&&this.deletedStates[e][d]&&null===this.deletedStates[e][d][m]&&delete this.deletedStates[e][d][m]}removeFeatureState(e,s,c){if(null===this.deletedStates[e])return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&void 0!==s)null!==this.deletedStates[e][d]&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][c]=null);else if(void 0!==s)if(this.stateChanges[e]&&this.stateChanges[e][d])for(c in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][c]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const c=String(s),d=Tn({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const m=this.deletedStates[e][s];if(null===m)return{};for(const _ in m)delete d[_]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),Tn(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];c[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(null===this.deletedStates[d])for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(null===this.deletedStates[d][_])this.state[d][_]={};else for(const b of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][b];m[_]=this.state[d][_]}c[d]=c[d]||{},Tn(c[d],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const d in e)e[d].setFeatureState(c,s)}}class bh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const c=this.toIdx(e,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function im(o,e,s,c){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(s[_]<o[_]||s[_]>e[_])return null}else{const b=1/c[_];let E=(o[_]-s[_])*b,S=(e[_]-s[_])*b;if(E>S){const P=E;E=S,S=P}if(E>d&&(d=E),S<m&&(m=S),d>m)return null}return d}function om(o,e,s,c,d,m,_,b,E,S,P){const L=c-o,O=d-e,$=m-s,K=_-o,te=b-e,de=E-s,be=P[1]*de-P[2]*te,Ae=P[2]*K-P[0]*de,Ne=P[0]*te-P[1]*K,Me=L*be+O*Ae+$*Ne;if(Math.abs(Me)<1e-15)return null;const ze=1/Me,$e=S[0]-o,Ye=S[1]-e,lt=S[2]-s,dt=($e*be+Ye*Ae+lt*Ne)*ze;if(dt<0||dt>1)return null;const xt=Ye*$-lt*O,tt=lt*L-$e*$,at=$e*O-Ye*L,bt=(P[0]*xt+P[1]*tt+P[2]*at)*ze;return bt<0||dt+bt>1?null:(K*xt+te*tt+de*at)*ze}function Mu(o,e,s){return(o-e)/(s-e)}function wh(o,e,s,c,d,m,_,b,E){const S=1<<s,P=m-c,L=_-d,O=(o+1)/S*P+c,$=(e+0)/S*L+d,K=(e+1)/S*L+d;b[0]=(o+0)/S*P+c,b[1]=$,E[0]=O,E[1]=K}class sm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(m){const _=Math.ceil(Math.log2(m.dim/8)),b=[];let E=Math.ceil(Math.pow(2,_));const S=1/E,P=($,K,te,de,be)=>{const Ae=de?1:0,Ne=($+1)*te-Ae,Me=K*te,ze=(K+1)*te-Ae;be[0]=$*te,be[1]=Me,be[2]=Ne,be[3]=ze};let L=new bh(E);const O=[];for(let $=0;$<E*E;$++){P($%E,Math.floor($/E),S,!1,O);const K=Va(O[0],O[1],m),te=Va(O[2],O[1],m),de=Va(O[2],O[3],m),be=Va(O[0],O[3],m);L.minimums.push(Math.min(K,te,de,be)),L.maximums.push(Math.max(K,te,de,be)),L.leaves.push(1)}for(b.push(L),E/=2;E>=1;E/=2){const $=b[b.length-1];L=new bh(E);for(let K=0;K<E*E;K++){P(K%E,Math.floor(K/E),2,!0,O);const te=$.getElevation(O[0],O[1]),de=$.getElevation(O[2],O[1]),be=$.getElevation(O[2],O[3]),Ae=$.getElevation(O[0],O[3]),Ne=$.isLeaf(O[0],O[1]),Me=$.isLeaf(O[2],O[1]),ze=$.isLeaf(O[2],O[3]),$e=$.isLeaf(O[0],O[3]),Ye=Math.min(te.min,de.min,be.min,Ae.min),lt=Math.max(te.max,de.max,be.max,Ae.max),dt=Ne&&Me&&ze&&$e;L.maximums.push(lt),L.minimums.push(Ye),L.leaves.push(lt-Ye<=5&&dt?1:0)}b.push(L)}return b}(this.dem),c=s.length-1,d=s[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(e,s,c,d,m,_,b=1){return im([e,s,-100],[c,d,this.maximums[0]*b],m,_)}raycast(e,s,c,d,m,_,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,s,c,d,m,_,b);if(null==E)return null;const S=[],P=[],L=[],O=[],$=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:K,t:te,nodex:de,nodey:be,depth:Ae}=$.pop();if(this.leaves[K]){wh(de,be,Ae,e,s,c,d,L,O);const Me=1<<Ae,ze=(de+0)/Me,$e=(de+1)/Me,Ye=(be+0)/Me,lt=(be+1)/Me,dt=Va(ze,Ye,this.dem)*b,xt=Va($e,Ye,this.dem)*b,tt=Va($e,lt,this.dem)*b,at=Va(ze,lt,this.dem)*b,bt=om(L[0],L[1],dt,O[0],L[1],xt,O[0],O[1],tt,m,_),rt=om(O[0],O[1],tt,L[0],O[1],at,L[0],L[1],dt,m,_),Yt=Math.min(null!==bt?bt:Number.MAX_VALUE,null!==rt?rt:Number.MAX_VALUE);if(Yt!==Number.MAX_VALUE)return Yt;{const At=md([],m,_,te);if(Eh(dt,xt,at,tt,Mu(At[0],L[0],O[0]),Mu(At[1],L[1],O[1]))>=At[2])return te}continue}let Ne=0;for(let Me=0;Me<this._siblingOffset.length;Me++){wh((de<<1)+this._siblingOffset[Me][0],(be<<1)+this._siblingOffset[Me][1],Ae+1,e,s,c,d,L,O),L[2]=-100,O[2]=this.maximums[this.childOffsets[K]+Me]*b;const ze=im(L,O,m,_);if(null!=ze){const $e=ze;S[Me]=$e;let Ye=!1;for(let lt=0;lt<Ne&&!Ye;lt++)$e>=S[P[lt]]&&(P.splice(lt,0,Me),Ye=!0);Ye||(P[Ne]=Me),Ne++}}for(let Me=0;Me<Ne;Me++){const ze=P[Me];$.push({idx:this.childOffsets[K]+ze,t:S[ze],nodex:(de<<1)+this._siblingOffset[ze][0],nodey:(be<<1)+this._siblingOffset[ze][1],depth:Ae+1})}}return null}_addNode(e,s,c){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,c,d,m){if(1===e[d].isLeaf(s,c))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,b=e[_];let E,S=0;for(let P=0;P<this._siblingOffset.length;P++){const L=2*s+this._siblingOffset[P][0],O=2*c+this._siblingOffset[P][1],$=b.getElevation(L,O),K=b.isLeaf(L,O),te=this._addNode($.min,$.max,K);K&&(S|=1<<P),E||(E=te)}for(let P=0;P<this._siblingOffset.length;P++)S&1<<P||this._construct(e,2*s+this._siblingOffset[P][0],2*c+this._siblingOffset[P][1],_,E+P)}}function Eh(o,e,s,c,d,m){return Nn(Nn(o,s,m),Nn(e,c,m),d)}function Va(o,e,s){const c=s.dim,d=zt(o*c-.5,0,c-1),m=zt(e*c-.5,0,c-1),_=Math.floor(d),b=Math.floor(m),E=Math.min(_+1,c-1),S=Math.min(b+1,c-1);return Eh(s.get(_,b),s.get(E,b),s.get(_,S),s.get(E,S),d-_,m-b)}const lf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ch{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,c,d=!1,m=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return er(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let b=0;b<_;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(_,b)]=this.data[this._idx(_-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,_)]=this.data[this._idx(b,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new sm(this)}get(e,s,c=!1){const d=new Uint8Array(this.data.buffer);c&&(e=zt(e,-1,this.dim),s=zt(s,-1,this.dim));const m=4*this._idx(e,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(d[m],d[m+1],d[m+2])}static getUnpackVector(e){return lf[e]}get unpackVector(){return lf[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,c){return(256*e*256+256*s+c)/10-1e4}_unpackTerrarium(e,s,c){return 256*e+s+c/256-32768}static pack(e,s){const c=[0,0,0,0],d=Ch.getUnpackVector(s);let m=Math.floor((e+d[3])/d[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new so({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,m=s*this.dim+this.dim,_=c*this.dim,b=c*this.dim+this.dim;switch(s){case-1:d=m-1;break;case 1:m=d+1}switch(c){case-1:_=b-1;break;case 1:b=_+1}const E=-s*this.dim,S=-c*this.dim;for(let P=_;P<b;P++)for(let L=d;L<m;L++)this.data[this._idx(L,P)]=e.data[this._idx(L+E,P+S)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}St("DEMData",Ch),St("DemMinMaxQuadTree",sm,{omit:["dem"]});class qg{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,c){const d=e.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const m={value:s,timeout:void 0};if(void 0!==c&&(m.timeout=setTimeout(()=>{this.remove(e,m)},c)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const c=e.wrapped().key,d=void 0===s?0:this.data[c].indexOf(s),m=this.data[c][d];return this.data[c].splice(d,1),m.timeout&&clearTimeout(m.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const c in this.data)for(const d of this.data[c])e(d.value)||s.push(d);for(const c of s)this.remove(c.value.tileID,c)}}class ec{constructor(e,s,c){this.func=e,this.mask=s,this.range=c}}ec.ReadOnly=!1,ec.ReadWrite=!0,ec.disabled=new ec(519,ec.ReadOnly,[0,1]);class cf{constructor(e,s,c,d,m,_){this.test=e,this.ref=s,this.mask=c,this.fail=d,this.depthFail=m,this.pass=_}}cf.disabled=new cf({func:519,mask:0},0,0,7680,7680,7680);class aa{constructor(e,s,c){this.blendFunction=e,this.blendColor=s,this.mask=c}}aa.Replace=[1,0],aa.disabled=new aa(aa.Replace,De.transparent,[!1,!1,!1,!1]),aa.unblended=new aa(aa.Replace,De.transparent,[!0,!0,!0,!0]),aa.alphaBlended=new aa([1,771],De.transparent,[!0,!0,!0,!0]);class Bs{constructor(e,s,c){this.enable=e,this.mode=s,this.frontFace=c}}Bs.disabled=new Bs(!1,1029,2305),Bs.backCCW=new Bs(!0,1029,2305),Bs.backCW=new Bs(!0,1029,2304),Bs.frontCW=new Bs(!0,1028,2304),Bs.frontCCW=new Bs(!0,1028,2305);class tc extends kt{constructor(e,s,c){super(),this.id=e,this._onlySymbols=c,s.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new qg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Hg}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Kr(this._tiles).map(e=>e.tileID).sort(Ua).map(e=>e.key)}getRenderableIds(e){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,e)&&s.push(this._tiles[c]);return e?s.sort((c,d)=>{const m=c.tileID,_=d.tileID,b=new je(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new je(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||E.y-b.y||E.x-b.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Ua).map(c=>c.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const c=this._tiles[e];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,e,s)))}_tileLoaded(e,s,c,d){if(d)return e.state="errored",void(404!==d.status?this._source.fire(new Ue(d,{tile:e})):this.update(this.transform));e.timeAdded=an.now(),"expired"===c&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ut("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const m=s[d];if(e.neighboringTiles&&e.neighboringTiles[m]){const _=this.getTileByID(m);c(e,_),c(_,e)}}function c(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const b=m.tileID.canonical.y-d.tileID.canonical.y,E=Math.pow(2,d.tileID.canonical.z),S=m.tileID.key;0===_&&0===b||Math.abs(b)>1||(Math.abs(_)>1&&(1===Math.abs(_+E)?_+=E:1===Math.abs(_-E)&&(_-=E)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,b),d.neighboringTiles&&d.neighboringTiles[S]&&(d.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,c,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>c)continue;let b=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(b=S)}let E=b;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){d[b.key]=b;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=e.overscaledZ-1;c>=s;c--){const d=e.scaledTo(c),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const c=Math.ceil(e.width/s)+1,d=Math.ceil(e.height/s)+1,m=Math.floor(c*d*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(e){const s=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,s){const c={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),c[m.tileID.key]=m}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(e,s,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(e,s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Oo(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(d=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(b=>this._source.hasTile(b)))):d=[];const m=this._updateRetainedTiles(d);if(Pu(this._source.type)&&0!==d.length){const b={},E={},S=Object.keys(m);for(const L of S){const O=m[L],$=this._tiles[L];if(!$||$.fadeEndTime&&$.fadeEndTime<=an.now())continue;const K=this.findLoadedParent(O,Math.max(O.overscaledZ-tc.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),b[K.tileID.key]=K.tileID),E[L]=O}const P=d[d.length-1].overscaledZ;for(const L in this._tiles){const O=this._tiles[L];if(m[L]||!O.hasData())continue;let $=O.tileID;for(;$.overscaledZ>P;){$=$.scaledTo($.overscaledZ-1);const K=this._tiles[$.key];if(K&&K.hasData()&&E[$.key]){m[L]=O.tileID;break}}}for(const L in b)m[L]||(this._coveredTiles[L]=!0,m[L]=b[L])}for(const b in m)this._tiles[b].clearFadeHold();const _=function(b,E){const S=[];for(const P in b)P in E||S.push(P);return S}(this._tiles,m);for(const b of _){const E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(0===e.length)return s;const c={},d=e[e.length-1].overscaledZ,m=e[0].overscaledZ,_=Math.max(m-tc.maxOverzooming,this._source.minzoom),b=Math.max(m+tc.maxUnderzooming,this._source.minzoom),E={};for(const S of e){const P=this._addTile(S);s[S.key]=S,P.hasData()||d<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,d,b,s);for(const S of e){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const O=S.children(this._source.maxzoom)[0],$=this.getTile(O);if($&&$.hasData()){s[O.key]=O;continue}}else{const O=S.children(this._source.maxzoom);if(s[O[0].key]&&s[O[1].key]&&s[O[2].key]&&s[O[3].key])continue}let L=P.wasRequested();for(let O=S.overscaledZ-1;O>=_;--O){const $=S.scaledTo(O);if(c[$.key]||(c[$.key]=!0,P=this.getTile($),!P&&L&&(P=this._addTile($)),P&&(s[$.key]=$,L=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let c,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}s.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;d=m}for(const m of s)this._loadedParentTiles[m]=c}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const c=Boolean(s);return c||(s=new rm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s?(s.uses++,this._tiles[e.key]=s,c||this._source.fire(new ut("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=s.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,s,c){const d=[],m=this.transform;if(!m)return d;for(const _ in this._tiles){const b=this._tiles[_];if(c&&b.clearQueryDebugViz(),b.holdingForFade())continue;const E=e.containsTile(b,m,s);E&&d.push(E)}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Pu(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=an.now())return!0}return!1}setFeatureState(e,s,c){this._state.updateState(e=e||"_geojsonTileLayer",s,c)}removeFeatureState(e,s,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,c)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,c){const d=this._tiles[e];d&&d.setDependencies(s,c)}reloadTilesForDependencies(e,s){for(const c in this._tiles)this._tiles[c].hasDependency(e,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(e,s))}}function Ua(o,e){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return o.overscaledZ-e.overscaledZ||c-s||e.canonical.y-o.canonical.y||e.canonical.x-o.canonical.x}function Pu(o){return"raster"===o||"image"===o||"video"===o}tc.maxOverzooming=10,tc.maxUnderzooming=3;class Sh{constructor(e,s,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(e,s,c){const d=c||e.findDEMTileFor(s);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,b=1<<s.canonical.z-_.canonical.z;return new Sh(d,d.tileSize/Qn/b,[(s.canonical.x/b-_.canonical.x)*m.dim,(s.canonical.y/b-_.canonical.y)*m.dim])}tileCoordToPixel(e,s){const c=s*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(c);return new je(d,m)}getElevationAt(e,s,c,d){const m=e*this._scale+this._offset[0],_=s*this._scale+this._offset[1],b=Math.floor(m),E=Math.floor(_),S=this._dem;return d=!!d,c?Nn(Nn(S.get(b,E,d),S.get(b,E+1,d),_-E),Nn(S.get(b+1,E,d),S.get(b+1,E+1,d),_-E),m-b):S.get(b,E,d)}getElevationAtPixel(e,s,c){return this._dem.get(e,s,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*of(1,e)*this._dem.stride}}class lm{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ca(Qn,16,0),this.featureIndexArray=new ll,this.promoteId=s}insert(e,s,c,d,m,_=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,m,_);const E=this.grid;for(let S=0;S<s.length;S++){const P=s[S],L=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const $=P[O];L[0]=Math.min(L[0],$.x),L[1]=Math.min(L[1],$.y),L[2]=Math.max(L[2],$.x),L[3]=Math.max(L[3],$.y)}L[0]<Qn&&L[1]<Qn&&L[2]>=0&&L[3]>=0&&E.insert(b,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ns.VectorTile(new Xc(this.rawTileData)).layers,this.sourceLayerCoder=new $g(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,c,d){this.loadVTLayers();const m=e.params||{},_=ya(m.filter),b=e.tileResult,E=e.transform,S=b.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(K,te,de,be)=>cd(b.bufferedTilespaceGeometry,K,te,de,be));P.sort(iu);let L=null;E.elevation&&P.length>0&&(L=Sh.create(E.elevation,this.tileID));const O={};let $;for(let K=0;K<P.length;K++){const te=P[K];if(te===$)continue;$=te;const de=this.featureIndexArray.get(te);let be=null;this.loadMatchingFeature(O,de,_,m.layers,m.availableImages,s,c,d,(Ae,Ne,Me,ze=0)=>(be||(be=Cc(Ae)),Ne.queryIntersectsFeature(b,Ae,Me,be,this.z,e.transform,e.pixelPosMatrix,L,ze)))}return O}loadMatchingFeature(e,s,c,d,m,_,b,E,S){const{featureIndex:P,bucketIndex:L,sourceLayerIndex:O,layoutVertexArrayOffset:$}=s,K=this.bucketLayerIDs[L];if(d&&!function(Ae,Ne){for(let Me=0;Me<Ae.length;Me++)if(Ne.indexOf(Ae[Me])>=0)return!0;return!1}(d,K))return;const te=this.sourceLayerCoder.decode(O),de=this.vtLayers[te].feature(P);if(c.needGeometry){const Ae=Dc(de,!0);if(!c.filter(new Y(this.tileID.overscaledZ),Ae,this.tileID.canonical))return}else if(!c.filter(new Y(this.tileID.overscaledZ),de))return;const be=this.getId(de,te);for(let Ae=0;Ae<K.length;Ae++){const Ne=K[Ae];if(d&&d.indexOf(Ne)<0)continue;const Me=_[Ne];if(!Me)continue;let ze={};void 0!==be&&E&&(ze=E.getState(Me.sourceLayer||"_geojsonTileLayer",be));const $e=Tn({},b[Ne]);$e.paint=Zg($e.paint,Me.paint,de,ze,m),$e.layout=Zg($e.layout,Me.layout,de,ze,m);const Ye=!S||S(de,Me,ze,$);if(!Ye)continue;const lt=new af(de,this.z,this.x,this.y,be);lt.layer=$e;let dt=e[Ne];void 0===dt&&(dt=e[Ne]=[]),dt.push({featureIndex:P,feature:lt,intersectionZ:Ye})}}lookupSymbolFeatures(e,s,c,d,m,_,b,E){const S={};this.loadVTLayers();const P=ya(m);for(const L of e)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:d,featureIndex:L,layoutVertexArrayOffset:0},P,_,b,E,s);return S}hasLayer(e){for(const s of this.bucketLayerIDs)for(const c of s)if(e===c)return!0;return!1}getId(e,s){let c=e.id;return this.promoteId&&(c=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof c&&(c=Number(c))),c}}function Zg(o,e,s,c,d){return In(o,(m,_)=>{const b=e instanceof Se?e.get(_):null;return b&&b.evaluate?b.evaluate(s,c,d):b})}function iu(o,e){return e-o}St("FeatureIndex",lm,{omit:["rawTileData","sourceLayerCoder"]});class uf{constructor(e){const s={},c=[];for(const b in e){const E=e[b],S=s[b]={};for(const P in E.glyphs){const L=E.glyphs[+P];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const O=L.metrics.localGlyph?2:1,$={x:0,y:0,w:L.bitmap.width+2*O,h:L.bitmap.height+2*O};c.push($),S[P]=$}}const{w:d,h:m}=Qc(c),_=new Wr({width:d||1,height:m||1});for(const b in e){const E=e[b];for(const S in E.glyphs){const P=E.glyphs[+S];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=s[b][S],O=P.metrics.localGlyph?2:1;Wr.copy(P.bitmap,_,{x:0,y:0},{x:L.x+O,y:L.y+O},P.bitmap)}}this.image=_,this.positions=s}}St("GlyphAtlas",uf);class Ru{constructor(e){this.tileID=new Oo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,s,c,d,m){this.status="parsing",this.data=e,this.collisionBoxArray=new ys;const _=new $g(Object.keys(e.layers).sort()),b=new lm(this.tileID,this.promoteId);b.bucketLayerIDs=[];const E={},S=new vh(256,256),P={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},L=s.familiesBySource[this.source];for(const ze in L){const $e=e.layers[ze];if(!$e)continue;let Ye=!1,lt=!1;for(const tt of L[ze])"symbol"===tt[0].type?Ye=!0:lt=!0;if(!0===this.isSymbolTile&&!Ye||!1===this.isSymbolTile&&!lt)continue;1===$e.version&&er(`Vector tile source "${this.source}" layer "${ze}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dt=_.encode(ze),xt=[];for(let tt=0;tt<$e.length;tt++){const at=$e.feature(tt),bt=b.getId(at,ze);xt.push({feature:at,id:bt,index:tt,sourceLayerIndex:dt})}for(const tt of L[ze]){const at=tt[0];void 0!==this.isSymbolTile&&"symbol"===at.type!==this.isSymbolTile||at.minzoom&&this.zoom<Math.floor(at.minzoom)||at.maxzoom&&this.zoom>=at.maxzoom||"none"!==at.visibility&&(Fc(tt,this.zoom,c),(E[at.id]=at.createBucket({index:b.bucketLayerIDs.length,layers:tt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dt,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(xt,P,this.tileID.canonical),b.bucketLayerIDs.push(tt.map(bt=>bt.id)))}}let O,$,K,te;S.trim();const de={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},be=In(P.glyphDependencies,ze=>Object.keys(ze).map(Number));Object.keys(be).length?d.send("getGlyphs",{uid:this.uid,stacks:be},(ze,$e)=>{O||(O=ze,$=$e,Me.call(this))},void 0,!1,de):$={};const Ae=Object.keys(P.iconDependencies);Ae.length?d.send("getImages",{icons:Ae,source:this.source,tileID:this.tileID,type:"icons"},(ze,$e)=>{O||(O=ze,K=$e,Me.call(this))},void 0,!1,de):K={};const Ne=Object.keys(P.patternDependencies);function Me(){if(O)return m(O);if($&&K&&te){const ze=new uf($),$e=new Nd(K,te);for(const Ye in E){const lt=E[Ye];lt instanceof Ba?(Fc(lt.layers,this.zoom,c),Bg(lt,$,ze.positions,K,$e.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):lt.hasPattern&&(lt instanceof oh||lt instanceof th||lt instanceof Id)&&(Fc(lt.layers,this.zoom,c),lt.addFeatures(P,this.tileID.canonical,$e.patternPositions))}this.status="done",m(null,{buckets:Kr(E).filter(Ye=>!Ye.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ze.image,lineAtlas:S,imageAtlas:$e,glyphMap:this.returnDependencies?$:null,iconMap:this.returnDependencies?K:null,glyphPositions:this.returnDependencies?ze.positions:null})}}Ne.length?d.send("getImages",{icons:Ne,source:this.source,tileID:this.tileID,type:"patterns"},(ze,$e)=>{O||(O=ze,te=$e,Me.call(this))},void 0,!1,de):te={},Me.call(this)}}function Fc(o,e,s){const c=new Y(e);for(const d of o)d.recalculate(c,s)}class cm{constructor(e){this.entries={},this.scheduler=e}request(e,s,c,d){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[_,b]=m.result;return this.scheduler?this.scheduler.add(()=>{d(_,b)},s):d(_,b),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=c((_,b)=>{m.result=[_,b];for(const E of m.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,b)},s):E(_,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==d),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function Ih(o,e,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const m=j(o.request,(_,b,E,S)=>{_?d(_):b&&d(null,{vectorTile:s?void 0:new Ns.VectorTile(new Xc(b)),rawData:b,cacheControl:E,expires:S})});return()=>{m.cancel(),d()}},e)}f.ARRAY_TYPE=vo,f.AUTH_ERR_MSG=Ui,f.Actor=class{constructor(o,e,s){this.target=o,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Hn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ji()?o:Te,this.scheduler=new tm}send(o,e,s,c,d=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[_]=s);const b=Lr(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:o,hasCallback:!!s,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:ks(e,b)},b),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const e=o.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(e.mustQueue||Ji()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),c&&c.metadata||{type:"message"})}else this.processTask(s,e)}processTask(o,e){if("<response>"===e.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(e.error?s(Wo(e.error)):s(null,Wo(e.data)))}else{const s=Lr(this.globalScope)?void 0:[],c=e.hasCallback?(m,_)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:m?ks(m):null,data:ks(_,s)},s)}:m=>{},d=Wo(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=zs,f.Color=De,f.ColorMode=aa,f.CullFaceMode=Bs,f.DEMData=Ch,f.DataConstantProperty=fe,f.DedupedRequest=cm,f.DepthMode=ec,f.EXTENT=Qn,f.Elevation=class{getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,s=!0){null==e&&(e=null);const c=this._source();if(!c||o.y<0||o.y>1)return e;const d=c.getSource().maxzoom,m=1<<d,_=Math.floor(o.x),b=o.x-_,E=new Oo(d,_,d,Math.floor(b*m),Math.floor(o.y*m)),S=this.findDEMTileFor(E);if(!S||!S.dem)return e;const P=S.dem,L=1<<S.tileID.canonical.z,O=(b*L-S.tileID.canonical.x)*P.dim,$=(o.y*L-S.tileID.canonical.y)*P.dim,K=Math.floor(O),te=Math.floor($);return(s?this.exaggeration():1)*Nn(Nn(P.get(K,te),P.get(K,te+1),$-te),Nn(P.get(K+1,te),P.get(K+1,te+1),$-te),O-K)}getAtTileOffset(o,e,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new ru(o.wrap+(o.canonical.x+e/Qn)/c,(o.canonical.y+s/Qn)/c))}getForTilePoints(o,e,s,c){const d=Sh.create(this,o,c);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(o){const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const s=e.dem.tree,c=e.tileID,d=1<<o.canonical.z-c.canonical.z;let m=o.canonical.x/d-c.canonical.x,_=o.canonical.y/d-c.canonical.y,b=0;for(let E=0;E<o.canonical.z-c.canonical.z&&!s.leaves[b];E++){m*=2,_*=2;const S=2*Math.floor(_)+Math.floor(m);b=s.childOffsets[b]+S,m%=1,_%=1}return{min:this.exaggeration()*s.minimums[b],max:this.exaggeration()*s.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=Ue,f.EvaluationParameters=Y,f.Event=ut,f.Evented=kt,f.GlyphManager=Su,f.ImagePosition=xs,f.LineAtlas=vh,f.LngLat=Xr,f.LngLatBounds=nu,f.LocalGlyphMode=Up,f.MAX_SAFE_INTEGER=He,f.MercatorCoordinate=ru,f.ONE_EM=24,f.OverscaledTileID=Oo,f.Properties=qe,f.RGBAImage=so,f.RequestManager=class{constructor(o,e,s){this._transformRequestFn=o,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Er,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,e){return this._transformRequestFn&&this._transformRequestFn(o,e)||{url:o}}normalizeStyleURL(o,e){if(!ri(o))return o;const s=gi(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(o,e){if(!ri(o))return o;const s=gi(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(o,e){if(!ri(o))return o;const s=gi(o);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(o,e,s,c){const d=gi(o);return ri(o)?(d.path=`/styles/v1${d.path}/sprite${e}${s}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${e}${s}`,ii(d))}normalizeTileURL(o,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ri(o))return o;const c=gi(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&"raster"!==c.authority&&512===s?"@2x":""}${jr.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Fn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Fn.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(m){for(const _ of m){const b=_.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(c.params)||Fn.ACCESS_TOKEN;return Fn.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(o,e){const s=gi(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Fn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Fn.TILE_URL_VERSION}/`,"")}`;let d=s.params;return e&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(o,e){const s=!!e&&ri(e),c=[];for(const d of o.tiles||[])Ai(d)?c.push(this.canonicalizeTileURL(d,s)):c.push(d);return c}_makeAPIURL(o,e){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=gi(Fn.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Fn.REQUIRE_ACCESS_TOKEN)return ii(o);if(e=e||Fn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(d=>-1===d.indexOf("access_token")),o.params.push(`access_token=${e||""}`),ii(o)}},f.ResourceType=ji,f.SegmentVector=ti,f.SourceCache=tc,f.StencilMode=cf,f.StructArrayLayout1ui2=Qo,f.StructArrayLayout2f1f2i16=oo,f.StructArrayLayout2i4=nn,f.StructArrayLayout2ui4=Br,f.StructArrayLayout3f12=mn,f.StructArrayLayout3ui6=cr,f.StructArrayLayout4i8=Rr,f.Texture=tf,f.Tile=rm,f.Transitionable=_e,f.Uniform1f=sd,f.Uniform1i=class extends Gl{constructor(o,e){super(o,e),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},f.Uniform2f=class extends Gl{constructor(o,e){super(o,e),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},f.Uniform3f=class extends Gl{constructor(o,e){super(o,e),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},f.Uniform4f=Gf,f.UniformColor=Hf,f.UniformMatrix3f=class extends Gl{constructor(o,e){super(o,e),this.current=$u}set(o){for(let e=0;e<9;e++)if(o[e]!==this.current[e]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},f.UniformMatrix4f=class extends Gl{constructor(o,e){super(o,e),this.current=qm}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let e=1;e<16;e++)if(o[e]!==this.current[e]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},f.UnwrappedTileID=xh,f.ValidationError=Ge,f.VectorTileWorkerSource=class extends kt{constructor(o,e,s,c,d){super(),this.actor=o,this.layerIndex=e,this.availableImages=s,this.loadVectorData=d||Ih,this.loading={},this.loaded={},this.deduped=new cm(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,e){const s=o.uid,c=o&&o.request,d=c&&c.collectResourceTiming,m=this.loading[s]=new Ru(o);m.abort=this.loadVectorData(o,(_,b)=>{const E=!this.loading[s];if(delete this.loading[s],E||_||!b)return m.status="done",E||(this.loaded[s]=m),e(_);const S=b.rawData,P={};b.expires&&(P.expires=b.expires),b.cacheControl&&(P.cacheControl=b.cacheControl),m.vectorTile=b.vectorTile||new Ns.VectorTile(new Xc(S));const L=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,$)=>{if(O||!$)return e(O);const K={};if(d){const te=sf(c);te.length>0&&(K.resourceTiming=JSON.parse(JSON.stringify(te)))}e(null,Tn({rawTileData:S.slice(0)},$,P,K))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[s]=m})}reloadTile(o,e){const s=this.loaded,c=o.uid,d=this;if(s&&s[c]){const m=s[c];m.showCollisionBoxes=o.showCollisionBoxes,m.enableTerrain=!!o.enableTerrain;const _=(b,E)=>{const S=m.reloadCallback;S&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,S)),e(b,E)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(o,e){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),e()}removeTile(o,e){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],e()}},f.WritingMode=bs,f.ZoomHistory=mc,f.add=function(o,e,s){return o[0]=e[0]+s[0],o[1]=e[1]+s[1],o[2]=e[2]+s[2],o},f.addDynamicAttributes=Jl,f.altitudeFromMercatorZ=yh,f.asyncAll=ni,f.bezier=Qt,f.bindAll=Hn,f.bufferConvexPolygon=function(o,e){const s=[];for(let c=0;c<o.length;c++){const d=Dt(c-1,-1,o.length-1),m=Dt(c+1,-1,o.length-1),_=o[c],b=o[m],E=o[d].sub(_).unit(),S=b.sub(_).unit(),P=S.angleWithSep(E.x,E.y),L=E.add(S).unit().mult(-1*e/Math.sin(P/2));s.push(_.add(L))}return s},f.cacheEntryPossiblyAdded=function(o){Mi++,Mi>ss&&(o.getActor().send("enforceCacheSizeLimit",Ln),Mi=0)},f.clamp=zt,f.clearTileCache=function(o){const e=Te.caches.delete(os);o&&e.catch(o).then(()=>o())},f.clipLine=kg,f.clone=function(o){var e=new vo(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e},f.clone$1=function(o){var e=new vo(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},f.clone$2=Rn,f.collisionCircleLayout=Fd,f.config=Fn,f.conjugate=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},f.copy=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o},f.create=Zu,f.create$1=function(){var o=new vo(16);return vo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},f.create$2=eg,f.createExpression=Zi,f.createFilter=ya,f.createLayout=Mt,f.createStyleLayer=function(o){return"custom"===o.type?new Zp(o):new Yp[o.type](o)},f.cross=function(o,e,s){var c=e[0],d=e[1],m=e[2],_=s[0],b=s[1],E=s[2];return o[0]=d*E-m*b,o[1]=m*_-c*E,o[2]=c*b-d*_,o},f.degToRad=mt,f.div=function(o,e,s){return o[0]=e[0]/s[0],o[1]=e[1]/s[1],o[2]=e[2]/s[2],o},f.dot=function(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]},f.dot$1=function(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]*e[3]},f.ease=Pn,f.easeCubicInOut=et,f.emitValidationErrors=Ll,f.endsWith=Jt,f.enforceCacheSizeLimit=function(o){_i(),Kt&&Kt.then(e=>{e.keys().then(s=>{for(let c=0;c<s.length-o;c++)e.delete(s[c])})})},f.evaluateSizeForFeature=wu,f.evaluateSizeForZoom=Wl,f.evaluateVariableOffset=Yd,f.evented=N,f.exactEquals=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},f.exactEquals$1=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]},f.exported=an,f.exported$1=jr,f.extend=Tn,f.filterObject=pt,f.fromMat4=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},f.fromQuat=function(o,e){var s=e[0],c=e[1],d=e[2],m=e[3],_=s+s,b=c+c,E=d+d,S=s*_,P=c*_,L=c*b,O=d*_,$=d*b,K=d*E,te=m*_,de=m*b,be=m*E;return o[0]=1-L-K,o[1]=P+be,o[2]=O-de,o[3]=0,o[4]=P-be,o[5]=1-S-K,o[6]=$+te,o[7]=0,o[8]=O+de,o[9]=$-te,o[10]=1-S-L,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.fromRotation=function(o,e){var s=Math.sin(e),c=Math.cos(e);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},f.fromScaling=function(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.furthestTileCorner=function(o){const e=Math.round((o+45+360)%360/90)%4;return Tt[e]},f.getAABBPointSquareDist=function(o,e,s){let c=0;for(let d=0;d<2;++d){const m=s?s[d]:0;o[d]>m&&(c+=(o[d]-m)*(o[d]-m)),e[d]<m&&(c+=(m-e[d])*(m-e[d]))}return c},f.getAnchorAlignment=Tu,f.getAnchorJustification=Gp,f.getBounds=function(o){let e=1/0,s=1/0,c=-1/0,d=-1/0;for(const m of o)e=Math.min(e,m.x),s=Math.min(s,m.y),c=Math.max(c,m.x),d=Math.max(d,m.y);return{min:new je(e,s),max:new je(c,d)}},f.getImage=Ce,f.getJSON=function(o,e){return re(Tn(o,{type:"json"}),e)},f.getMapSessionAPI=qn,f.getPerformanceMeasurement=sf,f.getRTLTextPluginStatus=U,f.getReferrer=pn,f.getVideo=function(o,e){const s=Te.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let c=0;c<o.length;c++){const d=Te.document.createElement("source");he(o[c])||(s.crossOrigin="Anonymous"),d.src=o[c],s.appendChild(d)}return{cancel:()=>{}}},f.identity=ep,f.identity$1=rp,f.invert=function(o,e){var s=e[0],c=e[1],d=e[2],m=e[3],_=e[4],b=e[5],E=e[6],S=e[7],P=e[8],L=e[9],O=e[10],$=e[11],K=e[12],te=e[13],de=e[14],be=e[15],Ae=s*b-c*_,Ne=s*E-d*_,Me=s*S-m*_,ze=c*E-d*b,$e=c*S-m*b,Ye=d*S-m*E,lt=P*te-L*K,dt=P*de-O*K,xt=P*be-$*K,tt=L*de-O*te,at=L*be-$*te,bt=O*be-$*de,rt=Ae*bt-Ne*at+Me*tt+ze*xt-$e*dt+Ye*lt;return rt?(o[0]=(b*bt-E*at+S*tt)*(rt=1/rt),o[1]=(d*at-c*bt-m*tt)*rt,o[2]=(te*Ye-de*$e+be*ze)*rt,o[3]=(O*$e-L*Ye-$*ze)*rt,o[4]=(E*xt-_*bt-S*dt)*rt,o[5]=(s*bt-d*xt+m*dt)*rt,o[6]=(de*Me-K*Ye-be*Ne)*rt,o[7]=(P*Ye-O*Me+$*Ne)*rt,o[8]=(_*at-b*xt+S*lt)*rt,o[9]=(c*xt-s*at-m*lt)*rt,o[10]=(K*$e-te*Me+be*Ae)*rt,o[11]=(L*Me-P*$e-$*Ae)*rt,o[12]=(b*dt-_*tt-E*lt)*rt,o[13]=(s*tt-c*dt+d*lt)*rt,o[14]=(te*Ne-K*ze-de*Ae)*rt,o[15]=(P*ze-L*Ne+O*Ae)*rt,o):null},f.isMapAuthenticated=function(o){return $r.has(o)},f.isMapboxURL=ri,f.latFromMercatorY=_h,f.len=gd,f.length=tp,f.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},f.loadVectorTile=Ih,f.makeRequest=re,f.mercatorXfromLng=rf,f.mercatorYfromLat=em,f.mercatorZfromAltitude=of,f.mul=function(o,e,s){return o[0]=e[0]*s[0],o[1]=e[1]*s[1],o[2]=e[2]*s[2],o[3]=e[3]*s[3],o},f.mul$1=tg,f.mul$2=rg,f.multiply=fd,f.multiply$1=fu,f.nextPowerOfTwo=_n,f.normalize=Wu,f.normalize$1=function(o,e){var s=e[0],c=e[1],d=e[2],m=e[3],_=s*s+c*c+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=s*_,o[1]=c*_,o[2]=d*_,o[3]=m*_,o},f.number=Nn,f.ortho=function(o,e,s,c,d,m,_){var b=1/(e-s),E=1/(c-d),S=1/(m-_);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(e+s)*b,o[13]=(d+c)*E,o[14]=(_+m)*S,o[15]=1,o},f.pbf=Xc,f.perspective=function(o,e,s,c,d){var m,_=1/Math.tan(e/2);return o[0]=_/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=d&&d!==1/0?(o[10]=(d+c)*(m=1/(c-d)),o[14]=2*d*c*m):(o[10]=-1,o[14]=-2*c),o},f.pick=function(o,e){const s={};for(let c=0;c<e.length;c++){const d=e[c];d in o&&(s[d]=o[d])}return s},f.plugin=q,f.pointGeometry=je,f.polygonIntersectsBox=cd,f.polygonIntersectsPolygon=Xf,f.polygonizeBounds=function(o,e,s=0,c=!0){const d=new je(s,s),m=o.sub(d),_=e.add(d),b=[m,new je(_.x,m.y),_,new je(m.x,_.y)];return c&&b.push(m),b},f.posAttributes=Gg,f.postMapLoadEvent=si,f.postTurnstileEvent=qt,f.potpack=Qc,f.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},f.radToDeg=function(o){return o*_t},f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(o){return o({pluginStatus:v,pluginURL:T}),N.on("pluginStateChange",o),o},f.removeAuthState=function(o){$r.delete(o)},f.renderColorRamp=xd,f.rotateX=function(o,e,s){var c=Math.sin(s),d=Math.cos(s),m=e[4],_=e[5],b=e[6],E=e[7],S=e[8],P=e[9],L=e[10],O=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=m*d+S*c,o[5]=_*d+P*c,o[6]=b*d+L*c,o[7]=E*d+O*c,o[8]=S*d-m*c,o[9]=P*d-_*c,o[10]=L*d-b*c,o[11]=O*d-E*c,o},f.rotateX$1=ip,f.rotateY=function(o,e,s){var c=Math.sin(s),d=Math.cos(s),m=e[0],_=e[1],b=e[2],E=e[3],S=e[8],P=e[9],L=e[10],O=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*d-S*c,o[1]=_*d-P*c,o[2]=b*d-L*c,o[3]=E*d-O*c,o[8]=m*c+S*d,o[9]=_*c+P*d,o[10]=b*c+L*d,o[11]=E*c+O*d,o},f.rotateZ=function(o,e,s){var c=Math.sin(s),d=Math.cos(s),m=e[0],_=e[1],b=e[2],E=e[3],S=e[4],P=e[5],L=e[6],O=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*d+S*c,o[1]=_*d+P*c,o[2]=b*d+L*c,o[3]=E*d+O*c,o[4]=S*d-m*c,o[5]=P*d-_*c,o[6]=L*d-b*c,o[7]=O*d-E*c,o},f.rotateZ$1=function(o,e,s){s*=.5;var c=e[0],d=e[1],m=e[2],_=e[3],b=Math.sin(s),E=Math.cos(s);return o[0]=c*E+d*b,o[1]=d*E-c*b,o[2]=m*E+_*b,o[3]=_*E-m*b,o},f.scale=function(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o},f.scale$1=function(o,e,s){var c=s[0],d=s[1],m=s[2];return o[0]=e[0]*c,o[1]=e[1]*c,o[2]=e[2]*c,o[3]=e[3]*c,o[4]=e[4]*d,o[5]=e[5]*d,o[6]=e[6]*d,o[7]=e[7]*d,o[8]=e[8]*m,o[9]=e[9]*m,o[10]=e[10]*m,o[11]=e[11]*m,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o},f.scale$2=function(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o[3]=e[3]*s,o},f.scaleAndAdd=md,f.setCacheLimits=function(o,e){Ln=o,ss=e},f.setRTLTextPlugin=function(o,e,s=!1){if(v===r||v===l||v===p)throw new Error("setRTLTextPlugin cannot be called multiple times.");T=an.resolveURL(o),v=r,y=e,R(),s||H()},f.smoothstep=function(o,e,s){return(s=zt((s-o)/(e-o),0,1))*s*(3-2*s)},f.spec=ve,f.storeAuthState=function(o,e){e?$r.add(o):$r.delete(o)},f.sub=ng,f.subtract=pd,f.symbolSize=Mp,f.transformMat3=function(o,e,s){var c=e[0],d=e[1],m=e[2];return o[0]=c*s[0]+d*s[3]+m*s[6],o[1]=c*s[1]+d*s[4]+m*s[7],o[2]=c*s[2]+d*s[5]+m*s[8],o},f.transformMat4=Wc,f.transformMat4$1=function(o,e,s){var c=e[0],d=e[1],m=e[2],_=s[3]*c+s[7]*d+s[11]*m+s[15];return o[0]=(s[0]*c+s[4]*d+s[8]*m+s[12])/(_=_||1),o[1]=(s[1]*c+s[5]*d+s[9]*m+s[13])/_,o[2]=(s[2]*c+s[6]*d+s[10]*m+s[14])/_,o},f.transformQuat=np,f.translate=function(o,e,s){var c,d,m,_,b,E,S,P,L,O,$,K,te=s[0],de=s[1],be=s[2];return e===o?(o[12]=e[0]*te+e[4]*de+e[8]*be+e[12],o[13]=e[1]*te+e[5]*de+e[9]*be+e[13],o[14]=e[2]*te+e[6]*de+e[10]*be+e[14],o[15]=e[3]*te+e[7]*de+e[11]*be+e[15]):(d=e[1],m=e[2],_=e[3],b=e[4],E=e[5],S=e[6],P=e[7],L=e[8],O=e[9],$=e[10],K=e[11],o[0]=c=e[0],o[1]=d,o[2]=m,o[3]=_,o[4]=b,o[5]=E,o[6]=S,o[7]=P,o[8]=L,o[9]=O,o[10]=$,o[11]=K,o[12]=c*te+b*de+L*be+e[12],o[13]=d*te+E*de+O*be+e[13],o[14]=m*te+S*de+$*be+e[14],o[15]=_*te+P*de+K*be+e[15]),o},f.triggerPluginCompletionEvent=A,f.uniqueId=Bi,f.validateCustomStyleLayer=function(o){const e=[],s=o.id;return void 0===s&&e.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&e.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},f.validateFog=Zo,f.validateLight=Ea,f.validateStyle=wa,f.values=Kr,f.vectorTile=Ns,f.version="2.5.1",f.warnOnce=er,f.window=Te,f.wrap=Dt}),ne(0,function(f){function Vt(re){const j=typeof re;if("number"===j||"boolean"===j||"string"===j||null==re)return JSON.stringify(re);if(Array.isArray(re)){let he="[";for(const ge of re)he+=`${Vt(ge)},`;return`${he}]`}const Z=Object.keys(re).sort();let ie="{";for(let he=0;he<Z.length;he++)ie+=`${JSON.stringify(Z[he])}:${Vt(re[Z[he]])},`;return`${ie}}`}function it(re){let j="";for(const Z of f.refProperties)j+=`/${Vt(re[Z])}`;return j}class Pt{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,Z){for(const he of j){this._layerConfigs[he.id]=he;const ge=this._layers[he.id]=f.createStyleLayer(he);ge._featureFilter=f.createFilter(ge.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Z)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ie=function(he,ge){const ke={};for(let Ce=0;Ce<he.length;Ce++){const Oe=ge&&ge[he[Ce].id]||it(he[Ce]);ge&&(ge[he[Ce].id]=Oe);let Xe=ke[Oe];Xe||(Xe=ke[Oe]=[]),Xe.push(he[Ce])}const Le=[];for(const Ce in ke)Le.push(ke[Ce]);return Le}(f.values(this._layerConfigs),this.keyCache);for(const he of ie){const ge=he.map(ut=>this._layers[ut.id]),ke=ge[0];if("none"===ke.visibility)continue;const Le=ke.source||"";let Ce=this.familiesBySource[Le];Ce||(Ce=this.familiesBySource[Le]={});const Oe=ke.sourceLayer||"_geojsonTileLayer";let Xe=Ce[Oe];Xe||(Xe=Ce[Oe]=[]),Xe.push(ge)}}}const{ImageBitmap:je}=f.window;class Ie{loadTile(j,Z){const{uid:ie,encoding:he,rawImageData:ge,padding:ke,buildQuadTree:Le}=j,Ce=je&&ge instanceof je?this.getImageData(ge,ke):ge;Z(null,new f.DEMData(ie,Ce,he,ke<1,Le))}getImageData(j,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);const ie=this.offscreenCanvasContext.getImageData(-Z,-Z,j.width+2*Z,j.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new f.RGBAImage({width:ie.width,height:ie.height},ie.data)}}var Te=function re(j,Z){var ie,he=j&&j.type;if("FeatureCollection"===he)for(ie=0;ie<j.features.length;ie++)re(j.features[ie],Z);else if("GeometryCollection"===he)for(ie=0;ie<j.geometries.length;ie++)re(j.geometries[ie],Z);else if("Feature"===he)re(j.geometry,Z);else if("Polygon"===he)He(j.coordinates,Z);else if("MultiPolygon"===he)for(ie=0;ie<j.coordinates.length;ie++)He(j.coordinates[ie],Z);return j};function He(re,j){if(0!==re.length){Qe(re[0],j);for(var Z=1;Z<re.length;Z++)Qe(re[Z],!j)}}function Qe(re,j){for(var Z=0,ie=0,he=re.length,ge=he-1;ie<he;ge=ie++)Z+=(re[ie][0]-re[ge][0])*(re[ge][1]+re[ie][1]);Z>=0!=!!j&&re.reverse()}const _t=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class mt{constructor(j){this._feature=j,this.extent=f.EXTENT,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(1===this._feature.type){const j=[];for(const Z of this._feature.geometry)j.push([new f.pointGeometry(Z[0],Z[1])]);return j}{const j=[];for(const Z of this._feature.geometry){const ie=[];for(const he of Z)ie.push(new f.pointGeometry(he[0],he[1]));j.push(ie)}return j}}toGeoJSON(j,Z,ie){return _t.call(this,j,Z,ie)}}class Tt{constructor(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=j.length,this._features=j}feature(j){return new mt(this._features[j])}}var et=f.vectorTile.VectorTileFeature,Qt=Pn;function Pn(re,j){this.options=j||{},this.features=re,this.length=re.length}function zt(re,j){this.id="number"==typeof re.id?re.id:void 0,this.type=re.type,this.rawGeometry=1===re.type?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=j||4096}Pn.prototype.feature=function(re){return new zt(this.features[re],this.options.extent)},zt.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var j=0;j<re.length;j++){for(var Z=re[j],ie=[],he=0;he<Z.length;he++)ie.push(new f.pointGeometry(Z[he][0],Z[he][1]));this.geometry.push(ie)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,j=1/0,Z=-1/0,ie=1/0,he=-1/0,ge=0;ge<re.length;ge++)for(var ke=re[ge],Le=0;Le<ke.length;Le++){var Ce=ke[Le];j=Math.min(j,Ce.x),Z=Math.max(Z,Ce.x),ie=Math.min(ie,Ce.y),he=Math.max(he,Ce.y)}return[j,ie,Z,he]},zt.prototype.toGeoJSON=et.prototype.toGeoJSON;var Dt=Kr,ni=Qt;function Kr(re){var j=new f.pbf;return function(Z,ie){for(var he in Z.layers)ie.writeMessage(3,Tn,Z.layers[he])}(re,j),j.finish()}function Tn(re,j){var Z;j.writeVarintField(15,re.version||1),j.writeStringField(1,re.name||""),j.writeVarintField(5,re.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<re.length;Z++)ie.feature=re.feature(Z),j.writeMessage(2,ha,ie);var he=ie.keys;for(Z=0;Z<he.length;Z++)j.writeStringField(3,he[Z]);var ge=ie.values;for(Z=0;Z<ge.length;Z++)j.writeMessage(4,Hn,ge[Z])}function ha(re,j){var Z=re.feature;void 0!==Z.id&&j.writeVarintField(1,Z.id),j.writeMessage(2,Bi,re),j.writeVarintField(3,Z.type),j.writeMessage(4,Xn,Z)}function Bi(re,j){var Z=re.feature,ie=re.keys,he=re.values,ge=re.keycache,ke=re.valuecache;for(var Le in Z.properties){var Ce=ge[Le];void 0===Ce&&(ie.push(Le),ge[Le]=Ce=ie.length-1),j.writeVarint(Ce);var Oe=Z.properties[Le],Xe=typeof Oe;"string"!==Xe&&"boolean"!==Xe&&"number"!==Xe&&(Oe=JSON.stringify(Oe));var ut=Xe+":"+Oe,Ue=ke[ut];void 0===Ue&&(he.push(Oe),ke[ut]=Ue=he.length-1),j.writeVarint(Ue)}}function Ft(re,j){return(j<<3)+(7&re)}function _n(re){return re<<1^re>>31}function Xn(re,j){for(var Z=re.loadGeometry(),ie=re.type,he=0,ge=0,ke=Z.length,Le=0;Le<ke;Le++){var Ce=Z[Le],Oe=1;1===ie&&(Oe=Ce.length),j.writeVarint(Ft(1,Oe));for(var Xe=3===ie?Ce.length-1:Ce.length,ut=0;ut<Xe;ut++){1===ut&&1!==ie&&j.writeVarint(Ft(2,Xe-1));var Ue=Ce[ut].x-he,kt=Ce[ut].y-ge;j.writeVarint(_n(Ue)),j.writeVarint(_n(kt)),he+=Ue,ge+=kt}3===ie&&j.writeVarint(Ft(7,1))}}function Hn(re,j){var Z=typeof re;"string"===Z?j.writeStringField(1,re):"boolean"===Z?j.writeBooleanField(7,re):"number"===Z&&(re%1!=0?j.writeDoubleField(3,re):re<0?j.writeSVarintField(6,re):j.writeVarintField(5,re))}function Jt(re,j,Z,ie,he,ge){if(he-ie<=Z)return;const ke=ie+he>>1;In(re,j,ke,ie,he,ge%2),Jt(re,j,Z,ie,ke-1,ge+1),Jt(re,j,Z,ke+1,he,ge+1)}function In(re,j,Z,ie,he,ge){for(;he>ie;){if(he-ie>600){const Oe=he-ie+1,Xe=Z-ie+1,ut=Math.log(Oe),Ue=.5*Math.exp(2*ut/3),kt=.5*Math.sqrt(ut*Ue*(Oe-Ue)/Oe)*(Xe-Oe/2<0?-1:1);In(re,j,Z,Math.max(ie,Math.floor(Z-Xe*Ue/Oe+kt)),Math.min(he,Math.floor(Z+(Oe-Xe)*Ue/Oe+kt)),ge)}const ke=j[2*Z+ge];let Le=ie,Ce=he;for(pt(re,j,ie,Z),j[2*he+ge]>ke&&pt(re,j,ie,he);Le<Ce;){for(pt(re,j,Le,Ce),Le++,Ce--;j[2*Le+ge]<ke;)Le++;for(;j[2*Ce+ge]>ke;)Ce--}j[2*ie+ge]===ke?pt(re,j,ie,Ce):(Ce++,pt(re,j,Ce,he)),Ce<=Z&&(ie=Ce+1),Z<=Ce&&(he=Ce-1)}}function pt(re,j,Z,ie){Rn(re,Z,ie),Rn(j,2*Z,2*ie),Rn(j,2*Z+1,2*ie+1)}function Rn(re,j,Z){const ie=re[j];re[j]=re[Z],re[Z]=ie}function Ur(re,j,Z,ie){const he=re-Z,ge=j-ie;return he*he+ge*ge}Dt.fromVectorTileJs=Kr,Dt.fromGeojsonVt=function(re,j){j=j||{};var Z={};for(var ie in re)Z[ie]=new Qt(re[ie].features,j),Z[ie].name=ie,Z[ie].version=j.version,Z[ie].extent=j.extent;return Kr({layers:Z})},Dt.GeoJSONWrapper=ni;const er=re=>re[0],fr=re=>re[1];class Ss{constructor(j,Z=er,ie=fr,he=64,ge=Float64Array){this.nodeSize=he,this.points=j;const ke=j.length<65536?Uint16Array:Uint32Array,Le=this.ids=new ke(j.length),Ce=this.coords=new ge(2*j.length);for(let Oe=0;Oe<j.length;Oe++)Le[Oe]=Oe,Ce[2*Oe]=Z(j[Oe]),Ce[2*Oe+1]=ie(j[Oe]);Jt(Le,Ce,he,0,Le.length-1,0)}range(j,Z,ie,he){return function(ge,ke,Le,Ce,Oe,Xe,ut){const Ue=[0,ge.length-1,0],kt=[];let ve,Ge;for(;Ue.length;){const Ut=Ue.pop(),rn=Ue.pop(),Lt=Ue.pop();if(rn-Lt<=ut){for(let hn=Lt;hn<=rn;hn++)ve=ke[2*hn],Ge=ke[2*hn+1],ve>=Le&&ve<=Oe&&Ge>=Ce&&Ge<=Xe&&kt.push(ge[hn]);continue}const un=Math.floor((Lt+rn)/2);ve=ke[2*un],Ge=ke[2*un+1],ve>=Le&&ve<=Oe&&Ge>=Ce&&Ge<=Xe&&kt.push(ge[un]);const Ht=(Ut+1)%2;(0===Ut?Le<=ve:Ce<=Ge)&&(Ue.push(Lt),Ue.push(un-1),Ue.push(Ht)),(0===Ut?Oe>=ve:Xe>=Ge)&&(Ue.push(un+1),Ue.push(rn),Ue.push(Ht))}return kt}(this.ids,this.coords,j,Z,ie,he,this.nodeSize)}within(j,Z,ie){return function(he,ge,ke,Le,Ce,Oe){const Xe=[0,he.length-1,0],ut=[],Ue=Ce*Ce;for(;Xe.length;){const kt=Xe.pop(),ve=Xe.pop(),Ge=Xe.pop();if(ve-Ge<=Oe){for(let Ht=Ge;Ht<=ve;Ht++)Ur(ge[2*Ht],ge[2*Ht+1],ke,Le)<=Ue&&ut.push(he[Ht]);continue}const Ut=Math.floor((Ge+ve)/2),rn=ge[2*Ut],Lt=ge[2*Ut+1];Ur(rn,Lt,ke,Le)<=Ue&&ut.push(he[Ut]);const un=(kt+1)%2;(0===kt?ke-Ce<=rn:Le-Ce<=Lt)&&(Xe.push(Ge),Xe.push(Ut-1),Xe.push(un)),(0===kt?ke+Ce>=rn:Le+Ce>=Lt)&&(Xe.push(Ut+1),Xe.push(ve),Xe.push(un))}return ut}(this.ids,this.coords,j,Z,ie,this.nodeSize)}}const Ji={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},ho=Math.fround||(Bo=new Float32Array(1),re=>(Bo[0]=+re,Bo[0]));var Bo;class fn{constructor(j){this.options=jr(Object.create(Ji),j),this.trees=new Array(this.options.maxZoom+1)}load(j){const{log:Z,minZoom:ie,maxZoom:he,nodeSize:ge}=this.options;Z&&console.time("total time");const ke=`prepare ${j.length} points`;Z&&console.time(ke),this.points=j;let Le=[];for(let Ce=0;Ce<j.length;Ce++)j[Ce].geometry&&Le.push(mi(j[Ce],Ce));this.trees[he+1]=new Ss(Le,tr,to,ge,Float32Array),Z&&console.timeEnd(ke);for(let Ce=he;Ce>=ie;Ce--){const Oe=+Date.now();Le=this._cluster(Le,Ce),this.trees[Ce]=new Ss(Le,tr,to,ge,Float32Array),Z&&console.log("z%d: %d clusters in %dms",Ce,Le.length,+Date.now()-Oe)}return Z&&console.timeEnd("total time"),this}getClusters(j,Z){let ie=((j[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,j[1]));let ge=180===j[2]?180:((j[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ie=-180,ge=180;else if(ie>ge){const Xe=this.getClusters([ie,he,180,ke],Z),ut=this.getClusters([-180,he,ge,ke],Z);return Xe.concat(ut)}const Le=this.trees[this._limitZoom(Z)],Ce=Le.range(an(ie),eo(ke),an(ge),eo(he)),Oe=[];for(const Xe of Ce){const ut=Le.points[Xe];Oe.push(ut.numPoints?Lr(ut):this.points[ut.index])}return Oe}getChildren(j){const Z=this._getOriginId(j),ie=this._getOriginZoom(j),he="No cluster with the specified id.",ge=this.trees[ie];if(!ge)throw new Error(he);const ke=ge.points[Z];if(!ke)throw new Error(he);const Le=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Ce=ge.within(ke.x,ke.y,Le),Oe=[];for(const Xe of Ce){const ut=ge.points[Xe];ut.parentId===j&&Oe.push(ut.numPoints?Lr(ut):this.points[ut.index])}if(0===Oe.length)throw new Error(he);return Oe}getLeaves(j,Z,ie){const he=[];return this._appendLeaves(he,j,Z=Z||10,ie=ie||0,0),he}getTile(j,Z,ie){const he=this.trees[this._limitZoom(j)],ge=Math.pow(2,j),{extent:ke,radius:Le}=this.options,Ce=Le/ke,Oe=(ie-Ce)/ge,Xe=(ie+1+Ce)/ge,ut={features:[]};return this._addTileFeatures(he.range((Z-Ce)/ge,Oe,(Z+1+Ce)/ge,Xe),he.points,Z,ie,ge,ut),0===Z&&this._addTileFeatures(he.range(1-Ce/ge,Oe,1,Xe),he.points,ge,ie,ge,ut),Z===ge-1&&this._addTileFeatures(he.range(0,Oe,Ce/ge,Xe),he.points,-1,ie,ge,ut),ut.features.length?ut:null}getClusterExpansionZoom(j){let Z=this._getOriginZoom(j)-1;for(;Z<=this.options.maxZoom;){const ie=this.getChildren(j);if(Z++,1!==ie.length)break;j=ie[0].properties.cluster_id}return Z}_appendLeaves(j,Z,ie,he,ge){const ke=this.getChildren(Z);for(const Le of ke){const Ce=Le.properties;if(Ce&&Ce.cluster?ge+Ce.point_count<=he?ge+=Ce.point_count:ge=this._appendLeaves(j,Ce.cluster_id,ie,he,ge):ge<he?ge++:j.push(Le),j.length===ie)break}return ge}_addTileFeatures(j,Z,ie,he,ge,ke){for(const Le of j){const Ce=Z[Le],Oe=Ce.numPoints;let Xe,ut,Ue;if(Oe)Xe=Dr(Ce),ut=Ce.x,Ue=Ce.y;else{const Ge=this.points[Ce.index];Xe=Ge.properties,ut=an(Ge.geometry.coordinates[0]),Ue=eo(Ge.geometry.coordinates[1])}const kt={type:1,geometry:[[Math.round(this.options.extent*(ut*ge-ie)),Math.round(this.options.extent*(Ue*ge-he))]],tags:Xe};let ve;Oe?ve=Ce.id:this.options.generateId?ve=Ce.index:this.points[Ce.index].id&&(ve=this.points[Ce.index].id),void 0!==ve&&(kt.id=ve),ke.features.push(kt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(+j,this.options.maxZoom+1))}_cluster(j,Z){const ie=[],{radius:he,extent:ge,reduce:ke,minPoints:Le}=this.options,Ce=he/(ge*Math.pow(2,Z));for(let Oe=0;Oe<j.length;Oe++){const Xe=j[Oe];if(Xe.zoom<=Z)continue;Xe.zoom=Z;const ut=this.trees[Z+1],Ue=ut.within(Xe.x,Xe.y,Ce),kt=Xe.numPoints||1;let ve=kt;for(const Ge of Ue){const Ut=ut.points[Ge];Ut.zoom>Z&&(ve+=Ut.numPoints||1)}if(ve>=Le){let Ge=Xe.x*kt,Ut=Xe.y*kt,rn=ke&&kt>1?this._map(Xe,!0):null;const Lt=(Oe<<5)+(Z+1)+this.points.length;for(const un of Ue){const Ht=ut.points[un];if(Ht.zoom<=Z)continue;Ht.zoom=Z;const hn=Ht.numPoints||1;Ge+=Ht.x*hn,Ut+=Ht.y*hn,Ht.parentId=Lt,ke&&(rn||(rn=this._map(Xe,!0)),ke(rn,this._map(Ht)))}Xe.parentId=Lt,ie.push(fo(Ge/ve,Ut/ve,Lt,ve,rn))}else if(ie.push(Xe),ve>1)for(const Ge of Ue){const Ut=ut.points[Ge];Ut.zoom<=Z||(Ut.zoom=Z,ie.push(Ut))}}return ie}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,Z){if(j.numPoints)return Z?jr({},j.properties):j.properties;const ie=this.points[j.index].properties,he=this.options.map(ie);return Z&&he===ie?jr({},he):he}}function fo(re,j,Z,ie,he){return{x:ho(re),y:ho(j),zoom:1/0,id:Z,parentId:-1,numPoints:ie,properties:he}}function mi(re,j){const[Z,ie]=re.geometry.coordinates;return{x:ho(an(Z)),y:ho(eo(ie)),zoom:1/0,index:j,parentId:-1}}function Lr(re){return{type:"Feature",id:re.id,properties:Dr(re),geometry:{type:"Point",coordinates:[(j=re.x,360*(j-.5)),Fn(re.y)]}};var j}function Dr(re){const j=re.numPoints,Z=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j;return jr(jr({},re.properties),{cluster:!0,cluster_id:re.id,point_count:j,point_count_abbreviated:Z})}function an(re){return re/360+.5}function eo(re){const j=Math.sin(re*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function Fn(re){const j=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function jr(re,j){for(const Z in j)re[Z]=j[Z];return re}function tr(re){return re.x}function to(re){return re.y}function nr(re,j,Z,ie){for(var he,ge=ie,ke=Z-j>>1,Le=Z-j,Ce=re[j],Oe=re[j+1],Xe=re[Z],ut=re[Z+1],Ue=j+3;Ue<Z;Ue+=3){var kt=Or(re[Ue],re[Ue+1],Ce,Oe,Xe,ut);if(kt>ge)he=Ue,ge=kt;else if(kt===ge){var ve=Math.abs(Ue-ke);ve<Le&&(he=Ue,Le=ve)}}ge>ie&&(he-j>3&&nr(re,j,he,ie),re[he+2]=ge,Z-he>3&&nr(re,he,Z,ie))}function Or(re,j,Z,ie,he,ge){var ke=he-Z,Le=ge-ie;if(0!==ke||0!==Le){var Ce=((re-Z)*ke+(j-ie)*Le)/(ke*ke+Le*Le);Ce>1?(Z=he,ie=ge):Ce>0&&(Z+=ke*Ce,ie+=Le*Ce)}return(ke=re-Z)*ke+(Le=j-ie)*Le}function Vi(re,j,Z,ie){var he={id:void 0===re?null:re,type:j,geometry:Z,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var ke=ge.geometry,Le=ge.type;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)Er(ge,ke);else if("Polygon"===Le||"MultiLineString"===Le)for(var Ce=0;Ce<ke.length;Ce++)Er(ge,ke[Ce]);else if("MultiPolygon"===Le)for(Ce=0;Ce<ke.length;Ce++)for(var Oe=0;Oe<ke[Ce].length;Oe++)Er(ge,ke[Ce][Oe])}(he),he}function Er(re,j){for(var Z=0;Z<j.length;Z+=3)re.minX=Math.min(re.minX,j[Z]),re.minY=Math.min(re.minY,j[Z+1]),re.maxX=Math.max(re.maxX,j[Z]),re.maxY=Math.max(re.maxY,j[Z+1])}function Ui(re,j,Z,ie){if(j.geometry){var he=j.geometry.coordinates,ge=j.geometry.type,ke=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Le=[],Ce=j.id;if(Z.promoteId?Ce=j.properties[Z.promoteId]:Z.generateId&&(Ce=ie||0),"Point"===ge)ri(he,Le);else if("MultiPoint"===ge)for(var Oe=0;Oe<he.length;Oe++)ri(he[Oe],Le);else if("LineString"===ge)Ai(he,Le,ke,!1);else if("MultiLineString"===ge){if(Z.lineMetrics){for(Oe=0;Oe<he.length;Oe++)Ai(he[Oe],Le=[],ke,!1),re.push(Vi(Ce,"LineString",Le,j.properties));return}Do(he,Le,ke,!1)}else if("Polygon"===ge)Do(he,Le,ke,!0);else{if("MultiPolygon"!==ge){if("GeometryCollection"===ge){for(Oe=0;Oe<j.geometry.geometries.length;Oe++)Ui(re,{id:Ce,geometry:j.geometry.geometries[Oe],properties:j.properties},Z,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Oe=0;Oe<he.length;Oe++){var Xe=[];Do(he[Oe],Xe,ke,!0),Le.push(Xe)}}re.push(Vi(Ce,ge,Le,j.properties))}}function ri(re,j){j.push(gi(re[0])),j.push(ii(re[1])),j.push(0)}function Ai(re,j,Z,ie){for(var he,ge,ke=0,Le=0;Le<re.length;Le++){var Ce=gi(re[Le][0]),Oe=ii(re[Le][1]);j.push(Ce),j.push(Oe),j.push(0),Le>0&&(ke+=ie?(he*Oe-Ce*ge)/2:Math.sqrt(Math.pow(Ce-he,2)+Math.pow(Oe-ge,2))),he=Ce,ge=Oe}var Xe=j.length-3;j[2]=1,nr(j,0,Xe,Z),j[Xe+2]=1,j.size=Math.abs(ke),j.start=0,j.end=j.size}function Do(re,j,Z,ie){for(var he=0;he<re.length;he++){var ge=[];Ai(re[he],ge,Z,ie),j.push(ge)}}function gi(re){return re/360+.5}function ii(re){var j=Math.sin(re*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function Nt(re,j,Z,ie,he,ge,ke,Le){if(ie/=j,ge>=(Z/=j)&&ke<ie)return re;if(ke<Z||ge>=ie)return null;for(var Ce=[],Oe=0;Oe<re.length;Oe++){var Xe=re[Oe],ut=Xe.geometry,Ue=Xe.type,kt=0===he?Xe.minX:Xe.minY,ve=0===he?Xe.maxX:Xe.maxY;if(kt>=Z&&ve<ie)Ce.push(Xe);else if(!(ve<Z||kt>=ie)){var Ge=[];if("Point"===Ue||"MultiPoint"===Ue)Kn(ut,Ge,Z,ie,he);else if("LineString"===Ue)$t(ut,Ge,Z,ie,he,!1,Le.lineMetrics);else if("MultiLineString"===Ue)oi(ut,Ge,Z,ie,he,!1);else if("Polygon"===Ue)oi(ut,Ge,Z,ie,he,!0);else if("MultiPolygon"===Ue)for(var Ut=0;Ut<ut.length;Ut++){var rn=[];oi(ut[Ut],rn,Z,ie,he,!0),rn.length&&Ge.push(rn)}if(Ge.length){if(Le.lineMetrics&&"LineString"===Ue){for(Ut=0;Ut<Ge.length;Ut++)Ce.push(Vi(Xe.id,Ue,Ge[Ut],Xe.tags));continue}"LineString"!==Ue&&"MultiLineString"!==Ue||(1===Ge.length?(Ue="LineString",Ge=Ge[0]):Ue="MultiLineString"),"Point"!==Ue&&"MultiPoint"!==Ue||(Ue=3===Ge.length?"Point":"MultiPoint"),Ce.push(Vi(Xe.id,Ue,Ge,Xe.tags))}}}return Ce.length?Ce:null}function Kn(re,j,Z,ie,he){for(var ge=0;ge<re.length;ge+=3){var ke=re[ge+he];ke>=Z&&ke<=ie&&(j.push(re[ge]),j.push(re[ge+1]),j.push(re[ge+2]))}}function $t(re,j,Z,ie,he,ge,ke){for(var Le,Ce,Oe=qt(re),Xe=0===he?Tr:qn,ut=re.start,Ue=0;Ue<re.length-3;Ue+=3){var kt=re[Ue],ve=re[Ue+1],Ge=re[Ue+2],Ut=re[Ue+3],rn=re[Ue+4],Lt=0===he?kt:ve,un=0===he?Ut:rn,Ht=!1;ke&&(Le=Math.sqrt(Math.pow(kt-Ut,2)+Math.pow(ve-rn,2))),Lt<Z?un>Z&&(Ce=Xe(Oe,kt,ve,Ut,rn,Z),ke&&(Oe.start=ut+Le*Ce)):Lt>ie?un<ie&&(Ce=Xe(Oe,kt,ve,Ut,rn,ie),ke&&(Oe.start=ut+Le*Ce)):si(Oe,kt,ve,Ge),un<Z&&Lt>=Z&&(Ce=Xe(Oe,kt,ve,Ut,rn,Z),Ht=!0),un>ie&&Lt<=ie&&(Ce=Xe(Oe,kt,ve,Ut,rn,ie),Ht=!0),!ge&&Ht&&(ke&&(Oe.end=ut+Le*Ce),j.push(Oe),Oe=qt(re)),ke&&(ut+=Le)}var hn=re.length-3;kt=re[hn],ve=re[hn+1],Ge=re[hn+2],(Lt=0===he?kt:ve)>=Z&&Lt<=ie&&si(Oe,kt,ve,Ge),hn=Oe.length-3,ge&&hn>=3&&(Oe[hn]!==Oe[0]||Oe[hn+1]!==Oe[1])&&si(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&j.push(Oe)}function qt(re){var j=[];return j.size=re.size,j.start=re.start,j.end=re.end,j}function oi(re,j,Z,ie,he,ge){for(var ke=0;ke<re.length;ke++)$t(re[ke],j,Z,ie,he,ge,!1)}function si(re,j,Z,ie){re.push(j),re.push(Z),re.push(ie)}function Tr(re,j,Z,ie,he,ge){var ke=(ge-j)/(ie-j);return re.push(ge),re.push(Z+(he-Z)*ke),re.push(1),ke}function qn(re,j,Z,ie,he,ge){var ke=(ge-Z)/(he-Z);return re.push(j+(ie-j)*ke),re.push(ge),re.push(1),ke}function $r(re,j){for(var Z=[],ie=0;ie<re.length;ie++){var he,ge=re[ie],ke=ge.type;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)he=os(ge.geometry,j);else if("MultiLineString"===ke||"Polygon"===ke){he=[];for(var Le=0;Le<ge.geometry.length;Le++)he.push(os(ge.geometry[Le],j))}else if("MultiPolygon"===ke)for(he=[],Le=0;Le<ge.geometry.length;Le++){for(var Ce=[],Oe=0;Oe<ge.geometry[Le].length;Oe++)Ce.push(os(ge.geometry[Le][Oe],j));he.push(Ce)}Z.push(Vi(ge.id,ke,he,ge.tags))}return Z}function os(re,j){var Z=[];Z.size=re.size,void 0!==re.start&&(Z.start=re.start,Z.end=re.end);for(var ie=0;ie<re.length;ie+=3)Z.push(re[ie]+j,re[ie+1],re[ie+2]);return Z}function Kt(re,j){if(re.transformed)return re;var Z,ie,he,ge=1<<re.z,ke=re.x,Le=re.y;for(Z=0;Z<re.features.length;Z++){var Ce=re.features[Z],Oe=Ce.geometry,Xe=Ce.type;if(Ce.geometry=[],1===Xe)for(ie=0;ie<Oe.length;ie+=2)Ce.geometry.push(po(Oe[ie],Oe[ie+1],j,ge,ke,Le));else for(ie=0;ie<Oe.length;ie++){var ut=[];for(he=0;he<Oe[ie].length;he+=2)ut.push(po(Oe[ie][he],Oe[ie][he+1],j,ge,ke,Le));Ce.geometry.push(ut)}}return re.transformed=!0,re}function po(re,j,Z,ie,he,ge){return[Math.round(Z*(re*ie-he)),Math.round(Z*(j*ie-ge))]}function Ln(re,j,Z,ie,he){for(var ge=j===he.maxZoom?0:he.tolerance/((1<<j)*he.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ie,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<re.length;Le++){ke.numFeatures++,ss(ke,re[Le],ge,he);var Ce=re[Le].minX,Oe=re[Le].minY,Xe=re[Le].maxX,ut=re[Le].maxY;Ce<ke.minX&&(ke.minX=Ce),Oe<ke.minY&&(ke.minY=Oe),Xe>ke.maxX&&(ke.maxX=Xe),ut>ke.maxY&&(ke.maxY=ut)}return ke}function ss(re,j,Z,ie){var he=j.geometry,ge=j.type,ke=[];if("Point"===ge||"MultiPoint"===ge)for(var Le=0;Le<he.length;Le+=3)ke.push(he[Le]),ke.push(he[Le+1]),re.numPoints++,re.numSimplified++;else if("LineString"===ge)_i(ke,he,re,Z,!1,!1);else if("MultiLineString"===ge||"Polygon"===ge)for(Le=0;Le<he.length;Le++)_i(ke,he[Le],re,Z,"Polygon"===ge,0===Le);else if("MultiPolygon"===ge)for(var Ce=0;Ce<he.length;Ce++){var Oe=he[Ce];for(Le=0;Le<Oe.length;Le++)_i(ke,Oe[Le],re,Z,!0,0===Le)}if(ke.length){var Xe=j.tags||null;if("LineString"===ge&&ie.lineMetrics){for(var ut in Xe={},j.tags)Xe[ut]=j.tags[ut];Xe.mapbox_clip_start=he.start/he.size,Xe.mapbox_clip_end=he.end/he.size}var Ue={geometry:ke,type:"Polygon"===ge||"MultiPolygon"===ge?3:"LineString"===ge||"MultiLineString"===ge?2:1,tags:Xe};null!==j.id&&(Ue.id=j.id),re.features.push(Ue)}}function _i(re,j,Z,ie,he,ge){var ke=ie*ie;if(ie>0&&j.size<(he?ke:ie))Z.numPoints+=j.length/3;else{for(var Le=[],Ce=0;Ce<j.length;Ce+=3)(0===ie||j[Ce+2]>ke)&&(Z.numSimplified++,Le.push(j[Ce]),Le.push(j[Ce+1])),Z.numPoints++;he&&function(Oe,Xe){for(var ut=0,Ue=0,kt=Oe.length,ve=kt-2;Ue<kt;ve=Ue,Ue+=2)ut+=(Oe[Ue]-Oe[ve])*(Oe[Ue+1]+Oe[ve+1]);if(ut>0===Xe)for(Ue=0,kt=Oe.length;Ue<kt/2;Ue+=2){var Ge=Oe[Ue],Ut=Oe[Ue+1];Oe[Ue]=Oe[kt-2-Ue],Oe[Ue+1]=Oe[kt-1-Ue],Oe[kt-2-Ue]=Ge,Oe[kt-1-Ue]=Ut}}(Le,ge),re.push(Le)}}function vn(re,j){var Z=(j=this.options=function(he,ge){for(var ke in ge)he[ke]=ge[ke];return he}(Object.create(this.options),j)).debug;if(Z&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,ge,ke,Le,Ce,Oe,ie=function(he,ge){var ke=[];if("FeatureCollection"===he.type)for(var Le=0;Le<he.features.length;Le++)Ui(ke,he.features[Le],ge,Le);else Ui(ke,"Feature"===he.type?he:{geometry:he},ge);return ke}(re,j);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=ie,ge=j,ke=ge.buffer/ge.extent,Le=he,Ce=Nt(he,1,-1-ke,ke,0,-1,2,ge),Oe=Nt(he,1,1-ke,2+ke,0,-1,2,ge),(Ce||Oe)&&(Le=Nt(he,1,-ke,1+ke,0,-1,2,ge)||[],Ce&&(Le=$r(Ce,1).concat(Le)),Oe&&(Le=Le.concat($r(Oe,-1)))),ie=Le).length&&this.splitTile(ie,0,0,0),Z&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mi(re,j,Z){return 32*((1<<re)*Z+j)+re}function ji(re,j){const Z=re.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);const ie=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!ie)return j(null,null);const he=new Tt(ie.features);let ge=Dt(he);0===ge.byteOffset&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),j(null,{vectorTile:he,rawData:ge.buffer})}vn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vn.prototype.splitTile=function(re,j,Z,ie,he,ge,ke){for(var Le=[re,j,Z,ie],Ce=this.options,Oe=Ce.debug;Le.length;){ie=Le.pop(),Z=Le.pop(),j=Le.pop(),re=Le.pop();var Xe=1<<j,ut=Mi(j,Z,ie),Ue=this.tiles[ut];if(!Ue&&(Oe>1&&console.time("creation"),Ue=this.tiles[ut]=Ln(re,j,Z,ie,Ce),this.tileCoords.push({z:j,x:Z,y:ie}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,Z,ie,Ue.numFeatures,Ue.numPoints,Ue.numSimplified),console.timeEnd("creation"));var kt="z"+j;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Ue.source=re,he){if(j===Ce.maxZoom||j===he)continue;var ve=1<<he-j;if(Z!==Math.floor(ge/ve)||ie!==Math.floor(ke/ve))continue}else if(j===Ce.indexMaxZoom||Ue.numPoints<=Ce.indexMaxPoints)continue;if(Ue.source=null,0!==re.length){Oe>1&&console.time("clipping");var Ge,Ut,rn,Lt,un,Ht,hn=.5*Ce.buffer/Ce.extent,Pi=.5-hn,ft=.5+hn,nt=1+hn;Ge=Ut=rn=Lt=null,un=Nt(re,Xe,Z-hn,Z+ft,0,Ue.minX,Ue.maxX,Ce),Ht=Nt(re,Xe,Z+Pi,Z+nt,0,Ue.minX,Ue.maxX,Ce),re=null,un&&(Ge=Nt(un,Xe,ie-hn,ie+ft,1,Ue.minY,Ue.maxY,Ce),Ut=Nt(un,Xe,ie+Pi,ie+nt,1,Ue.minY,Ue.maxY,Ce),un=null),Ht&&(rn=Nt(Ht,Xe,ie-hn,ie+ft,1,Ue.minY,Ue.maxY,Ce),Lt=Nt(Ht,Xe,ie+Pi,ie+nt,1,Ue.minY,Ue.maxY,Ce),Ht=null),Oe>1&&console.timeEnd("clipping"),Le.push(Ge||[],j+1,2*Z,2*ie),Le.push(Ut||[],j+1,2*Z,2*ie+1),Le.push(rn||[],j+1,2*Z+1,2*ie),Le.push(Lt||[],j+1,2*Z+1,2*ie+1)}}},vn.prototype.getTile=function(re,j,Z){var ie=this.options,he=ie.extent,ge=ie.debug;if(re<0||re>24)return null;var ke=1<<re,Le=Mi(re,j=(j%ke+ke)%ke,Z);if(this.tiles[Le])return Kt(this.tiles[Le],he);ge>1&&console.log("drilling down to z%d-%d-%d",re,j,Z);for(var Ce,Oe=re,Xe=j,ut=Z;!Ce&&Oe>0;)Oe--,Xe=Math.floor(Xe/2),ut=Math.floor(ut/2),Ce=this.tiles[Mi(Oe,Xe,ut)];return Ce&&Ce.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Oe,Xe,ut),ge>1&&console.time("drilling down"),this.splitTile(Ce.source,Oe,Xe,ut,re,j,Z),ge>1&&console.timeEnd("drilling down"),this.tiles[Le]?Kt(this.tiles[Le],he):null):null};class ai extends f.VectorTileWorkerSource{constructor(j,Z,ie,he,ge){super(j,Z,ie,he,ji),ge&&(this.loadGeoJSON=ge)}loadData(j,Z){const ie=j&&j.request,he=ie&&ie.collectResourceTiming;this.loadGeoJSON(j,(ge,ke)=>{if(ge||!ke)return Z(ge);if("object"!=typeof ke)return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{Te(ke,!0);try{if(j.filter){const Ce=f.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ce.result)throw new Error(Ce.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));const Oe=ke.features.filter(Xe=>Ce.value.evaluate({zoom:0},Xe));ke={type:"FeatureCollection",features:Oe}}this._geoJSONIndex=j.cluster?new fn(function({superclusterOptions:Ce,clusterProperties:Oe}){if(!Oe||!Ce)return Ce;const Xe={},ut={},Ue={accumulated:null,zoom:0},kt={properties:null},ve=Object.keys(Oe);for(const Ge of ve){const[Ut,rn]=Oe[Ge],Lt=f.createExpression(rn),un=f.createExpression("string"==typeof Ut?[Ut,["accumulated"],["get",Ge]]:Ut);Xe[Ge]=Lt.value,ut[Ge]=un.value}return Ce.map=Ge=>{kt.properties=Ge;const Ut={};for(const rn of ve)Ut[rn]=Xe[rn].evaluate(Ue,kt);return Ut},Ce.reduce=(Ge,Ut)=>{kt.properties=Ut;for(const rn of ve)Ue.accumulated=Ge[rn],Ge[rn]=ut[rn].evaluate(Ue,kt)},Ce}(j)).load(ke.features):new vn(Ce=ke,j.geojsonVtOptions)}catch(Ce){return Z(Ce)}this.loaded={};const Le={};if(he){const Ce=f.getPerformanceMeasurement(ie);Ce&&(Le.resourceTiming={},Le.resourceTiming[j.source]=JSON.parse(JSON.stringify(Ce)))}Z(null,Le)}var Ce})}reloadTile(j,Z){const ie=this.loaded;return ie&&ie[j.uid]?super.reloadTile(j,Z):this.loadTile(j,Z)}loadGeoJSON(j,Z){if(j.request)f.getJSON(j.request,Z);else{if("string"!=typeof j.data)return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(j.data))}catch(ie){return Z(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ie){Z(ie)}}getClusterChildren(j,Z){try{Z(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ie){Z(ie)}}getClusterLeaves(j,Z){try{Z(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ie){Z(ie)}}}class pn{constructor(j){this.self=j,this.actor=new f.Actor(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:ai},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,ie)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=ie},this.self.registerRTLTextPlugin=Z=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=Z.applyArabicShaping,f.plugin.processBidirectionalText=Z.processBidirectionalText,f.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}checkIfReady(j,Z,ie){ie()}setReferrer(j,Z){this.referrer=Z}spriteLoaded(j,Z){this.isSpriteLoaded=Z;for(const ie in this.workerSources[j]){const he=this.workerSources[j][ie];for(const ge in he)he[ge]instanceof f.VectorTileWorkerSource&&(he[ge].isSpriteLoaded=Z,he[ge].fire(new f.Event("isSpriteLoaded")))}}setImages(j,Z,ie){this.availableImages[j]=Z;for(const he in this.workerSources[j]){const ge=this.workerSources[j][he];for(const ke in ge)ge[ke].availableImages=Z}ie()}enableTerrain(j,Z,ie){this.terrain=Z,ie()}setLayers(j,Z,ie){this.getLayerIndex(j).replace(Z),ie()}updateLayers(j,Z,ie){this.getLayerIndex(j).update(Z.layers,Z.removedIds),ie()}loadTile(j,Z,ie){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},Z):Z;this.getWorkerSource(j,Z.type,Z.source).loadTile(he,ie)}loadDEMTile(j,Z,ie){const he=this.enableTerrain?f.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(j,Z.source).loadTile(he,ie)}reloadTile(j,Z,ie){const he=this.enableTerrain?f.extend({enableTerrain:this.terrain},Z):Z;this.getWorkerSource(j,Z.type,Z.source).reloadTile(he,ie)}abortTile(j,Z,ie){this.getWorkerSource(j,Z.type,Z.source).abortTile(Z,ie)}removeTile(j,Z,ie){this.getWorkerSource(j,Z.type,Z.source).removeTile(Z,ie)}removeSource(j,Z,ie){if(!this.workerSources[j]||!this.workerSources[j][Z.type]||!this.workerSources[j][Z.type][Z.source])return;const he=this.workerSources[j][Z.type][Z.source];delete this.workerSources[j][Z.type][Z.source],void 0!==he.removeSource?he.removeSource(Z,ie):ie()}loadWorkerSource(j,Z,ie){try{this.self.importScripts(Z.url),ie()}catch(he){ie(he.toString())}}syncRTLPluginState(j,Z,ie){try{f.plugin.setState(Z);const he=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=he){this.self.importScripts(he);const ge=f.plugin.isParsed();ie(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),ge)}}catch(he){ie(he.toString())}}getAvailableImages(j){let Z=this.availableImages[j];return Z||(Z=[]),Z}getLayerIndex(j){let Z=this.layerIndexes[j];return Z||(Z=this.layerIndexes[j]=new Pt),Z}getWorkerSource(j,Z,ie){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][Z]||(this.workerSources[j][Z]={}),this.workerSources[j][Z][ie]||(this.workerSources[j][Z][ie]=new this.workerSourceTypes[Z]({send:(he,ge,ke,Le,Ce,Oe)=>{this.actor.send(he,ge,ke,j,Ce,Oe)},scheduler:this.actor.scheduler},this.getLayerIndex(j),this.getAvailableImages(j),this.isSpriteLoaded)),this.workerSources[j][Z][ie]}getDEMWorkerSource(j,Z){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][Z]||(this.demWorkerSources[j][Z]=new Ie),this.demWorkerSources[j][Z]}enforceCacheSizeLimit(j,Z){f.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(j,Z,ie){ie(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new pn(self)),pn}),ne(0,function(f){var Vt=it;function it(h){return r=h,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{y=new Worker(T),p=!0}catch(A){p=!1}return y&&y.terminate(),URL.revokeObjectURL(T),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===Pt[l=r&&r.failIfMajorPerformanceCaveat]&&(Pt[l]=function(p){var y,T,A,R,v=(T=p,A=document.createElement("canvas"),(R=Object.create(it.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch(T){return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),!0===v.getShaderParameter(y,v.COMPILE_STATUS))}(l)),!Pt[l]||document.documentMode));var r,l}var Pt={};function je(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!je(h[l],r[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==r){if("object"!=typeof r||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!je(h[l],r[l]))return!1;return!0}return h===r}it.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ie={create:function(h,r,l){const p=f.window.document.createElement(h);return void 0!==r&&(p.className=r),l&&l.appendChild(p),p},createNS:function(h,r){return f.window.document.createElementNS(h,r)}},Te=f.window.document&&f.window.document.documentElement.style,He=Te&&void 0!==Te.userSelect?"userSelect":"WebkitUserSelect";let Qe;Ie.disableDrag=function(){Te&&He&&(Qe=Te[He],Te[He]="none")},Ie.enableDrag=function(){Te&&He&&(Te[He]=Qe)},Ie.setTransform=function(h,r){h.style.transform=r};let _t=!1;try{const h=Object.defineProperty({},"passive",{get(){_t=!0}});f.window.addEventListener("test",h,h),f.window.removeEventListener("test",h,h)}catch(h){_t=!1}Ie.addEventListener=function(h,r,l,p={}){h.addEventListener(r,l,"passive"in p&&_t?p:p.capture)},Ie.removeEventListener=function(h,r,l,p={}){h.removeEventListener(r,l,"passive"in p&&_t?p:p.capture)};const mt=function(h){h.preventDefault(),h.stopPropagation(),f.window.removeEventListener("click",mt,!0)};function Tt(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new f.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}Ie.suppressClick=function(){f.window.addEventListener("click",mt,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",mt,!0)},0)},Ie.mousePos=function(h,r){const l=h.getBoundingClientRect();return Tt(h,l,r)},Ie.touchPos=function(h,r){const l=h.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(Tt(h,l,r[y]));return p},Ie.mouseButton=function(h){return void 0!==f.window.InstallTrigger&&2===h.button&&h.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},Ie.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};class et{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,p){const y=f.dot(l,this.dir);if(Math.abs(y)<1e-6)return!1;const v=f.dot(f.sub(f.create(),r,this.pos),l)/y,T=f.scaleAndAdd(f.create(),this.pos,this.dir,v);return f.copy(p,T),!0}}class Qt{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,p){const y=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const R=f.transformMat4([],A,r),N=1/R[3]/l*y;return f.mul(R,R,[N,N,1/R[3],N])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const R=f.sub([],v[A[0]],v[A[1]]),N=f.sub([],v[A[2]],v[A[1]]),U=f.normalize([],f.cross([],R,N)),H=-f.dot(U,v[A[1]]);return U.concat(H)});return new Qt(v,T)}}class Pn{constructor(r,l){this.min=r,this.max=l,this.center=f.scale([],f.add([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],p=f.clone(this.min),y=f.clone(this.max);for(let v=0;v<l.length;v++)p[v]=l[v]?this.min[v]:this.center[v],y[v]=l[v]?this.center[v]:this.max[v];return y[2]=this.max[2],new Pn(p,y)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}intersects(r){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let y=0;y<r.planes.length;y++){const v=r.planes[y];let T=0;for(let A=0;A<l.length;A++)T+=f.dot$1(v,l[A])>=0;if(0===T)return 0;T!==l.length&&(p=!1)}if(p)return 2;for(let y=0;y<3;y++){let v=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const R=r.points[A][y]-this.min[y];v=Math.min(v,R),T=Math.max(T,R)}if(T<0||v>this.max[y]-this.min[y])return 0}return 1}}function zt(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class Dt extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new f.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||l<y[1])return!1;p=y[1]}return!0}_validateContent(r,l){return!(r&&(4!==r.length||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const y of r)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const y of r){this.images[y]||this.fire(new f.Event("styleimagemissing",{id:y}));const v=this.images[y];v?p[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:f.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new f.ImagePosition(y,p);this.patterns[r]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:l,h:p}=f.potpack(r),y=this.atlasImage;y.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:T}=this.patterns[v],A=T.x+1,R=T.y+1,N=this.images[v].data,U=N.width,H=N.height;f.RGBAImage.copy(N,y,{x:0,y:0},{x:A,y:R},{width:U,height:H}),f.RGBAImage.copy(N,y,{x:0,y:H-1},{x:A,y:R-1},{width:U,height:1}),f.RGBAImage.copy(N,y,{x:0,y:0},{x:A,y:R+H},{width:U,height:1}),f.RGBAImage.copy(N,y,{x:U-1,y:0},{x:A-1,y:R},{width:1,height:H}),f.RGBAImage.copy(N,y,{x:0,y:0},{x:A+U,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];zt(p)&&this.updateImage(l,p)}}}const ni=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(h,r){return function([l,p,y]){const v=f.degToRad(p+90),T=f.degToRad(y);return{x:l*Math.cos(v)*Math.sin(T),y:l*Math.sin(v)*Math.sin(T),z:l*Math.cos(T),azimuthal:p,polar:y}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:f.number(h.x,r.x,l),y:f.number(h.y,r.y,l),z:f.number(h.z,r.z,l),azimuthal:f.number(h.azimuthal,r.azimuthal,l),polar:f.number(h.polar,r.polar,l)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),Kr="-transition";class Tn extends f.Evented{constructor(r){super(),this._transitionable=new f.Transitionable(ni),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(f.validateLight,r,l))for(const p in r){const y=r[p];f.endsWith(p,Kr)?this._transitionable.setTransition(p.slice(0,-Kr.length),y):this._transitionable.setValue(p,y)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&f.emitValidationErrors(this,r.call(f.validateStyle,f.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const ha=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),Bi="-transition";class Ft extends f.Evented{constructor(r){super(),this._transitionable=new f.Transitionable(ha),this.set(r),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];f.endsWith(l,Bi)?this._transitionable.setTransition(l.slice(0,-Bi.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function _n(h,r,l,p){const y=f.smoothstep(45,65,l),[v,T]=Xn(h,p),A=f.length(r);let R=1-Math.min(1,Math.exp((A-v)/(T-v)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*y*h.alpha}function Xn(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const Hn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"])}),Jt="-transition";class In extends f.Evented{constructor(r){super(),this._transitionable=new f.Transitionable(Hn),this.set(r),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(f.validateFog,r,l))for(const p in r){const y=r[p];f.endsWith(p,Jt)?this._transitionable.setTransition(p.slice(0,-Jt.length),y):this._transitionable.setValue(p,y)}}getOpacity(r){const l=this.properties&&this.properties.get("color")||1;return f.smoothstep(45,65,r)*l.a}getOpacityAtLatLng(r,l){return function(p,y,v){const T=f.MercatorCoordinate.fromLngLat(y),A=v.elevation?v.elevation.getAtPointOrZero(T):0,R=[T.x,T.y,A];return f.transformMat4$1(R,R,v.mercatorFogMatrix),_n(p,R,v.pitch,v._fov)}(this.state,r,l)}getFovAdjustedRange(r){return Xn(this.state,r)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&f.emitValidationErrors(this,r.call(f.validateStyle,f.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class pt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const v=new pt.Actor(p[y],l,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){f.asyncAll(this.actors,(y,v)=>{y.send(r,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Rn(h,r,l){return r*(f.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}pt.Actor=f.Actor;class Ur{constructor(r,l,p,y){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>y.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,l){let p,y;if(r instanceof f.pointGeometry||"number"==typeof r[0]){const v=f.pointGeometry.convert(r);p=[f.pointGeometry.convert(r)],y=l.isPointAboveHorizon(v)}else{const v=f.pointGeometry.convert(r[0]),T=f.pointGeometry.convert(r[1]);p=[v,T],y=f.polygonizeBounds(v,T).every(A=>l.isPointAboveHorizon(A))}return new Ur(p,l.getCameraPoint(),y,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],y=f.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),f.bufferConvexPolygon(y,r)}containsTile(r,l,p){const y=r.queryPadding+1,v=p?this._bufferedCameraMercator(y,l).map(Y=>r.tileID.getTilePoint(Y)):this._bufferedScreenMercator(y,l).map(Y=>r.tileID.getTilePoint(Y)),T=this.screenGeometryMercator.map(Y=>r.tileID.getTileVec3(Y)),A=T.map(Y=>new f.pointGeometry(Y[0],Y[1])),R=l.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),N=r.tileID.getTileVec3(R),U=T.map(Y=>{const se=f.sub(Y,Y,N);return f.normalize(se,se),new et(N,se)}),H=Rn(r,1,l.zoom);if(f.polygonIntersectsBox(v,0,0,f.EXTENT,f.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:U,bufferedTilespaceGeometry:v,bufferedTilespaceBounds:(q=f.getBounds(v),q.min.x=f.clamp(q.min.x,0,f.EXTENT),q.min.y=f.clamp(q.min.y,0,f.EXTENT),q.max.x=f.clamp(q.max.x,0,f.EXTENT),q.max.y=f.clamp(q.max.y,0,f.EXTENT),q),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:H};var q}_bufferedScreenMercator(r,l){const p=er(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const y=this.bufferedScreenGeometry(r).map(v=>l.pointCoordinate3D(v));return this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,l){const p=er(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const y=this.bufferedCameraGeometry(r).map(v=>l.pointCoordinate3D(v));return this._cameraRaycastCache[p]=y,y}}}function er(h){return 100*h|0}function fr(h,r,l){const p=function(y,v){if(y)return l(y);if(v){const T=f.pick(f.extend(v,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(T.vectorLayers=v.vector_layers,T.vectorLayerIds=T.vectorLayers.map(A=>A.id)),T.tiles=r.canonicalizeTileset(T,h.url),l(null,T)}};return h.url?f.getJSON(r.transformRequest(r.normalizeSourceURL(h.url),f.ResourceType.Source),p):f.exported.frame(()=>p(null,h))}class Ss{constructor(r,l,p){this.bounds=f.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*l),y=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<v&&r.y>=y&&r.y<T}}class Ji{constructor(r,l,p){this.context=r;const y=r.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ho={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bo{constructor(r,l,p,y){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const y=l.attributes[this.attributes[p].name];void 0!==y&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,l,p){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],T=l.attributes[v.name];void 0!==T&&r.vertexAttribPointer(T,v.components,r[ho[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fo extends fn{getDefault(){return f.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mi extends fn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Lr extends fn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Dr extends fn{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class an extends fn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class eo extends fn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Fn extends fn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class jr extends fn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class tr extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class to extends fn{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class nr extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Or extends fn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Vi extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Er extends fn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ui extends fn{getDefault(){return f.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ri extends fn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Ai extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Do extends fn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class gi extends fn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class ii extends fn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Nt extends fn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Kn extends fn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $t extends fn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class qt extends fn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class oi extends fn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class si extends fn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Tr extends fn{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class qn extends fn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class $r extends fn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class os extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Kt extends fn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class po extends fn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Ln extends po{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ss extends po{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class _i extends ss{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vn{constructor(r,l,p,y){this.context=r,this.width=l,this.height=p;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ln(r,v),y&&(this.depthAttachment=new ss(r,v))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class Mi{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new fo(this),this.clearDepth=new mi(this),this.clearStencil=new Lr(this),this.colorMask=new Dr(this),this.depthMask=new an(this),this.stencilMask=new eo(this),this.stencilFunc=new Fn(this),this.stencilOp=new jr(this),this.stencilTest=new tr(this),this.depthRange=new to(this),this.depthTest=new nr(this),this.depthFunc=new Or(this),this.blend=new Vi(this),this.blendFunc=new Er(this),this.blendColor=new Ui(this),this.blendEquation=new ri(this),this.cullFace=new Ai(this),this.cullFaceSide=new Do(this),this.frontFace=new gi(this),this.program=new ii(this),this.activeTexture=new Nt(this),this.viewport=new Kn(this),this.bindFramebuffer=new $t(this),this.bindRenderbuffer=new qt(this),this.bindTexture=new oi(this),this.bindVertexBuffer=new si(this),this.bindElementBuffer=new Tr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qn(this),this.pixelStoreUnpack=new $r(this),this.pixelStoreUnpackPremultiplyAlpha=new os(this),this.pixelStoreUnpackFlipY=new Kt(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Ji(this,r,l)}createVertexBuffer(r,l,p){return new Bo(this,r,l,p)}createRenderbuffer(r,l,p){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,l,p){return new vn(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const y=this.gl;let v=0;r&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),y.clear(v)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){je(r.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ji extends f.Evented{constructor(r,l,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},l),f.extend(this,f.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fr(this._options,this.map._requestManager,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new f.ErrorEvent(r)):l&&(f.extend(this,l),l.bounds&&(this.tileBounds=new Ss(l.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(l.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=f.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=f.getImage(this.map._requestManager.transformRequest(y,f.ResourceType.Tile),(v,T,A,R)=>{if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(v)r.state="errored",l(v);else if(T){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:R});const N=this.map.painter.context,U=N.gl;r.texture=this.map.painter.getTileTexture(T.width),r.texture?r.texture.update(T,{useMipmap:!0}):(r.texture=new f.Texture(N,T,U.RGBA,{useMipmap:!0}),r.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),N.extTextureFilterAnisotropic&&U.texParameterf(U.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax)),r.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let ai;var pn=f.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class re extends f.Evented{constructor(r,l,p,y){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=l}load(r,l){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(p,y)=>{this._loaded=!0,p?this.fire(new f.ErrorEvent(p)):y&&(this.image=f.exported.getImageData(y),r&&(this.coordinates=r),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r;const l=r.map(f.MercatorCoordinate.fromLngLat);this.tileID=function(y){let v=1/0,T=1/0,A=-1/0,R=-1/0;for(const q of y)v=Math.min(v,q.x),T=Math.min(T,q.y),A=Math.max(A,q.x),R=Math.max(R,q.y);const N=Math.max(A-v,R-T),U=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),H=Math.pow(2,U);return new f.CanonicalTileID(U,Math.floor((v+A)/2*H),Math.floor((T+R)/2*H))}(l),this.minzoom=this.maxzoom=this.tileID.z;const p=l.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new f.StructArrayLayout4i8,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,f.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,f.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,f.EXTENT,f.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,l=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new f.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const j={vector:class extends f.Evented{constructor(h,r,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(r,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fr(this._options,this.map._requestManager,(h,r)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new f.ErrorEvent(h)):r&&(f.extend(this,r),r.bounds&&(this.tileBounds=new Ss(r.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h();const r=this.map.style._getSourceCaches(this.id);for(const l of r)l.clearTiles();this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,f.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&"expired"!==h.state)"loading"===h.state?h.reloadCallback=r:h.request=h.actor.send("reloadTile",p,y.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,y.bind(this),void 0,!0);else{const v=f.loadVectorTile.call({deduped:this._deduped},p,(T,A)=>{T||!A?y.call(this,T):(p.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,y.bind(this),void 0,!0))},!0);h.request={cancel:v}}function y(v,T){return delete h.request,h.aborted?r(null):v&&404!==v.status?r(v):(T&&T.resourceTiming&&(h.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&h.setExpiryData(T),h.loadVectorData(T,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ji,"raster-dem":class extends ji{constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(h.state="errored",r(y)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=f.getImage(this.map._requestManager.transformRequest(l,f.ResourceType.Tile),function(y,v,T,A){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(y)h.state="errored",r(y);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:A});const R=f.window.ImageBitmap&&v instanceof f.window.ImageBitmap&&(null==ai&&(ai=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),ai),N=1-(v.width-f.prevPowerOfTwo(v.width))/2;N<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const U=R?v:f.exported.getImageData(v,N),H={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:U,encoding:this.encoding,padding:N};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",H,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,y=0===r.x?h.wrap-1:h.wrap,v=(r.x+1+l)%l,T=r.x+1===l?h.wrap+1:h.wrap,A={};return A[new f.OverscaledTileID(h.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},A[new f.OverscaledTileID(h.overscaledZ,T,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(A[new f.OverscaledTileID(h.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},A[new f.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new f.OverscaledTileID(h.overscaledZ,T,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(A[new f.OverscaledTileID(h.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},A[new f.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new f.OverscaledTileID(h.overscaledZ,T,r.z,v,r.y+1).key]={backfilled:!1}),A}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends f.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=f.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*y,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*y,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=f.extend({},this.workerOptions),r=this._data;"string"==typeof r?(h.request=this.map._requestManager.transformRequest(f.exported.resolveURL(r),f.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new f.ErrorEvent(l));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y.resourceTiming=p.resourceTiming[this.id]),this.fire(new f.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,y)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(y,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends re{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,f.ResourceType.Source).url);f.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new f.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const l in this.tiles){const p=this.tiles[l];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:re,canvas:class extends re{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(v=>"number"!=typeof v))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context,l=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(r,this.canvas,l.RGBA,{premultiply:!0});for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}},Z=function(h,r,l,p){const y=new j[r.type](h,r,l,p);if(y.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${y.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],y),y};function ie(h,r){const l=f.identity([]);return f.scale$1(l,l,[.5*h.width,.5*-h.height,1]),f.translate(l,l,[1,-1,0]),f.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped()))}function he(h,r,l,p,y,v,T,A=!1){const R=h.tilesIn(p,T,A);R.sort(ke);const N=[];for(const H of R)N.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(r,l,h._state,H,y,v,ie(h.transform,H.tile.tileID),A)});const U=function(H){const q={},Y={};for(const se of H){const le=se.queryResults,_e=se.wrappedTileID,ee=Y[_e]=Y[_e]||{};for(const ce in le){const me=le[ce],xe=ee[ce]=ee[ce]||{},Se=q[ce]=q[ce]||[];for(const fe of me)xe[fe.featureIndex]||(xe[fe.featureIndex]=!0,Se.push(fe))}}return q}(N);for(const H in U)U[H].forEach(q=>{const Y=q.feature,se=h.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=se});return U}function ge(h,r){const l=h.getRenderableIds().map(v=>h.getTileByID(v)),p=[],y={};for(let v=0;v<l.length;v++){const T=l[v],A=T.tileID.canonical.key;y[A]||(y[A]=!0,T.querySourceFeatures(p,r))}return p}function ke(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Le(){return null!=X.workerClass?new X.workerClass:new f.window.Worker(X.workerUrl)}const Ce="mapboxgl_preloaded_worker_pool";class Oe{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Oe.workerCount;)this.workers.push(new Le);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ce]}numActive(){return Object.keys(this.active).length}}let Xe;function ut(){return Xe||(Xe=new Oe),Xe}function Ue(h,r){const l={};for(const p in h)"ref"!==p&&(l[p]=h[p]);return f.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function kt(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=Ue(h[l],r[h[l].ref]));return h}Oe.workerCount=2;const ve={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ge(h,r,l){l.push({command:ve.addSource,args:[h,r[h]]})}function Ut(h,r,l){r.push({command:ve.removeSource,args:[h]}),l[h]=!0}function rn(h,r,l,p){Ut(h,l,p),Ge(h,r,l)}function Lt(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&"data"!==p&&!je(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&"data"!==p&&!je(h[l][p],r[l][p]))return!1;return!0}function un(h,r,l,p,y,v){let T;for(T in r=r||{},h=h||{})h.hasOwnProperty(T)&&(je(h[T],r[T])||l.push({command:v,args:[p,T,r[T],y]}));for(T in r)r.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(je(h[T],r[T])||l.push({command:v,args:[p,T,r[T],y]}))}function Ht(h){return h.id}function hn(h,r){return h[r.id]=r,h}class Pi{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=f.clamp(r,0,1);let l=1,p=this._distances[l];const y=r*this.paddedLength+this.padding;for(;p<y&&l<this._distances.length;)p=this._distances[++l];const v=l-1,T=this._distances[v],A=p-T,R=A>0?(y-T)/A:0;return this.points[v].mult(1-R).add(this.points[l].mult(R))}}class ft{constructor(r,l,p){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,y,v){this._forEachCell(l,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(r,l,p,y){this._forEachCell(l-y,p-y,l+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,l,p,y,v,T){this.boxCells[v].push(T)}_insertCircleCell(r,l,p,y,v,T){this.circleCells[v].push(T)}_query(r,l,p,y,v,T){if(p<0||r>this.width||y<0||l>this.height)return!v&&[];const A=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const N=this.circles[3*R],U=this.circles[3*R+1],H=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:N-H,y1:U-H,x2:N+H,y2:U+H})}return T?A.filter(T):A}return this._forEachCell(r,l,p,y,this._queryCell,A,{hitTest:v,seenUids:{box:{},circle:{}}},T),v?A.length>0:A}_queryCircle(r,l,p,y,v){const T=r-p,A=r+p,R=l-p,N=l+p;if(A<0||T>this.width||N<0||R>this.height)return!y&&[];const U=[];return this._forEachCell(T,R,A,N,this._queryCellCircle,U,{hitTest:y,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},v),y?U.length>0:U}query(r,l,p,y,v){return this._query(r,l,p,y,!1,v)}hitTest(r,l,p,y,v){return this._query(r,l,p,y,!0,v)}hitTestCircle(r,l,p,y){return this._queryCircle(r,l,p,!0,y)}_queryCell(r,l,p,y,v,T,A,R){const N=A.seenUids,U=this.boxCells[v];if(null!==U){const q=this.bboxes;for(const Y of U)if(!N.box[Y]){N.box[Y]=!0;const se=4*Y;if(r<=q[se+2]&&l<=q[se+3]&&p>=q[se+0]&&y>=q[se+1]&&(!R||R(this.boxKeys[Y]))){if(A.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Y],x1:q[se],y1:q[se+1],x2:q[se+2],y2:q[se+3]})}}}const H=this.circleCells[v];if(null!==H){const q=this.circles;for(const Y of H)if(!N.circle[Y]){N.circle[Y]=!0;const se=3*Y;if(this._circleAndRectCollide(q[se],q[se+1],q[se+2],r,l,p,y)&&(!R||R(this.circleKeys[Y]))){if(A.hitTest)return T.push(!0),!0;{const le=q[se],_e=q[se+1],ee=q[se+2];T.push({key:this.circleKeys[Y],x1:le-ee,y1:_e-ee,x2:le+ee,y2:_e+ee})}}}}}_queryCellCircle(r,l,p,y,v,T,A,R){const N=A.circle,U=A.seenUids,H=this.boxCells[v];if(null!==H){const Y=this.bboxes;for(const se of H)if(!U.box[se]){U.box[se]=!0;const le=4*se;if(this._circleAndRectCollide(N.x,N.y,N.radius,Y[le+0],Y[le+1],Y[le+2],Y[le+3])&&(!R||R(this.boxKeys[se])))return T.push(!0),!0}}const q=this.circleCells[v];if(null!==q){const Y=this.circles;for(const se of q)if(!U.circle[se]){U.circle[se]=!0;const le=3*se;if(this._circlesCollide(Y[le],Y[le+1],Y[le+2],N.x,N.y,N.radius)&&(!R||R(this.circleKeys[se])))return T.push(!0),!0}}}_forEachCell(r,l,p,y,v,T,A,R){const N=this._convertToXCellCoord(r),U=this._convertToYCellCoord(l),H=this._convertToXCellCoord(p),q=this._convertToYCellCoord(y);for(let Y=N;Y<=H;Y++)for(let se=U;se<=q;se++)if(v.call(this,r,l,p,y,this.xCellCount*se+Y,T,A,R))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,y,v,T){const A=y-r,R=v-l,N=p+T;return N*N>A*A+R*R}_circleAndRectCollide(r,l,p,y,v,T,A){const R=(T-y)/2,N=Math.abs(r-(y+R));if(N>R+p)return!1;const U=(A-v)/2,H=Math.abs(l-(v+U));if(H>U+p)return!1;if(N<=R||H<=U)return!0;const q=N-R,Y=H-U;return q*q+Y*Y<=p*p}}const nt=Math.tan(85*Math.PI/180);function gt(h,r,l,p,y){const v=f.create$1();return r?(f.scale$1(v,v,[1/y,1/y,1]),l||f.rotateZ(v,v,p.angle)):f.multiply(v,p.labelPlaneMatrix,h),v}function on(h,r,l,p,y){if(r){const v=f.clone$1(h);return f.scale$1(v,v,[y,y,1]),l||f.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function xn(h,r,l=0){const p=[h.x,h.y,l,1];l?f.transformMat4(p,p,r):ae(p,p,r);const y=p[3];return{point:new f.pointGeometry(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function Wt(h,r){return Math.min(.5+h/r*.5,1.5)}function hr(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function Ri(h,r,l,p,y,v,T,A,R){const N=p?h.textSizeData:h.iconSizeData,U=f.evaluateSizeForZoom(N,l.transform.zoom),H=[256/l.width*2+1,256/l.height*2+1],q=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;q.clear();const Y=h.lineVertexArray,se=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,le=l.transform.width/l.transform.height;let _e=!1;for(let ee=0;ee<se.length;ee++){const ce=se.get(ee);if(ce.writingMode!==f.WritingMode.vertical||_e||0!==ee&&se.get(ee-1).writingMode===f.WritingMode.horizontal||(_e=!0),ce.hidden||ce.writingMode===f.WritingMode.vertical&&!_e){pe(ce.numGlyphs,q);continue}_e=!1;const me=new f.pointGeometry(ce.tileAnchorX,ce.tileAnchorY),xe=R?R(me):0,Se=[me.x,me.y,xe],fe=[...Se,1];if(f.transformMat4(fe,fe,r),!hr(fe,H)){pe(ce.numGlyphs,q);continue}const Fe=Wt(l.transform.cameraToCenterDistance,fe[3]),Ke=f.evaluateSizeForFeature(N,U,ce),st=T?Ke/Fe:Ke*Fe,Re=xn(new f.pointGeometry(Se[0],Se[1]),y,Se[2]);if(Re.signedDistanceFromCamera<=0){pe(ce.numGlyphs,q);continue}let qe={};const vt=T?null:R,It=Vn(ce,st,!1,A,r,y,v,h.glyphOffsetArray,Y,q,Re.point,me,qe,le,vt);_e=It.useVertical,vt&&It.needsFlipping&&(qe={}),(It.notEnoughRoom||_e||It.needsFlipping&&Vn(ce,st,!0,A,r,y,v,h.glyphOffsetArray,Y,q,Re.point,me,qe,le,vt).notEnoughRoom)&&pe(ce.numGlyphs,q)}p?h.text.dynamicLayoutVertexBuffer.updateData(q):h.icon.dynamicLayoutVertexBuffer.updateData(q)}function Zn(h,r,l,p,y,v,T,A,R,N,U,H,q){const Y=A.glyphStartIndex+A.numGlyphs,se=A.lineStartIndex,le=A.lineStartIndex+A.lineLength,_e=r.getoffsetX(A.glyphStartIndex),ee=r.getoffsetX(Y-1),ce=Gr(h*_e,l,p,y,v,T,A.segment,se,le,R,N,U,H,q,!0);if(!ce)return null;const me=Gr(h*ee,l,p,y,v,T,A.segment,se,le,R,N,U,H,q,!0);return me?{first:ce,last:me}:null}function Sr(h,r,l,p){return h.writingMode===f.WritingMode.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*p?{useVertical:!0}:h.writingMode===f.WritingMode.vertical?r.y<l.y?{needsFlipping:!0}:null:0!==h.flipState&&function(y,v,T){const A=(v.x-y.x)*T;return 0===A||Math.abs((v.y-y.y)/A)>nt}(r,l,p)?1===h.flipState?{needsFlipping:!0}:null:r.x>l.x?{needsFlipping:!0}:null}function Vn(h,r,l,p,y,v,T,A,R,N,U,H,q,Y,se){const le=r/24,_e=h.lineOffsetX*le,ee=h.lineOffsetY*le;let ce;if(h.numGlyphs>1){const me=h.glyphStartIndex+h.numGlyphs,xe=h.lineStartIndex,Se=h.lineStartIndex+h.lineLength,fe=Zn(le,A,_e,ee,l,U,H,h,R,v,q,se,!1);if(!fe)return{notEnoughRoom:!0};const Fe=xn(fe.first.point,T).point,Ke=xn(fe.last.point,T).point;if(p&&!l){const st=Sr(h,Fe,Ke,Y);if(h.flipState=st&&st.needsFlipping?1:2,st)return st}ce=[fe.first];for(let st=h.glyphStartIndex+1;st<me-1;st++)ce.push(Gr(le*A.getoffsetX(st),_e,ee,l,U,H,h.segment,xe,Se,R,v,q,se,!1,!1));ce.push(fe.last)}else{if(p&&!l){const xe=xn(H,y).point,Se=h.lineStartIndex+h.segment+1,fe=new f.pointGeometry(R.getx(Se),R.gety(Se)),Fe=xn(fe,y),Ke=Sr(h,xe,Fe.signedDistanceFromCamera>0?Fe.point:ki(H,fe,xe,1,y,void 0),Y);if(h.flipState=Ke&&Ke.needsFlipping?1:2,Ke)return Ke}const me=Gr(le*A.getoffsetX(h.glyphStartIndex),_e,ee,l,U,H,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,R,v,q,se,!1,!1);if(!me)return{notEnoughRoom:!0};ce=[me]}for(const me of ce)f.addDynamicAttributes(N,me.point,me.angle);return{}}function ln(h,r,l){const p={x:h.x,y:h.y,z:0};if(!l)return xn(p,r,p.z);const y=l(h);return xn(new f.pointGeometry(p.x,p.y),r,p.z+y)}function ki(h,r,l,p,y,v){const T=ln(h.add(h.sub(r)._unit()),y,v).point,A=l.sub(T);return l.add(A._mult(p/A.mag()))}function Gr(h,r,l,p,y,v,T,A,R,N,U,H,q,Y,se){const le=p?h-r:h+r;let _e=le>0?1:-1,ee=0;p&&(_e*=-1,ee=Math.PI),_e<0&&(ee+=Math.PI);let ce=_e>0?A+T:A+T+1,me=y,xe=y,Se=0,fe=0;const Fe=Math.abs(le),Ke=[],st=[];let Re=v;const qe=()=>{const wn=ce-_e;return 0===Se?v:new f.pointGeometry(N.getx(wn),N.gety(wn))},vt=()=>ki(qe(),Re,xe,Fe-Se+1,U,q);for(;Se+fe<=Fe;){if(ce+=_e,ce<A||ce>=R)return null;if(xe=me,Ke.push(me),Y&&st.push(Re||qe()),me=H[ce],void 0===me){Re=new f.pointGeometry(N.getx(ce),N.gety(ce));const wn=ln(Re,U,q);me=wn.signedDistanceFromCamera>0?H[ce]=wn.point:vt()}else Re=null;Se+=fe,fe=xe.dist(me)}se&&q&&(Re=Re||new f.pointGeometry(N.getx(ce),N.gety(ce)),H[ce]=me=void 0===H[ce]?me:vt(),fe=xe.dist(me));const It=(Fe-Se)/fe,Ct=me.sub(xe),yt=Ct.mult(It)._add(xe);l&&yt._add(Ct._unit()._perp()._mult(l*_e));const Mt=ee+Math.atan2(me.y-xe.y,me.x-xe.x);return Ke.push(yt),Y&&(Re=Re||new f.pointGeometry(N.getx(ce),N.gety(ce)),st.push(function(wn,nn,Rr){const xr=1-Rr;return new f.pointGeometry(wn.x*xr+nn.x*Rr,wn.y*xr+nn.y*Rr)}(st.length>0?st[st.length-1]:Re,Re,It))),{point:yt,angle:Mt,path:Ke,tilePath:st}}const we=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pe(h,r){for(let l=0;l<h;l++){const p=r.length;r.resize(p+4),r.float32.set(we,3*p)}}function ae(h,r,l){const p=r[0],y=r[1];return h[0]=l[0]*p+l[4]*y+l[12],h[1]=l[1]*p+l[5]*y+l[13],h[3]=l[3]*p+l[7]*y+l[15],h}const De=100;class Je{constructor(r,l,p=new ft(r.width+200,r.height+200,25),y=new ft(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+De,this.screenBottomBoundary=r.height+De,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,y,v,T,A){let R=l.projectedAnchorZ;l.elevation&&(R+=l.elevation);const N=this.projectAndGetPerspectiveRatio(T,l.projectedAnchorX,l.projectedAnchorY,R,l.tileID),U=v*N.perspectiveRatio,H=(l.x1*r+p.x-l.padding)*U+N.point.x,q=(l.y1*r+p.y-l.padding)*U+N.point.y,Y=(l.x2*r+p.x+l.padding)*U+N.point.x,se=(l.y2*r+p.y+l.padding)*U+N.point.y,le=N.perspectiveRatio<=.55||N.aboveHorizon;return!this.isInsideGrid(H,q,Y,se)||!y&&this.grid.hitTest(H,q,Y,se,A)||le?{box:[],offscreen:!1}:{box:[H,q,Y,se],offscreen:this.isOffscreen(H,q,Y,se)}}placeCollisionCircles(r,l,p,y,v,T,A,R,N,U,H,q,Y,se){const le=[],_e=this.transform.elevation,ee=_e?vt=>_e.getAtTileOffset(se,vt.x,vt.y):vt=>0,ce=new f.pointGeometry(l.tileAnchorX,l.tileAnchorY),me=ee(ce),xe=this.projectAndGetPerspectiveRatio(T,ce.x,ce.y,me,se),{perspectiveRatio:Se}=xe,fe=(U?v/Se:v*Se)/f.ONE_EM,Fe=xn(ce,A,me).point,Ke=xe.signedDistanceFromCamera>0?Zn(fe,y,l.lineOffsetX*fe,l.lineOffsetY*fe,!1,Fe,ce,l,p,A,{},_e&&!U?ee:null,U&&!!_e):null;let st=!1,Re=!1,qe=!0;if(Ke&&!xe.aboveHorizon){const vt=.5*q*Se+Y,It=new f.pointGeometry(-100,-100),Ct=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),yt=new Pi,Mt=Ke.first,wn=Ke.last;let nn=[];for(let mn=Mt.path.length-1;mn>=1;mn--)nn.push(Mt.path[mn]);for(let mn=1;mn<wn.path.length;mn++)nn.push(wn.path[mn]);const Rr=2.5*vt;if(R){const mn=nn.map(_e?(dn,yr)=>{const io=ee(yr<Mt.path.length-1?Mt.tilePath[Mt.path.length-1-yr]:wn.tilePath[yr-Mt.path.length+2]);return xn(dn,R,io)}:dn=>xn(dn,R));nn=mn.some(dn=>dn.signedDistanceFromCamera<=0)?[]:mn.map(dn=>dn.point)}let xr=[];if(nn.length>0){const mn=nn[0].clone(),dn=nn[0].clone();for(let yr=1;yr<nn.length;yr++)mn.x=Math.min(mn.x,nn[yr].x),mn.y=Math.min(mn.y,nn[yr].y),dn.x=Math.max(dn.x,nn[yr].x),dn.y=Math.max(dn.y,nn[yr].y);xr=mn.x>=It.x&&dn.x<=Ct.x&&mn.y>=It.y&&dn.y<=Ct.y?[nn]:dn.x<It.x||mn.x>Ct.x||dn.y<It.y||mn.y>Ct.y?[]:f.clipLine([nn],It.x,It.y,Ct.x,Ct.y)}for(const mn of xr){yt.reset(mn,.25*vt);let dn=0;dn=yt.length<=.5*vt?1:Math.ceil(yt.paddedLength/Rr)+1;for(let yr=0;yr<dn;yr++){const io=yr/Math.max(dn-1,1),Qs=yt.lerp(io),ei=Qs.x+De,Yi=Qs.y+De;le.push(ei,Yi,vt,0);const oo=ei-vt,Js=Yi-vt,cr=ei+vt,Ir=Yi+vt;if(qe=qe&&this.isOffscreen(oo,Js,cr,Ir),Re=Re||this.isInsideGrid(oo,Js,cr,Ir),!r&&this.grid.hitTestCircle(ei,Yi,vt,H)&&(st=!0,!N))return{circles:[],offscreen:!1,collisionDetected:st}}}}return{circles:!N&&st||!Re?[]:le,offscreen:qe,collisionDetected:st}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,y=1/0,v=-1/0,T=-1/0;for(const U of r){const H=new f.pointGeometry(U.x+De,U.y+De);p=Math.min(p,H.x),y=Math.min(y,H.y),v=Math.max(v,H.x),T=Math.max(T,H.y),l.push(H)}const A=this.grid.query(p,y,v,T).concat(this.ignoredGrid.query(p,y,v,T)),R={},N={};for(const U of A){const H=U.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const q=[new f.pointGeometry(U.x1,U.y1),new f.pointGeometry(U.x2,U.y1),new f.pointGeometry(U.x2,U.y2),new f.pointGeometry(U.x1,U.y2)];f.polygonIntersectsPolygon(l,q)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===N[H.bucketInstanceId]&&(N[H.bucketInstanceId]=[]),N[H.bucketInstanceId].push(H.featureIndex))}return N}insertCollisionBox(r,l,p,y,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,y,v){const T=l?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let R=0;R<r.length;R+=4)T.insertCircle(A,r[R],r[R+1],r[R+2])}projectAndGetPerspectiveRatio(r,l,p,y,v){const T=[l,p,y||0,1];let A=!1;if(y||this.transform.pitch>0){f.transformMat4(T,T,r);let R=!1;this.fogState&&v&&(R=function(N,U,H,q,Y,se){const le=se.calculateFogTileMatrix(Y),_e=[U,H,q];return f.transformMat4$1(_e,_e,le),_n(N,_e,se.pitch,se._fov)}(this.fogState,l,p,y||0,v.toUnwrapped(),this.transform)>.9),A=T[2]>T[3]||R}else ae(T,T,r);return{point:new f.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+De,(-T[1]/T[3]+1)/2*this.transform.height+De),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:A}}isOffscreen(r,l,p,y){return p<De||r>=this.screenRightBoundary||y<De||l>this.screenBottomBoundary}isInsideGrid(r,l,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=f.identity([]);return f.translate(r,r,[-100,-100,0]),r}}class Ot{constructor(r,l,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):y&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Et{constructor(r,l,p,y,v){this.text=new Ot(r?r.text:null,l,p,v),this.icon=new Ot(r?r.icon:null,l,y,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kn{constructor(r,l,p){this.text=r,this.icon=l,this.skipFade=p}}class yi{constructor(){this.invProjMatrix=f.create$1(),this.viewportMatrix=f.create$1(),this.circles=[]}}class vi{constructor(r,l,p,y,v){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class lr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function $i(h,r,l,p,y){const{horizontalAlign:v,verticalAlign:T}=f.getAnchorAlignment(h),A=-(v-.5)*r,R=-(T-.5)*l,N=f.evaluateVariableOffset(h,p);return new f.pointGeometry(A+N[0]*y,R+N[1]*y)}function li(h,r,l,p,y){const v=new f.pointGeometry(h,r);return l&&v._rotate(p?y:-y),v}class vr{constructor(r,l,p,y,v){this.transform=r.clone(),this.collisionIndex=new Je(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new lr(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,y){const v=p.getBucket(l),T=p.latestFeatureIndex;if(!v||!T||l.id!==v.layerIds[0])return;const A=p.collisionBoxArray,R=v.layers[0].layout,N=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/f.EXTENT,H=this.transform.calculateProjMatrix(p.tileID.toUnwrapped()),q="map"===R.get("text-pitch-alignment"),Y="map"===R.get("text-rotation-alignment"),se=Rn(p,1,this.transform.zoom),le=gt(H,q,Y,this.transform,se);let _e=null;if(q){const ce=on(H,q,Y,this.transform,se);_e=f.multiply([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[v.bucketInstanceId]=new vi(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,p.tileID);const ee={bucket:v,layout:R,posMatrix:H,textLabelPlaneMatrix:le,labelToScreenMatrix:_e,scale:N,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const ce of v.sortKeyRanges){const{sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:Se}=ce;r.push({sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:Se,parameters:ee})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(r,l,p,y,v,T,A,R,N,U,H,q,Y,se,le,_e,ee,ce){const me=[q.textOffset0,q.textOffset1],xe=$i(r,p,y,me,v),Se=this.collisionIndex.placeCollisionBox(v,l,li(xe.x,xe.y,T,A,this.transform.angle),H,R,N,U.predicate);if((!_e||0!==this.collisionIndex.placeCollisionBox(se.getSymbolInstanceIconSize(ce,this.transform.zoom,Y),_e,li(xe.x,xe.y,T,A,this.transform.angle),H,R,N,U.predicate).box.length)&&Se.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[q.crossTileID].anchor),this.variableOffsets[q.crossTileID]={textOffset:me,width:p,height:y,anchor:r,textScale:v,prevAnchor:fe},this.markUsedJustification(se,r,q,le),se.allowVerticalPlacement&&(this.markUsedOrientation(se,le,q),this.placedOrientations[q.crossTileID]=le),{shift:xe,placedGlyphBoxes:Se}}}placeLayerBucketPart(r,l,p,y){const{bucket:v,layout:T,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:N,textPixelRatio:U,holdingForFade:H,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:se,collisionGroup:le}=r.parameters,_e=T.get("text-optional"),ee=T.get("icon-optional"),ce=T.get("text-allow-overlap"),me=T.get("icon-allow-overlap"),xe="map"===T.get("text-rotation-alignment"),Se="map"===T.get("text-pitch-alignment"),fe="none"!==T.get("icon-text-fit"),Fe="viewport-y"===T.get("symbol-z-order"),Ke=ce&&(me||!v.hasIconData()||ee),st=me&&(ce||!v.hasTextData()||_e);!v.collisionArrays&&q&&v.deserializeCollisionBoxes(q),p&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,q);const Re=(qe,vt,It)=>{if(l[qe.crossTileID])return;if(H)return void(this.placements[qe.crossTileID]=new kn(!1,!1,!1));let Ct=!1,yt=!1,Mt=!0,wn=null,nn={box:null,offscreen:null},Rr={box:null,offscreen:null},xr=null,mn=null,dn=null,yr=0,io=0,Qs=0;It.textFeatureIndex?yr=It.textFeatureIndex:qe.useRuntimeCollisionCircles&&(yr=qe.featureIndex),It.verticalTextFeatureIndex&&(io=It.verticalTextFeatureIndex);const ei=cr=>{cr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||cr.elevation)&&(cr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,cr.tileAnchorX,cr.tileAnchorY):0)},Yi=It.textBox;if(Yi){ei(Yi);const cr=Gn=>{let zr=f.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Gn&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[qe.crossTileID];Xi&&(this.placedOrientations[qe.crossTileID]=Xi,zr=Xi,this.markUsedOrientation(v,zr,qe))}return zr},Ir=(Gn,zr)=>{if(v.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&It.verticalTextBox){for(const Xi of v.writingModes)if(Xi===f.WritingMode.vertical?(nn=zr(),Rr=nn):nn=Gn(),nn&&nn.box&&nn.box.length)break}else nn=Gn()};if(T.get("text-variable-anchor")){let Gn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe.crossTileID]){const rr=this.prevPlacement.variableOffsets[qe.crossTileID];Gn.indexOf(rr.anchor)>0&&(Gn=Gn.filter(Br=>Br!==rr.anchor),Gn.unshift(rr.anchor))}const zr=(rr,Br,Qo)=>{const ur=v.getSymbolInstanceTextSize(Y,qe,this.transform.zoom,vt),xc=(rr.x2-rr.x1)*ur+2*rr.padding,Vu=(rr.y2-rr.y1)*ur+2*rr.padding,Os=fe&&!me?Br:null;Os&&ei(Os);let ys={box:[],offscreen:!1};const Uu=ce?2*Gn.length:Gn.length;for(let jl=0;jl<Uu;++jl){const bc=this.attemptAnchorPlacement(Gn[jl%Gn.length],rr,xc,Vu,ur,xe,Se,U,A,le,jl>=Gn.length,qe,vt,v,Qo,Os,Y,se);if(bc&&(ys=bc.placedGlyphBoxes,ys&&ys.box&&ys.box.length)){Ct=!0,wn=bc.shift;break}}return ys};Ir(()=>zr(Yi,It.iconBox,f.WritingMode.horizontal),()=>{const rr=It.verticalTextBox;return rr&&ei(rr),v.allowVerticalPlacement&&!(nn&&nn.box&&nn.box.length)&&qe.numVerticalGlyphVertices>0&&rr?zr(rr,It.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null}}),nn&&(Ct=nn.box,Mt=nn.offscreen);const Xi=cr(nn&&nn.box);if(!Ct&&this.prevPlacement){const rr=this.prevPlacement.variableOffsets[qe.crossTileID];rr&&(this.variableOffsets[qe.crossTileID]=rr,this.markUsedJustification(v,rr.anchor,qe,Xi))}}else{const Gn=(zr,Xi)=>{const rr=v.getSymbolInstanceTextSize(Y,qe,this.transform.zoom,vt),Br=this.collisionIndex.placeCollisionBox(rr,zr,new f.pointGeometry(0,0),ce,U,A,le.predicate);return Br&&Br.box&&Br.box.length&&(this.markUsedOrientation(v,Xi,qe),this.placedOrientations[qe.crossTileID]=Xi),Br};Ir(()=>Gn(Yi,f.WritingMode.horizontal),()=>{const zr=It.verticalTextBox;return v.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&zr?(ei(zr),Gn(zr,f.WritingMode.vertical)):{box:null,offscreen:null}}),cr(nn&&nn.box&&nn.box.length)}}if(xr=nn,Ct=xr&&xr.box&&xr.box.length>0,Mt=xr&&xr.offscreen,qe.useRuntimeCollisionCircles){const cr=v.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),Ir=f.evaluateSizeForFeature(v.textSizeData,Y,cr),Gn=T.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(ce,cr,v.lineVertexArray,v.glyphOffsetArray,Ir,A,R,N,p,Se,le.predicate,qe.collisionCircleDiameter*Ir/f.ONE_EM,Gn,this.retainedQueryData[v.bucketInstanceId].tileID),Ct=ce||mn.circles.length>0&&!mn.collisionDetected,Mt=Mt&&mn.offscreen}if(It.iconFeatureIndex&&(Qs=It.iconFeatureIndex),It.iconBox){const cr=Ir=>{ei(Ir);const Gn=fe&&wn?li(wn.x,wn.y,xe,Se,this.transform.angle):new f.pointGeometry(0,0),zr=v.getSymbolInstanceIconSize(se,this.transform.zoom,vt);return this.collisionIndex.placeCollisionBox(zr,Ir,Gn,me,U,A,le.predicate)};Rr&&Rr.box&&Rr.box.length&&It.verticalIconBox?(dn=cr(It.verticalIconBox),yt=dn.box.length>0):(dn=cr(It.iconBox),yt=dn.box.length>0),Mt=Mt&&dn.offscreen}const oo=_e||0===qe.numHorizontalGlyphVertices&&0===qe.numVerticalGlyphVertices,Js=ee||0===qe.numIconVertices;if(oo||Js?Js?oo||(yt=yt&&Ct):Ct=yt&&Ct:yt=Ct=yt&&Ct,Ct&&xr&&xr.box&&this.collisionIndex.insertCollisionBox(xr.box,T.get("text-ignore-placement"),v.bucketInstanceId,Rr&&Rr.box&&io?io:yr,le.ID),yt&&dn&&this.collisionIndex.insertCollisionBox(dn.box,T.get("icon-ignore-placement"),v.bucketInstanceId,Qs,le.ID),mn&&(Ct&&this.collisionIndex.insertCollisionCircles(mn.circles,T.get("text-ignore-placement"),v.bucketInstanceId,yr,le.ID),p)){const cr=v.bucketInstanceId;let Ir=this.collisionCircleArrays[cr];void 0===Ir&&(Ir=this.collisionCircleArrays[cr]=new yi);for(let Gn=0;Gn<mn.circles.length;Gn+=4)Ir.circles.push(mn.circles[Gn+0]),Ir.circles.push(mn.circles[Gn+1]),Ir.circles.push(mn.circles[Gn+2]),Ir.circles.push(mn.collisionDetected?1:0)}this.placements[qe.crossTileID]=new kn(Ct||Ke,yt||st,Mt||v.justReloaded),l[qe.crossTileID]=!0};if(Fe){const qe=v.getSortedSymbolIndexes(this.transform.angle);for(let vt=qe.length-1;vt>=0;--vt){const It=qe[vt];Re(v.symbolInstances.get(It),It,v.collisionArrays[It])}}else for(let qe=r.symbolInstanceStart;qe<r.symbolInstanceEnd;qe++)Re(v.symbolInstances.get(qe),qe,v.collisionArrays[qe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[v.bucketInstanceId];f.invert(qe.invProjMatrix,A),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,l,p,y){let v;v=y===f.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(l)];const T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of T)A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:p.crossTileID)}markUsedOrientation(r,l,p){const y=l===f.WritingMode.horizontal||l===f.WritingMode.horizontalOnly?l:0,v=l===f.WritingMode.vertical?l:0,T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of T)r.text.placedSymbolArray.get(A).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(r):1,v=l?l.opacities:{},T=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const R in this.placements){const N=this.placements[R],U=v[R];U?(this.opacities[R]=new Et(U,y,N.text,N.icon),p=p||N.text!==U.text.placed||N.icon!==U.icon.placed):(this.opacities[R]=new Et(null,y,N.text,N.icon,N.skipFade),p=p||N.text||N.icon)}for(const R in v){const N=v[R];if(!this.opacities[R]){const U=new Et(N,y,!1,!1);U.isHidden()||(this.opacities[R]=U,p=p||N.text.placed||N.icon.placed)}}for(const R in T)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=T[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const y of l){const v=y.getBucket(r);v&&y.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,y.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const y=r.layers[0].layout,v=new Et(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),R=y.get("text-variable-anchor"),N="map"===y.get("text-rotation-alignment"),U="map"===y.get("text-pitch-alignment"),H="none"!==y.get("icon-text-fit"),q=new Et(null,0,T&&(A||!r.hasIconData()||y.get("icon-optional")),A&&(T||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const Y=(se,le,_e)=>{for(let ee=0;ee<le/4;ee++)se.opacityVertexArray.emplaceBack(_e)};for(let se=0;se<r.symbolInstances.length;se++){const le=r.symbolInstances.get(se),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:ee,crossTileID:ce}=le;let me=this.opacities[ce];l[ce]?me=v:me||(me=q,this.opacities[ce]=me),l[ce]=!0;const xe=le.numIconVertices>0,Se=this.placedOrientations[le.crossTileID],fe=Se===f.WritingMode.vertical,Fe=Se===f.WritingMode.horizontal||Se===f.WritingMode.horizontalOnly;if(_e>0||ee>0){const Ke=Fi(me.text);Y(r.text,_e,fe?Is:Ke),Y(r.text,ee,Fe?Is:Ke);const st=me.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(vt=>{vt>=0&&(r.text.placedSymbolArray.get(vt).hidden=st||fe?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=st||Fe?1:0);const Re=this.variableOffsets[le.crossTileID];Re&&this.markUsedJustification(r,Re.anchor,le,Se);const qe=this.placedOrientations[le.crossTileID];qe&&(this.markUsedJustification(r,"left",le,qe),this.markUsedOrientation(r,qe,le))}if(xe){const Ke=Fi(me.icon);le.placedIconSymbolIndex>=0&&(Y(r.icon,le.numIconVertices,fe?Is:Ke),r.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=me.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(Y(r.icon,le.numVerticalIconVertices,Fe?Is:Ke),r.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ke=r.collisionArrays[se];if(Ke){let st=new f.pointGeometry(0,0);if(Ke.textBox||Ke.verticalTextBox){let qe=!0;if(R){const vt=this.variableOffsets[ce];vt?(st=$i(vt.anchor,vt.width,vt.height,vt.textOffset,vt.textScale),N&&st._rotate(U?this.transform.angle:-this.transform.angle)):qe=!1}Ke.textBox&&On(r.textCollisionBox.collisionVertexArray,me.text.placed,!qe||fe,st.x,st.y),Ke.verticalTextBox&&On(r.textCollisionBox.collisionVertexArray,me.text.placed,!qe||Fe,st.x,st.y)}const Re=Boolean(!Fe&&Ke.verticalIconBox);Ke.iconBox&&On(r.iconCollisionBox.collisionVertexArray,me.icon.placed,Re,H?st.x:0,H?st.y:0),Ke.verticalIconBox&&On(r.iconCollisionBox.collisionVertexArray,me.icon.placed,!Re,H?st.x:0,H?st.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=se.invProjMatrix,r.placementViewportMatrix=se.viewportMatrix,r.collisionCircleArray=se.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function On(h,r,l,p,y){h.emplaceBack(r?1:0,l?1:0,p||0,y||0),h.emplaceBack(r?1:0,l?1:0,p||0,y||0),h.emplaceBack(r?1:0,l?1:0,p||0,y||0),h.emplaceBack(r?1:0,l?1:0,p||0,y||0)}const xi=Math.pow(2,25),ci=Math.pow(2,24),ui=Math.pow(2,17),Wa=Math.pow(2,16),no=Math.pow(2,9),da=Math.pow(2,8),hi=Math.pow(2,1);function Fi(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*xi+r*ci+l*ui+r*Wa+l*no+r*da+l*hi+r}const Is=0;class Vo{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,y,v){const T=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(T,y,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<T.length;){const A=T[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,p,0===A.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class Ya{constructor(r,l,p,y,v,T,A,R){this.placement=new vr(r,v,T,A,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const y=f.exported.now(),v=()=>{const T=f.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Vo(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Xa=512/f.EXTENT/2;class cc{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let y=0;y<l.length;y++){const v=l.get(y),T=v.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,l){const p=Xa/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*f.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*f.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<r.length;v++){const T=r.get(v);if(T.crossTileID)continue;const A=this.indexedSymbolInstances[T.key];if(!A)continue;const R=this.getScaledCoordinates(T,l);for(const N of A)if(Math.abs(N.coord.x-R.x)<=y&&Math.abs(N.coord.y-R.y)<=y&&!p[N.crossTileID]){p[N.crossTileID]=!0,T.crossTileID=N.crossTileID;break}}}}class xl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const p in this.indexes){const y=this.indexes[p],v={};for(const T in y){const A=y[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const y=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>r.overscaledZ)for(const A in T){const R=T[A];R.tileID.isChildOf(r)&&R.findMatches(l.symbolInstances,r,y)}else{const A=T[r.scaledTo(Number(v)).key];A&&A.findMatches(l.symbolInstances,r,y)}}for(let v=0;v<l.symbolInstances.length;v++){const T=l.symbolInstances.get(v);T.crossTileID||(T.crossTileID=p.generate(),y[T.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new cc(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const y of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][y.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const y=this.indexes[p];for(const v in y)r[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],l=!0)}return l}}class To{constructor(){this.layerIndexes={},this.crossTileIDs=new xl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p){let y=this.layerIndexes[r.id];void 0===y&&(y=this.layerIndexes[r.id]=new fa);let v=!1;const T={};y.handleWrapJump(p);for(const A of l){const R=A.getBucket(r);R&&r.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,R,this.crossTileIDs)&&(v=!0),T[R.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(v=!0),v}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const So=(h,r)=>f.emitValidationErrors(h,r&&r.filter(l=>"source.canvas"!==l.identifier)),bl=f.pick(ve,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),wl=f.pick(ve,["setCenter","setZoom","setBearing","setPitch"]),Nc=function(){const h={},r=f.spec.$version;for(const l in f.spec.$root){const p=f.spec.$root[l];if(p.required){let y=null;y="version"===l?r:"array"===p.type?[]:{},null!=y&&(h[l]=y)}}return h}(),Io={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Li extends f.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new pt(ut(),this),this.imageManager=new Dt,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(r._requestManager,l.localFontFamily?f.LocalGlyphMode.all:l.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new To,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const p=this;this._rtlTextPluginCallback=Li.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,T)=>{if(f.triggerPluginCompletionEvent(v),T&&T.every(A=>A))for(const A in p._sourceCaches){const R=p._sourceCaches[A],N=R.getSource().type;"vector"!==N&&"geojson"!==N||R.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const T in this._layers){const A=this._layers[T];A.source===v.id&&this._validateLayer(A)}})}loadURL(r,l={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!f.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const y=this.map._requestManager.transformRequest(r,f.ResourceType.Style);this._request=f.getJSON(y,(v,T)=>{this._request=null,v?this.fire(new f.ErrorEvent(v)):T&&this._load(T,p)})}loadJSON(r,l={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(Nc,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&So(this,f.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r;for(const y in r.sources)this.addSource(y,r.sources[y],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=kt(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of p)y=f.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Tn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(l,p,y){let v,T,A;const R=f.exported.devicePixelRatio>1?"@2x":"";let N=f.getJSON(p.transformRequest(p.normalizeSpriteURL(l,R,".json"),f.ResourceType.SpriteJSON),(q,Y)=>{N=null,A||(A=q,v=Y,H())}),U=f.getImage(p.transformRequest(p.normalizeSpriteURL(l,R,".png"),f.ResourceType.SpriteImage),(q,Y)=>{U=null,A||(A=q,T=Y,H())});function H(){if(A)y(A);else if(v&&T){const q=f.exported.getImageData(T),Y={};for(const se in v){const{width:le,height:_e,x:ee,y:ce,sdf:me,pixelRatio:xe,stretchX:Se,stretchY:fe,content:Fe}=v[se],Ke=new f.RGBAImage({width:le,height:_e});f.RGBAImage.copy(q,Ke,{x:ee,y:ce},{x:0,y:0},{width:le,height:_e}),Y[se]={data:Ke,pixelRatio:xe,sdf:me,stretchX:Se,stretchY:fe,content:Fe}}y(null,Y)}}return{cancel(){N&&(N.cancel(),N=null),U&&(U.cancel(),U=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new f.ErrorEvent(l));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const y=this._layers[p];"custom"!==y.type&&l.push(y.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Io[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const T in this._updatedSources){const A=this._updatedSources[T];"reload"===A?this._reloadSource(T):"clear"===A&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];p[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const A=this._getLayerSourceCache(v);A&&(A.used=!0)}const T=this.map.painter;if(T){const A=v.getProgramIds();if(!A)continue;const R=v.getProgramConfiguration(r.zoom);for(const N of A)T.useProgram(N,R)}}for(const y in p){const v=this._sourceCaches[y];p[y]!==v.used&&v.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),So(this,f.validateStyle(r)))return!1;(r=f.clone$2(r)).layers=kt(r.layers);const l=function(y,v){if(!y)return[{command:ve.setStyle,args:[v]}];let T=[];try{if(!je(y.version,v.version))return[{command:ve.setStyle,args:[v]}];je(y.center,v.center)||T.push({command:ve.setCenter,args:[v.center]}),je(y.zoom,v.zoom)||T.push({command:ve.setZoom,args:[v.zoom]}),je(y.bearing,v.bearing)||T.push({command:ve.setBearing,args:[v.bearing]}),je(y.pitch,v.pitch)||T.push({command:ve.setPitch,args:[v.pitch]}),je(y.sprite,v.sprite)||T.push({command:ve.setSprite,args:[v.sprite]}),je(y.glyphs,v.glyphs)||T.push({command:ve.setGlyphs,args:[v.glyphs]}),je(y.transition,v.transition)||T.push({command:ve.setTransition,args:[v.transition]}),je(y.light,v.light)||T.push({command:ve.setLight,args:[v.light]}),je(y.fog,v.fog)||T.push({command:ve.setFog,args:[v.fog]});const A={},R=[];!function(H,q,Y,se){let le;for(le in q=q||{},H=H||{})H.hasOwnProperty(le)&&(q.hasOwnProperty(le)||Ut(le,Y,se));for(le in q)q.hasOwnProperty(le)&&(H.hasOwnProperty(le)?je(H[le],q[le])||("geojson"===H[le].type&&"geojson"===q[le].type&&Lt(H,q,le)?Y.push({command:ve.setGeoJSONSourceData,args:[le,q[le].data]}):rn(le,q,Y,se)):Ge(le,q,Y))}(y.sources,v.sources,R,A);const N=[];y.layers&&y.layers.forEach(H=>{A[H.source]?T.push({command:ve.removeLayer,args:[H.id]}):N.push(H)});let U=y.terrain;U&&A[U.source]&&(T.push({command:ve.setTerrain,args:[void 0]}),U=void 0),T=T.concat(R),je(U,v.terrain)||T.push({command:ve.setTerrain,args:[v.terrain]}),function(H,q,Y){q=q||[];const se=(H=H||[]).map(Ht),le=q.map(Ht),_e=H.reduce(hn,{}),ee=q.reduce(hn,{}),ce=se.slice(),me=Object.create(null);let xe,Se,fe,Fe,Ke,st,Re;for(xe=0,Se=0;xe<se.length;xe++)fe=se[xe],ee.hasOwnProperty(fe)?Se++:(Y.push({command:ve.removeLayer,args:[fe]}),ce.splice(ce.indexOf(fe,Se),1));for(xe=0,Se=0;xe<le.length;xe++)fe=le[le.length-1-xe],ce[ce.length-1-xe]!==fe&&(_e.hasOwnProperty(fe)?(Y.push({command:ve.removeLayer,args:[fe]}),ce.splice(ce.lastIndexOf(fe,ce.length-Se),1)):Se++,st=ce[ce.length-xe],Y.push({command:ve.addLayer,args:[ee[fe],st]}),ce.splice(ce.length-xe,0,fe),me[fe]=!0);for(xe=0;xe<le.length;xe++)if(fe=le[xe],Fe=_e[fe],Ke=ee[fe],!me[fe]&&!je(Fe,Ke))if(je(Fe.source,Ke.source)&&je(Fe["source-layer"],Ke["source-layer"])&&je(Fe.type,Ke.type)){for(Re in un(Fe.layout,Ke.layout,Y,fe,null,ve.setLayoutProperty),un(Fe.paint,Ke.paint,Y,fe,null,ve.setPaintProperty),je(Fe.filter,Ke.filter)||Y.push({command:ve.setFilter,args:[fe,Ke.filter]}),je(Fe.minzoom,Ke.minzoom)&&je(Fe.maxzoom,Ke.maxzoom)||Y.push({command:ve.setLayerZoomRange,args:[fe,Ke.minzoom,Ke.maxzoom]}),Fe)Fe.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?un(Fe[Re],Ke[Re],Y,fe,Re.slice(6),ve.setPaintProperty):je(Fe[Re],Ke[Re])||Y.push({command:ve.setLayerProperty,args:[fe,Re,Ke[Re]]}));for(Re in Ke)Ke.hasOwnProperty(Re)&&!Fe.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?un(Fe[Re],Ke[Re],Y,fe,Re.slice(6),ve.setPaintProperty):je(Fe[Re],Ke[Re])||Y.push({command:ve.setLayerProperty,args:[fe,Re,Ke[Re]]}))}else Y.push({command:ve.removeLayer,args:[fe]}),st=ce[ce.lastIndexOf(fe)+1],Y.push({command:ve.addLayer,args:[Ke,st]})}(N,v.layers,T)}catch(A){console.warn("Unable to compute style diff:",A),T=[{command:ve.setStyle,args:[v]}]}return T}(this.serialize(),r).filter(y=>!(y.command in wl));if(0===l.length)return!1;const p=l.filter(y=>!(y.command in bl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return l.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=r,!0}addImage(r,l){if(this.getImage(r))return this.fire(new f.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new f.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(f.validateStyle.source,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=Z(r,l,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:r}));const v=T=>{const A=(T?"symbol:":"other:")+r,R=this._sourceCaches[A]=new f.SourceCache(A,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[r]=R,R.style=this,R.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(void 0===l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new f.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new f.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const y of p)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}addLayer(r,l,p={}){this._checkLoaded();const y=r.id;if(this.getLayer(y))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if("custom"===r.type){if(So(this,f.validateCustomStyleLayer(r)))return;v=f.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(y,r.source),r=f.clone$2(r),r=f.extend(r,{source:y})),this._validate(f.validateStyle.layer,`layers.${y}`,r,{arrayIndex:-1},p))return;v=f.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&-1===T)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const A=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&A&&"custom"!==v.type){const R=this._removedLayers[y];delete this._removedLayers[y],R.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",A.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const y=l?this._order.indexOf(l):this._order.length;l&&-1===y?this.fire(new f.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(y,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const y=this.getLayer(r);y?y.minzoom===l&&y.maxzoom===p||(null!=l&&(y.minzoom=l),null!=p&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const y=this.getLayer(r);if(y){if(!je(y.filter,l))return null==l?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(f.validateStyle.filter,`layers.${y.id}.filter`,l,null,p)||(y.filter=f.clone$2(l),this._updateLayer(y)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){return f.clone$2(this.getLayer(r).filter)}setLayoutProperty(r,l,p,y={}){this._checkLoaded();const v=this.getLayer(r);v?je(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,y),this._updateLayer(v)):this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,y={}){this._checkLoaded();const v=this.getLayer(r);v?je(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,y=r.sourceLayer,v=this.getSource(p);if(void 0===v)return void this.fire(new f.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=v.type;if("geojson"===T&&y)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!y)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(p);for(const R of A)R.setFeatureState(y,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,y=this.getSource(p);if(void 0===y)return void this.fire(new f.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=y.type,T="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!T)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(p);for(const R of A)R.removeFeatureState(T,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,y=this.getSource(l);if(void 0!==y){if("vector"!==y.type||p)return void 0===r.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:r,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const l=T=>"fill-extrusion"===this._layers[T].type,p={},y=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(l(A)){p[A]=T;for(const R of r){const N=R[A];if(N)for(const U of N)y.push(U)}}}y.sort((T,A)=>A.intersectionZ-T.intersectionZ);const v=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(l(A))for(let R=y.length-1;R>=0;R--){const N=y[R].feature;if(p[N.layer.id]<T)break;v.push(N),y.pop()}else for(const R of r){const N=R[A];if(N)for(const U of N)v.push(U.feature)}}return v}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(f.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const y={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of l.layers){const N=this._layers[R];if(!N)return this.fire(new f.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];y[N.source]=!0}}const v=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(R=>{const N=this.getLayer(R);return N&&N.is3D()}):this.has3DLayers(),A=Ur.createFromScreenPoints(r,p);for(const R in this._sourceCaches){const N=this._sourceCaches[R].getSource().id;l.layers&&!y[N]||v.push(he(this._sourceCaches[R],this._layers,this._serializedLayers,A,l,p,T,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(R,N,U,H,q,Y,se){const le={},_e=Y.queryRenderedSymbols(H),ee=[];for(const ce of Object.keys(_e).map(Number))ee.push(se[ce]);ee.sort(ke);for(const ce of ee){const me=ce.featureIndex.lookupSymbolFeatures(_e[ce.bucketInstanceId],N,ce.bucketIndex,ce.sourceLayerIndex,q.filter,q.layers,q.availableImages,R);for(const xe in me){const Se=le[xe]=le[xe]||[],fe=me[xe];fe.sort((Fe,Ke)=>{const st=ce.featureSortOrder;if(st){const Re=st.indexOf(Fe.featureIndex);return st.indexOf(Ke.featureIndex)-Re}return Ke.featureIndex-Fe.featureIndex});for(const Fe of fe)Se.push(Fe)}}for(const ce in le)le[ce].forEach(me=>{const xe=me.feature,Se=U(R[ce]).getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=Se});return le}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,l){l&&l.filter&&this._validate(f.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let y=[];for(const v of p)y=y.concat(ge(v,l));return y}addSourceType(r,l,p){return Li.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Li.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const T in r)if(!je(r[T],p[T])){y=!0;break}if(!y)return;const v={now:f.exported.now(),transition:f.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(r){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof r.source){const l="terrain-dem-src";this.addSource(l,r.source),r=f.clone$2(r),r=f.extend(r,{source:l})}if(!this._validate(f.validateStyle.terrain,"terrain",r)){if(this.terrain){const l=this.terrain,p=l.get();for(const y in r)if(!je(r[y],p[y])){l.set(r),this.stylesheet.terrain=r;const v={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createTerrain(r);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(r){const l=this.fog=new In(r);this.stylesheet.fog=r;const p={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();for(const y in r)if(!je(r[y],p[y])){l.set(r),this.stylesheet.fog=r;const v={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r){const l=this.terrain=new Ft(r);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_validate(r,l,p,y,v={}){return(!v||!1!==v.validate)&&So(this,r.call(f.validateStyle,f.extend({key:l,style:this.serialize(),value:p,styleSpec:f.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,y,v=!1){let T=!1,A=!1;const R={};for(const N of this._order){const U=this._layers[N];if("symbol"!==U.type)continue;if(!R[U.source]){const q=this._getLayerSourceCache(U);if(!q)continue;R[U.source]=q.getRenderableIds(!0).map(Y=>q.getTileByID(Y)).sort((Y,se)=>se.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(se.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(U,R[U.source],r.center.lng);T=T||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),r.zoom))&&(this.pauseablePlacement=new Ya(r,this._order,v,l,p,y,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T)for(const N of this._order){const U=this._layers[N];"symbol"===U.type&&this.placement.updateLayerOpacities(U,R[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};y(this._otherSourceCaches[l.source]),y(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return f.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Li.getSourceType=function(h){return j[h]},Li.setSourceType=function(h,r){j[h]=r},Li.registerForPluginStateChange=f.registerForPluginStateChange;var El="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",pa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let $s={},di={};$s=An("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),di=An("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Uo=An("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),as=El;var Gs={background:An("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:An("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:An("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:An("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:An("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:An("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:An("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:An("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:An("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:An("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:An("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:An("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:An("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:An("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:An("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:An("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:An("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:An("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:An("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:An("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:An("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:An("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:An("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:An("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:An("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:An("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pa),skyboxGradient:An("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pa),skyboxCapture:An("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:An("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:An("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:An("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function An(h,r,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=h.match(y),A=r.match(y),R=El.match(y);let N=A?A.concat(T):T;l||($s.staticUniforms&&(N=$s.staticUniforms.concat(N)),di.staticUniforms&&(N=di.staticUniforms.concat(N))),N&&(N=N.concat(R));const U={};return{fragmentSource:h=h.replace(p,(H,q,Y,se,le)=>(U[le]=!0,"define"===q?`\n#ifndef HAS_UNIFORM_u_${le}\nvarying ${Y} ${se} ${le};\n#else\nuniform ${Y} ${se} u_${le};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${le}\n    ${Y} ${se} ${le} = u_${le};\n#endif\n`)),vertexSource:r=r.replace(p,(H,q,Y,se,le)=>{const _e="float"===se?"vec2":"vec4",ee=le.match(/color/)?"color":_e;return U[le]?"define"===q?`\n#ifndef HAS_UNIFORM_u_${le}\nuniform lowp float u_${le}_t;\nattribute ${Y} ${_e} a_${le};\nvarying ${Y} ${se} ${le};\n#else\nuniform ${Y} ${se} u_${le};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${le}\n    ${le} = a_${le};\n#else\n    ${Y} ${se} ${le} = u_${le};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${le}\n    ${le} = unpack_mix_${ee}(a_${le}, u_${le}_t);\n#else\n    ${Y} ${se} ${le} = u_${le};\n#endif\n`:"define"===q?`\n#ifndef HAS_UNIFORM_u_${le}\nuniform lowp float u_${le}_t;\nattribute ${Y} ${_e} a_${le};\n#else\nuniform ${Y} ${se} u_${le};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${le}\n    ${Y} ${se} ${le} = a_${le};\n#else\n    ${Y} ${se} ${le} = u_${le};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${le}\n    ${Y} ${se} ${le} = unpack_mix_${ee}(a_${le}, u_${le}_t);\n#else\n    ${Y} ${se} ${le} = u_${le};\n#endif\n`}),staticAttributes:v,staticUniforms:N}}class Gi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,p,y,v,T,A,R){this.context=r;let N=this.boundPaintVertexBuffers.length!==y.length;for(let U=0;!N&&U<y.length;U++)this.boundPaintVertexBuffers[U]!==y[U]&&(N=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!N&&this.boundIndexBuffer===v&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===R?(r.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),R&&R.bind()):this.freshBind(l,p,y,v,T,A,R)}freshBind(r,l,p,y,v,T,A){let R;const N=r.numAttributes,U=this.context,H=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=A;else{R=U.currentNumAttributes||0;for(let q=N;q<R;q++)H.disableVertexAttribArray(q)}l.enableAttributes(H,r);for(const q of p)q.enableAttributes(H,r);T&&T.enableAttributes(H,r),A&&A.enableAttributes(H,r),l.bind(),l.setVertexAttribPointers(H,r,v);for(const q of p)q.bind(),q.setVertexAttribPointers(H,r,v);T&&(T.bind(),T.setVertexAttribPointers(H,r,v)),y&&y.bind(),A&&(A.bind(),A.setVertexAttribPointers(H,r,v)),U.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ma(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new f.MercatorCoordinate(0,p/l).toLngLat().lat,new f.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Hs(h,r,l,p,y,v,T){const A=h.context,R=A.gl,N=l.fbo;if(!N)return;h.prepareDrawTile(r);const U=h.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,N.colorAttachment.get());const H=((q,Y,se,le)=>{const _e=se.paint.get("hillshade-shadow-color"),ee=se.paint.get("hillshade-highlight-color"),ce=se.paint.get("hillshade-accent-color");let me=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===se.paint.get("hillshade-illumination-anchor")&&(me-=q.transform.angle);const xe=!q.options.moving;return{u_matrix:le||q.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),xe),u_image:0,u_latrange:ma(0,Y.tileID),u_light:[se.paint.get("hillshade-exaggeration"),me],u_shadow:_e,u_highlight:ee,u_accent:ce}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(A,U,r.toUnwrapped()),U.draw(A,R.TRIANGLES,y,v,T,f.CullFaceMode.disabled,H,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function As(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const v=l.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new f.Texture(p,v,y.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Nn(h,r,l,p,y,v){const T=h.context,A=T.gl;if(!r.dem)return;const R=r.dem;if(T.activeTexture.set(A.TEXTURE1),As(h,r,R),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const N=R.dim;T.activeTexture.set(A.TEXTURE0);let U=r.fbo;if(!U){const H=new f.Texture(T,{width:N,height:N,data:null},A.RGBA);H.bind(A.LINEAR,A.CLAMP_TO_EDGE),U=r.fbo=T.createFramebuffer(N,N,!0),U.colorAttachment.set(H.texture)}T.bindFramebuffer.set(U.framebuffer),T.viewport.set([0,0,N,N]),h.useProgram("hillshadePrepare").draw(T,A.TRIANGLES,p,y,v,f.CullFaceMode.disabled,((H,q)=>{const Y=q.stride,se=f.create$1();return f.ortho(se,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(se,se,[0,-f.EXTENT,0]),{u_matrix:se,u_image:1,u_dimension:[Y,Y],u_zoom:H.overscaledZ,u_unpack:q.unpackVector}})(r.tileID,R),l.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),r.needsHillshadePrepare=!1}const jo=(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_image0:new f.Uniform1i(h,r.u_image0),u_skirt_height:new f.Uniform1f(h,r.u_skirt_height)}),Ao=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),ls=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,y){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:y,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Ka={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ms(h,r){const l=1<<h.z;return!r&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const z=h=>({u_matrix:h});function W(h,r,l,p,y){if(y>0){const v=f.exported.now(),T=(v-h.timeAdded)/y,A=r?(v-r.timeAdded)/y:-1,R=l.getSource(),N=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!r||Math.abs(r.tileID.overscaledZ-N)>Math.abs(h.tileID.overscaledZ-N),H=U&&h.refreshedUponExpiration?1:f.clamp(U?T:1-A,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class B extends f.SourceCache{constructor(r){const l=Z("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new pt(ut(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,T)=>{if(v[T.key]="",!this._tiles[T.key]){const A=new f.Tile(T,this._source.tileSize*T.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[T.key]=A}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class J extends f.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Ee extends f.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,v]=function(R){const N=new f.StructArrayLayout4i8,U=new f.StructArrayLayout3ui6,H=131;N.reserve(17161),U.reserve(33800);const q=f.EXTENT/128,Y=f.EXTENT+q/2,se=Y+q;for(let _e=-q;_e<se;_e+=q)for(let ee=-q;ee<se;ee+=q){const ce=ee<0||ee>Y||_e<0||_e>Y?24575:0,me=f.clamp(Math.round(ee),0,f.EXTENT),xe=f.clamp(Math.round(_e),0,f.EXTENT);N.emplaceBack(me+ce,xe,me,xe)}const le=(_e,ee)=>{const ce=ee*H+_e;U.emplaceBack(ce+1,ce,ce+H),U.emplaceBack(ce+H,ce+H+1,ce+1)};for(let _e=1;_e<129;_e++)for(let ee=1;ee<129;ee++)le(ee,_e);return[0,129].forEach(_e=>{for(let ee=0;ee<130;ee++)le(ee,_e),le(_e,ee)}),[N,U,32768]}(),T=r.context;this.gridBuffer=T.createVertexBuffer(p,pn.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=f.SegmentVector.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new B(l.map),this.orthoMatrix=f.create$1(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const A=T.gl;this._overlapStencilMode=new f.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const y=r.terrain.properties;this.sourceCache=r._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.sourceCache.getSource().tileSize/128,A=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(l,T*A,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(R=>{const N=l.getTileByID(R).tileID;return N.projMatrix=p.calculateProjMatrix(N.toUnwrapped()),N});(function(R,N){const U=N.transform.pointCoordinate(N.transform.getCameraPoint()),H=new f.pointGeometry(U.x,U.y);R.sort((q,Y)=>{if(Y.overscaledZ-q.overscaledZ)return Y.overscaledZ-q.overscaledZ;const se=new f.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),le=new f.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),_e=H.mult(1<<q.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(se)-_e.distSqr(le)})})(y,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const R in T){const N=T[R];if(!N.used||(N!==this.sourceCache&&(this._findCoveringTileCache[N.id]={}),this._setupProxiedCoordsForOrtho(N,r[R],v),N.usedForTerrain))continue;const U=r[R];N.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[l.id]=y.map(R=>new J(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const N=this.terrainTileForTile[R.key];if(!N)continue;const U=N.tileID.key;U in A||(this._visibleDemTiles.push(N),A[U]=U)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),As(this.painter,y,v))}}_prepareDemTileUniforms(r,l,p,y){if(!l||null==l.demTexture)return!1;const v=r.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-v.z),A=y||"";return p[`u_dem_tl${A}`]=[v.x*T%1,v.y*T%1],p[`u_dem_scale${A}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const v=y.dem.tree.minimums[0];return v>0&&r++,p+v},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(f.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new f.Texture(r,y,l.RGBA,{premultiply:!1}),v}setupElevationDraw(r,l,p){const y=this.painter.context,v=y.gl,T=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let R=null,N=null,U=1;if(p&&p.morphing&&this._useVertexMorphing){const H=p.morphing.srcDemTile,q=p.morphing.dstDemTile;U=p.morphing.phase,H&&q&&(this._prepareDemTileUniforms(r,H,T,"_prev")&&(N=H),this._prepareDemTileUniforms(r,q,T)&&(R=q))}if(N&&R?(y.activeTexture.set(v.TEXTURE2),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),N.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),T.u_dem_lerp=U):(R=this.terrainTileForTile[r.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,R,T)?R.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST)),p&&p.useDepthForOcclusion&&(y.activeTexture.set(v.TEXTURE3),this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=H}p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(y,T)}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(y,v,T,A,R){const N=y.context,U=N.gl;let H,q;const Y=y.options.showTerrainWireframe?2:0,se=(me,xe)=>{if(q===me)return;const Se=[Ka[me]];xe&&Se.push(Ka[Y]),H=y.useProgram("terrainRaster",null,Se),q=me},le=y.colorModeForRenderPass(),_e=new f.DepthMode(U.LEQUAL,f.DepthMode.ReadWrite,y.depthRangeFor3D);ls.update(R);const ee=y.transform,ce=6*Math.pow(1.5,22-ee.zoom)*v.exaggeration();(Y?[!1,!0]:[!1]).forEach(me=>{q=-1;const xe=me?U.LINES:U.TRIANGLES,[Se,fe]=me?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const st of A){const Re=T.getTile(st),qe=f.StencilMode.disabled,vt=v.prevTerrainTileForTile[st.key],It=v.terrainTileForTile[st.key];Ke=It,null!=(Fe=vt)&&null!=Ke&&Fe.hasData()&&Ke.hasData()&&null!=Fe.demTexture&&null!=Ke.demTexture&&Fe.tileID.key!==Ke.tileID.key&&ls.newMorphing(st.key,vt,It,R,250),N.activeTexture.set(U.TEXTURE0),Re.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST);const Ct=ls.getMorphValuesForProxy(st.key),yt=Ct?1:0;let Mt;Ct&&(Mt={morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:f.easeCubicInOut(Ct.phase)}});const wn=Ao(st.projMatrix,Ms(st.canonical,ee.renderWorldCopies)?ce/10:ce);se(yt,me),v.setupElevationDraw(Re,H,Mt),y.prepareDrawProgram(N,H,st.toUnwrapped()),H.draw(N,xe,_e,qe,le,f.CullFaceMode.backCCW,wn,"terrain_raster",v.gridBuffer,Se,fe)}var Fe,Ke})}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),A=[],R=l.style.order;let N=0;for(const U of v){const H=y.getTileByID(U.proxyTileKey),q=y.proxyCachedFBO[U.key]?y.proxyCachedFBO[U.key][r]:void 0,Y=void 0!==q?y.renderCache[q]:this.pool[N++],se=void 0!==q;if(H.texture=Y.tex,se&&!Y.dirty){A.push(H.tileID);continue}let le;p.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(p.clear({color:f.Color.transparent}),Y.dirty=!1);for(let _e=T.start;_e<=T.end;++_e){const ee=l.style._layers[R[_e]];if(ee.isHidden(l.transform.zoom))continue;const ce=l.style._getLayerSourceCache(ee),me=ce?this.proxyToSource[U.key][ce.id]:[U];if(!me)continue;const xe=me;p.viewport.set([0,0,Y.fb.width,Y.fb.height]),le!==(ce?ce.id:null)&&(this._setupStencil(Y,me,ee,ce),le=ce?ce.id:null),l.renderLayer(l,ce,ee,xe)}this.renderedToTile?(Y.dirty=!0,A.push(H.tileID)):se||--N,5===N&&(N=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(0===l)return{efficiency:100};let p,y=0,v=0,T=!1;for(let A=0;A<l;++A){const R=r._layers[r.order[A]];this._style.isLayerDraped(R)?(T&&++y,++v):T||(T=!0,p=R.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const T=v.tileID,A=Math.pow(2,T.overscaledZ),{x:R,y:N}=T.canonical,U=R/A,H=(R+1)/A,q=N/A,Y=(N+1)/A;return{minx:U,miny:q,maxx:H,maxy:Y,t:v.dem.tree.raycastRoot(U,q,H,Y,r,l,p),tile:v}});y.sort((v,T)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const v of y){if(null==v.t)return null;const T=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,l,p);if(null!=T)return T}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const y=new f.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=r.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new _i(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom),y=l.getCrossfadeParameters(),v=!!y&&1!==y.t,T=l.hasTransition();return"custom"!==l.type&&!p&&(v||T)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof ji){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],y=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||y||!v)continue;const T=p.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][v.id];if(R)for(const N of R){const U=W(v.getTile(N),v.findLoadedParent(N,0),v,this.painter.transform,T);(1!==U.opacity||0!==U.mix)&&this._clearRenderCacheForTile(v.id,N)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(0===l)return;const p=[];let y,v=0,T=this._style._layers[r[v]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++v<l;)T=this._style._layers[r[v]];for(;v<l;++v){const A=this._style._layers[r[v]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===y&&(y=v):void 0!==y&&(p.push({start:y,end:v-1}),y=void 0))}void 0!==y&&p.push({start:y,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<T.length;++A){const R=Object.values(T[A]);l.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const A=p[T];if(l.getTileByID(A.key),void 0!==l.proxyCachedFBO[A.key]){const R=r[A.key],N=this.proxyToSource[A.key];let U=0;for(const H in N){const q=N[H],Y=R[H];if(!Y||Y.length!==q.length||q.some((se,le)=>se!==Y[le]||y[H]&&y[H].hasOwnProperty(se.key))){U=-1;break}++U}for(const H in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][H]].dirty=U<0||U!==Object.values(R).length}}const v=[...this._drapedRenderBatches];v.sort((T,A)=>A.end-A.start-(T.end-T.start));for(const T of v)for(const A of p){if(l.proxyCachedFBO[A.key])continue;let R=l.renderCachePool.pop();void 0===R&&l.renderCache.length<50&&(R=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==R&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][T.start]=R,l.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,T=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode(f.ColorMode.disabled),y.setDepthMode(f.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const A of r){const R=p._tileClippingMaskIDs[A.key]=--l;T.draw(y,v.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,z(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];f.transformMat4(p,p,l.pixelMatrixInverse),f.scale$2(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const y=l._camera.position,v=f.mercatorZfromAltitude(1,l.center.lat),T=[y[0],y[1],y[2]/v,0],A=f.subtract([],p.slice(0,3),T);f.normalize(A,A);const R=this.raycast(T,A,this._exaggeration);return null!==R&&R?(f.scaleAndAdd(T,T,A,R),T[3]=T[2],T[2]*=v,T):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,y=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=l.gl,A=l.createFramebuffer(y,v,!0);l.activeTexture.set(T.TEXTURE0);const R=new f.Texture(l,{width:y,height:v,data:null},T.RGBA);R.bind(T.NEAREST,T.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const N=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,y,v);A.depthAttachment.set(N),this._depthFBO=A,this._depthTexture=R}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,y,v]),function(T,A,R,N){const U=T.context,H=U.gl;U.clear({depth:1});const q=T.useProgram("terrainDepth"),Y=new f.DepthMode(H.LESS,f.DepthMode.ReadWrite,T.depthRangeFor3D);for(const se of N){const le=R.getTile(se),_e=Ao(se.projMatrix,0);A.setupElevationDraw(le,q),q.draw(U,H.TRIANGLES,Y,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,_e,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof re)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){const R=v[A],N=this._findTileCoveringTileID(R,r);if(N){const U=this._createProxiedId(R,N,p[R.key]&&p[R.key][r.id]);y.push(U),this.proxyToSource[R.key][r.id]=[U]}}let T=!1;for(let A=0;A<l.length;A++){const R=r.getTile(l[A]);if(!R||!R.hasData())continue;const N=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==R.tileID.canonical.z){const U=this.proxyToSource[N.tileID.key][r.id],H=this._createProxiedId(N.tileID,R,p[N.tileID.key]&&p[N.tileID.key][r.id]);U?U.splice(U.length-1,0,H):this.proxyToSource[N.tileID.key][r.id]=[H],y.push(H),T=!0}}this._sourceTilesOverlap[r.id]=T}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords,T=r.getSource(),A=new f.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),R=T.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((U,H)=>(U.min.x=Math.min(U.min.x,H.x-A.x),U.min.y=Math.min(U.min.y,H.y-A.y),U.max.x=Math.max(U.max.x,H.x-A.x),U.max.y=Math.max(U.max.y,H.y-A.y),U),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(U,H)=>{const q=U.wrap+U.canonical.x/(1<<U.canonical.z),Y=U.canonical.y/(1<<U.canonical.z),se=f.EXTENT/(1<<U.canonical.z),le=H.wrap+H.canonical.x/(1<<H.canonical.z),_e=H.canonical.y/(1<<H.canonical.z);return q+se<le+R.min.x||q>le+R.max.x||Y+se<_e+R.min.y||Y>_e+R.max.y};for(let U=0;U<v.length;U++){const H=v[U];for(let q=0;q<l.length;q++){const Y=r.getTile(l[q]);if(!Y||!Y.hasData()||N(H,Y.tileID))continue;const se=this._createProxiedId(H,Y,p[H.key]&&p[H.key][r.id]),le=this.proxyToSource[H.key][r.id];le?le.push(se):this.proxyToSource[H.key][r.id]=[se],y.push(se)}}}_createProxiedId(r,l,p){let y=this.orthoMatrix;if(p){const v=p.find(T=>T.key===l.tileID.key);if(v)return v}if(l.tileID.key!==r.key){const v=r.canonical.z-l.tileID.canonical.z;let T,A,R;y=f.create$1();const N=l.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(T=f.EXTENT>>v,A=T*((l.tileID.canonical.x<<v)-r.canonical.x+N),R=T*((l.tileID.canonical.y<<v)-r.canonical.y)):(T=f.EXTENT<<-v,A=f.EXTENT*(l.tileID.canonical.x-(r.canonical.x+N<<-v)),R=f.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-v))),f.ortho(y,0,T,0,T,0,1),f.translate(y,y,[A,R,0])}return new J(l.tileID,r.key,y)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[l.id],v=y[r.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let T=p?p.tileID:r,A=T.overscaledZ;const R=l.getSource().minzoom,N=[];if(!v){const H=l.getSource().maxzoom;if(r.canonical.z>=H){const q=r.canonical.z-H;l.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,l.transform.tileZoom),T=new f.OverscaledTileID(A,r.wrap,H,r.canonical.x>>q,r.canonical.y>>q)):0!==q&&(A=H,T=new f.OverscaledTileID(A,r.wrap,H,r.canonical.x>>q,r.canonical.y>>q))}T.key!==r.key&&(N.push(T.key),p=l.getTile(T))}const U=H=>{N.forEach(q=>{y[q]=H}),N.length=0};for(A-=1;A>=R&&(!p||!p.hasData());A--){p&&U(p.tileID.key);const H=T.calculateScaledKey(A);if(p=l.getTileByID(H),p&&p.hasData())break;const q=y[H];if(null===q)break;void 0===q?N.push(H):p=l.getTileByID(q)}return U(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(r){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p,y,v;const T=new f.StructArrayLayout2ui4,A=131;for(y=1;y<129;y++){for(p=1;p<129;p++)v=y*A+p,T.emplaceBack(v,v+1),T.emplaceBack(v,v+A),T.emplaceBack(v+1,v+A),128===y&&T.emplaceBack(v+A,v+A+1);T.emplaceBack(v+1,v+1+A)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function We(h){const r=[];for(let l=0;l<h.length;l++){if(null===h[l])continue;const p=h[l].split(" ");r.push(p.pop())}return r}class ht{static cacheKey(r,l,p){let y=`${r}${p?p.cacheKey:""}`;for(const v of l)y+=`/${v}`;return y}constructor(r,l,p,y,v,T){const A=r.gl;this.program=A.createProgram();const R=We(p.staticAttributes),N=y?y.getBinderAttributes():[],U=R.concat(N),H=p.staticUniforms?We(p.staticUniforms):[],q=y?y.getBinderUniforms():[],Y=H.concat(q),se=[];for(const Se of Y)se.indexOf(Se)<0&&se.push(Se);let le=y?y.defines():[];le=le.concat(T.map(Se=>`#define ${Se}`));const _e=le.concat(Uo.fragmentSource,as,di.fragmentSource,p.fragmentSource).join("\n"),ee=le.concat(Uo.vertexSource,as,di.vertexSource,$s.vertexSource,p.vertexSource).join("\n"),ce=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ce,_e),A.compileShader(ce),A.attachShader(this.program,ce);const me=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(me,ee),A.compileShader(me),A.attachShader(this.program,me),this.attributes={};const xe={};this.numAttributes=U.length;for(let Se=0;Se<this.numAttributes;Se++)U[Se]&&(A.bindAttribLocation(this.program,Se,U[Se]),this.attributes[U[Se]]=Se);A.linkProgram(this.program),A.deleteShader(me),A.deleteShader(ce);for(let Se=0;Se<se.length;Se++){const fe=se[Se];if(fe&&!xe[fe]){const Fe=A.getUniformLocation(this.program,fe);Fe&&(xe[fe]=Fe)}}var Se,fe;this.fixedUniforms=v(r,xe),this.binderUniforms=y?y.getUniforms(r,xe):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(Se=r,(fe=xe).u_dem),u_dem_prev:new f.Uniform1i(Se,fe.u_dem_prev),u_dem_unpack:new f.Uniform4f(Se,fe.u_dem_unpack),u_dem_tl:new f.Uniform2f(Se,fe.u_dem_tl),u_dem_scale:new f.Uniform1f(Se,fe.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(Se,fe.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(Se,fe.u_dem_scale_prev),u_dem_size:new f.Uniform1f(Se,fe.u_dem_size),u_dem_lerp:new f.Uniform1f(Se,fe.u_dem_lerp),u_exaggeration:new f.Uniform1f(Se,fe.u_exaggeration),u_depth:new f.Uniform1i(Se,fe.u_depth),u_depth_size_inv:new f.Uniform2f(Se,fe.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(Se,fe.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(Se,fe.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(Se,fe.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(Se,fe.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(Se,fe.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(Se,fe.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(Se,fe.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((Se,fe)=>({u_fog_matrix:new f.UniformMatrix4f(Se,fe.u_fog_matrix),u_fog_range:new f.Uniform2f(Se,fe.u_fog_range),u_fog_color:new f.Uniform4f(Se,fe.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(Se,fe.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(Se,fe.u_fog_temporal_offset)}))(r,xe))}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(l[y])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].location&&p[y].set(l[y])}}draw(r,l,p,y,v,T,A,R,N,U,H,q,Y,se,le,_e){const ee=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(y),r.setColorMode(v),r.setCullFace(T);for(const me in this.fixedUniforms)this.fixedUniforms[me].set(A[me]);se&&se.setUniforms(r,this.binderUniforms,q,{zoom:Y});const ce={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[l];for(const me of H.get()){const xe=me.vaos||(me.vaos={});(xe[R]||(xe[R]=new Gi)).bind(r,this,N,se?se.getPaintVertexBuffers():[],U,me.vertexOffset,le,_e),ee.drawElements(l,me.primitiveLength*ce,ee.UNSIGNED_SHORT,me.primitiveOffset*ce*2)}}}function Gt(h,r,l){const p=1/Rn(l,1,r.transform.tileZoom),y=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,r.transform.tileZoom)/y,T=v*(l.tileID.canonical.x+l.tileID.wrap*y),A=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const Zt=(h,r,l,p)=>{const y=r.style.light,v=y.properties.get("position"),T=[v.x,v.y,v.z],A=f.create$2();"viewport"===y.properties.get("anchor")&&(f.fromRotation(A,-r.transform.angle),f.transformMat3(T,T,A));const R=y.properties.get("color");return{u_matrix:h,u_lightpos:T,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+l,u_opacity:p}},pr=(h,r,l,p,y,v,T)=>f.extend(Zt(h,r,l,p),Gt(v,r,T),{u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8}),jn=h=>({u_matrix:h}),bn=(h,r,l,p)=>f.extend(jn(h),Gt(l,r,p)),Sn=(h,r)=>({u_matrix:h,u_world:r}),Mn=(h,r,l,p,y)=>f.extend(bn(h,r,l,p),{u_world:y}),Hr=(h,r,l,p)=>{const y=h.transform;let v;if("map"===p.paint.get("circle-pitch-alignment")){const T=Rn(l,1,y.zoom);v=[T,T]}else v=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:v}},ro=h=>{const r=[];return"map"===h.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},mr=(h,r,l)=>{const p=f.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/p,r.pixelsToGLUnits[1]/p]}},bi=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),mo=(h,r,l,p)=>({u_matrix:h,u_extrude_scale:Rn(r,1,l),u_intensity:p}),Qr=(h,r,l,p,y,v)=>{const T=h.transform,A={u_matrix:qs(h,r,l,y),u_ratio:1/Rn(r,1,T.zoom),u_device_pixel_ratio:f.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Hi(l)){const R=Ps(r,h.transform);A.u_texsize=r.lineAtlasTexture.size,A.u_scale=[R,p.fromScale,p.toScale],A.u_mix=p.t}return A},qr=(h,r,l,p,y)=>{const v=h.transform,T=Ps(r,v);return{u_matrix:qs(h,r,l,y),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Rn(r,1,v.zoom),u_device_pixel_ratio:f.exported.devicePixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function Ps(h,r){return 1/Rn(h,1,r.tileZoom)}function qs(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const zc=h=>{const r=[];return Hi(h)&&r.push("RENDER_LINE_DASH"),h.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT"),r};function Hi(h){const r=h.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const Mo=(h,r,l,p,y)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(T=y.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(v=y.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Cl(y.paint.get("raster-hue-rotate"))};var v,T};function Cl(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const sn=(h,r,l,p,y,v,T,A,R,N)=>{const U=y.transform;return{u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:U.width/U.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+p,u_texsize:N,u_texture:0}},au=(h,r,l,p,y,v,T,A,R,N,U)=>{const{cameraToCenterDistance:H,_pitch:q}=y.transform;return f.extend(sn(h,r,l,p,y,v,T,A,R,N),{u_gamma_scale:p?H*Math.cos(y.terrain?0:q):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+U})},lu=(h,r,l,p,y,v,T,A,R,N)=>f.extend(au(h,r,l,p,y,v,T,A,!0,R,!0),{u_texsize_icon:N,u_texture_icon:1}),uc=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),go=(h,r,l,p,y,v)=>f.extend(function(T,A,R,N){const U=R.imageManager.getPattern(T.from.toString()),H=R.imageManager.getPattern(T.to.toString()),{width:q,height:Y}=R.imageManager.getPixelSize(),se=Math.pow(2,N.tileID.overscaledZ),le=N.tileSize*Math.pow(2,R.transform.tileZoom)/se,_e=le*(N.tileID.canonical.x+N.tileID.wrap*se),ee=le*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:U.tl,u_pattern_br_a:U.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[q,Y],u_mix:A.t,u_pattern_size_a:U.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Rn(N,1,R.transform.tileZoom),u_pixel_coord_upper:[_e>>16,ee>>16],u_pixel_coord_lower:[65535&_e,65535&ee]}}(p,v,l,y),{u_matrix:h,u_opacity:r}),Qa={fillExtrusion:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_lightpos:new f.Uniform3f(h,r.u_lightpos),u_lightintensity:new f.Uniform1f(h,r.u_lightintensity),u_lightcolor:new f.Uniform3f(h,r.u_lightcolor),u_vertical_gradient:new f.Uniform1f(h,r.u_vertical_gradient),u_opacity:new f.Uniform1f(h,r.u_opacity)}),fillExtrusionPattern:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_lightpos:new f.Uniform3f(h,r.u_lightpos),u_lightintensity:new f.Uniform1f(h,r.u_lightintensity),u_lightcolor:new f.Uniform3f(h,r.u_lightcolor),u_vertical_gradient:new f.Uniform1f(h,r.u_vertical_gradient),u_height_factor:new f.Uniform1f(h,r.u_height_factor),u_image:new f.Uniform1i(h,r.u_image),u_texsize:new f.Uniform2f(h,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(h,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(h,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(h,r.u_scale),u_fade:new f.Uniform1f(h,r.u_fade),u_opacity:new f.Uniform1f(h,r.u_opacity)}),fill:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix)}),fillPattern:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_image:new f.Uniform1i(h,r.u_image),u_texsize:new f.Uniform2f(h,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(h,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(h,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(h,r.u_scale),u_fade:new f.Uniform1f(h,r.u_fade)}),fillOutline:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_world:new f.Uniform2f(h,r.u_world)}),fillOutlinePattern:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_world:new f.Uniform2f(h,r.u_world),u_image:new f.Uniform1i(h,r.u_image),u_texsize:new f.Uniform2f(h,r.u_texsize),u_pixel_coord_upper:new f.Uniform2f(h,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(h,r.u_pixel_coord_lower),u_scale:new f.Uniform3f(h,r.u_scale),u_fade:new f.Uniform1f(h,r.u_fade)}),circle:(h,r)=>({u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(h,r.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(h,r.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(h,r.u_matrix)}),collisionBox:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(h,r.u_extrude_scale)}),collisionCircle:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_inv_matrix:new f.UniformMatrix4f(h,r.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(h,r.u_viewport_size)}),debug:(h,r)=>({u_color:new f.UniformColor(h,r.u_color),u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_overlay:new f.Uniform1i(h,r.u_overlay),u_overlay_scale:new f.Uniform1f(h,r.u_overlay_scale)}),clippingMask:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix)}),heatmap:(h,r)=>({u_extrude_scale:new f.Uniform1f(h,r.u_extrude_scale),u_intensity:new f.Uniform1f(h,r.u_intensity),u_matrix:new f.UniformMatrix4f(h,r.u_matrix)}),heatmapTexture:(h,r)=>({u_image:new f.Uniform1i(h,r.u_image),u_color_ramp:new f.Uniform1i(h,r.u_color_ramp),u_opacity:new f.Uniform1f(h,r.u_opacity)}),hillshade:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_image:new f.Uniform1i(h,r.u_image),u_latrange:new f.Uniform2f(h,r.u_latrange),u_light:new f.Uniform2f(h,r.u_light),u_shadow:new f.UniformColor(h,r.u_shadow),u_highlight:new f.UniformColor(h,r.u_highlight),u_accent:new f.UniformColor(h,r.u_accent)}),hillshadePrepare:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_image:new f.Uniform1i(h,r.u_image),u_dimension:new f.Uniform2f(h,r.u_dimension),u_zoom:new f.Uniform1f(h,r.u_zoom),u_unpack:new f.Uniform4f(h,r.u_unpack)}),line:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_ratio:new f.Uniform1f(h,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(h,r.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(h,r.u_units_to_pixels),u_dash_image:new f.Uniform1i(h,r.u_dash_image),u_gradient_image:new f.Uniform1i(h,r.u_gradient_image),u_image_height:new f.Uniform1f(h,r.u_image_height),u_texsize:new f.Uniform2f(h,r.u_texsize),u_scale:new f.Uniform3f(h,r.u_scale),u_mix:new f.Uniform1f(h,r.u_mix)}),linePattern:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_texsize:new f.Uniform2f(h,r.u_texsize),u_ratio:new f.Uniform1f(h,r.u_ratio),u_device_pixel_ratio:new f.Uniform1f(h,r.u_device_pixel_ratio),u_image:new f.Uniform1i(h,r.u_image),u_units_to_pixels:new f.Uniform2f(h,r.u_units_to_pixels),u_scale:new f.Uniform3f(h,r.u_scale),u_fade:new f.Uniform1f(h,r.u_fade)}),raster:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_tl_parent:new f.Uniform2f(h,r.u_tl_parent),u_scale_parent:new f.Uniform1f(h,r.u_scale_parent),u_buffer_scale:new f.Uniform1f(h,r.u_buffer_scale),u_fade_t:new f.Uniform1f(h,r.u_fade_t),u_opacity:new f.Uniform1f(h,r.u_opacity),u_image0:new f.Uniform1i(h,r.u_image0),u_image1:new f.Uniform1i(h,r.u_image1),u_brightness_low:new f.Uniform1f(h,r.u_brightness_low),u_brightness_high:new f.Uniform1f(h,r.u_brightness_high),u_saturation_factor:new f.Uniform1f(h,r.u_saturation_factor),u_contrast_factor:new f.Uniform1f(h,r.u_contrast_factor),u_spin_weights:new f.Uniform3f(h,r.u_spin_weights)}),symbolIcon:(h,r)=>({u_is_size_zoom_constant:new f.Uniform1i(h,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(h,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(h,r.u_size_t),u_size:new f.Uniform1f(h,r.u_size),u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(h,r.u_pitch),u_rotate_symbol:new f.Uniform1i(h,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(h,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(h,r.u_fade_change),u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(h,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(h,r.u_coord_matrix),u_is_text:new f.Uniform1i(h,r.u_is_text),u_pitch_with_map:new f.Uniform1i(h,r.u_pitch_with_map),u_texsize:new f.Uniform2f(h,r.u_texsize),u_texture:new f.Uniform1i(h,r.u_texture)}),symbolSDF:(h,r)=>({u_is_size_zoom_constant:new f.Uniform1i(h,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(h,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(h,r.u_size_t),u_size:new f.Uniform1f(h,r.u_size),u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(h,r.u_pitch),u_rotate_symbol:new f.Uniform1i(h,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(h,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(h,r.u_fade_change),u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(h,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(h,r.u_coord_matrix),u_is_text:new f.Uniform1i(h,r.u_is_text),u_pitch_with_map:new f.Uniform1i(h,r.u_pitch_with_map),u_texsize:new f.Uniform2f(h,r.u_texsize),u_texture:new f.Uniform1i(h,r.u_texture),u_gamma_scale:new f.Uniform1f(h,r.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(h,r.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(h,r.u_is_halo)}),symbolTextAndIcon:(h,r)=>({u_is_size_zoom_constant:new f.Uniform1i(h,r.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(h,r.u_is_size_feature_constant),u_size_t:new f.Uniform1f(h,r.u_size_t),u_size:new f.Uniform1f(h,r.u_size),u_camera_to_center_distance:new f.Uniform1f(h,r.u_camera_to_center_distance),u_pitch:new f.Uniform1f(h,r.u_pitch),u_rotate_symbol:new f.Uniform1i(h,r.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(h,r.u_aspect_ratio),u_fade_change:new f.Uniform1f(h,r.u_fade_change),u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(h,r.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(h,r.u_coord_matrix),u_is_text:new f.Uniform1i(h,r.u_is_text),u_pitch_with_map:new f.Uniform1i(h,r.u_pitch_with_map),u_texsize:new f.Uniform2f(h,r.u_texsize),u_texsize_icon:new f.Uniform2f(h,r.u_texsize_icon),u_texture:new f.Uniform1i(h,r.u_texture),u_texture_icon:new f.Uniform1i(h,r.u_texture_icon),u_gamma_scale:new f.Uniform1f(h,r.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(h,r.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(h,r.u_is_halo)}),background:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_opacity:new f.Uniform1f(h,r.u_opacity),u_color:new f.UniformColor(h,r.u_color)}),backgroundPattern:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_opacity:new f.Uniform1f(h,r.u_opacity),u_image:new f.Uniform1i(h,r.u_image),u_pattern_tl_a:new f.Uniform2f(h,r.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(h,r.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(h,r.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(h,r.u_pattern_br_b),u_texsize:new f.Uniform2f(h,r.u_texsize),u_mix:new f.Uniform1f(h,r.u_mix),u_pattern_size_a:new f.Uniform2f(h,r.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(h,r.u_pattern_size_b),u_scale_a:new f.Uniform1f(h,r.u_scale_a),u_scale_b:new f.Uniform1f(h,r.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(h,r.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(h,r.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(h,r.u_tile_units_to_pixels)}),terrainRaster:jo,terrainDepth:jo,skybox:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_sun_direction:new f.Uniform3f(h,r.u_sun_direction),u_cubemap:new f.Uniform1i(h,r.u_cubemap),u_opacity:new f.Uniform1f(h,r.u_opacity),u_temporal_offset:new f.Uniform1f(h,r.u_temporal_offset)}),skyboxGradient:(h,r)=>({u_matrix:new f.UniformMatrix4f(h,r.u_matrix),u_color_ramp:new f.Uniform1i(h,r.u_color_ramp),u_center_direction:new f.Uniform3f(h,r.u_center_direction),u_radius:new f.Uniform1f(h,r.u_radius),u_opacity:new f.Uniform1f(h,r.u_opacity),u_temporal_offset:new f.Uniform1f(h,r.u_temporal_offset)}),skyboxCapture:(h,r)=>({u_matrix_3f:new f.UniformMatrix3f(h,r.u_matrix_3f),u_sun_direction:new f.Uniform3f(h,r.u_sun_direction),u_sun_intensity:new f.Uniform1f(h,r.u_sun_intensity),u_color_tint_r:new f.Uniform4f(h,r.u_color_tint_r),u_color_tint_m:new f.Uniform4f(h,r.u_color_tint_m),u_luminance:new f.Uniform1f(h,r.u_luminance)})};let Zs;function $o(h,r,l,p,y,v,T){const A=h.context,R=A.gl,N=h.useProgram("collisionBox"),U=[];let H=0,q=0;for(let me=0;me<p.length;me++){const xe=p[me],Se=r.getTile(xe),fe=Se.getBucket(l);if(!fe)continue;let Fe=xe.projMatrix;0===y[0]&&0===y[1]||(Fe=h.translatePosMatrix(xe.projMatrix,Se,y,v));const Ke=T?fe.textCollisionBox:fe.iconCollisionBox,st=fe.collisionCircleArray;if(st.length>0){const Re=f.create$1(),qe=Fe;f.mul$1(Re,fe.placementInvProjMatrix,h.transform.glCoordMatrix),f.mul$1(Re,Re,fe.placementViewportMatrix),U.push({circleArray:st,circleOffset:q,transform:qe,invTransform:Re}),H+=st.length/4,q=H}Ke&&(h.terrain&&h.terrain.setupElevationDraw(Se,N),N.draw(A,R.LINES,f.DepthMode.disabled,f.StencilMode.disabled,h.colorModeForRenderPass(),f.CullFaceMode.disabled,mr(Fe,h.transform,Se),l.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,h.transform.zoom,null,Ke.collisionVertexBuffer,Ke.collisionVertexBufferExt))}if(!T||!U.length)return;const Y=h.useProgram("collisionCircle"),se=new f.StructArrayLayout2f1f2i16;se.resize(4*H),se._trim();let le=0;for(const me of U)for(let xe=0;xe<me.circleArray.length/4;xe++){const Se=4*xe,fe=me.circleArray[Se+0],Fe=me.circleArray[Se+1],Ke=me.circleArray[Se+2],st=me.circleArray[Se+3];se.emplace(le++,fe,Fe,Ke,st,0),se.emplace(le++,fe,Fe,Ke,st,1),se.emplace(le++,fe,Fe,Ke,st,2),se.emplace(le++,fe,Fe,Ke,st,3)}(!Zs||Zs.length<2*H)&&(Zs=function(me){const xe=2*me,Se=new f.StructArrayLayout3ui6;Se.resize(xe),Se._trim();for(let fe=0;fe<xe;fe++){const Fe=6*fe;Se.uint16[Fe+0]=4*fe+0,Se.uint16[Fe+1]=4*fe+1,Se.uint16[Fe+2]=4*fe+2,Se.uint16[Fe+3]=4*fe+2,Se.uint16[Fe+4]=4*fe+3,Se.uint16[Fe+5]=4*fe+0}return Se}(H));const _e=A.createIndexBuffer(Zs,!0),ee=A.createVertexBuffer(se,f.collisionCircleLayout.members,!0);for(const me of U){const xe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(ce=h.transform).cameraToCenterDistance,u_viewport_size:[ce.width,ce.height]};Y.draw(A,R.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,h.colorModeForRenderPass(),f.CullFaceMode.disabled,xe,l.id,ee,_e,f.SegmentVector.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ce;ee.destroy(),_e.destroy()}const ct=f.identity(new Float32Array(16));function zn(h,r,l,p,y,v){const{horizontalAlign:T,verticalAlign:A}=f.getAnchorAlignment(h),R=-(T-.5)*r,N=-(A-.5)*l,U=f.evaluateVariableOffset(h,p);return new f.pointGeometry((R/y+U[0])*v,(N/y+U[1])*v)}function Dl(h,r,l,p,y,v,T,A,R,N,U,H){const q=h.text.placedSymbolArray,Y=h.text.dynamicLayoutVertexArray,se=h.icon.dynamicLayoutVertexArray,le={};Y.clear();for(let _e=0;_e<q.length;_e++){const ee=q.get(_e),ce=h.allowVerticalPlacement&&!ee.placedOrientation,me=ee.hidden||!ee.crossTileID||ce?null:p[ee.crossTileID];if(me){const xe=new f.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),Se=H(xe),fe=xn(xe,l?A:T,Se),Fe=Wt(v.cameraToCenterDistance,fe.signedDistanceFromCamera);let Ke=y.evaluateSizeForFeature(h.textSizeData,N,ee)*Fe/f.ONE_EM;l&&(Ke*=h.tilePixelRatio/R);const{width:st,height:Re,anchor:qe,textOffset:vt,textScale:It}=me,Ct=zn(qe,st,Re,vt,It,Ke),yt=l?xn(xe.add(Ct),T,Se).point:fe.point.add(r?Ct.rotate(-v.angle):Ct),Mt=h.allowVerticalPlacement&&ee.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let wn=0;wn<ee.numGlyphs;wn++)f.addDynamicAttributes(Y,yt,Mt);U&&ee.associatedIconIndex>=0&&(le[ee.associatedIconIndex]={shiftedAnchor:yt,angle:Mt})}else pe(ee.numGlyphs,Y)}if(U){se.clear();const _e=h.icon.placedSymbolArray;for(let ee=0;ee<_e.length;ee++){const ce=_e.get(ee);if(ce.hidden)pe(ce.numGlyphs,se);else{const me=le[ee];if(me)for(let xe=0;xe<ce.numGlyphs;xe++)f.addDynamicAttributes(se,me.shiftedAnchor,me.angle);else pe(ce.numGlyphs,se)}}h.icon.dynamicLayoutVertexBuffer.updateData(se)}h.text.dynamicLayoutVertexBuffer.updateData(Y)}function gr(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Tl(h,r,l,p,y,v,T,A,R,N,U,H){const q=h.context,Y=q.gl,se=h.transform,le="map"===A,_e="map"===R,ee=le&&"point"!==l.layout.get("symbol-placement"),ce=le&&!_e&&!ee,me=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let xe=!1;const Se=h.depthModeForSublayer(0,f.DepthMode.ReadOnly),fe=l.layout.get("text-variable-anchor"),Fe=[],Ke=h.terrain&&_e?["PITCH_WITH_MAP_TERRAIN"]:null;for(const st of p){const Re=r.getTile(st),qe=Re.getBucket(l);if(!qe)continue;const vt=y?qe.text:qe.icon;if(!vt||!vt.segments.get().length)continue;const It=vt.programConfigurations.get(l.id),Ct=y||qe.sdfIcons,yt=y?qe.textSizeData:qe.iconSizeData,Mt=_e||0!==se.pitch,wn=h.useProgram(gr(Ct,y,qe),It,Ke),nn=f.evaluateSizeForZoom(yt,se.zoom);let Rr,xr,mn,dn,yr=[0,0],io=null;if(y){if(xr=Re.glyphAtlasTexture,mn=Y.LINEAR,Rr=Re.glyphAtlasTexture.size,qe.iconsInText){yr=Re.imageAtlasTexture.size,io=Re.imageAtlasTexture;const Qo="composite"===yt.kind||"camera"===yt.kind;dn=Mt||h.options.rotating||h.options.zooming||Qo?Y.LINEAR:Y.NEAREST}}else{const Qo=1!==l.layout.get("icon-size").constantOr(0)||qe.iconsNeedLinear;xr=Re.imageAtlasTexture,mn=Ct||h.options.rotating||h.options.zooming||Qo||Mt?Y.LINEAR:Y.NEAREST,Rr=Re.imageAtlasTexture.size}const Qs=Rn(Re,1,h.transform.zoom),ei=gt(st.projMatrix,_e,le,h.transform,Qs),Yi=h.terrain&&_e&&ee?f.invert(new Float32Array(16),ei):ct,oo=on(st.projMatrix,_e,le,h.transform,Qs),Js=fe&&qe.hasTextData(),cr="none"!==l.layout.get("icon-text-fit")&&Js&&qe.hasIconData();if(ee){const Qo=se.elevation;Ri(qe,st.projMatrix,h,y,ei,oo,_e,N,Qo?ur=>Qo.getAtTileOffset(st,ur.x,ur.y):null)}const Ir=h.translatePosMatrix(st.projMatrix,Re,v,T),Gn=ee||y&&fe||cr?ct:ei,zr=h.translatePosMatrix(oo,Re,v,T,!0),Xi=Ct&&0!==l.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let rr;rr=Ct?qe.iconsInText?lu(yt.kind,nn,ce,_e,h,Ir,Gn,zr,Rr,yr):au(yt.kind,nn,ce,_e,h,Ir,Gn,zr,y,Rr,!0):sn(yt.kind,nn,ce,_e,h,Ir,Gn,zr,y,Rr);const Br={program:wn,buffers:vt,uniformValues:rr,atlasTexture:xr,atlasTextureIcon:io,atlasInterpolation:mn,atlasInterpolationIcon:dn,isSDF:Ct,hasHalo:Xi,tile:Re,labelPlaneMatrixInv:Yi};if(me&&qe.canOverlap){xe=!0;const Qo=vt.segments.get();for(const ur of Qo)Fe.push({segments:new f.SegmentVector([ur]),sortKey:ur.sortKey,state:Br})}else Fe.push({segments:vt.segments,sortKey:0,state:Br})}xe&&Fe.sort((st,Re)=>st.sortKey-Re.sortKey);for(const st of Fe){const Re=st.state;if(h.terrain&&h.terrain.setupElevationDraw(Re.tile,Re.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Re.labelPlaneMatrixInv}),q.activeTexture.set(Y.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,Y.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(q.activeTexture.set(Y.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Re.isSDF){const qe=Re.uniformValues;Re.hasHalo&&(qe.u_is_halo=1,qi(Re.buffers,st.segments,l,h,Re.program,Se,U,H,qe)),qe.u_is_halo=0}qi(Re.buffers,st.segments,l,h,Re.program,Se,U,H,Re.uniformValues)}}function qi(h,r,l,p,y,v,T,A,R){const N=p.context;y.draw(N,N.gl.TRIANGLES,v,T,A,f.CullFaceMode.disabled,R,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function fi(h,r,l,p,y,v,T){const A=h.context.gl,R=l.paint.get("fill-pattern"),N=R&&R.constantOr(1),U=l.getCrossfadeParameters();let H,q,Y,se,le;T?(q=N&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=A.LINES):(q=N?"fillPattern":"fill",H=A.TRIANGLES);for(const _e of p){const ee=r.getTile(_e);if(N&&!ee.patternsLoaded())continue;const ce=ee.getBucket(l);if(!ce)continue;h.prepareDrawTile(_e);const me=ce.programConfigurations.get(l.id),xe=h.useProgram(q,me);N&&(h.context.activeTexture.set(A.TEXTURE0),ee.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),me.updatePaintBuffers(U));const Se=R.constantOr(null);if(Se&&ee.imageAtlas){const Fe=ee.imageAtlas,Ke=Fe.patternPositions[Se.to.toString()],st=Fe.patternPositions[Se.from.toString()];Ke&&st&&me.setConstantPatternPositions(Ke,st)}const fe=h.translatePosMatrix(_e.projMatrix,ee,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){se=ce.indexBuffer2,le=ce.segments2;const Fe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Y="fillOutlinePattern"===q&&N?Mn(fe,h,U,ee,Fe):Sn(fe,Fe)}else se=ce.indexBuffer,le=ce.segments,Y=N?bn(fe,h,U,ee):jn(fe);h.prepareDrawProgram(h.context,xe,_e.toUnwrapped()),xe.draw(h.context,H,y,h.stencilModeForClipping(_e),v,f.CullFaceMode.disabled,Y,l.id,ce.layoutVertexBuffer,se,le,l.paint,h.transform.zoom,me)}}function Ws(h,r,l,p,y,v,T){const A=h.context,R=A.gl,N=l.paint.get("fill-extrusion-pattern"),U=N.constantOr(1),H=l.getCrossfadeParameters(),q=l.paint.get("fill-extrusion-opacity");for(const Y of p){const se=r.getTile(Y),le=se.getBucket(l);if(!le)continue;const _e=le.programConfigurations.get(l.id),ee=h.useProgram(U?"fillExtrusionPattern":"fillExtrusion",_e);if(h.terrain){const fe=h.terrain;if(!le.enableTerrain)continue;if(fe.setupElevationDraw(se,ee,{useMeterToDem:!0}),cs(A,r,Y,le,l,fe),!le.centroidVertexBuffer){const Fe=ee.attributes.a_centroid_pos;void 0!==Fe&&R.vertexAttrib2f(Fe,0,0)}}U&&(h.context.activeTexture.set(R.TEXTURE0),se.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),_e.updatePaintBuffers(H));const ce=N.constantOr(null);if(ce&&se.imageAtlas){const fe=se.imageAtlas,Fe=fe.patternPositions[ce.to.toString()],Ke=fe.patternPositions[ce.from.toString()];Fe&&Ke&&_e.setConstantPatternPositions(Fe,Ke)}const me=h.translatePosMatrix(Y.projMatrix,se,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),xe=l.paint.get("fill-extrusion-vertical-gradient"),Se=U?pr(me,h,xe,q,Y,H,se):Zt(me,h,xe,q);h.prepareDrawProgram(A,ee,Y.toUnwrapped()),ee.draw(A,A.gl.TRIANGLES,y,v,T,f.CullFaceMode.backCCW,Se,l.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,l.paint,h.transform.zoom,_e,h.terrain?le.centroidVertexBuffer:null)}}function cs(h,r,l,p,y,v){const T=[ee=>{let ce=ee.canonical.x-1,me=ee.wrap;return ce<0&&(ce=(1<<ee.canonical.z)-1,me--),new f.OverscaledTileID(ee.overscaledZ,me,ee.canonical.z,ce,ee.canonical.y)},ee=>{let ce=ee.canonical.x+1,me=ee.wrap;return ce===1<<ee.canonical.z&&(ce=0,me++),new f.OverscaledTileID(ee.overscaledZ,me,ee.canonical.z,ce,ee.canonical.y)},ee=>new f.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,(0===ee.canonical.y?1<<ee.canonical.z:ee.canonical.y)-1),ee=>new f.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y===(1<<ee.canonical.z)-1?0:ee.canonical.y+1)],A=ee=>{const ce=r.getSource().maxzoom,me=Fe=>{const Ke=r.getTileByID(Fe);if(Ke&&Ke.hasData())return Ke.getBucket(y)};let xe,Se,fe;return(ee.overscaledZ===ee.canonical.z||ee.overscaledZ>=ce)&&(xe=me(ee.key)),ee.overscaledZ>=ce&&(Se=me(ee.calculateScaledKey(ee.overscaledZ+1))),ee.overscaledZ>ce&&(fe=me(ee.calculateScaledKey(ee.overscaledZ-1))),xe||Se||fe},R=[0,0,0],N=(ee,ce)=>(R[0]=Math.min(ee.min.y,ce.min.y),R[1]=Math.max(ee.max.y,ce.max.y),R[2]=f.EXTENT-ce.min.x>ee.max.x?ce.min.x-f.EXTENT:ee.max.x,R),U=(ee,ce)=>(R[0]=Math.min(ee.min.x,ce.min.x),R[1]=Math.max(ee.max.x,ce.max.x),R[2]=f.EXTENT-ce.min.y>ee.max.y?ce.min.y-f.EXTENT:ee.max.y,R),H=[(ee,ce)=>N(ee,ce),(ee,ce)=>N(ce,ee),(ee,ce)=>U(ee,ce),(ee,ce)=>U(ce,ee)],q=new f.pointGeometry(0,0);let Y,se,le;const _e=(ee,ce,me,xe,Se)=>{const fe=[[xe?me:ee,xe?ee:me,0],[xe?me:ce,xe?ce:me,0]],Fe=Se<0?f.EXTENT+Se:Se,Ke=[xe?Fe:(ee+ce)/2,xe?(ee+ce)/2:Fe,0];return 0===me&&Se<0||0!==me&&Se>0?v.getForTilePoints(le,[Ke],!0,se):fe.push(Ke),v.getForTilePoints(l,fe,!0,Y),Math.max(fe[0][2],fe[1][2],Ke[2])/v.exaggeration()};for(let ee=0;ee<4;ee++){const ce=p.borders[ee];if(0===ce.length&&(p.borderDone[ee]=!0),p.borderDone[ee])continue;const me=le=T[ee](l),xe=A(me);if(!(xe&&xe.enableTerrain&&(se=v.findDEMTileFor(me),se&&se.dem)))continue;if(!Y){const Ke=v.findDEMTileFor(l);if(!Ke||!Ke.dem)return;Y=Ke}const Se=(ee<2?1:5)-ee,fe=xe.borders[Se];let Fe=0;for(let Ke=0;Ke<ce.length;Ke++){const st=p.featuresOnBorder[ce[Ke]],Re=st.borders[ee];let qe;for(;Fe<fe.length&&(qe=xe.featuresOnBorder[fe[Fe]],!(qe.borders[Se][1]>Re[0]+3));)xe.borderDone[Se]||xe.encodeCentroid(void 0,qe,!1),Fe++;if(qe&&Fe<fe.length){const vt=Fe;let It=0;for(;!(qe.borders[Se][0]>Re[1]-3)&&(It++,++Fe!==fe.length);)qe=xe.featuresOnBorder[fe[Fe]];if(qe=xe.featuresOnBorder[fe[vt]],st.intersectsCount()>1||qe.intersectsCount()>1||1!==It){1!==It&&(Fe=vt),p.encodeCentroid(void 0,st,!1),xe.borderDone[Se]||xe.encodeCentroid(void 0,qe,!1);continue}const Ct=H[ee](st,qe),yt=ee%2?f.EXTENT-1:0;q.x=_e(Ct[0],Math.min(f.EXTENT-1,Ct[1]),yt,ee<2,Ct[2]),q.y=0,p.encodeCentroid(q,st,!1),xe.borderDone[Se]||xe.encodeCentroid(q,qe,!1)}else p.encodeCentroid(void 0,st,!1)}p.borderDone[ee]=p.needsCentroidUpdate=!0,xe.borderDone[Se]||(xe.borderDone[Se]=xe.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const $n=new f.Color(1,0,0,1),Ys=new f.Color(0,1,0,1),Ja=new f.Color(0,0,1,1),el=new f.Color(1,0,1,1),Zr=new f.Color(0,1,1,1);function Po(h,r,l,p){Go(h,0,r+l/2,h.transform.width,l,p)}function hc(h,r,l,p){Go(h,r-l/2,0,l,h.transform.height,p)}function Go(h,r,l,p,y,v){const T=h.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*f.exported.devicePixelRatio,l*f.exported.devicePixelRatio,p*f.exported.devicePixelRatio,y*f.exported.devicePixelRatio),T.clear({color:v}),A.disable(A.SCISSOR_TEST)}function Ro(h,r,l){const p=h.context,y=p.gl,v=l.projMatrix,T=h.useProgram("debug"),A=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(A,T);const R=f.DepthMode.disabled,N=f.StencilMode.disabled,U=h.colorModeForRenderPass(),H="$debug";p.activeTexture.set(y.TEXTURE0),h.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),T.draw(p,y.LINE_STRIP,R,N,U,f.CullFaceMode.disabled,bi(v,f.Color.red),H,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);const q=A.latestRawTileData,Y=Math.floor((q&&q.byteLength||0)/1024),se=r.getTile(l).tileSize,le=512/Math.min(se,512)*(l.overscaledZ/h.transform.zoom)*.5;let _e=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(_e+=` => ${l.overscaledZ}`),function(ee,ce){ee.initDebugOverlayCanvas();const me=ee.debugOverlayCanvas,xe=ee.context.gl,Se=ee.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,me.width,me.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ce,5,5),Se.strokeText(ce,5,5),ee.debugOverlayTexture.update(me),ee.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(h,`${_e} ${Y}kb`),T.draw(p,y.TRIANGLES,R,N,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,bi(v,f.Color.transparent,le),H,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}const dc=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ga}=dc;function Zi(h,r,l,p){h.emplaceBack(r,l,p)}class Sl{constructor(r){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,Zi(this.vertexArray,-1,-1,1),Zi(this.vertexArray,1,-1,1),Zi(this.vertexArray,-1,1,1),Zi(this.vertexArray,1,1,1),Zi(this.vertexArray,-1,-1,-1),Zi(this.vertexArray,1,-1,-1),Zi(this.vertexArray,-1,1,-1),Zi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,ga),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Ho(h,r,l,p,y,v){const T=h.gl,A=r.paint.get("sky-atmosphere-color"),R=r.paint.get("sky-atmosphere-halo-color"),N=r.paint.get("sky-atmosphere-sun-intensity"),U={u_matrix_3f:f.fromMat4([],p),u_sun_direction:y,u_sun_intensity:N,u_color_tint_r:[(se=A).r,se.g,se.b,se.a],u_color_tint_m:[(le=R).r,le.g,le.b,le.a],u_luminance:5e-5};var se,le;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),l.draw(h,T.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,U,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Rs={symbol:function(h,r,l,p,y){if("translucent"!==h.renderPass)return;const v=f.StencilMode.disabled,T=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,R,N,U,H,q,Y){const se=R.transform,le="map"===H,_e="map"===q;for(const ee of A){const ce=U.getTile(ee),me=ce.getBucket(N);if(!me||!me.text||!me.text.segments.get().length)continue;const xe=f.evaluateSizeForZoom(me.textSizeData,se.zoom),Se=Rn(ce,1,R.transform.zoom),fe=gt(ee.projMatrix,_e,le,R.transform,Se),Fe="none"!==N.layout.get("icon-text-fit")&&me.hasIconData();if(xe){const Ke=Math.pow(2,se.zoom-ce.tileID.overscaledZ),st=se.elevation;Dl(me,le,_e,Y,f.symbolSize,se,fe,ee.projMatrix,Ke,xe,Fe,st?Re=>st.getAtTileOffset(ee,Re.x,Re.y):Re=>0)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y),0!==l.paint.get("icon-opacity").constantOr(1)&&Tl(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,T),0!==l.paint.get("text-opacity").constantOr(1)&&Tl(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,T),r.map.showCollisionBoxes&&($o(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),$o(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if("translucent"!==h.renderPass)return;const y=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),A=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===v.constantOr(1)||0===T.constantOr(1)))return;const R=h.context,N=R.gl,U=h.depthModeForSublayer(0,f.DepthMode.ReadOnly),H=f.StencilMode.disabled,q=h.colorModeForRenderPass(),Y=[];for(let se=0;se<p.length;se++){const le=p[se],_e=r.getTile(le),ee=_e.getBucket(l);if(!ee)continue;const ce=ee.programConfigurations.get(l.id),me=ro(l),xe={programConfiguration:ce,program:h.useProgram("circle",ce,me),layoutVertexBuffer:ee.layoutVertexBuffer,indexBuffer:ee.indexBuffer,uniformValues:Hr(h,le,_e,l),tile:_e};if(A){const Se=ee.segments.get();for(const fe of Se)Y.push({segments:new f.SegmentVector([fe]),sortKey:fe.sortKey,state:xe})}else Y.push({segments:ee.segments,sortKey:0,state:xe})}A&&Y.sort((se,le)=>se.sortKey-le.sortKey);for(const se of Y){const{programConfiguration:le,program:_e,layoutVertexBuffer:ee,indexBuffer:ce,uniformValues:me,tile:xe}=se.state,Se=se.segments;h.terrain&&h.terrain.setupElevationDraw(xe,_e,{useDepthForOcclusion:!0}),h.prepareDrawProgram(R,_e,xe.tileID.toUnwrapped()),_e.draw(R,N.TRIANGLES,U,H,q,f.CullFaceMode.disabled,me,l.id,ee,ce,Se,l.paint,h.transform.zoom,le)}},heatmap:function(h,r,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const y=h.context,v=y.gl,T=f.StencilMode.disabled,A=new f.ColorMode([v.ONE,v.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(R,N,U){const H=R.gl;R.activeTexture.set(H.TEXTURE1),R.viewport.set([0,0,N.width/4,N.height/4]);let q=U.heatmapFbo;if(q)H.bindTexture(H.TEXTURE_2D,q.colorAttachment.get()),R.bindFramebuffer.set(q.framebuffer);else{const Y=H.createTexture();H.bindTexture(H.TEXTURE_2D,Y),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),q=U.heatmapFbo=R.createFramebuffer(N.width/4,N.height/4,!1),function(se,le,_e,ee){const ce=se.gl;ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,le.width/4,le.height/4,0,ce.RGBA,se.extRenderToTextureHalfFloat?se.extTextureHalfFloat.HALF_FLOAT_OES:ce.UNSIGNED_BYTE,null),ee.colorAttachment.set(_e)}(R,N,Y,q)}})(y,h,l),y.clear({color:f.Color.transparent});for(let R=0;R<p.length;R++){const N=p[R];if(r.hasRenderableParent(N))continue;const U=r.getTile(N),H=U.getBucket(l);if(!H)continue;const q=H.programConfigurations.get(l.id),Y=h.useProgram("heatmap",q),{zoom:se}=h.transform;h.terrain&&h.terrain.setupElevationDraw(U,Y),h.prepareDrawProgram(y,Y,N.toUnwrapped()),Y.draw(y,v.TRIANGLES,f.DepthMode.disabled,T,A,f.CullFaceMode.disabled,mo(N.projMatrix,U,se,l.paint.get("heatmap-intensity")),l.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,l.paint,h.transform.zoom,q)}y.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(y,v){const T=y.context,A=T.gl,R=v.heatmapFbo;if(!R)return;T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),T.activeTexture.set(A.TEXTURE1);let N=v.colorRampTexture;N||(N=v.colorRampTexture=new f.Texture(T,v.colorRamp,A.RGBA)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,A.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,y.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(h,l))},line:function(h,r,l,p){if("translucent"!==h.renderPass)return;const y=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===y.constantOr(1)||0===v.constantOr(1))return;const T=h.depthModeForSublayer(0,f.DepthMode.ReadOnly),A=h.colorModeForRenderPass(),R=l.paint.get("line-dasharray"),N=R.constantOr(1),U=l.layout.get("line-cap"),H=l.paint.get("line-pattern"),q=H.constantOr(1),Y=l.paint.get("line-gradient"),se=l.getCrossfadeParameters(),le=q?"linePattern":"line",_e=h.context,ee=_e.gl;for(const ce of p){const me=r.getTile(ce);if(q&&!me.patternsLoaded())continue;const xe=me.getBucket(l);if(!xe)continue;h.prepareDrawTile(ce);const Se=xe.programConfigurations.get(l.id),fe=zc(l),Fe=h.useProgram(le,Se,fe),Ke=H.constantOr(null);if(Ke&&me.imageAtlas){const It=me.imageAtlas,Ct=It.patternPositions[Ke.to.toString()],yt=It.patternPositions[Ke.from.toString()];Ct&&yt&&Se.setConstantPatternPositions(Ct,yt)}const st=R.constantOr(null),Re=U.constantOr(null);if(!q&&st&&Re&&me.lineAtlas){const It=me.lineAtlas,Ct=It.getDash(st.to,Re),yt=It.getDash(st.from,Re);Ct&&yt&&Se.setConstantPatternPositions(Ct,yt)}const qe=h.terrain?ce.projMatrix:null,vt=q?qr(h,me,l,se,qe):Qr(h,me,l,se,qe,xe.lineClipsArray.length);if(Y){const It=xe.gradients[l.id];let Ct=It.texture;if(l.gradientVersion!==It.version){let yt=256;if(l.stepInterpolant){const Mt=r.getSource().maxzoom,wn=ce.canonical.z===Mt?Math.ceil(1<<h.transform.maxZoom-ce.canonical.z):1;yt=f.clamp(f.nextPowerOfTwo(xe.maxLineLength/f.EXTENT*1024*wn),256,_e.maxTextureSize)}It.gradient=f.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:yt,image:It.gradient||void 0,clips:xe.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new f.Texture(_e,It.gradient,ee.RGBA),It.version=l.gradientVersion,Ct=It.texture}_e.activeTexture.set(ee.TEXTURE1),Ct.bind(l.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}N&&(_e.activeTexture.set(ee.TEXTURE0),me.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),Se.updatePaintBuffers(se)),q&&(_e.activeTexture.set(ee.TEXTURE0),me.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Se.updatePaintBuffers(se)),h.prepareDrawProgram(_e,Fe,ce.toUnwrapped()),Fe.draw(_e,ee.TRIANGLES,T,h.stencilModeForClipping(ce),A,f.CullFaceMode.disabled,vt,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,h.transform.zoom,Se,xe.layoutVertexBuffer2)}},fill:function(h,r,l,p){const y=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const T=h.colorModeForRenderPass(),A=l.paint.get("fill-pattern"),R=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===y.constantOr(f.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(h.renderPass===R){const N=h.depthModeForSublayer(1,"opaque"===h.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);fi(h,r,l,p,N,T,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const N=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);fi(h,r,l,p,N,T,!0)}},"fill-extrusion":function(h,r,l,p){const y=l.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===h.renderPass){const v=new f.DepthMode(h.context.gl.LEQUAL,f.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==y||l.paint.get("fill-extrusion-pattern").constantOr(1))Ws(h,r,l,p,v,f.StencilMode.disabled,f.ColorMode.disabled),Ws(h,r,l,p,v,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const T=h.colorModeForRenderPass();Ws(h,r,l,p,v,f.StencilMode.disabled,T)}}},hillshade:function(h,r,l,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const y=h.context,v=h.depthModeForSublayer(0,f.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture,[R,N]="translucent"!==h.renderPass||A?[{},p]:h.stencilConfigForOverlap(p);for(const U of N){const H=r.getTile(U);if(H.needsHillshadePrepare&&"offscreen"===h.renderPass)Nn(h,H,l,v,f.StencilMode.disabled,T);else if("translucent"===h.renderPass){const q=A&&h.terrain?h.terrain.stencilModeForRTTOverlap(U):R[U.overscaledZ];Hs(h,U,H,l,v,q,T)}}y.viewport.set([0,0,h.width,h.height])},raster:function(h,r,l,p,y,v){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const T=h.context,A=T.gl,R=r.getSource(),N=h.useProgram("raster"),U=h.colorModeForRenderPass(),H=h.terrain&&h.terrain.renderingToTexture,[q,Y]=R instanceof re||H?[{},p]:h.stencilConfigForOverlap(p),se=Y[Y.length-1].overscaledZ,le=!h.options.moving;for(const _e of Y){const ee=H?f.DepthMode.disabled:h.depthModeForSublayer(_e.overscaledZ-se,1===l.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,A.LESS),ce=_e.toUnwrapped(),me=r.getTile(_e);if(H&&(!me||!me.hasData()))continue;const xe=H?_e.projMatrix:h.transform.calculateProjMatrix(ce,le),Se=h.terrain&&H?h.terrain.stencilModeForRTTOverlap(_e):q[_e.overscaledZ],fe=v?0:l.paint.get("raster-fade-duration");me.registerFadeDuration(fe);const Fe=r.findLoadedParent(_e,0),Ke=W(me,Fe,r,h.transform,fe);let st,Re;h.terrain&&h.terrain.prepareDrawTile(_e);const qe="nearest"===l.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;T.activeTexture.set(A.TEXTURE0),me.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(A.TEXTURE1),Fe?(Fe.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),st=Math.pow(2,Fe.tileID.overscaledZ-me.tileID.overscaledZ),Re=[me.tileID.canonical.x*st%1,me.tileID.canonical.y*st%1]):me.texture.bind(qe,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const vt=Mo(xe,Re||[0,0],st||1,Ke,l);h.prepareDrawProgram(T,N,ce),R instanceof re?N.draw(T,A.TRIANGLES,ee,f.StencilMode.disabled,U,f.CullFaceMode.disabled,vt,l.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):N.draw(T,A.TRIANGLES,ee,Se,U,f.CullFaceMode.disabled,vt,l.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,r,l,p){const y=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const T=h.context,A=T.gl,R=h.transform,N=R.tileSize,U=l.paint.get("background-pattern");if(h.isPatternMissing(U))return;const H=!U&&1===y.a&&1===v&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==H)return;const q=f.StencilMode.disabled,Y=h.depthModeForSublayer(0,"opaque"===H?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),se=h.colorModeForRenderPass(),le=h.useProgram(U?"backgroundPattern":"background"),_e=p||R.coveringTiles({tileSize:N});U&&(T.activeTexture.set(A.TEXTURE0),h.imageManager.bind(h.context));const ee=l.getCrossfadeParameters();for(const ce of _e){const me=ce.toUnwrapped(),xe=p?ce.projMatrix:h.transform.calculateProjMatrix(me);h.prepareDrawTile(ce);const Se=U?go(xe,v,h,U,{tileID:ce,tileSize:N},ee):uc(xe,v,y);h.prepareDrawProgram(T,le,me),le.draw(T,A.TRIANGLES,Y,q,se,f.CullFaceMode.disabled,Se,l.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},sky:function(h,r,l){const p=l.paint.get("sky-opacity");if(0===p)return;const y=h.context,v=l.paint.get("sky-type"),T=new f.DepthMode(y.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;"atmosphere"===v?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(R,N,U,H){const q=R.context,Y=q.gl;let se=N.skyboxFbo;if(!se){se=N.skyboxFbo=q.createFramebuffer(32,32,!1),N.skyboxGeometry=new Sl(q),N.skyboxTexture=q.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,N.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ce=0;ce<6;++ce)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(se.framebuffer),q.viewport.set([0,0,32,32]);const le=N.getCenter(R,!0),_e=R.useProgram("skyboxCapture"),ee=new Float64Array(16);f.identity(ee),f.rotateY(ee,ee,.5*-Math.PI),Ho(q,N,_e,ee,le,0),f.identity(ee),f.rotateY(ee,ee,.5*Math.PI),Ho(q,N,_e,ee,le,1),f.identity(ee),f.rotateX(ee,ee,.5*-Math.PI),Ho(q,N,_e,ee,le,2),f.identity(ee),f.rotateX(ee,ee,.5*Math.PI),Ho(q,N,_e,ee,le,3),f.identity(ee),Ho(q,N,_e,ee,le,4),f.identity(ee),f.rotateY(ee,ee,Math.PI),Ho(q,N,_e,ee,le,5),q.viewport.set([0,0,R.width,R.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(R,N,U,H,q){const Y=R.context,se=Y.gl,le=R.transform,_e=R.useProgram("skybox");Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,N.skyboxTexture);const ee={u_matrix:le.skyboxMatrix,u_sun_direction:N.getCenter(R,!1),u_cubemap:0,u_opacity:H,u_temporal_offset:q};R.prepareDrawProgram(Y,_e),_e.draw(Y,se.TRIANGLES,U,f.StencilMode.disabled,R.colorModeForRenderPass(),f.CullFaceMode.backCW,ee,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(h,l,T,p,A):"gradient"===v&&"sky"===h.renderPass&&function(R,N,U,H,q){const Y=R.context,se=Y.gl,le=R.transform,_e=R.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Sl(Y)),Y.activeTexture.set(se.TEXTURE0);let ee=N.colorRampTexture;ee||(ee=N.colorRampTexture=new f.Texture(Y,N.colorRamp,se.RGBA)),ee.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ce=(me=le.skyboxMatrix,xe=N.getCenter(R,!1),Se=N.paint.get("sky-gradient-radius"),fe=H,Fe=q,{u_matrix:me,u_color_ramp:0,u_center_direction:xe,u_radius:f.degToRad(Se),u_opacity:fe,u_temporal_offset:Fe});var me,xe,Se,fe,Fe;R.prepareDrawProgram(Y,_e),_e.draw(Y,se.TRIANGLES,U,f.StencilMode.disabled,R.colorModeForRenderPass(),f.CullFaceMode.backCW,ce,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(h,l,T,p,A)},debug:function(h,r,l){for(let p=0;p<l.length;p++)Ro(h,r,l[p])},custom:function(h,r,l){const p=h.context,y=l.implementation;if("offscreen"===h.renderPass){const v=y.prerender;v&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),v.call(y,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if("translucent"===h.renderPass){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(f.StencilMode.disabled);const v="3d"===y.renderingMode?new f.DepthMode(h.context.gl.LEQUAL,f.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,f.DepthMode.ReadOnly);p.setDepthMode(v),y.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class tl{constructor(r,l){this.context=new Mi(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new To,this.gpuTimers={},this.frameCounter=0}updateTerrain(r,l){const p=!!r&&!!r.terrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ee(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=l.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*f.exported.devicePixelRatio,this.height=l*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new f.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(f.EXTENT,0),l.emplaceBack(0,f.EXTENT),l.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const p=new f.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(f.EXTENT,0),p.emplaceBack(0,f.EXTENT),p.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=r.createVertexBuffer(p,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const y=new f.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(f.EXTENT,0,f.EXTENT,0),y.emplaceBack(0,f.EXTENT,0,f.EXTENT),y.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(y,pn.members),this.rasterBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const v=new f.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const T=new f.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(T);const A=new f.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new f.Texture(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA),this.identityMat=f.create$1();const R=this.context.gl;this.stencilClearMode=new f.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(f.window.performance.now())}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(r,l.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,z(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,l,p){if(!(l&&this.currentStencilSource!==l.id&&r.isTileClipped()&&p&&p.length))return;this.currentStencilSource=l.id;const y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(f.ColorMode.disabled),y.setDepthMode(f.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const R=this._tileClippingMaskIDs[A.key]=this.nextStencilID++;T.draw(y,v.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,z(A.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new f.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new f.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((T,A)=>A.overscaledZ-T.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let A=0;A<v;A++)T[A+y]=new f.StencilMode({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[T,p]}return[{[y]:f.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;if(this._showOverdrawInspector){const l=1/8;return new f.ColorMode([r.CONSTANT_COLOR,r.ONE],new f.Color(l,l,l,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new f.DepthMode(p||this.context.gl.LEQUAL,l,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const p=this.style.order,y=this.style._sourceCaches;for(const N in y){const U=y[N];U.used&&U.prepare(this.context)}const v={},T={},A={};for(const N in y){const U=y[N];v[N]=U.getVisibleCoordinates(),T[N]=v[N].slice().reverse(),A[N]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<p.length;N++)if(this.style._layers[p[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of p){const U=this.style._layers[N],H=r._getLayerSourceCache(U);if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const q=H?T[H.id]:void 0;("custom"===U.type||U.isSky()||q&&q.length)&&this.renderLayer(this,H,U,q)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let R=f.Color.transparent;if(this.style.fog&&(R=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?f.Color.black:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[p[this.currentLayer]],U=r._getLayerSourceCache(N);if(N.isSky())continue;const H=U?T[U.id]:void 0;this._renderTileClippingMasks(N,U,H),this.renderLayer(this,U,N,H)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const N=this.style._layers[p[this.currentLayer]],U=r._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,U,N,U?T[U.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const N=this.style._layers[p[this.currentLayer]],U=r._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=U?("symbol"===N.type?A:T)[U.id]:void 0;this._renderTileClippingMasks(N,U,U?v[U.id]:void 0),this.renderLayer(this,U,N,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let N=null;f.values(this.style._layers).forEach(U=>{const H=r._getLayerSourceCache(U);H&&!U.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<H.getSource().maxzoom)&&(N=H)}),N&&this.options.showTileBoundaries&&Rs.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const U=N.transform.padding;Po(N,N.transform.height-(U.top||0),3,$n),Po(N,U.bottom||0,3,Ys),hc(N,U.left||0,3,Ja),hc(N,N.transform.width-(U.right||0),3,el);const H=N.transform.centerPoint;var q,Y,se,le;Go(q=N,(Y=H.x)-1,(se=N.transform.height-H.y)-10,2,20,le=Zr),Go(q,Y-10,se-1,20,2,le)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%f.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,p,y){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),Rs[p.type](r,l,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const l={};for(const p in r){const y=r[p],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),l[p]=T}return l}translatePosMatrix(r,l,p,y,v){if(!p[0]&&!p[1])return r;const T=v?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(T){const N=Math.sin(T),U=Math.cos(T);p=[p[0]*U-p[1]*N,p[0]*N+p[1]*U]}const A=[v?p[0]:Rn(l,p[0],this.transform.zoom),v?p[1]:Rn(l,p[1],this.transform.zoom),0],R=new Float32Array(16);return f.translate(R,r,A),R}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!l||!p}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!r&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,l,p){this.cache=this.cache||{};const y=p||[],v=this.currentGlobalDefines().concat(y),T=ht.cacheKey(r,v,l);return this.cache[T]||(this.cache[T]=new ht(this.context,r,Gs[r],l,Qa[r],v)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(r){this.terrain&&this.terrain.prepareDrawTile(r)}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch);0!==v&&l.setFogUniformValues(r,((T,A,R,N)=>{const U=A.properties.get("color"),H=T.frameCounter/1e3%1,q=[U.r/U.a,U.g/U.a,U.b/U.a,N];return{u_fog_matrix:R?T.transform.calculateFogTileMatrix(R):T.identityMat,u_fog_range:A.getFovAdjustedRange(T.transform._fov),u_fog_color:q,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:H}})(this,y,p,v))}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}}class _o{constructor(r=0,l=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=y}interpolate(r,l,p){return null!=l.top&&null!=r.top&&(this.top=f.number(r.top,l.top,p)),null!=l.bottom&&null!=r.bottom&&(this.bottom=f.number(r.bottom,l.bottom,p)),null!=l.left&&null!=r.left&&(this.left=f.number(r.left,l.left,p)),null!=l.right&&null!=r.right&&(this.right=f.number(r.right,l.right,p)),this}getCenter(r,l){const p=f.clamp((this.left+r-this.right)/2,0,r),y=f.clamp((this.top+l-this.bottom)/2,0,l);return new f.pointGeometry(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new _o(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Oi(h,r){return[h[4*r],h[4*r+1],h[4*r+2],h[4*r+3]]}function Il(h,r,l){h[4*r+0]=l[0],h[4*r+1]=l[1],h[4*r+2]=l[2],h[4*r+3]=l[3]}function ko(h,r){const l=Oi(h,3);f.fromQuat(h,r),Il(h,3,l)}function Al(h,r){Il(h,3,[r[0],r[1],r[2],1])}function us(h,r){const l=f.identity$1([]);return f.rotateZ$1(l,l,-r),f.rotateX$1(l,l,-h),l}function Xs(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(f.length(l)>=1e-15){const T=f.normalize([],l);f.scale(p,T,f.dot(p,T)),r[0]=p[0],r[1]=p[1]}const y=f.cross([],r,h);if(f.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return us(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class nl{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){this._position=this._renderWorldCopies?function(l){if(!l)return;const p=Array.isArray(l)?new f.MercatorCoordinate(l[0],l[1],l[2]):l;return p.x=f.wrap(p.x,0,1),p}(r):r}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(r)):0,y=this.position,v=f.MercatorCoordinate.fromLngLat(r,p),T=[v.x-y.x,v.y-y.y,v.z-y.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Xs(T,l)}setPitchBearing(r,l){this.orientation=us(f.degToRad(r),f.degToRad(-l))}}class _a{constructor(r,l){this._transform=f.identity([]),this._orientation=f.identity$1([]),l&&(this._orientation=l,ko(this._transform,this._orientation)),r&&Al(this._transform,r)}get mercatorPosition(){const r=this.position;return new f.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=Oi(this._transform,3);return[r[0],r[1],r[2]]}set position(r){Al(this._transform,r)}get orientation(){return this._orientation}set orientation(r){this._orientation=r,ko(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=us(r,l),ko(this._transform,this._orientation)}forward(){const r=Oi(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=Oi(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=Oi(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return f.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const y=this.position;f.scale(y,y,-r);const v=new Float64Array(16);return f.fromScaling(v,[p,p,p]),f.translate(v,v,y),v[10]*=l,v}getWorldToCamera(r,l){const p=new Float64Array(16),y=new Float64Array(4),v=this.position;return f.conjugate(y,this._orientation),f.scale(v,v,-r),f.fromQuat(p,y),f.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,y){const v=new Float64Array(16);return f.perspective(v,r,l,p,y),v}getDistanceToElevation(r){const l=0===r?0:f.mercatorZfromAltitude(r,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new _a([...this.position],[...this.orientation])}}class ya{constructor(r,l,p,y,v){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=null==p?0:p,this._maxPitch=null==y?60:y,this.setMaxBounds(),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _o,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new _a,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const r=new ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._cameraZoom=this._cameraZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,r?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(r){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),r&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return f.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const l=-f.wrap(r,-180,180)*Math.PI/180;var p,y,v,T,A,R,N,U,H,q;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),y=this.rotationMatrix,T=this.angle,A=(v=this.rotationMatrix)[0],R=v[1],N=v[2],U=v[3],H=Math.sin(T),q=Math.cos(T),y[0]=A*q+N*H,y[1]=R*q+U*H,y[2]=A*-H+N*q,y[3]=R*-H+U*q)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=f.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const r=this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(this.center),-1);return-1===r?(this._cameraZoom=null,!1):(this._centerAltitude=r,!0)}_updateCameraOnTerrain(){const r=this.cameraToCenterDistance/this.worldSize,l=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(l+r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,v=0;for(let T=0;T<l.length;T++){const A=new f.pointGeometry(l[T][0]*this.width,p+l[T][1]*(this.height-p)),R=r.pointCoordinate(A);if(!R)continue;const N=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);y+=R[3]*N,v+=N}return 0===v?NaN:y/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const r=this._cameraZoom,l=this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(this.center)),p=f.mercatorZfromAltitude(l,this.center.lat),y=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const y=f.length(f.sub([],this._camera.position,p));return f.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!f.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];f.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new nl;return l.position=new f.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this._renderWorldCopies,l}_setCameraOrientation(r){if(!f.length$1(r))return!1;f.normalize$1(r,r);const l=f.transformQuat([],[0,0,-1],r),p=f.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const y=Xs(l,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=f.clamp(r[2],y/p,y/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new f.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new f.pointGeometry(0,0)),y=this.pointCoordinate(new f.pointGeometry(this.width,0)),v=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new f.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,y.x,v.x,T.x)),R=Math.floor(Math.max(p.x,y.x,v.x,T.x)),N=1;for(let U=A-N;U<=R+N;U++)0!==U&&l.push(new f.UnwrappedTileID(U,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,y=this.elevation&&!r.isTerrainDEM;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const v=f.MercatorCoordinate.fromLngLat(this.center),T=1<<l,A=[T*v.x,T*v.y,0],R=Qt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l),N=this.pointCoordinate(this.getCameraPoint()),U=T*f.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),q=[T*N.x,T*N.y,H],Y=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?l:0,le=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=r.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=Re=>({aabb:new Pn([Re*T,0,_e],[(Re+1)*T,T,le]),zoom:0,x:0,y:0,wrap:Re,fullyVisible:!1}),ce=[];let me=[];const xe=l,Se=r.reparseOverscaled?p:l,fe=Re=>{if(!this._elevation||!Re.tileID)return;const qe=this._elevation.getMinMaxForTile(Re.tileID),vt=Re.aabb;qe?(vt.min[2]=qe.min,vt.max[2]=qe.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(Re.shouldSplit=st(Re),Re.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},Fe=Re=>Re*Re,Ke=Fe((H-this._centerAltitude)*U),st=Re=>{if(Re.zoom<se)return!0;if(Re.zoom===xe)return!1;if(null!=Re.shouldSplit)return Re.shouldSplit;const qe=Re.aabb.distanceX(q),vt=Re.aabb.distanceY(q);let It=Ke;y&&(It=Fe(Re.aabb.distanceZ(q)*U));const Ct=qe*qe+vt*vt+It;return Ct<Fe((1<<xe-Re.zoom)*Y*((yt,Mt)=>{if(Mt*Fe(.707)<yt)return 1;const wn=Math.sqrt(Mt/yt);return wn/(1.4144271570014144+(Math.pow(1.1,wn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Ke),Ct))};if(this._renderWorldCopies)for(let Re=1;Re<=3;Re++)ce.push(ee(-Re)),ce.push(ee(Re));for(ce.push(ee(0));ce.length>0;){const Re=ce.pop(),qe=Re.x,vt=Re.y;let It=Re.fullyVisible;if(!It){const Ct=Re.aabb.intersects(R);if(0===Ct)continue;It=2===Ct}if(Re.zoom!==xe&&st(Re))for(let Ct=0;Ct<4;Ct++){const yt=(qe<<1)+Ct%2,Mt=(vt<<1)+(Ct>>1),wn={aabb:Re.aabb.quadrant(Ct),zoom:Re.zoom+1,x:yt,y:Mt,wrap:Re.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0};y&&(wn.tileID=new f.OverscaledTileID(Re.zoom+1===xe?Se:Re.zoom+1,Re.wrap,Re.zoom+1,yt,Mt),fe(wn)),ce.push(wn)}else{const Ct=Re.zoom===xe?Se:Re.zoom;if(r.minzoom&&r.minzoom>Ct)continue;const yt=A[0]-(.5+qe+(Re.wrap<<Re.zoom))*(1<<l-Re.zoom),Mt=A[1]-.5-vt,wn=Re.tileID?Re.tileID:new f.OverscaledTileID(Ct,Re.wrap,Re.zoom,qe,vt);me.push({tileID:wn,distanceSq:yt*yt+Mt*Mt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,qe=this.horizonLineFromTop();me=me.filter(vt=>{const It=[0,0,0,1],Ct=[f.EXTENT,f.EXTENT,0,1],yt=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());f.transformMat4(It,It,yt),f.transformMat4(Ct,Ct,yt);const Mt=f.getAABBPointSquareDist(It,Ct);if(0===Mt)return!0;let wn=!1;const nn=this._elevation;if(nn&&Mt>Re&&0!==qe){const Rr=this.calculateProjMatrix(vt.tileID.toUnwrapped());let xr;r.isTerrainDEM||(xr=nn.getMinMaxForTile(vt.tileID)),xr||(xr={min:_e,max:le});const mn=f.furthestTileCorner(this.bearing),dn=[mn[0]*f.EXTENT,mn[1]*f.EXTENT,xr.max];f.transformMat4$1(dn,dn,Rr),wn=(1-dn[1])*this.height*.5<qe}return Mt<Re||wn})}return me.sort((Re,qe)=>Re.distanceSq-qe.distanceSq).map(Re=>Re.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=f.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new f.pointGeometry(f.mercatorXfromLng(r.lng)*this.worldSize,f.mercatorYfromLat(l)*this.worldSize)}unproject(r){return new f.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(r,l){const p=this.pointCoordinate(l),y=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r),T=new f.MercatorCoordinate(v.x-(p.x-y.x),v.y-(p.y-y.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(r){this.center=this.coordinateLocation(r),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r){return this._coordinatePoint(this.locationCoordinate(r),!1)}locationPoint3D(r){return this._coordinatePoint(this.locationCoordinate(r),!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r){return f.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r.toLngLat()}pointRayIntersection(r,l){const p=null!=l?l:this._centerAltitude,y=[r.x,r.y,0,1],v=[r.x,r.y,1,1];f.transformMat4(y,y,this.pixelMatrixInverse),f.transformMat4(v,v,this.pixelMatrixInverse);const T=v[3];f.scale$2(y,y,1/y[3]),f.scale$2(v,v,1/T);const A=y[2],R=v[2];return{p0:y,p1:v,t:A===R?0:(p-A)/(R-A)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return f.transformMat4(l,l,this.pixelMatrixInverse),f.transformMat4(p,p,this.pixelMatrixInverse),f.scale$2(l,l,1/l[3]),f.scale$2(p,p,1/p[3]),l[2]=f.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=f.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,f.scale$2(l,l,1/this.worldSize),f.scale$2(p,p,1/this.worldSize),new et([l[0],l[1],l[2]],f.normalize([],f.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:y}=r,v=f.mercatorZfromAltitude(l[2],this._center.lat),T=f.mercatorZfromAltitude(p[2],this._center.lat);return new f.MercatorCoordinate(f.number(l[0],p[0],y)/this.worldSize,f.number(l[1],p[1],y)/this.worldSize,f.number(v,T,y))}pointCoordinate(r,l=this._centerAltitude){const p=this.horizonLineFromTop(!1),y=new f.pointGeometry(r.x,Math.max(p,r.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(y,l))}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);const l=this.elevation;let p=this.elevation.pointCoordinate(r);if(p)return new f.MercatorCoordinate(p[0],p[1],p[2]);let y=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r);const T=.02*v,A=r.clone();for(let R=0;R<10&&v-y>T;R++){A.y=f.number(y,v,.66);const N=l.pointCoordinate(A);N?(v=A.y,p=N):y=A.y}return p?new f.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){if(this.elevation)return!this.elevation.pointCoordinate(r);{const l=this.horizonLineFromTop();return r.y<l}}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return f.transformMat4(y,y,this.pixelMatrix),y[3]>0?new f.pointGeometry(y[0]/y[3],y[1]/y[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,l){const p=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(p,r),R=this.pointCoordinate(y,r);const N=this.pointCoordinate(v,l),U=this.pointCoordinate(T,l),H=(q,Y)=>(Y.y-q.y)/(Y.x-q.x);return A.y>1&&R.y>=0?A=new f.MercatorCoordinate((1-U.y)/H(U,A)+U.x,1):A.y<0&&R.y<=1&&(A=new f.MercatorCoordinate(-U.y/H(U,A)+U.x,0)),R.y>1&&A.y>=0?R=new f.MercatorCoordinate((1-N.y)/H(N,R)+N.x,1):R.y<0&&A.y<=1&&(R=new f.MercatorCoordinate(-N.y/H(N,R)+N.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(N))}_getBounds3D(){const r=this.elevation,l=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new f.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(r){if(r){const l=r.getEast(),p=r.getWest();this.lngRange=[p,l>p?l:l+360],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(r,l){const p=r.canonical,y=l/this.zoomScale(p.z),v=p.x+Math.pow(2,p.z)*r.wrap,T=f.identity(new Float64Array(16));return f.translate(T,T,[v*y,p.y*y,0]),f.scale$1(T,T,[y/f.EXTENT,y/f.EXTENT,1]),T}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const y=this.calculatePosMatrix(r,this.cameraWorldSize);return f.multiply(y,this.worldToFogMatrix,y),p[l]=new Float32Array(y),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,y=l?this._alignedProjMatrixCache:this._projMatrixCache;if(y[p])return y[p];const v=this.calculatePosMatrix(r,this.worldSize);return f.multiply(v,l?this.alignedProjMatrix:this.projMatrix,v),y[p]=new Float32Array(v),y[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=this._camera.position,p=this._camera.forward();if(l[2]<=0||p[2]>=0)return;const y=f.mercatorZfromAltitude(1,this._center.lat);l[2]/=y,p[2]/=y,f.normalize(p,p);const v=r.raycast(l,p,r.exaggeration());if(v){const T=f.scaleAndAdd([],l,p,v),A=new f.MercatorCoordinate(T[0],T[1],f.mercatorZfromAltitude(T[2],f.latFromMercatorY(T[1]))),R=this._camera.position,N=A.z+f.length([A.x-R[0],A.y-R[1],A.z-R[2]]);this._cameraZoom=this._zoomFromMercatorZ(N),this._centerAltitude=A.toAltitude(),this._center=A.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=r.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),y=f.mercatorZfromAltitude(l,this._center.lat),v=this._camera.position[2]-y;if(v<p){const T=f.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),A=this._camera.mercatorPosition,R=[T.x-A.x,T.y-A.y,T.z-A.z],N=f.length(R);R[2]-=p-v;const U=f.length(R);if(0===U)return;f.scale(R,R,N/U),this._camera.position=[T.x-R[0],T.y-R[1],T.z-R[2]],this._camera.orientation=Xs(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,l,p,y,v,T=1/0,A=-1/0;const R=this.size,N=this._unmodified;if(this.latRange){const Y=this.latRange;T=f.mercatorYfromLat(Y[1])*this.worldSize,A=f.mercatorYfromLat(Y[0])*this.worldSize,p=A-T<R.y?R.y/(A-T):0}if(this.lngRange){const Y=this.lngRange;r=f.mercatorXfromLng(Y[0])*this.worldSize,l=f.mercatorXfromLng(Y[1])*this.worldSize,y=l-r<R.x?R.x/(l-r):0}const U=this.point,H=Math.max(y||0,p||0);if(H)return this.center=this.unproject(new f.pointGeometry(y?(l+r)/2:U.x,p?(A+T)/2:U.y)),this.zoom+=this.scaleZoom(H),this._unmodified=N,void(this._constraining=!1);if(this.latRange){const Y=U.y,se=R.y/2;Y-se<T&&(v=T+se),Y+se>A&&(v=A-se)}let q=U.x;if(this.lngRange){const Y=this.worldSize/2-(r+l)/2;q=(q+Y+this.worldSize)%this.worldSize,r+=Y,l+=Y;const se=R.x/2;q-se<r&&(q=r+se),q+se>l&&(q=l-se),q-=Y}q===U.x&&void 0===v||(this.center=this.unproject(new f.pointGeometry(q,void 0!==v?v:U.y))),this._constrainCameraAltitude(),this._unmodified=N,this._constraining=!1}_minZoomForBounds(){const r=(y,v)=>Math.log2(y/(this.tileSize*Math.abs(v[1]-v[0])));let l=0;if(this.latRange){const y=this.latRange;l=r(this.height,[f.mercatorYfromLat(y[0]),f.mercatorYfromLat(y[1])])}let p=0;if(this.lngRange){const y=this.lngRange;p=r(this.width,[f.mercatorXfromLng(y[0]),f.mercatorXfromLng(y[1])])}return Math.max(l,p)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const l=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,y=this.fovAboveCenter,v=this.elevation?this.elevation.getMinElevationBelowMSL()*l:0,T=(this._camera.position[2]*this.worldSize-v)/Math.cos(this._pitch),A=Math.sin(y)*T/Math.sin(f.clamp(Math.PI-p-y,.01,Math.PI-.01)),R=this.point,N=R.x,U=R.y,H=Math.cos(Math.PI/2-this._pitch)*A+T,q=Math.min(1.01*H,T*(1/this._horizonShift)),Y=this.height/50,se=this._camera.getWorldToCamera(this.worldSize,l),le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,Y,q);le[8]=2*-r.x/this.width,le[9]=2*r.y/this.height;let _e=f.mul$1([],le,se);this.mercatorMatrix=f.scale$1([],_e,[this.worldSize,this.worldSize,this.worldSize/l]),this.projMatrix=_e,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const ee=new Float32Array(16);f.identity(ee),f.scale$1(ee,ee,[1,-1,1]),f.rotateX(ee,ee,this._pitch),f.rotateZ(ee,ee,this.angle);const ce=f.perspective(new Float32Array(16),this._fov,this.width/this.height,Y,q),me=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ce[8]=2*-r.x/this.width,ce[9]=2*(r.y+me)/this.height,this.skyboxMatrix=f.multiply(ee,ce,ee);const xe=this.width%2/2,Se=this.height%2/2,fe=Math.cos(this.angle),Fe=Math.sin(this.angle),Ke=N-Math.round(N)+fe*xe+Fe*Se,st=U-Math.round(U)+fe*Se+Fe*xe,Re=new Float64Array(_e);if(f.translate(Re,Re,[Ke>.5?Ke-1:Ke,st>.5?st-1:st,0]),this.alignedProjMatrix=Re,_e=f.create$1(),f.scale$1(_e,_e,[this.width/2,-this.height/2,1]),f.translate(_e,_e,[1,-1,0]),this.labelPlaneMatrix=_e,_e=f.create$1(),f.scale$1(_e,_e,[1,-1,1]),f.translate(_e,_e,[-1,-1,0]),f.scale$1(_e,_e,[2/this.width,2/this.height,1]),this.glCoordMatrix=_e,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),_e=f.invert(new Float64Array(16),this.pixelMatrix),!_e)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_e,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height,v=[r,r,l];f.scale(v,v,y),f.scale(p,p,-1),f.multiply$1(p,p,v);const T=f.create$1();f.translate(T,T,p),f.scale$1(T,T,v),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,y)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const r=this._camera.forward(),l=this.cameraToCenterDistance,p=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-f.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this.cameraToCenterDistance/y;this._camera.position=[p.x/this.worldSize-r[0]*l/v,p.y/this.worldSize-r[1]*l/v,f.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-r[2]*l/v]}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=r[2];let y=1;p>0&&(y=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat),T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),A=Math.max((r[2]-v)/Math.cos(p),T),R=this._zoomFromMercatorZ(A);f.scaleAndAdd(r,r,l,A),this._pitch=f.clamp(p,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(y,-Math.PI,Math.PI),this._setZoom(f.clamp(R,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new f.MercatorCoordinate(r[0],r[1],r[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(r,l){const p=Math.min(r.x,l.x),y=Math.max(r.x,l.x),v=Math.min(r.y,l.y),T=Math.max(r.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;const A=[new f.pointGeometry(p,v),new f.pointGeometry(y,T),new f.pointGeometry(p,T),new f.pointGeometry(y,v)],R=this._renderWorldCopies?-3:0,N=this._renderWorldCopies?4:1;for(const U of A){const H=this.pointRayIntersection(U);if(H.t<0)return!0;const q=this.rayIntersectionCoordinate(H);if(q.x<R||q.y<0||q.x>N||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=f.length(f.sub([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(y)}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,r))}}function Bc(h,r){let l=!1,p=null;const y=()=>{p=null,l&&(h(),p=setTimeout(y,r),l=!1)};return()=>(l=!0,p||y(),p)}class wi{constructor(r){this._hashName=r&&encodeURIComponent(r),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,f.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return f.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const l=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),T=Math.round(l.lng*v)/v,A=Math.round(l.lat*v)/v,R=this._map.getBearing(),N=this._map.getPitch();let U="";if(U+=r?`/${T}/${A}/${p}`:`${p}/${A}/${T}`,(R||N)&&(U+="/"+Math.round(10*R)/10),N&&(U+=`/${Math.round(N)}`),this._hashName){const H=this._hashName;let q=!1;const Y=f.window.location.hash.slice(1).split("&").map(se=>{const le=se.split("=")[0];return le===H?(q=!0,`${le}=${U}`):se}).filter(se=>se);return q||Y.push(`${H}=${U}`),`#${Y.join("&")}`}return`#${U}`}_getCurrentHash(){const r=f.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,r)}}const Wi={linearity:.3,easing:f.bezier(0,0,.3,1)},_r=f.extend({deceleration:2500,maxSpeed:1400},Wi),Vc=f.extend({deceleration:20,maxSpeed:1400},Wi),Uc=f.extend({deceleration:1e3,maxSpeed:360},Wi),Ml=f.extend({deceleration:1e3,maxSpeed:90},Wi);class fc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=f.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const v=va(l.pan.mag(),p,f.extend({},_r,r||{}));y.offset=l.pan.mult(v.amount/l.pan.mag()),y.center=this._map.transform.center,rl(y,v)}if(l.zoom){const v=va(l.zoom,p,Vc);y.zoom=this._map.transform.zoom+v.amount,rl(y,v)}if(l.bearing){const v=va(l.bearing,p,Uc);y.bearing=this._map.transform.bearing+f.clamp(v.amount,-179,179),rl(y,v)}if(l.pitch){const v=va(l.pitch,p,Ml);y.pitch=this._map.transform.pitch+v.amount,rl(y,v)}if(y.zoom||y.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),f.extend(y,{noMoveStart:!0})}}function rl(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function va(h,r,l){const{maxSpeed:p,linearity:y,deceleration:v}=l,T=f.clamp(h*y/(r/1e3),-p,p),A=Math.abs(T)/(v*y);return{easing:l.easing,duration:1e3*A,amount:T*(A/2)}}class Ei extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,y={}){const v=Ie.mousePos(l.getCanvasContainer(),p),T=l.unproject(v);super(r,f.extend({point:v,lngLat:T,originalEvent:p},y)),this._defaultPrevented=!1,this.target=l}}class hs extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const y="touchend"===r?p.changedTouches:p.touches,v=Ie.touchPos(l.getCanvasContainer(),y),T=v.map(R=>l.unproject(R)),A=v.reduce((R,N,U,H)=>R.add(N.div(H.length)),new f.pointGeometry(0,0));super(r,{points:v,point:A,lngLats:T,lngLat:l.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class xa extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class ds{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new xa(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Ei(r.type,this._map,r))}mouseup(r){this._map.fire(new Ei(r.type,this._map,r))}preclick(r){const l=f.extend({},r);l.type="preclick",this._map.fire(new Ei(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ei(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ei(r.type,this._map,r))}mouseover(r){this._map.fire(new Ei(r.type,this._map,r))}mouseout(r){this._map.fire(new Ei(r.type,this._map,r))}touchstart(r){return this._firePreventable(new hs(r.type,this._map,r))}touchmove(r){this._map.fire(new hs(r.type,this._map,r))}touchend(r){this._map.fire(new hs(r.type,this._map,r))}touchcancel(r){this._map.fire(new hs(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pl{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Ei(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ei(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jc{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(Ie.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=p,this._box||(this._box=Ie.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(y.x,p.x),T=Math.max(y.x,p.x),A=Math.min(y.y,p.y),R=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(Ie.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=T-v+"px",this._box.style.height=R-A+"px")})}mouseupWindow(r,l){if(!this._active||0!==r.button)return;const p=this._startPos,y=l;if(this.reset(),Ie.suppressClick(),p.x!==y.x||p.y!==y.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Ie.remove(this._box),this._box=null),Ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new f.Event(r,{originalEvent:l}))}}function Fo(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class ba{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const v=new f.pointGeometry(0,0);for(const T of y)v._add(T);return v.div(y.length)}(l),this.touches=Fo(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const y=Fo(p,l);for(const v in this.touches){const T=this.touches[v],A=y[v];(!A||A.dist(T)>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Rl{constructor(r){this.singleTap=new ba(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const y=this.singleTap.touchend(r,l,p);if(y){const v=r.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(v&&T||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class $c{constructor(){this._zoomIn=new Rl({numTouches:1,numTaps:2}),this._zoomOut=new Rl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const y=this._zoomIn.touchend(r,l,p),v=this._zoomOut.touchend(r,l,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Pr={0:1,2:2};class il{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=Ie.mouseButton(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p)if(r.preventDefault(),function(y,v){const T=Pr[v];return void 0===y.buttons||(y.buttons&T)!==T}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(r){this._lastPoint&&Ie.mouseButton(r)===this._eventButton&&(this._moved&&Ie.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fs extends il{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class pc extends il{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class qo extends il{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class wa{constructor(r){this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,l,p)}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const y=Fo(p,l),v=new f.pointGeometry(0,0),T=new f.pointGeometry(0,0);let A=0;for(const N in y){const U=y[N],H=this._touches[N];H&&(v._add(U),T._add(U.sub(H)),A++,y[N]=U)}if(this._touches=y,A<this._minTouches||!T.mag())return;const R=T.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ea{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){if(!this._firstTwoTouches)return;r.preventDefault();const[y,v]=this._firstTwoTouches,T=Zo(p,l,y),A=Zo(p,l,v);if(!T||!A)return;const R=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],R,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,T=Zo(p,l,y),A=Zo(p,l,v);T&&A||(this._active&&Ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zo(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function kl(h,r){return Math.log(h/r)/Math.LN2}class Fl extends Ea{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(kl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kl(this._distance,p),pinchAround:l}}}function Ll(h,r){return 180*h.angleWith(r)/Math.PI}class Ca extends Ea{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ll(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=Ll(r,this._startVector);return Math.abs(p)<l}}function Jr(h){return Math.abs(h.y)>Math.abs(h.x)}class Gc extends Ea{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(r){this._lastPoints=r,Jr(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const y=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(y,v,p.timeStamp),this._valid)return this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5}}gestureBeginsVertically(r,l,p){if(void 0!==this._valid)return this._valid;const y=r.mag()>=2,v=l.mag()>=2;if(!y&&!v)return;if(!y||!v)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=r.y>0==l.y>0;return Jr(r)&&Jr(l)&&T}}const Ks={panStep:100,bearingStep:15,pitchStep:10};class Nr{constructor(){const r=Ks;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,y=0,v=0,T=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),T=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:St,zoom:l?Math.round(R)+l*(r.shiftKey?2:1):R,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function St(h){return h*(2-h)}const ol=4.000244140625;class Da{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&"center"===r.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;let l=r.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=f.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%ol==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Ie.mousePos(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,l=()=>r._terrainEnabled()?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>ol?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==N&&(N=1/N);const U=l(),H=Math.pow(2,U),q="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(q*N))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),y=this._startZoom,v=this._easing;let T,A=!1;if("wheel"===this._type&&y&&v){const R=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),N=v(R);T=f.number(y,p,N),R<1?this._frameId||(this._frameId=!0):A=!0}else T=p,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=f.ease;if(this._prevEase){const p=this._prevEase,y=(f.exported.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),T=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-T*T);l=f.bezier(T,A,.25,1)}return this._prevEase={start:f.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}}class ks{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mc{constructor(){this._tap=new Rl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=l[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ta{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sa{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ol{constructor(r,l,p,y){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ps=h=>h.zoom||h.drag||h.pitch||h.rotate;class sl extends f.Event{}class gc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=f.sub([],l,r);this.radius=f.length(p[2]<0?f.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){f.div(r,r,this.constants),f.normalize(r,r),f.mul$2(r,r,this.constants);const l=f.scale([],r,this.radius);if(l[2]>0){const p=f.scale([],[0,0,1],f.dot(l,[0,0,1])),y=f.scale([],f.normalize([],[l[0],l[1],0]),this.radius),v=f.add([],l,f.scale([],f.sub([],f.add([],y,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function ms(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ia{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fc(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new gc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),f.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[y,v,T]of this._listeners)Ie.addEventListener(y,v,y===f.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[r,l,p]of this._listeners)Ie.removeEventListener(r,l,r===f.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ds(l,r));const y=l.boxZoom=new jc(l,r);this._add("boxZoom",y);const v=new $c,T=new Wo;l.doubleClickZoom=new ks(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const A=new mc;this._add("tapDragZoom",A);const R=l.touchPitch=new Gc;this._add("touchPitch",R);const N=new pc(r),U=new qo(r);l.dragRotate=new Sa(r,N,U),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const H=new fs(r),q=new wa(r);l.dragPan=new Ta(p,H,q),this._add("mousePan",H),this._add("touchPan",q,["touchZoom","touchRotate"]);const Y=new Ca,se=new Fl;l.touchZoomRotate=new Ol(p,se,Y,A),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pl(l));const le=l.scrollZoom=new Da(l,this);this._add("scrollZoom",le,["mousePan"]);const _e=l.keyboard=new Nr;this._add("keyboard",_e);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ee]&&l[ee].enable(r[ee])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ps(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,l,p){for(const y in r)if(y!==p&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p="renderFrame"===r.type,y=p?void 0:r,v={needsRenderFrame:!1},T={},A={},R=r.touches?this._getMapTouches(r.touches):void 0,N=R?Ie.touchPos(this._el,R):p?void 0:Ie.mousePos(this._el,r);for(const{handlerName:q,handler:Y,allowed:se}of this._handlers){if(!Y.isEnabled())continue;let le;this._blockedByActive(A,se,q)?Y.reset():Y[l||r.type]&&(le=Y[l||r.type](r,N,R),this.mergeHandlerResult(v,T,le,q,y),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||Y.isActive())&&(A[q]=Y)}const U={};for(const q in this._previousActiveHandlers)A[q]||(U[q]=y);this._previousActiveHandlers=A,(Object.keys(U).length||ms(v))&&(this._changes.push([v,T,U]),this._triggerRenderFrame()),(Object.keys(A).length||ms(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=v;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(r,l,p,y,v){if(!p)return;f.extend(r,p);const T={handlerName:y,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=T),void 0!==p.panDelta&&(l.drag=T),void 0!==p.pitchDelta&&(l.pitch=T),void 0!==p.bearingDelta&&(l.rotate=T)}_applyChanges(){const r={},l={},p={};for(const[y,v,T]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new f.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(r.around=y.around),void 0!==y.aroundCoord&&(r.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),f.extend(l,v),f.extend(p,T);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const y=this._map,v=y.transform,T=ce=>[ce.x,ce.y,ce.z];if((ce=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!ms(r)){const ce=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ce!==v.zoom&&this._map._update(!0)}if(!ms(r))return this._fireEvents(l,p,!0);let{panDelta:A,zoomDelta:R,bearingDelta:N,pitchDelta:U,around:H,aroundCoord:q,pinchAround:Y}=r;void 0!==Y&&(H=Y),(ce=>l.drag&&!this._eventsInProgress.drag)()&&H&&(this._dragOrigin=T(v.pointCoordinate3D(H)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),H=H||y.transform.centerPoint,N&&(v.bearing+=N),U&&(v.pitch+=U),v._updateCameraState();const se=[0,0,0];if(A){const ce=v.screenPointToMercatorRay(H),me=v.screenPointToMercatorRay(H.sub(A)),xe=this._trackingEllipsoid.projectRay(ce.dir),Se=this._trackingEllipsoid.projectRay(me.dir);se[0]=Se[0]-xe[0],se[1]=Se[1]-xe[1]}const le=v.zoom,_e=[0,0,0];if(R){const ce=T(q||v.pointCoordinate3D(H)),me={dir:f.normalize([],f.sub([],ce,v._camera.position))},xe=v.screenPointToMercatorRay(v.centerPoint);if(me.dir[2]<0){const Se=f.altitudeFromMercatorZ(ce[2],ce[1]),fe=v.rayIntersectionCoordinate(v.pointRayIntersection(v.centerPoint,Se)),Fe=v.zoomDeltaToMovement(T(fe),R)*(xe.dir[2]/me.dir[2]);f.scale(_e,me.dir,Fe)}else if(v._terrainEnabled()){const Se=v.zoomDeltaToMovement(ce,R);f.scale(_e,me.dir,Se)}}const ee=f.add(se,se,_e);v._translateCameraConstrained(ee),R&&Math.abs(v.zoom-le)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const y=ps(this._eventsInProgress),v=ps(r),T={};for(const U in r){const{originalEvent:H}=r[U];this._eventsInProgress[U]||(T[`${U}start`]=H),this._eventsInProgress[U]=r[U]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const U in T)this._fireEvent(U,T[U]);v&&this._fireEvent("move",v.originalEvent);for(const U in r){const{originalEvent:H}=r[U];this._fireEvent(U,H)}const A={};let R;for(const U in this._eventsInProgress){const{handlerName:H,originalEvent:q}=this._eventsInProgress[U];this._handlersById[H].isActive()||(delete this._eventsInProgress[U],R=l[H]||q,A[`${U}end`]=R)}for(const U in A)this._fireEvent(U,A[U]);const N=ps(this._eventsInProgress);if(p&&(y||v)&&!N){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;U?(H(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:R})):(this._map.fire(new f.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new f.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new sl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Nl extends f.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=f.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,f.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(f.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(f.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(f.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,f.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=f.LngLatBounds.convert(r);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=f.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=f.extend(l,r.padding),r}_cameraForBoxAndBearing(r,l,p,y){const v=this._extendCameraOptions(y),T=this.transform,A=T.padding,R=T.project(f.LngLat.convert(r)),N=T.project(f.LngLat.convert(l)),U=R.rotate(-f.degToRad(p)),H=N.rotate(-f.degToRad(p)),q=new f.pointGeometry(Math.max(U.x,H.x),Math.max(U.y,H.y)),Y=new f.pointGeometry(Math.min(U.x,H.x),Math.min(U.y,H.y)),se=q.sub(Y),le=(T.width-(A.left+A.right+v.padding.left+v.padding.right))/se.x,_e=(T.height-(A.top+A.bottom+v.padding.top+v.padding.bottom))/se.y;if(_e<0||le<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ee=Math.min(T.scaleZoom(T.scale*Math.min(le,_e)),v.maxZoom),ce="number"==typeof v.offset.x?new f.pointGeometry(v.offset.x,v.offset.y):f.pointGeometry.convert(v.offset),me=new f.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),xe=ce.add(me).mult(T.scale/T.zoomScale(ee));return{center:T.unproject(R.add(N).div(2).sub(xe)),zoom:ee,bearing:p}}_cameraForBox(r,l,p,y,v){const T=this._extendCameraOptions(v);p=p||0,y=y||0,r=f.LngLat.convert(r),l=f.LngLat.convert(l);const A=this.transform.clone();A.padding=T.padding;const R=this.getFreeCameraOptions(),N=new f.LngLat(.5*(r.lng+l.lng),.5*(r.lat+l.lat)),U=.5*(p+y);if(A._camera.position[2]<f.mercatorZfromAltitude(U,N.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");R.lookAtPoint(N),A.setFreeCameraOptions(R);const H=f.MercatorCoordinate.fromLngLat(r),q=f.MercatorCoordinate.fromLngLat(l),Y=A.pointRayIntersection(A.centerPoint,U),se=[(le=A.rayIntersectionCoordinate(Y)).x,le.y,le.z];var le;const _e=A.screenPointToMercatorRay(A.centerPoint);let ee,ce=0;do{const me=Math.floor(A.zoom),xe=1<<me,Se=Math.min(xe*H.x,xe*q.x),fe=Math.min(xe*H.y,xe*q.y),Fe=Math.max(xe*H.x,xe*q.x),Ke=Math.max(xe*H.y,xe*q.y),st=new Pn([Se,fe,p],[Fe,Ke,y]),Re=Qt.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,me);if(2!==st.intersects(Re)){ee&&(A._camera.position=f.scaleAndAdd([],A._camera.position,_e.dir,-ee),A._updateStateFromCamera());break}const qe=f.sub([],A._camera.position,se);ee=.5*f.length(qe),A._camera.position=f.scaleAndAdd([],A._camera.position,_e.dir,ee);try{A._updateStateFromCamera()}catch(vt){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ce<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(r,l,p){return this._fitInternal(this.cameraForBounds(r,l),l,p)}_raycastElevationBox(r,l){const p=this.transform.elevation;if(!p)return;const y=new f.pointGeometry(r.x,l.y),v=new f.pointGeometry(l.x,r.y),T=p.pointCoordinate(r);if(!T)return;const A=p.pointCoordinate(l);if(!A)return;const R=p.pointCoordinate(y);if(!R)return;const N=p.pointCoordinate(v);if(!N)return;const U=new f.MercatorCoordinate(T[0],T[1]).toLngLat(),H=new f.MercatorCoordinate(A[0],A[1]).toLngLat(),q=new f.MercatorCoordinate(R[0],R[1]).toLngLat(),Y=new f.MercatorCoordinate(N[0],N[1]).toLngLat(),se=Math.min(U.lng,Math.min(H.lng,Math.min(q.lng,Y.lng))),le=Math.min(U.lat,Math.min(H.lat,Math.min(q.lat,Y.lat))),_e=Math.max(U.lng,Math.max(H.lng,Math.max(q.lng,Y.lng))),ee=Math.max(U.lat,Math.max(H.lat,Math.max(q.lat,Y.lat))),ce=Math.min(T[3],Math.min(A[3],Math.min(R[3],N[3]))),me=Math.max(T[3],Math.max(A[3],Math.max(R[3],N[3])));return{minLngLat:new f.LngLat(se,le),maxLngLat:new f.LngLat(_e,ee),minAltitude:ce,maxAltitude:me}}fitScreenCoordinates(r,l,p,y,v){let T,A,R,N;const U=f.pointGeometry.convert(r),H=f.pointGeometry.convert(l),q=this._raycastElevationBox(U,H);if(q)T=q.minLngLat,A=q.maxLngLat,R=q.minAltitude,N=q.maxAltitude;else{if(this.transform.isCornerOffEdge(U,H))return this;T=this.transform.pointLocation(U),A=this.transform.pointLocation(H)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(r)),this.transform.pointLocation(f.pointGeometry.convert(l)),p,y):this._cameraForBox(T,A,R,N,y),y,v)}_fitInternal(r,l,p){return r?(delete(l=f.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=this.transform;let y=!1,v=!1,T=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=f.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(T=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this.fire(new f.Event("movestart",l)).fire(new f.Event("move",l)),y&&this.fire(new f.Event("zoomstart",l)).fire(new f.Event("zoom",l)).fire(new f.Event("zoomend",l)),v&&this.fire(new f.Event("rotatestart",l)).fire(new f.Event("rotate",l)).fire(new f.Event("rotateend",l)),T&&this.fire(new f.Event("pitchstart",l)).fire(new f.Event("pitch",l)).fire(new f.Event("pitchend",l)),this.fire(new f.Event("moveend",l))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){this.stop();const p=this.transform,y=p.zoom,v=p.pitch,T=p.bearing;p.setFreeCameraOptions(r);const A=y!==p.zoom,R=v!==p.pitch,N=T!==p.bearing;return this.fire(new f.Event("movestart",l)).fire(new f.Event("move",l)),A&&this.fire(new f.Event("zoomstart",l)).fire(new f.Event("zoom",l)).fire(new f.Event("zoomend",l)),N&&this.fire(new f.Event("rotatestart",l)).fire(new f.Event("rotate",l)).fire(new f.Event("rotateend",l)),R&&this.fire(new f.Event("pitchstart",l)).fire(new f.Event("pitch",l)).fire(new f.Event("pitchend",l)),this.fire(new f.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=f.extend({offset:[0,0],duration:500,easing:f.ease},r)).animate||!r.essential&&f.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),A=this.getPadding(),R="zoom"in r?+r.zoom:y,N="bearing"in r?this._normalizeBearing(r.bearing,v):v,U="pitch"in r?+r.pitch:T,H="padding"in r?r.padding:p.padding,q=f.pointGeometry.convert(r.offset);let Y=p.centerPoint.add(q);const se=p.pointLocation(Y),le=f.LngLat.convert(r.center||se);this._normalizeCenter(le);const _e=p.project(se),ee=p.project(le).sub(_e),ce=p.zoomScale(R-y);let me,xe;r.around&&(me=f.LngLat.convert(r.around),xe=p.locationPoint(me));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||R!==y,this._rotating=this._rotating||v!==N,this._pitching=this._pitching||U!==T,this._padding=!p.isPaddingEqual(H),this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Se),this._ease(fe=>{if(this._zooming&&(p.zoom=f.number(y,R,fe)),this._rotating&&(p.bearing=f.number(v,N,fe)),this._pitching&&(p.pitch=f.number(T,U,fe)),this._padding&&(p.interpolatePadding(A,H,fe),Y=p.centerPoint.add(q)),me)p.setLocationAtPoint(me,xe);else{const Fe=p.zoomScale(p.zoom-y),Ke=R>y?Math.min(2,ce):Math.max(.5,ce),st=Math.pow(Ke,1-fe),Re=p.unproject(_e.add(ee.mult(fe*st)).mult(Fe));p.setLocationAtPoint(p.renderWorldCopies?Re.wrap():Re,Y)}this._fireMoveEvents(l)},fe=>{p.recenterOnTerrain(),this._afterEase(l,fe)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new f.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new f.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new f.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new f.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new f.Event("move",r)),this._zooming&&this.fire(new f.Event("zoom",r)),this._rotating&&this.fire(new f.Event("rotate",r)),this._pitching&&this.fire(new f.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new f.Event("zoomend",r)),y&&this.fire(new f.Event("rotateend",r)),v&&this.fire(new f.Event("pitchend",r)),this.fire(new f.Event("moveend",r))}flyTo(r,l){if(!r.essential&&f.exported.prefersReducedMotion){const yt=f.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,l)}this.stop(),r=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},r);const p=this.transform,y=this.getZoom(),v=this.getBearing(),T=this.getPitch(),A=this.getPadding(),R="zoom"in r?f.clamp(+r.zoom,p.minZoom,p.maxZoom):y,N="bearing"in r?this._normalizeBearing(r.bearing,v):v,U="pitch"in r?+r.pitch:T,H="padding"in r?r.padding:p.padding,q=p.zoomScale(R-y),Y=f.pointGeometry.convert(r.offset);let se=p.centerPoint.add(Y);const le=p.pointLocation(se),_e=f.LngLat.convert(r.center||le);this._normalizeCenter(_e);const ee=p.project(le),ce=p.project(_e).sub(ee);let me=r.curve;const xe=Math.max(p.width,p.height),Se=xe/q,fe=ce.mag();if("minZoom"in r){const yt=f.clamp(Math.min(r.minZoom,y,R),p.minZoom,p.maxZoom),Mt=xe/p.zoomScale(yt-y);me=Math.sqrt(Mt/fe*2)}const Fe=me*me;function Ke(yt){const Mt=(Se*Se-xe*xe+(yt?-1:1)*Fe*Fe*fe*fe)/(2*(yt?Se:xe)*Fe*fe);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function st(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function Re(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const qe=Ke(0);let vt=function(yt){return Re(qe)/Re(qe+me*yt)},It=function(yt){return xe*((Re(qe)*(st(Mt=qe+me*yt)/Re(Mt))-st(qe))/Fe)/fe;var Mt},Ct=(Ke(1)-qe)/me;if(Math.abs(fe)<1e-6||!isFinite(Ct)){if(Math.abs(xe-Se)<1e-6)return this.easeTo(r,l);const yt=Se<xe?-1:1;Ct=Math.abs(Math.log(Se/xe))/me,It=function(){return 0},vt=function(Mt){return Math.exp(yt*me*Mt)}}return r.duration="duration"in r?+r.duration:1e3*Ct/("screenSpeed"in r?+r.screenSpeed/me:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=v!==N,this._pitching=U!==T,this._padding=!p.isPaddingEqual(H),this._prepareEase(l,!1),this._ease(yt=>{const Mt=yt*Ct,wn=1/vt(Mt);p.zoom=1===yt?R:y+p.scaleZoom(wn),this._rotating&&(p.bearing=f.number(v,N,yt)),this._pitching&&(p.pitch=f.number(T,U,yt)),this._padding&&(p.interpolatePadding(A,H,yt),se=p.centerPoint.add(Y));const nn=1===yt?_e:p.unproject(ee.add(ce.mult(It(Mt))).mult(wn));p.setLocationAtPoint(p.renderWorldCopies?nn.wrap():nn,se),p._updateCenterElevation(),this._fireMoveEvents(l)},()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){!1===p.animate||0===p.duration?(r(1),l()):(this._easeStart=f.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=f.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}}class Yo{constructor(r={}){this.options=r,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=Ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ie.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){Ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.title=p,r.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(r){const p=l.reduce((y,v,T)=>(v.value&&(y+=`${v.key}=${v.value}${T<l.length-1?"&":""}`),y),"?");r.href=`${f.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._sourceCaches;for(const y in l){const v=l[y];if(v.used){const T=v.getSource();T.attribution&&r.indexOf(T.attribution)<0&&r.push(T.attribution)}}r.sort((y,v)=>y.length-v.length),r=r.filter((y,v)=>{for(let T=v+1;T<r.length;T++)if(r[T].indexOf(y)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zl{constructor(){f.bindAll(["_updateLogo"],this),f.bindAll(["_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ie.create("div","mapboxgl-ctrl");const l=Ie.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ie.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class _c{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Aa(h,r,l){if(h=new f.LngLat(h.lng,h.lat),r){const p=new f.LngLat(h.lng-360,h.lat),y=new f.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),T=l.locationPoint(h).distSqr(r),A=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<T&&(A||Math.abs(p.lng-l.center.lng)<v)?h=p:l.locationPoint(y).distSqr(r)<T&&(A||Math.abs(y.lng-l.center.lng)<v)&&(h=y)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const Fs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bl extends f.Evented{constructor(r,l){if(super(),(r instanceof f.window.HTMLElement||l)&&(r=f.extend({element:r},l)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=f.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie.create("div"),this._element.setAttribute("aria-label","Map marker");const y=Ie.createNS("http://www.w3.org/2000/svg","svg"),v=41,T=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${v}px`),y.setAttributeNS(null,"width",`${T}px`),y.setAttributeNS(null,"viewBox",`0 0 ${T} ${v}`);const A=Ie.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const R=Ie.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const N=Ie.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");const U=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const me of U){const xe=Ie.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",me.rx),xe.setAttributeNS(null,"ry",me.ry),N.appendChild(xe)}const H=Ie.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const q=Ie.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(q);const Y=Ie.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const se=Ie.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(se);const le=Ie.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(6.0, 7.0)"),le.setAttributeNS(null,"fill","#FFFFFF");const _e=Ie.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=Ie.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const ce=Ie.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),_e.appendChild(ee),_e.appendChild(ce),R.appendChild(N),R.appendChild(H),R.appendChild(Y),R.appendChild(le),R.appendChild(_e),y.appendChild(R),y.setAttributeNS(null,"height",v*this._scale+"px"),y.setAttributeNS(null,"width",T*this._scale+"px"),this._element.appendChild(y),this._offset=f.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const p=this._element.classList;for(const y in Fs)p.remove(`mapboxgl-marker-anchor-${y}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),Ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=f.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const l=38.1,p=13.5,y=Math.sqrt(Math.pow(p,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-l],"bottom-left":[y,-1*(l-p+y)],"bottom-right":[-y,-1*(l-p+y)],left:[p,-1*(l-p)],right:[-p,-1*(l-p)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_evaluateOpacity(){const r=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(r))return void this._clearFadeTimer();const l=this._map.unproject(r);let p=!1;if(this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const T=v.position.toLngLat();p=T.distanceTo(l)<.9*T.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(l))*(p?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(r){const l=this._map.transform;return!!r&&r.x>=0&&r.x<l.width&&r.y>=0&&r.y<l.height}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Aa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let l="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?l=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),r&&"moveend"!==r.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&Ie.setTransform(this._element,`${Fs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${l}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const r=this._map.transform,l=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&l._rotate(r.angle),"map"===this._pitchAlignment&&(l.y*=Math.cos(r._pitch)),l}getOffset(){return this._offset}setOffset(r){return this._offset=f.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&"auto"!==r?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class yc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=f.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Vl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Xo,HTMLElement:vc,ImageBitmap:gs}=f.window,Ul={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ko(h){h.parentNode&&h.parentNode.removeChild(h)}const _s={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ls{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new pc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new qo({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ie.addEventListener(l,"mousedown",this.mousedown),Ie.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),Ie.addEventListener(l,"touchmove",this.touchmove),Ie.addEventListener(l,"touchend",this.touchend),Ie.addEventListener(l,"touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Ie.disableDrag()}move(r,l){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,l);if(y&&y.bearingDelta&&p.setBearing(p.getBearing()+y.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(r,l);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const r=this.element;Ie.removeEventListener(r,"mousedown",this.mousedown),Ie.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),Ie.removeEventListener(r,"touchmove",this.touchmove),Ie.removeEventListener(r,"touchend",this.touchend),Ie.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){Ie.enableDrag(),Ie.removeEventListener(f.window,"mousemove",this.mousemove),Ie.removeEventListener(f.window,"mouseup",this.mouseup)}mousedown(r){this.down(f.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Ie.mousePos(this.element,r)),Ie.addEventListener(f.window,"mousemove",this.mousemove),Ie.addEventListener(f.window,"mouseup",this.mouseup)}mousemove(r){this.move(r,Ie.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ie.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Ie.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ma={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Lo,yo=0,al=!1;const M={maxWidth:100,unit:"metric"};function D(h,r,l){const p=l&&l.maxWidth||100,y=h._container.getBoundingClientRect().height/2,v=h.unproject([0,y]),T=h.unproject([p,y]),A=v.distanceTo(T);if(l&&"imperial"===l.unit){const R=3.2808*A;R>5280?C(r,p,R/5280,h._getUIString("ScaleControl.Miles"),h):C(r,p,R,h._getUIString("ScaleControl.Feet"),h)}else l&&"nautical"===l.unit?C(r,p,A/1852,h._getUIString("ScaleControl.NauticalMiles"),h):A>=1e3?C(r,p,A/1e3,h._getUIString("ScaleControl.Kilometers"),h):C(r,p,A,h._getUIString("ScaleControl.Meters"),h)}function C(h,r,l,p,y){const v=function(A){const R=Math.pow(10,`${Math.floor(A)}`.length-1);let N=A/R;return N=N>=10?10:N>=5?5:N>=3?3:N>=2?2:N>=1?1:function(U){const H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(N),R*N}(l),T=v/l;y._requestDomTask(()=>{h.style.width=r*T+"px",h.innerHTML=`${v}&nbsp;${p}`})}const k={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},V=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),X={version:f.version,supported:Vt,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends Nl{constructor(h){if(null!=(h=f.extend({},Ul,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ya(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._renderTaskQueue=new _c,this._domRenderTaskQueue=new _c,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},Vl,h.locale),this._clickTolerance=h.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new yc(0),this._requestManager=new f.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=f.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ia(this,h),this._hash=h.hash&&new wi("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,f.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.attributionControl&&this.addControl(new Yo({customAttribution:h.customAttribution})),this._logoControl=new zl,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new f.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new f.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(void 0===r&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){const[r,l]=this._containerDimensions();if(r===this.transform.width&&l===this.transform.height)return this;this._resizeCanvas(r,l),this.transform.resize(r,l),this.painter.resize(Math.ceil(r),Math.ceil(l));const p=!this._moving;return p&&this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),this.fire(new f.Event("resize",h)),p&&this.fire(new f.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(f.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=null==h?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=null==h?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=null==h?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=null==h?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint3D(f.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(f.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(h,r,l){if("mouseenter"===h||"mouseover"===h){let p=!1;return{layer:r,listener:l,delegates:{mousemove:v=>{const T=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];T.length?p||(p=!0,l.call(this,new Ei(h,this,v.originalEvent,{features:T}))):p=!1},mouseout:()=>{p=!1}}}}if("mouseleave"===h||"mouseout"===h){let p=!1;return{layer:r,listener:l,delegates:{mousemove:T=>{(this.getLayer(r)?this.queryRenderedFeatures(T.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,l.call(this,new Ei(h,this,T.originalEvent)))},mouseout:T=>{p&&(p=!1,l.call(this,new Ei(h,this,T.originalEvent)))}}}}{const p=y=>{const v=this.getLayer(r)?this.queryRenderedFeatures(y.point,{layers:[r]}):[];v.length&&(y.features=v,l.call(this,y),delete y.features)};return{layer:r,listener:l,delegates:{[h]:p}}}}on(h,r,l){if(void 0===l)return super.on(h,r);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(h,r,l){if(void 0===l)return super.once(h,r);const p=this._createDelegatedListener(h,r,l);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(h,r,l){return void 0===l?super.off(h,r):(this._delegatedListeners&&this._delegatedListeners[h]&&(p=>{const y=this._delegatedListeners[h];for(let v=0;v<y.length;v++){const T=y[v];if(T.layer===r&&T.listener===l){for(const A in T.delegates)this.off(A,T.delegates[A]);return y.splice(v,1),this}}})(),this)}queryRenderedFeatures(h,r){return this.style?(void 0!==r||void 0===h||h instanceof f.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}queryTerrainElevation(h,r){const l=this.transform.elevation;return l?(r=f.extend({},{exaggerated:!0},r),l.getAtPoint(f.MercatorCoordinate.fromLngLat(h),null,r.exaggerated)):null}setStyle(h,r){return!1!==(r=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(null==r)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),h&&(this.style=new Li(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Li(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,f.ResourceType.Style);f.getJSON(p,(y,v)=>{y?this.fire(new f.ErrorEvent(y)):v&&this._updateDiff(v,r)})}else"object"==typeof h&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){f.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():f.warnOnce("There is no style added to the map.")}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){const r=this.style&&this.style._getSourceCaches(h);if(0!==r.length)return r.every(l=>l.loaded());this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const y=l[p];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(h,r,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:y,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),r instanceof Xo||gs&&r instanceof gs){const{width:A,height:R,data:N}=f.exported.getImageData(r);this.style.addImage(h,{data:new f.RGBAImage({width:A,height:R},N),pixelRatio:l,stretchX:y,stretchY:v,content:T,sdf:p,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:R,data:N}=r,U=r;this.style.addImage(h,{data:new f.RGBAImage({width:A,height:R},new Uint8Array(N)),pixelRatio:l,stretchX:y,stretchY:v,content:T,sdf:p,version:0,userImage:U}),U.onAdd&&U.onAdd(this,h)}}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof Xo||gs&&r instanceof gs?f.exported.getImageData(r):r,{width:y,height:v,data:T}=p;return void 0===y||void 0===v?this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==l.data.width||v!==l.data.height?this.fire(new f.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(T,!(r instanceof Xo||gs&&r instanceof gs)),void this.style.updateImage(h,l))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){f.getImage(this._requestManager.transformRequest(h,f.ResourceType.Image),(l,p)=>{r(l,p instanceof Xo?f.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_containerDimensions(){let h=0,r=0;return this._container&&(h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300),[h,r]}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ie.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ie.create("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Ie.create("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1]);const p=this._controlContainer=Ie.create("div","mapboxgl-control-container",h),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{y[v]=Ie.create("div",`mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=f.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const h=f.extend({},Vt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(f.storeAuthState(r,!0),this.painter=new tl(r,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(r)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.isMoving()&&this.loaded()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=f.exported.now();this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r));let y=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;let v=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,N=f.exported.now();this.style.zoomHistory.update(R,N);const U=new f.EvaluationParameters(R,{now:N,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=U.crossFadingFactor();1===H&&H===this._crossFadingFactor||(v=!0,this._crossFadingFactor=H),this.style.update(U)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const R=f.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const N=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new f.Event("gpu-timing-frame",{cpuTime:R,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(R);this.fire(new f.Event("gpu-timing-layer",{layerTimes:N}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(A||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(y=this._updateAverageElevation(p,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const v=Math.abs(p-y);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),l(y);this._averageElevation.easeTo(y,h,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),l(y)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===f.AUTH_ERR_MSG||401===h.status)){const r=this.painter.context.gl;f.storeAuthState(r,!1),this._logoControl instanceof zl&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function y(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(y(h),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const y=h.length/4;for(let v=0;v<r.length;v++){const T=r[v];let A=0;for(let R=0;R<T.length;R+=4)T[R]===h[R]&&T[R+1]===h[R+1]&&T[R+2]===h[R+2]&&T[R+3]===h[R+3]&&(A+=1);p+=(l[v+2]-l[v+1])*(1-A/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),Ko(this._canvasContainer),Ko(this._controlContainer),Ko(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=f.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,r){f.setCacheLimits(h,r)}get version(){return f.version}},NavigationControl:class{constructor(h){this.options=f.extend({},_s,h),this._container=Ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),Ie.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),Ie.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=Ie.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const h=this._map.getZoom(),r=h===this._map.getMaxZoom(),l=h===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ls(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,r){const l=Ie.create("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){const l=this._map._getUIString(`NavigationControl.${r}`);h.title=l,h.setAttribute("aria-label",l)}},GeolocateControl:class extends f.Evented{constructor(h){super(),this.options=f.extend({},Ma,h),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Bc(this._updateMarkerRotation,20)}onAdd(h){var r;return this._map=h,this._container=Ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Lo?r(Lo):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Lo="denied"!==l.state,r(Lo)}):(Lo=!!f.window.navigator.geolocation,r(Lo)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ie.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yo=0,al=!1}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new f.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),y=f.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),y,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new f.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.getBoundingClientRect().height/2,r=this._map.unproject([0,h]),l=this._map.unproject([100,h]),p=r.distanceTo(l)/100,y=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&al)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ie.create("button","mapboxgl-ctrl-geolocate",this._container),Ie.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===h){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Ie.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ie.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ie.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yo--,al=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yo++,yo>1?(h={maximumAge:6e5,timeout:0},al=!0):(h=this.options.positionOptions,al=!1),this._geolocationWatchID=f.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else f.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&h()}).catch(console.error):h()}_clearWatch(){f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yo,ScaleControl:class{constructor(h){this.options=f.extend({},M,h),f.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){D(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=Ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,D(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof f.window.HTMLElement?this._container=h.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Ie.remove(this._controlContainer),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Ie.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ie.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(h){super(),this.options=f.extend(Object.create(k),h),f.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Ie.remove(this._content),this._container&&(Ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=f.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(f.window.document.createTextNode(h))}setHTML(h){const r=f.window.document.createDocumentFragment(),l=f.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ie.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._container&&this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._container&&this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._container&&this._updateClassList(),r}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ie.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._pos,l=this._container.offsetWidth,p=this._container.offsetHeight;let y;return y=r.y+h.bottom.y<p?["top"]:r.y>this._map.transform.height-p?["bottom"]:[],r.x<l/2?y.push("left"):r.x>this._map.transform.width-l/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),this._container.className=h.join(" ")}_update(h){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Ie.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Ie.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Aa(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h){const r=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),l=function(v){if(v||(v=new f.pointGeometry(0,0)),"number"==typeof v){const T=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new f.pointGeometry(0,0),top:new f.pointGeometry(0,v),"top-left":new f.pointGeometry(T,T),"top-right":new f.pointGeometry(-T,T),bottom:new f.pointGeometry(0,-v),"bottom-left":new f.pointGeometry(T,-T),"bottom-right":new f.pointGeometry(-T,-T),left:new f.pointGeometry(v,0),right:new f.pointGeometry(-v,0)}}if(v instanceof f.pointGeometry||Array.isArray(v)){const T=f.pointGeometry.convert(v);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:f.pointGeometry.convert(v.center||[0,0]),top:f.pointGeometry.convert(v.top||[0,0]),"top-left":f.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":f.pointGeometry.convert(v["top-right"]||[0,0]),bottom:f.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":f.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":f.pointGeometry.convert(v["bottom-right"]||[0,0]),left:f.pointGeometry.convert(v.left||[0,0]),right:f.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(l),y=r.add(l[p]).round();this._map._requestDomTask(()=>{this._container&&p&&Ie.setTransform(this._container,`${Fs[p]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(V);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._content&&(this._content.style.opacity=h),this._tip&&(this._tip.style.opacity=h)}},Marker:Bl,Style:Li,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:nl,Evented:f.Evented,config:f.config,prewarm:function(){ut().acquire(Ce)},clearPrewarmedResources:function(){const h=Xe;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(Ce),Xe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(h){f.config.ACCESS_TOKEN=h},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(h){f.config.API_URL=h},get workerCount(){return Oe.workerCount},set workerCount(h){Oe.workerCount=h},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){f.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){f.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return X}),ue}()},574:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{y:()=>He});var ue=Ve(393),jt=Ve(181),f=Ve(490),it=Ve(554),Pt=Ve(487);var Te=Ve(494);let He=(()=>{class _t{constructor(Tt){this._isScalar=!1,Tt&&(this._subscribe=Tt)}lift(Tt){const et=new _t;return et.source=this,et.operator=Tt,et}subscribe(Tt,et,Qt){const{operator:Pn}=this,zt=function(_t,mt,Tt){if(_t){if(_t instanceof ue.L)return _t;if(_t[jt.b])return _t[jt.b]()}return _t||mt||Tt?new ue.L(_t,mt,Tt):new ue.L(f.c)}(Tt,et,Qt);if(zt.add(Pn?Pn.call(zt,this.source):this.source||Te.v.useDeprecatedSynchronousErrorHandling&&!zt.syncErrorThrowable?this._subscribe(zt):this._trySubscribe(zt)),Te.v.useDeprecatedSynchronousErrorHandling&&zt.syncErrorThrowable&&(zt.syncErrorThrowable=!1,zt.syncErrorThrown))throw zt.syncErrorValue;return zt}_trySubscribe(Tt){try{return this._subscribe(Tt)}catch(et){Te.v.useDeprecatedSynchronousErrorHandling&&(Tt.syncErrorThrown=!0,Tt.syncErrorValue=et),function(_t){for(;_t;){const{closed:mt,destination:Tt,isStopped:et}=_t;if(mt||et)return!1;_t=Tt&&Tt instanceof ue.L?Tt:null}return!0}(Tt)?Tt.error(et):console.warn(et)}}forEach(Tt,et){return new(et=Qe(et))((Qt,Pn)=>{let zt;zt=this.subscribe(Dt=>{try{Tt(Dt)}catch(ni){Pn(ni),zt&&zt.unsubscribe()}},Pn,Qt)})}_subscribe(Tt){const{source:et}=this;return et&&et.subscribe(Tt)}[it.L](){return this}pipe(...Tt){return 0===Tt.length?this:function(_t){return 0===_t.length?Pt.y:1===_t.length?_t[0]:function(Tt){return _t.reduce((et,Qt)=>Qt(et),Tt)}}(Tt)(this)}toPromise(Tt){return new(Tt=Qe(Tt))((et,Qt)=>{let Pn;this.subscribe(zt=>Pn=zt,zt=>Qt(zt),()=>et(Pn))})}}return _t.create=mt=>new _t(mt),_t})();function Qe(_t){if(_t||(_t=Te.v.Promise||Promise),!_t)throw new Error("no Promise impl found");return _t}},490:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{c:()=>jt});var ue=Ve(494),ne=Ve(449);const jt={closed:!0,next(f){},error(f){if(ue.v.useDeprecatedSynchronousErrorHandling)throw f;(0,ne.z)(f)},complete(){}}},709:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{xQ:()=>je,Yc:()=>Pt});var ue=Ve(574),ne=Ve(393),jt=Ve(319),f=Ve(971);class Vt extends jt.w{constructor(He,Qe){super(),this.subject=He,this.subscriber=Qe,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const He=this.subject,Qe=He.observers;if(this.subject=null,!Qe||0===Qe.length||He.isStopped||He.closed)return;const _t=Qe.indexOf(this.subscriber);-1!==_t&&Qe.splice(_t,1)}}var it=Ve(181);class Pt extends ne.L{constructor(He){super(He),this.destination=He}}let je=(()=>{class Te extends ue.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[it.b](){return new Pt(this)}lift(Qe){const _t=new Ie(this,this);return _t.operator=Qe,_t}next(Qe){if(this.closed)throw new f.N;if(!this.isStopped){const{observers:_t}=this,mt=_t.length,Tt=_t.slice();for(let et=0;et<mt;et++)Tt[et].next(Qe)}}error(Qe){if(this.closed)throw new f.N;this.hasError=!0,this.thrownError=Qe,this.isStopped=!0;const{observers:_t}=this,mt=_t.length,Tt=_t.slice();for(let et=0;et<mt;et++)Tt[et].error(Qe);this.observers.length=0}complete(){if(this.closed)throw new f.N;this.isStopped=!0;const{observers:Qe}=this,_t=Qe.length,mt=Qe.slice();for(let Tt=0;Tt<_t;Tt++)mt[Tt].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(Qe){if(this.closed)throw new f.N;return super._trySubscribe(Qe)}_subscribe(Qe){if(this.closed)throw new f.N;return this.hasError?(Qe.error(this.thrownError),jt.w.EMPTY):this.isStopped?(Qe.complete(),jt.w.EMPTY):(this.observers.push(Qe),new Vt(this,Qe))}asObservable(){const Qe=new ue.y;return Qe.source=this,Qe}}return Te.create=(He,Qe)=>new Ie(He,Qe),Te})();class Ie extends je{constructor(He,Qe){super(),this.destination=He,this.source=Qe}next(He){const{destination:Qe}=this;Qe&&Qe.next&&Qe.next(He)}error(He){const{destination:Qe}=this;Qe&&Qe.error&&this.destination.error(He)}complete(){const{destination:He}=this;He&&He.complete&&this.destination.complete()}_subscribe(He){const{source:Qe}=this;return Qe?this.source.subscribe(He):jt.w.EMPTY}}},393:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{L:()=>Pt});var ue=Ve(105),ne=Ve(490),jt=Ve(319),f=Ve(181),Vt=Ve(494),it=Ve(449);class Pt extends jt.w{constructor(Te,He,Qe){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=ne.c;break;case 1:if(!Te){this.destination=ne.c;break}if("object"==typeof Te){Te instanceof Pt?(this.syncErrorThrowable=Te.syncErrorThrowable,this.destination=Te,Te.add(this)):(this.syncErrorThrowable=!0,this.destination=new je(this,Te));break}default:this.syncErrorThrowable=!0,this.destination=new je(this,Te,He,Qe)}}[f.b](){return this}static create(Te,He,Qe){const _t=new Pt(Te,He,Qe);return _t.syncErrorThrowable=!1,_t}next(Te){this.isStopped||this._next(Te)}error(Te){this.isStopped||(this.isStopped=!0,this._error(Te))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(Te){this.destination.next(Te)}_error(Te){this.destination.error(Te),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:Te}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=Te,this}}class je extends Pt{constructor(Te,He,Qe,_t){super(),this._parentSubscriber=Te;let mt,Tt=this;(0,ue.m)(He)?mt=He:He&&(mt=He.next,Qe=He.error,_t=He.complete,He!==ne.c&&(Tt=Object.create(He),(0,ue.m)(Tt.unsubscribe)&&this.add(Tt.unsubscribe.bind(Tt)),Tt.unsubscribe=this.unsubscribe.bind(this))),this._context=Tt,this._next=mt,this._error=Qe,this._complete=_t}next(Te){if(!this.isStopped&&this._next){const{_parentSubscriber:He}=this;Vt.v.useDeprecatedSynchronousErrorHandling&&He.syncErrorThrowable?this.__tryOrSetError(He,this._next,Te)&&this.unsubscribe():this.__tryOrUnsub(this._next,Te)}}error(Te){if(!this.isStopped){const{_parentSubscriber:He}=this,{useDeprecatedSynchronousErrorHandling:Qe}=Vt.v;if(this._error)Qe&&He.syncErrorThrowable?(this.__tryOrSetError(He,this._error,Te),this.unsubscribe()):(this.__tryOrUnsub(this._error,Te),this.unsubscribe());else if(He.syncErrorThrowable)Qe?(He.syncErrorValue=Te,He.syncErrorThrown=!0):(0,it.z)(Te),this.unsubscribe();else{if(this.unsubscribe(),Qe)throw Te;(0,it.z)(Te)}}}complete(){if(!this.isStopped){const{_parentSubscriber:Te}=this;if(this._complete){const He=()=>this._complete.call(this._context);Vt.v.useDeprecatedSynchronousErrorHandling&&Te.syncErrorThrowable?(this.__tryOrSetError(Te,He),this.unsubscribe()):(this.__tryOrUnsub(He),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(Te,He){try{Te.call(this._context,He)}catch(Qe){if(this.unsubscribe(),Vt.v.useDeprecatedSynchronousErrorHandling)throw Qe;(0,it.z)(Qe)}}__tryOrSetError(Te,He,Qe){if(!Vt.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{He.call(this._context,Qe)}catch(_t){return Vt.v.useDeprecatedSynchronousErrorHandling?(Te.syncErrorValue=_t,Te.syncErrorThrown=!0,!0):((0,it.z)(_t),!0)}return!1}_unsubscribe(){const{_parentSubscriber:Te}=this;this._context=null,this._parentSubscriber=null,Te.unsubscribe()}}},319:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{w:()=>it});var ue=Ve(796),ne=Ve(555),jt=Ve(105);const Vt=(()=>{function je(Ie){return Error.call(this),this.message=Ie?`${Ie.length} errors occurred during unsubscription:\n${Ie.map((Te,He)=>`${He+1}) ${Te.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Ie,this}return je.prototype=Object.create(Error.prototype),je})();class it{constructor(Ie){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,Ie&&(this._ctorUnsubscribe=!0,this._unsubscribe=Ie)}unsubscribe(){let Ie;if(this.closed)return;let{_parentOrParents:Te,_ctorUnsubscribe:He,_unsubscribe:Qe,_subscriptions:_t}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,Te instanceof it)Te.remove(this);else if(null!==Te)for(let mt=0;mt<Te.length;++mt)Te[mt].remove(this);if((0,jt.m)(Qe)){He&&(this._unsubscribe=void 0);try{Qe.call(this)}catch(mt){Ie=mt instanceof Vt?Pt(mt.errors):[mt]}}if((0,ue.k)(_t)){let mt=-1,Tt=_t.length;for(;++mt<Tt;){const et=_t[mt];if((0,ne.K)(et))try{et.unsubscribe()}catch(Qt){Ie=Ie||[],Qt instanceof Vt?Ie=Ie.concat(Pt(Qt.errors)):Ie.push(Qt)}}}if(Ie)throw new Vt(Ie)}add(Ie){let Te=Ie;if(!Ie)return it.EMPTY;switch(typeof Ie){case"function":Te=new it(Ie);case"object":if(Te===this||Te.closed||"function"!=typeof Te.unsubscribe)return Te;if(this.closed)return Te.unsubscribe(),Te;if(!(Te instanceof it)){const _t=Te;Te=new it,Te._subscriptions=[_t]}break;default:throw new Error("unrecognized teardown "+Ie+" added to Subscription.")}let{_parentOrParents:He}=Te;if(null===He)Te._parentOrParents=this;else if(He instanceof it){if(He===this)return Te;Te._parentOrParents=[He,this]}else{if(-1!==He.indexOf(this))return Te;He.push(this)}const Qe=this._subscriptions;return null===Qe?this._subscriptions=[Te]:Qe.push(Te),Te}remove(Ie){const Te=this._subscriptions;if(Te){const He=Te.indexOf(Ie);-1!==He&&Te.splice(He,1)}}}var je;function Pt(je){return je.reduce((Ie,Te)=>Ie.concat(Te instanceof Vt?Te.errors:Te),[])}it.EMPTY=((je=new it).closed=!0,je)},494:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{v:()=>ne});let ue=!1;const ne={Promise:void 0,set useDeprecatedSynchronousErrorHandling(jt){if(jt){const f=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+f.stack)}else ue&&console.log("RxJS: Back to a better error behavior. Thank you. <3");ue=jt},get useDeprecatedSynchronousErrorHandling(){return ue}}},345:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{IY:()=>f,Ds:()=>it,ft:()=>je});var ue=Ve(393),ne=Ve(574),jt=Ve(444);class f extends ue.L{constructor(Te){super(),this.parent=Te}_next(Te){this.parent.notifyNext(Te)}_error(Te){this.parent.notifyError(Te),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class it extends ue.L{notifyNext(Te){this.destination.next(Te)}notifyError(Te){this.destination.error(Te)}notifyComplete(){this.destination.complete()}}function je(Ie,Te){if(Te.closed)return;if(Ie instanceof ne.y)return Ie.subscribe(Te);let He;try{He=(0,jt.s)(Ie)(Te)}catch(Qe){Te.error(Qe)}return He}},441:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{c:()=>Vt,N:()=>it});var ue=Ve(709),ne=Ve(574),jt=Ve(319),f=Ve(307);class Vt extends ne.y{constructor(He,Qe){super(),this.source=He,this.subjectFactory=Qe,this._refCount=0,this._isComplete=!1}_subscribe(He){return this.getSubject().subscribe(He)}getSubject(){const He=this._subject;return(!He||He.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let He=this._connection;return He||(this._isComplete=!1,He=this._connection=new jt.w,He.add(this.source.subscribe(new Pt(this.getSubject(),this))),He.closed&&(this._connection=null,He=jt.w.EMPTY)),He}refCount(){return(0,f.x)()(this)}}const it=(()=>{const Te=Vt.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:Te._subscribe},_isComplete:{value:Te._isComplete,writable:!0},getSubject:{value:Te.getSubject},connect:{value:Te.connect},refCount:{value:Te.refCount}}})();class Pt extends ue.Yc{constructor(He,Qe){super(He),this.connectable=Qe}_error(He){this._unsubscribe(),super._error(He)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const He=this.connectable;if(He){this.connectable=null;const Qe=He._connection;He._refCount=0,He._subject=null,He._connection=null,Qe&&Qe.unsubscribe()}}}},402:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{D:()=>Tt});var ue=Ve(574),ne=Ve(444),jt=Ve(319),f=Ve(554),Pt=Ve(87),je=Ve(377),He=Ve(72),Qe=Ve(489);function Tt(et,Qt){return Qt?function(et,Qt){if(null!=et){if(function(et){return et&&"function"==typeof et[f.L]}(et))return function(et,Qt){return new ue.y(Pn=>{const zt=new jt.w;return zt.add(Qt.schedule(()=>{const Dt=et[f.L]();zt.add(Dt.subscribe({next(ni){zt.add(Qt.schedule(()=>Pn.next(ni)))},error(ni){zt.add(Qt.schedule(()=>Pn.error(ni)))},complete(){zt.add(Qt.schedule(()=>Pn.complete()))}}))})),zt})}(et,Qt);if((0,He.t)(et))return function(et,Qt){return new ue.y(Pn=>{const zt=new jt.w;return zt.add(Qt.schedule(()=>et.then(Dt=>{zt.add(Qt.schedule(()=>{Pn.next(Dt),zt.add(Qt.schedule(()=>Pn.complete()))}))},Dt=>{zt.add(Qt.schedule(()=>Pn.error(Dt)))}))),zt})}(et,Qt);if((0,Qe.z)(et))return(0,Pt.r)(et,Qt);if(function(et){return et&&"function"==typeof et[je.hZ]}(et)||"string"==typeof et)return function(et,Qt){if(!et)throw new Error("Iterable cannot be null");return new ue.y(Pn=>{const zt=new jt.w;let Dt;return zt.add(()=>{Dt&&"function"==typeof Dt.return&&Dt.return()}),zt.add(Qt.schedule(()=>{Dt=et[je.hZ](),zt.add(Qt.schedule(function(){if(Pn.closed)return;let ni,Kr;try{const Tn=Dt.next();ni=Tn.value,Kr=Tn.done}catch(Tn){return void Pn.error(Tn)}Kr?Pn.complete():(Pn.next(ni),this.schedule())}))})),zt})}(et,Qt)}throw new TypeError((null!==et&&typeof et||et)+" is not observable")}(et,Qt):et instanceof ue.y?et:new ue.y((0,ne.s)(et))}},693:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{n:()=>f});var ue=Ve(574),ne=Ve(15),jt=Ve(87);function f(Vt,it){return it?(0,jt.r)(Vt,it):new ue.y((0,ne.V)(Vt))}},2:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{U:()=>ne});var ue=Ve(393);function ne(Vt,it){return function(je){if("function"!=typeof Vt)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return je.lift(new jt(Vt,it))}}class jt{constructor(it,Pt){this.project=it,this.thisArg=Pt}call(it,Pt){return Pt.subscribe(new f(it,this.project,this.thisArg))}}class f extends ue.L{constructor(it,Pt,je){super(it),this.project=Pt,this.count=0,this.thisArg=je||this}_next(it){let Pt;try{Pt=this.project.call(this.thisArg,it,this.count++)}catch(je){return void this.destination.error(je)}this.destination.next(Pt)}}},282:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{J:()=>jt});var ue=Ve(773),ne=Ve(487);function jt(f=Number.POSITIVE_INFINITY){return(0,ue.zg)(ne.y,f)}},773:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{zg:()=>f});var ue=Ve(2),ne=Ve(402),jt=Ve(345);function f(je,Ie,Te=Number.POSITIVE_INFINITY){return"function"==typeof Ie?He=>He.pipe(f((Qe,_t)=>(0,ne.D)(je(Qe,_t)).pipe((0,ue.U)((mt,Tt)=>Ie(Qe,mt,_t,Tt))),Te)):("number"==typeof Ie&&(Te=Ie),He=>He.lift(new Vt(je,Te)))}class Vt{constructor(Ie,Te=Number.POSITIVE_INFINITY){this.project=Ie,this.concurrent=Te}call(Ie,Te){return Te.subscribe(new it(Ie,this.project,this.concurrent))}}class it extends jt.Ds{constructor(Ie,Te,He=Number.POSITIVE_INFINITY){super(Ie),this.project=Te,this.concurrent=He,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(Ie){this.active<this.concurrent?this._tryNext(Ie):this.buffer.push(Ie)}_tryNext(Ie){let Te;const He=this.index++;try{Te=this.project(Ie,He)}catch(Qe){return void this.destination.error(Qe)}this.active++,this._innerSub(Te)}_innerSub(Ie){const Te=new jt.IY(this),He=this.destination;He.add(Te);const Qe=(0,jt.ft)(Ie,Te);Qe!==Te&&He.add(Qe)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(Ie){this.destination.next(Ie)}notifyComplete(){const Ie=this.buffer;this.active--,Ie.length>0?this._next(Ie.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},307:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{x:()=>ne});var ue=Ve(393);function ne(){return function(it){return it.lift(new jt(it))}}class jt{constructor(it){this.connectable=it}call(it,Pt){const{connectable:je}=this;je._refCount++;const Ie=new f(it,je),Te=Pt.subscribe(Ie);return Ie.closed||(Ie.connection=je.connect()),Te}}class f extends ue.L{constructor(it,Pt){super(it),this.connectable=Pt}_unsubscribe(){const{connectable:it}=this;if(!it)return void(this.connection=null);this.connectable=null;const Pt=it._refCount;if(Pt<=0)return void(this.connection=null);if(it._refCount=Pt-1,Pt>1)return void(this.connection=null);const{connection:je}=this,Ie=it._connection;this.connection=null,Ie&&(!je||Ie===je)&&Ie.unsubscribe()}}},87:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{r:()=>jt});var ue=Ve(574),ne=Ve(319);function jt(f,Vt){return new ue.y(it=>{const Pt=new ne.w;let je=0;return Pt.add(Vt.schedule(function(){je!==f.length?(it.next(f[je++]),it.closed||Pt.add(this.schedule())):it.complete()})),Pt})}},377:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{hZ:()=>ne});const ne="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},554:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{L:()=>ue});const ue="function"==typeof Symbol&&Symbol.observable||"@@observable"},181:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{b:()=>ue});const ue="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},971:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{N:()=>ne});const ne=(()=>{function jt(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return jt.prototype=Object.create(Error.prototype),jt})()},449:(Un,Rt,Ve)=>{"use strict";function ue(ne){setTimeout(()=>{throw ne},0)}Ve.d(Rt,{z:()=>ue})},487:(Un,Rt,Ve)=>{"use strict";function ue(ne){return ne}Ve.d(Rt,{y:()=>ue})},796:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{k:()=>ue});const ue=Array.isArray||(ne=>ne&&"number"==typeof ne.length)},489:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{z:()=>ue});const ue=ne=>ne&&"number"==typeof ne.length&&"function"!=typeof ne},105:(Un,Rt,Ve)=>{"use strict";function ue(ne){return"function"==typeof ne}Ve.d(Rt,{m:()=>ue})},555:(Un,Rt,Ve)=>{"use strict";function ue(ne){return null!==ne&&"object"==typeof ne}Ve.d(Rt,{K:()=>ue})},72:(Un,Rt,Ve)=>{"use strict";function ue(ne){return!!ne&&"function"!=typeof ne.subscribe&&"function"==typeof ne.then}Ve.d(Rt,{t:()=>ue})},869:(Un,Rt,Ve)=>{"use strict";function ue(ne){return ne&&"function"==typeof ne.schedule}Ve.d(Rt,{K:()=>ue})},444:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{s:()=>He});var ue=Ve(15),ne=Ve(449),f=Ve(377),it=Ve(554),je=Ve(489),Ie=Ve(72),Te=Ve(555);const He=Qe=>{if(Qe&&"function"==typeof Qe[it.L])return(Qe=>_t=>{const mt=Qe[it.L]();if("function"!=typeof mt.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return mt.subscribe(_t)})(Qe);if((0,je.z)(Qe))return(0,ue.V)(Qe);if((0,Ie.t)(Qe))return(Qe=>_t=>(Qe.then(mt=>{_t.closed||(_t.next(mt),_t.complete())},mt=>_t.error(mt)).then(null,ne.z),_t))(Qe);if(Qe&&"function"==typeof Qe[f.hZ])return(Qe=>_t=>{const mt=Qe[f.hZ]();for(;;){let Tt;try{Tt=mt.next()}catch(et){return _t.error(et),_t}if(Tt.done){_t.complete();break}if(_t.next(Tt.value),_t.closed)break}return"function"==typeof mt.return&&_t.add(()=>{mt.return&&mt.return()}),_t})(Qe);{const mt=`You provided ${(0,Te.K)(Qe)?"an invalid object":`'${Qe}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(mt)}}},15:(Un,Rt,Ve)=>{"use strict";Ve.d(Rt,{V:()=>ue});const ue=ne=>jt=>{for(let f=0,Vt=ne.length;f<Vt&&!jt.closed;f++)jt.next(ne[f]);jt.complete()}},137:(Un,Rt,Ve)=>{"use strict";var ue=Ve(583),ne=Ve(639);class jt extends ue.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class f extends jt{static makeCurrent(){(0,ue.HT)(new f)}onAndCancel(pe,ae,De){return pe.addEventListener(ae,De,!1),()=>{pe.removeEventListener(ae,De,!1)}}dispatchEvent(pe,ae){pe.dispatchEvent(ae)}remove(pe){pe.parentNode&&pe.parentNode.removeChild(pe)}createElement(pe,ae){return(ae=ae||this.getDefaultDocument()).createElement(pe)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(pe){return pe.nodeType===Node.ELEMENT_NODE}isShadowRoot(pe){return pe instanceof DocumentFragment}getGlobalEventTarget(pe,ae){return"window"===ae?window:"document"===ae?pe:"body"===ae?pe.body:null}getBaseHref(pe){const ae=(Vt=Vt||document.querySelector("base"),Vt?Vt.getAttribute("href"):null);return null==ae?null:function(we){Pt=Pt||document.createElement("a"),Pt.setAttribute("href",we);const pe=Pt.pathname;return"/"===pe.charAt(0)?pe:`/${pe}`}(ae)}resetBaseElement(){Vt=null}getUserAgent(){return window.navigator.userAgent}getCookie(pe){return(0,ue.Mx)(document.cookie,pe)}}let Pt,Vt=null;const Ie=new ne.OlP("TRANSITION_ID"),He=[{provide:ne.ip1,useFactory:function(we,pe,ae){return()=>{ae.get(ne.CZH).donePromise.then(()=>{const De=(0,ue.q)(),Je=pe.querySelectorAll(`style[ng-transition="${we}"]`);for(let Ot=0;Ot<Je.length;Ot++)De.remove(Je[Ot])})}},deps:[Ie,ue.K0,ne.zs3],multi:!0}];class Qe{static init(){(0,ne.VLi)(new Qe)}addToWindow(pe){ne.dqk.getAngularTestability=(De,Je=!0)=>{const Ot=pe.findTestabilityInTree(De,Je);if(null==Ot)throw new Error("Could not find testability for element.");return Ot},ne.dqk.getAllAngularTestabilities=()=>pe.getAllTestabilities(),ne.dqk.getAllAngularRootElements=()=>pe.getAllRootElements(),ne.dqk.frameworkStabilizers||(ne.dqk.frameworkStabilizers=[]),ne.dqk.frameworkStabilizers.push(De=>{const Je=ne.dqk.getAllAngularTestabilities();let Ot=Je.length,Et=!1;const kn=function(yi){Et=Et||yi,Ot--,0==Ot&&De(Et)};Je.forEach(function(yi){yi.whenStable(kn)})})}findTestabilityInTree(pe,ae,De){if(null==ae)return null;const Je=pe.getTestability(ae);return null!=Je?Je:De?(0,ue.q)().isShadowRoot(ae)?this.findTestabilityInTree(pe,ae.host,!0):this.findTestabilityInTree(pe,ae.parentElement,!0):null}}let _t=(()=>{class we{build(){return new XMLHttpRequest}}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();const Hn=new ne.OlP("EventManagerPlugins");let Jt=(()=>{class we{constructor(ae,De){this._zone=De,this._eventNameToPlugin=new Map,ae.forEach(Je=>Je.manager=this),this._plugins=ae.slice().reverse()}addEventListener(ae,De,Je){return this._findPluginFor(De).addEventListener(ae,De,Je)}addGlobalEventListener(ae,De,Je){return this._findPluginFor(De).addGlobalEventListener(ae,De,Je)}getZone(){return this._zone}_findPluginFor(ae){const De=this._eventNameToPlugin.get(ae);if(De)return De;const Je=this._plugins;for(let Ot=0;Ot<Je.length;Ot++){const Et=Je[Ot];if(Et.supports(ae))return this._eventNameToPlugin.set(ae,Et),Et}throw new Error(`No event manager plugin found for event ${ae}`)}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(Hn),ne.LFG(ne.R0b))},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();class In{constructor(pe){this._doc=pe}addGlobalEventListener(pe,ae,De){const Je=(0,ue.q)().getGlobalEventTarget(this._doc,pe);if(!Je)throw new Error(`Unsupported event target ${Je} for event ${ae}`);return this.addEventListener(Je,ae,De)}}let pt=(()=>{class we{constructor(){this._stylesSet=new Set}addStyles(ae){const De=new Set;ae.forEach(Je=>{this._stylesSet.has(Je)||(this._stylesSet.add(Je),De.add(Je))}),this.onStylesAdded(De)}onStylesAdded(ae){}getAllStyles(){return Array.from(this._stylesSet)}}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})(),Rn=(()=>{class we extends pt{constructor(ae){super(),this._doc=ae,this._hostNodes=new Map,this._hostNodes.set(ae.head,[])}_addStylesToHost(ae,De,Je){ae.forEach(Ot=>{const Et=this._doc.createElement("style");Et.textContent=Ot,Je.push(De.appendChild(Et))})}addHost(ae){const De=[];this._addStylesToHost(this._stylesSet,ae,De),this._hostNodes.set(ae,De)}removeHost(ae){const De=this._hostNodes.get(ae);De&&De.forEach(Ur),this._hostNodes.delete(ae)}onStylesAdded(ae){this._hostNodes.forEach((De,Je)=>{this._addStylesToHost(ae,Je,De)})}ngOnDestroy(){this._hostNodes.forEach(ae=>ae.forEach(Ur))}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(ue.K0))},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();function Ur(we){(0,ue.q)().remove(we)}const er={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},fr=/%COMP%/g;function mi(we,pe,ae){for(let De=0;De<pe.length;De++){let Je=pe[De];Array.isArray(Je)?mi(we,Je,ae):(Je=Je.replace(fr,we),ae.push(Je))}return ae}function Lr(we){return pe=>{if("__ngUnwrap__"===pe)return we;!1===we(pe)&&(pe.preventDefault(),pe.returnValue=!1)}}let an=(()=>{class we{constructor(ae,De,Je){this.eventManager=ae,this.sharedStylesHost=De,this.appId=Je,this.rendererByCompId=new Map,this.defaultRenderer=new eo(ae)}createRenderer(ae,De){if(!ae||!De)return this.defaultRenderer;switch(De.encapsulation){case ne.ifc.Emulated:{let Je=this.rendererByCompId.get(De.id);return Je||(Je=new to(this.eventManager,this.sharedStylesHost,De,this.appId),this.rendererByCompId.set(De.id,Je)),Je.applyToHost(ae),Je}case 1:case ne.ifc.ShadowDom:return new nr(this.eventManager,this.sharedStylesHost,ae,De);default:if(!this.rendererByCompId.has(De.id)){const Je=mi(De.id,De.styles,[]);this.sharedStylesHost.addStyles(Je),this.rendererByCompId.set(De.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(Jt),ne.LFG(Rn),ne.LFG(ne.AFp))},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();class eo{constructor(pe){this.eventManager=pe,this.data=Object.create(null)}destroy(){}createElement(pe,ae){return ae?document.createElementNS(er[ae]||ae,pe):document.createElement(pe)}createComment(pe){return document.createComment(pe)}createText(pe){return document.createTextNode(pe)}appendChild(pe,ae){pe.appendChild(ae)}insertBefore(pe,ae,De){pe&&pe.insertBefore(ae,De)}removeChild(pe,ae){pe&&pe.removeChild(ae)}selectRootElement(pe,ae){let De="string"==typeof pe?document.querySelector(pe):pe;if(!De)throw new Error(`The selector "${pe}" did not match any elements`);return ae||(De.textContent=""),De}parentNode(pe){return pe.parentNode}nextSibling(pe){return pe.nextSibling}setAttribute(pe,ae,De,Je){if(Je){ae=Je+":"+ae;const Ot=er[Je];Ot?pe.setAttributeNS(Ot,ae,De):pe.setAttribute(ae,De)}else pe.setAttribute(ae,De)}removeAttribute(pe,ae,De){if(De){const Je=er[De];Je?pe.removeAttributeNS(Je,ae):pe.removeAttribute(`${De}:${ae}`)}else pe.removeAttribute(ae)}addClass(pe,ae){pe.classList.add(ae)}removeClass(pe,ae){pe.classList.remove(ae)}setStyle(pe,ae,De,Je){Je&(ne.JOm.DashCase|ne.JOm.Important)?pe.style.setProperty(ae,De,Je&ne.JOm.Important?"important":""):pe.style[ae]=De}removeStyle(pe,ae,De){De&ne.JOm.DashCase?pe.style.removeProperty(ae):pe.style[ae]=""}setProperty(pe,ae,De){pe[ae]=De}setValue(pe,ae){pe.nodeValue=ae}listen(pe,ae,De){return"string"==typeof pe?this.eventManager.addGlobalEventListener(pe,ae,Lr(De)):this.eventManager.addEventListener(pe,ae,Lr(De))}}class to extends eo{constructor(pe,ae,De,Je){super(pe),this.component=De;const Ot=mi(Je+"-"+De.id,De.styles,[]);ae.addStyles(Ot),this.contentAttr="_ngcontent-%COMP%".replace(fr,Je+"-"+De.id),this.hostAttr="_nghost-%COMP%".replace(fr,Je+"-"+De.id)}applyToHost(pe){super.setAttribute(pe,this.hostAttr,"")}createElement(pe,ae){const De=super.createElement(pe,ae);return super.setAttribute(De,this.contentAttr,""),De}}class nr extends eo{constructor(pe,ae,De,Je){super(pe),this.sharedStylesHost=ae,this.hostEl=De,this.shadowRoot=De.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Ot=mi(Je.id,Je.styles,[]);for(let Et=0;Et<Ot.length;Et++){const kn=document.createElement("style");kn.textContent=Ot[Et],this.shadowRoot.appendChild(kn)}}nodeOrShadowRoot(pe){return pe===this.hostEl?this.shadowRoot:pe}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(pe,ae){return super.appendChild(this.nodeOrShadowRoot(pe),ae)}insertBefore(pe,ae,De){return super.insertBefore(this.nodeOrShadowRoot(pe),ae,De)}removeChild(pe,ae){return super.removeChild(this.nodeOrShadowRoot(pe),ae)}parentNode(pe){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(pe)))}}let Or=(()=>{class we extends In{constructor(ae){super(ae)}supports(ae){return!0}addEventListener(ae,De,Je){return ae.addEventListener(De,Je,!1),()=>this.removeEventListener(ae,De,Je)}removeEventListener(ae,De,Je){return ae.removeEventListener(De,Je)}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(ue.K0))},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();const Kn=["alt","control","meta","shift"],qt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},oi={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},os={alt:we=>we.altKey,control:we=>we.ctrlKey,meta:we=>we.metaKey,shift:we=>we.shiftKey};let Kt=(()=>{class we extends In{constructor(ae){super(ae)}supports(ae){return null!=we.parseEventName(ae)}addEventListener(ae,De,Je){const Ot=we.parseEventName(De),Et=we.eventCallback(Ot.fullKey,Je,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,ue.q)().onAndCancel(ae,Ot.domEventName,Et))}static parseEventName(ae){const De=ae.toLowerCase().split("."),Je=De.shift();if(0===De.length||"keydown"!==Je&&"keyup"!==Je)return null;const Ot=we._normalizeKey(De.pop());let Et="";if(Kn.forEach(yi=>{const vi=De.indexOf(yi);vi>-1&&(De.splice(vi,1),Et+=yi+".")}),Et+=Ot,0!=De.length||0===Ot.length)return null;const kn={};return kn.domEventName=Je,kn.fullKey=Et,kn}static getEventFullKey(ae){let De="",Je=function(we){let pe=we.key;if(null==pe){if(pe=we.keyIdentifier,null==pe)return"Unidentified";pe.startsWith("U+")&&(pe=String.fromCharCode(parseInt(pe.substring(2),16)),3===we.location&&oi.hasOwnProperty(pe)&&(pe=oi[pe]))}return qt[pe]||pe}(ae);return Je=Je.toLowerCase()," "===Je?Je="space":"."===Je&&(Je="dot"),Kn.forEach(Ot=>{Ot!=Je&&os[Ot](ae)&&(De+=Ot+".")}),De+=Je,De}static eventCallback(ae,De,Je){return Ot=>{we.getEventFullKey(Ot)===ae&&Je.runGuarded(()=>De(Ot))}}static _normalizeKey(ae){switch(ae){case"esc":return"escape";default:return ae}}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(ue.K0))},we.\u0275prov=ne.Yz7({token:we,factory:we.\u0275fac}),we})();const ie=(0,ne.eFA)(ne._c5,"browser",[{provide:ne.Lbi,useValue:ue.bD},{provide:ne.g9A,useValue:function(){f.makeCurrent(),Qe.init()},multi:!0},{provide:ue.K0,useFactory:function(){return(0,ne.RDi)(document),document},deps:[]}]),he=[[],{provide:ne.zSh,useValue:"root"},{provide:ne.qLn,useFactory:function(){return new ne.qLn},deps:[]},{provide:Hn,useClass:Or,multi:!0,deps:[ue.K0,ne.R0b,ne.Lbi]},{provide:Hn,useClass:Kt,multi:!0,deps:[ue.K0]},[],{provide:an,useClass:an,deps:[Jt,Rn,ne.AFp]},{provide:ne.FYo,useExisting:an},{provide:pt,useExisting:Rn},{provide:Rn,useClass:Rn,deps:[ue.K0]},{provide:ne.dDg,useClass:ne.dDg,deps:[ne.R0b]},{provide:Jt,useClass:Jt,deps:[Hn,ne.R0b]},{provide:ue.JF,useClass:_t,deps:[]},[]];let ge=(()=>{class we{constructor(ae){if(ae)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ae){return{ngModule:we,providers:[{provide:ne.AFp,useValue:ae.appId},{provide:Ie,useExisting:ne.AFp},He]}}}return we.\u0275fac=function(ae){return new(ae||we)(ne.LFG(we,12))},we.\u0275mod=ne.oAB({type:we}),we.\u0275inj=ne.cJS({providers:he,imports:[ue.ez,ne.hGG]}),we})();"undefined"!=typeof window&&window;var xn=Ve(353);const Wt=[{path:"mapas",loadChildren:()=>Ve.e(496).then(Ve.bind(Ve,496)).then(we=>we.MapasModule)},{path:"**",redirectTo:"mapas"}];let hr=(()=>{class we{}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275mod=ne.oAB({type:we}),we.\u0275inj=ne.cJS({imports:[[xn.Bz.forRoot(Wt)],xn.Bz]}),we})();var Ri=Ve(958);const Sr=function(we){return[we]};function Vn(we,pe){if(1&we&&(ne.TgZ(0,"li",2),ne._uU(1),ne.qZA()),2&we){const ae=pe.$implicit;ne.Q6J("routerLink",ne.VKq(2,Sr,ae.ruta)),ne.xp6(1),ne.hij(" ",ae.nombre," ")}}let ln=(()=>{class we{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"FullScreen"},{ruta:"/mapas/zoom-range",nombre:"Zoom Range"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275cmp=ne.Xpm({type:we,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["class","list-group-item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(ae,De){1&ae&&(ne.TgZ(0,"ul",0),ne.YNc(1,Vn,2,4,"li",1),ne.qZA()),2&ae&&(ne.xp6(1),ne.Q6J("ngForOf",De.menuItems))},directives:[ue.sg,xn.Od,xn.rH],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),we})(),ki=(()=>{class we{ngOnInit(){Ri.accessToken="pk.eyJ1Ijoic29yb2RyaWd1ZXoiLCJhIjoiY2t2ZnZuOXBmOXo2YTJ3b2Y4OTJsdGE0MCJ9.ZLPLMK9BeWanuL9FVWBZqA"}}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275cmp=ne.Xpm({type:we,selectors:[["app-root"]],decls:2,vars:0,template:function(ae,De){1&ae&&(ne._UZ(0,"app-menu"),ne._UZ(1,"router-outlet"))},directives:[ln,xn.lC],styles:[""]}),we})(),Gr=(()=>{class we{}return we.\u0275fac=function(ae){return new(ae||we)},we.\u0275mod=ne.oAB({type:we,bootstrap:[ki]}),we.\u0275inj=ne.cJS({providers:[],imports:[[ge,hr]]}),we})();(0,ne.G48)(),ie().bootstrapModule(Gr).catch(we=>console.error(we))}},Un=>{Un(Un.s=137)}]);